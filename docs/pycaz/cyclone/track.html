<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 12.3.1"/>
    <title>pycaz.cyclone.track API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent }nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .pdoc-alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:1rem center;margin-bottom:1rem;}.pdoc .pdoc-alert > *:last-child{margin-bottom:0;}.pdoc .pdoc-alert-note {color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--code);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>            <a class="pdoc-button module-list-button" href="../cyclone.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                &nbsp;pycaz.cyclone</a>


            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>



        <h2>API Documentation</h2>
            <ul class="memberlist">
            <li>
                    <a class="class" href="#Record">Record</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#Record.__init__">Record</a>
                        </li>
                        <li>
                                <a class="function" href="#Record.gen_radial_fields">gen_radial_fields</a>
                        </li>
                        <li>
                                <a class="function" href="#Record.calc_rmax">calc_rmax</a>
                        </li>
                        <li>
                                <a class="function" href="#Record.calculate_wind">calculate_wind</a>
                        </li>
                        <li>
                                <a class="function" href="#Record.calculate_pressure">calculate_pressure</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#Track">Track</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#Track.__init__">Track</a>
                        </li>
                        <li>
                                <a class="function" href="#Track.sort">sort</a>
                        </li>
                        <li>
                                <a class="function" href="#Track.calc_translation">calc_translation</a>
                        </li>
                        <li>
                                <a class="function" href="#Track.append">append</a>
                        </li>
                        <li>
                                <a class="function" href="#Track.interpolate">interpolate</a>
                        </li>
                        <li>
                                <a class="function" href="#Track.plot">plot</a>
                        </li>
                </ul>

            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
<a href="./../../pycaz.html">pycaz</a><wbr>.<a href="./../cyclone.html">cyclone</a><wbr>.track    </h1>

                
                        <input id="mod-track-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-track-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">   1</span></a><span class="ch">#!/usr/bin/env python</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">   2</span></a><span class="c1"># -*- coding: utf-8 -*-</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos">   3</span></a>
</span><span id="L-4"><a href="#L-4"><span class="linenos">   4</span></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos">   5</span></a><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos">   6</span></a><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos">   7</span></a><span class="kn">from</span> <span class="nn">scipy.interpolate</span> <span class="kn">import</span> <span class="n">interp1d</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos">   8</span></a><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos">   9</span></a><span class="kn">import</span> <span class="nn">cartopy.crs</span> <span class="k">as</span> <span class="nn">ccrs</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos">  10</span></a><span class="kn">from</span> <span class="nn">pycaz.cyclone.model</span> <span class="kn">import</span> <span class="n">coriolis</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos">  11</span></a><span class="kn">from</span> <span class="nn">pycaz.cyclone.model</span> <span class="kn">import</span> <span class="n">calc_rmax_e11</span><span class="p">,</span> <span class="n">calc_rmax_h80</span><span class="p">,</span> <span class="n">calc_rmax_s02</span><span class="p">,</span> <span class="n">calc_rmax_w04</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos">  12</span></a><span class="kn">from</span> <span class="nn">pycaz.cyclone.model</span> <span class="kn">import</span> <span class="n">calc_holland_B</span><span class="p">,</span> <span class="n">calc_holland_B_full</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos">  13</span></a><span class="kn">from</span> <span class="nn">pycaz.cyclone.model</span> <span class="kn">import</span> <span class="n">calc_mslp_h80</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos">  14</span></a><span class="kn">from</span> <span class="nn">pycaz.cyclone.model</span> <span class="kn">import</span> <span class="n">calc_vcirc_h80</span><span class="p">,</span> <span class="n">calc_vcirc_h80c</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos">  15</span></a><span class="kn">from</span> <span class="nn">pycaz.cyclone.model</span> <span class="kn">import</span> <span class="n">calc_vcirc_j92</span><span class="p">,</span> <span class="n">calc_vcirc_w06</span><span class="p">,</span> <span class="n">calc_vcirc_m16</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos">  16</span></a><span class="kn">from</span> <span class="nn">pycaz.cyclone.model</span> <span class="kn">import</span> <span class="n">calc_vcirc_e04</span><span class="p">,</span> <span class="n">calc_vcirc_e11</span>
</span><span id="L-17"><a href="#L-17"><span class="linenos">  17</span></a><span class="kn">from</span> <span class="nn">pycaz.convert</span> <span class="kn">import</span> <span class="n">gc_distance</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos">  18</span></a>
</span><span id="L-19"><a href="#L-19"><span class="linenos">  19</span></a><span class="k">class</span> <span class="nc">Record</span><span class="p">(</span><span class="nb">dict</span><span class="p">):</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos">  20</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos">  21</span></a><span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="L-22"><a href="#L-22"><span class="linenos">  22</span></a><span class="sd">        A recrod object takes keyworded input as arguments by entending the python</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos">  23</span></a><span class="sd">        dictionary object. </span>
</span><span id="L-24"><a href="#L-24"><span class="linenos">  24</span></a>
</span><span id="L-25"><a href="#L-25"><span class="linenos">  25</span></a><span class="sd">        The required fields are - </span>
</span><span id="L-26"><a href="#L-26"><span class="linenos">  26</span></a><span class="sd">            : timestamp:    datetime, pd.Datetimeindex</span>
</span><span id="L-27"><a href="#L-27"><span class="linenos">  27</span></a><span class="sd">            : lon:          longitude, 0-359, float</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos">  28</span></a><span class="sd">            : lat:          latitude, -180, 180, float</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos">  29</span></a><span class="sd">            : mslp:         central pressure, Pa, float</span>
</span><span id="L-30"><a href="#L-30"><span class="linenos">  30</span></a><span class="sd">            : vmax:         maximum velocity, m/s, float</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos">  31</span></a><span class="sd">        </span>
</span><span id="L-32"><a href="#L-32"><span class="linenos">  32</span></a><span class="sd">        The optional (but recommended) fields are - </span>
</span><span id="L-33"><a href="#L-33"><span class="linenos">  33</span></a><span class="sd">            : rmax:         radius of maximum wind, m, float</span>
</span><span id="L-34"><a href="#L-34"><span class="linenos">  34</span></a><span class="sd">            : vinfo:        list of velocity, m/s, list or numpy array, size n</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos">  35</span></a><span class="sd">            : radinfo:      2d list of radial info, m, list or numpy array, size nx4</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos">  36</span></a><span class="sd">            : ustorm:       speed of storm in x-direction, m/s</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos">  37</span></a><span class="sd">            : vstorm:       speed of strom in y-direction, m/s</span>
</span><span id="L-38"><a href="#L-38"><span class="linenos">  38</span></a><span class="sd">        &#39;&#39;&#39;</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos">  39</span></a>        <span class="n">req_kw</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">,</span> <span class="s1">&#39;lon&#39;</span><span class="p">,</span> <span class="s1">&#39;lat&#39;</span><span class="p">,</span> <span class="s1">&#39;mslp&#39;</span><span class="p">,</span> <span class="s1">&#39;vmax&#39;</span><span class="p">]</span>
</span><span id="L-40"><a href="#L-40"><span class="linenos">  40</span></a>        <span class="n">opt_kw</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;rmax&#39;</span><span class="p">,</span> <span class="s1">&#39;vinfo&#39;</span><span class="p">,</span> <span class="s1">&#39;radinfo&#39;</span><span class="p">,</span> <span class="s1">&#39;ustorm&#39;</span><span class="p">,</span> <span class="s1">&#39;vstorm&#39;</span><span class="p">]</span>
</span><span id="L-41"><a href="#L-41"><span class="linenos">  41</span></a>
</span><span id="L-42"><a href="#L-42"><span class="linenos">  42</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-43"><a href="#L-43"><span class="linenos">  43</span></a>            <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">([</span><span class="n">kw</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">for</span> <span class="n">kw</span> <span class="ow">in</span> <span class="n">req_kw</span><span class="p">])</span>
</span><span id="L-44"><a href="#L-44"><span class="linenos">  44</span></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="L-45"><a href="#L-45"><span class="linenos">  45</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;All required fields are not provided&#39;</span><span class="p">)</span>
</span><span id="L-46"><a href="#L-46"><span class="linenos">  46</span></a>
</span><span id="L-47"><a href="#L-47"><span class="linenos">  47</span></a>        <span class="k">for</span> <span class="n">kw</span> <span class="ow">in</span> <span class="n">opt_kw</span><span class="p">:</span>
</span><span id="L-48"><a href="#L-48"><span class="linenos">  48</span></a>            <span class="k">if</span> <span class="n">kw</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
</span><span id="L-49"><a href="#L-49"><span class="linenos">  49</span></a>                <span class="n">kwargs</span><span class="p">[</span><span class="n">kw</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
</span><span id="L-50"><a href="#L-50"><span class="linenos">  50</span></a>
</span><span id="L-51"><a href="#L-51"><span class="linenos">  51</span></a>        <span class="c1"># Correcting datetime and convert to pandas datetime object</span>
</span><span id="L-52"><a href="#L-52"><span class="linenos">  52</span></a>        <span class="n">allowed_datetime</span> <span class="o">=</span> <span class="p">(</span><span class="n">datetime</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
</span><span id="L-53"><a href="#L-53"><span class="linenos">  53</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-54"><a href="#L-54"><span class="linenos">  54</span></a>            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">],</span> <span class="n">allowed_datetime</span><span class="p">)</span>
</span><span id="L-55"><a href="#L-55"><span class="linenos">  55</span></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="L-56"><a href="#L-56"><span class="linenos">  56</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;timestamp must be parsable by pd.to_datetime&#39;</span><span class="p">)</span>
</span><span id="L-57"><a href="#L-57"><span class="linenos">  57</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-58"><a href="#L-58"><span class="linenos">  58</span></a>            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">])</span>
</span><span id="L-59"><a href="#L-59"><span class="linenos">  59</span></a>
</span><span id="L-60"><a href="#L-60"><span class="linenos">  60</span></a>        <span class="c1"># Initiate the dictionary</span>
</span><span id="L-61"><a href="#L-61"><span class="linenos">  61</span></a>        <span class="nb">super</span><span class="p">(</span><span class="n">Record</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="L-62"><a href="#L-62"><span class="linenos">  62</span></a>    
</span><span id="L-63"><a href="#L-63"><span class="linenos">  63</span></a>    <span class="k">def</span> <span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
</span><span id="L-64"><a href="#L-64"><span class="linenos">  64</span></a>        <span class="nb">super</span><span class="p">(</span><span class="n">Record</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__setitem__</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</span><span id="L-65"><a href="#L-65"><span class="linenos">  65</span></a>
</span><span id="L-66"><a href="#L-66"><span class="linenos">  66</span></a>    <span class="nd">@property</span>
</span><span id="L-67"><a href="#L-67"><span class="linenos">  67</span></a>    <span class="k">def</span> <span class="nf">center</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-68"><a href="#L-68"><span class="linenos">  68</span></a>        <span class="k">return</span><span class="p">((</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">]))</span>
</span><span id="L-69"><a href="#L-69"><span class="linenos">  69</span></a>
</span><span id="L-70"><a href="#L-70"><span class="linenos">  70</span></a>    <span class="k">def</span> <span class="nf">gen_radial_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fraction</span><span class="o">=</span><span class="mf">0.56</span><span class="p">,</span> <span class="n">angle</span><span class="o">=</span><span class="mf">19.2</span><span class="p">,</span> <span class="n">swrf</span><span class="o">=</span><span class="mf">0.9</span><span class="p">):</span>
</span><span id="L-71"><a href="#L-71"><span class="linenos">  71</span></a><span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="L-72"><a href="#L-72"><span class="linenos">  72</span></a><span class="sd">        Generate the interpolator for radial field for exisiting radial informations.</span>
</span><span id="L-73"><a href="#L-73"><span class="linenos">  73</span></a><span class="sd">        To get correct radial field, atmospheric background is removed and</span>
</span><span id="L-74"><a href="#L-74"><span class="linenos">  74</span></a><span class="sd">        the amount to be removed is controlled by fraction, and angle.  </span>
</span><span id="L-75"><a href="#L-75"><span class="linenos">  75</span></a>
</span><span id="L-76"><a href="#L-76"><span class="linenos">  76</span></a><span class="sd">        Arguments:</span>
</span><span id="L-77"><a href="#L-77"><span class="linenos">  77</span></a><span class="sd">            fraction: float, fraction of translation speed to remove</span>
</span><span id="L-78"><a href="#L-78"><span class="linenos">  78</span></a><span class="sd">            angle: float, angle of translation velocity change in degree</span>
</span><span id="L-79"><a href="#L-79"><span class="linenos">  79</span></a><span class="sd">            swrf: float, surface wind reduction factor</span>
</span><span id="L-80"><a href="#L-80"><span class="linenos">  80</span></a>
</span><span id="L-81"><a href="#L-81"><span class="linenos">  81</span></a><span class="sd">        Due to translation a fraction of the wind-speed is embadded to the axysymmetric</span>
</span><span id="L-82"><a href="#L-82"><span class="linenos">  82</span></a><span class="sd">        wind structure. To get the radial wind structure, we need to remove this</span>
</span><span id="L-83"><a href="#L-83"><span class="linenos">  83</span></a><span class="sd">        translation velocity from the recorded wind velocity.</span>
</span><span id="L-84"><a href="#L-84"><span class="linenos">  84</span></a><span class="sd">        </span>
</span><span id="L-85"><a href="#L-85"><span class="linenos">  85</span></a><span class="sd">        The fraction is historically taken as unity (1). However, as shown in </span>
</span><span id="L-86"><a href="#L-86"><span class="linenos">  86</span></a><span class="sd">        lin and chavas (2012), more statistically consistent value of this fraction</span>
</span><span id="L-87"><a href="#L-87"><span class="linenos">  87</span></a><span class="sd">        is 0.56 (default)</span>
</span><span id="L-88"><a href="#L-88"><span class="linenos">  88</span></a>
</span><span id="L-89"><a href="#L-89"><span class="linenos">  89</span></a><span class="sd">        Similarly, the translation is not fully forward (angle=0), rather the </span>
</span><span id="L-90"><a href="#L-90"><span class="linenos">  90</span></a><span class="sd">        background wind is slightly on southerly direction if we consider the</span>
</span><span id="L-91"><a href="#L-91"><span class="linenos">  91</span></a><span class="sd">        storm is westerly. The angle is found around 19.2 degrees from statistical</span>
</span><span id="L-92"><a href="#L-92"><span class="linenos">  92</span></a><span class="sd">        analysis. Thus the background wind is rotated anti-clockwise and needs </span>
</span><span id="L-93"><a href="#L-93"><span class="linenos">  93</span></a><span class="sd">        to be updated before applying as fraction to the wind values.</span>
</span><span id="L-94"><a href="#L-94"><span class="linenos">  94</span></a>
</span><span id="L-95"><a href="#L-95"><span class="linenos">  95</span></a><span class="sd">        In the advisories, radial fields are defined at 10m level, whereas </span>
</span><span id="L-96"><a href="#L-96"><span class="linenos">  96</span></a><span class="sd">        the analytical fields are defined at the boundary layer. Thus the velocity</span>
</span><span id="L-97"><a href="#L-97"><span class="linenos">  97</span></a><span class="sd">        is needed to be divided by SWRF to shift it to boundary layer and multiplied</span>
</span><span id="L-98"><a href="#L-98"><span class="linenos">  98</span></a><span class="sd">        by SWRF to get it back to 10m level.</span>
</span><span id="L-99"><a href="#L-99"><span class="linenos">  99</span></a><span class="sd">        &#39;&#39;&#39;</span>
</span><span id="L-100"><a href="#L-100"><span class="linenos"> 100</span></a>        <span class="c1"># Rotating ustorm vstorm by 19.2 degree anti-clockwise</span>
</span><span id="L-101"><a href="#L-101"><span class="linenos"> 101</span></a>        <span class="c1"># Same operation as rotating a cartesian coordinate by 19.2 degree</span>
</span><span id="L-102"><a href="#L-102"><span class="linenos"> 102</span></a>        <span class="n">angle_rad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>
</span><span id="L-103"><a href="#L-103"><span class="linenos"> 103</span></a>        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">([</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;ustorm&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;vstorm&#39;</span><span class="p">]])):</span>
</span><span id="L-104"><a href="#L-104"><span class="linenos"> 104</span></a>            <span class="n">ustorm</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-105"><a href="#L-105"><span class="linenos"> 105</span></a>            <span class="n">vstorm</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-106"><a href="#L-106"><span class="linenos"> 106</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-107"><a href="#L-107"><span class="linenos"> 107</span></a>            <span class="n">ustorm</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;ustorm&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle_rad</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;vstorm&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angle_rad</span><span class="p">)</span>
</span><span id="L-108"><a href="#L-108"><span class="linenos"> 108</span></a>            <span class="n">vstorm</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;ustorm&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angle_rad</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;vstorm&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle_rad</span><span class="p">)</span>
</span><span id="L-109"><a href="#L-109"><span class="linenos"> 109</span></a>
</span><span id="L-110"><a href="#L-110"><span class="linenos"> 110</span></a>        <span class="c1"># Apply correction to vmax for 4 quadrant clockwise from 0N</span>
</span><span id="L-111"><a href="#L-111"><span class="linenos"> 111</span></a>        <span class="c1"># Careful about the sin/cos from north</span>
</span><span id="L-112"><a href="#L-112"><span class="linenos"> 112</span></a>        <span class="c1">#            N</span>
</span><span id="L-113"><a href="#L-113"><span class="linenos"> 113</span></a>        <span class="c1">#            | t /</span>
</span><span id="L-114"><a href="#L-114"><span class="linenos"> 114</span></a>        <span class="c1">#            | /</span>
</span><span id="L-115"><a href="#L-115"><span class="linenos"> 115</span></a>        <span class="c1">#    W ------*------- E</span>
</span><span id="L-116"><a href="#L-116"><span class="linenos"> 116</span></a>        <span class="c1">#            |</span>
</span><span id="L-117"><a href="#L-117"><span class="linenos"> 117</span></a>        <span class="c1">#            |</span>
</span><span id="L-118"><a href="#L-118"><span class="linenos"> 118</span></a>        <span class="c1">#            S</span>
</span><span id="L-119"><a href="#L-119"><span class="linenos"> 119</span></a>        <span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
</span><span id="L-120"><a href="#L-120"><span class="linenos"> 120</span></a>        <span class="n">vmax_x</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;vmax&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">fraction</span><span class="o">*</span><span class="n">ustorm</span> 
</span><span id="L-121"><a href="#L-121"><span class="linenos"> 121</span></a>        <span class="n">vmax_y</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;vmax&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="o">-</span> <span class="n">fraction</span><span class="o">*</span><span class="n">vstorm</span>
</span><span id="L-122"><a href="#L-122"><span class="linenos"> 122</span></a>        <span class="n">vmax_amp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">vmax_x</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">vmax_y</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="n">swrf</span>
</span><span id="L-123"><a href="#L-123"><span class="linenos"> 123</span></a>        <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;fvmax&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">vmax_amp</span><span class="p">)</span>
</span><span id="L-124"><a href="#L-124"><span class="linenos"> 124</span></a>
</span><span id="L-125"><a href="#L-125"><span class="linenos"> 125</span></a>        <span class="c1"># Apply correction to vinfo for 4 quadrant</span>
</span><span id="L-126"><a href="#L-126"><span class="linenos"> 126</span></a>        <span class="n">fvinfo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
</span><span id="L-127"><a href="#L-127"><span class="linenos"> 127</span></a>        <span class="n">fradinfo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
</span><span id="L-128"><a href="#L-128"><span class="linenos"> 128</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">vinfo</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;vinfo&#39;</span><span class="p">])):</span>
</span><span id="L-129"><a href="#L-129"><span class="linenos"> 129</span></a>            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">vinfo</span><span class="p">):</span>
</span><span id="L-130"><a href="#L-130"><span class="linenos"> 130</span></a>                <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;vinfo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
</span><span id="L-131"><a href="#L-131"><span class="linenos"> 131</span></a>                <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;radinfo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
</span><span id="L-132"><a href="#L-132"><span class="linenos"> 132</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-133"><a href="#L-133"><span class="linenos"> 133</span></a>                <span class="n">vinfo_x</span> <span class="o">=</span> <span class="n">vinfo</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">fraction</span><span class="o">*</span><span class="n">ustorm</span>
</span><span id="L-134"><a href="#L-134"><span class="linenos"> 134</span></a>                <span class="n">vinfo_y</span> <span class="o">=</span> <span class="n">vinfo</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="o">-</span> <span class="n">fraction</span><span class="o">*</span><span class="n">vstorm</span>
</span><span id="L-135"><a href="#L-135"><span class="linenos"> 135</span></a>                <span class="n">vinfo_amp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">vinfo_x</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">vinfo_y</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="n">swrf</span>
</span><span id="L-136"><a href="#L-136"><span class="linenos"> 136</span></a>                <span class="n">vinfo_func</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">vinfo_amp</span><span class="p">)</span>
</span><span id="L-137"><a href="#L-137"><span class="linenos"> 137</span></a>                <span class="n">fvinfo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fvinfo</span><span class="p">,</span> <span class="n">vinfo_func</span><span class="p">)</span>
</span><span id="L-138"><a href="#L-138"><span class="linenos"> 138</span></a>
</span><span id="L-139"><a href="#L-139"><span class="linenos"> 139</span></a>                <span class="n">radinfo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;radinfo&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;radinfo&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
</span><span id="L-140"><a href="#L-140"><span class="linenos"> 140</span></a>                <span class="n">radinfo_func</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">radinfo</span><span class="p">)</span>
</span><span id="L-141"><a href="#L-141"><span class="linenos"> 141</span></a>                <span class="n">fradinfo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fradinfo</span><span class="p">,</span> <span class="n">radinfo_func</span><span class="p">)</span>
</span><span id="L-142"><a href="#L-142"><span class="linenos"> 142</span></a>        
</span><span id="L-143"><a href="#L-143"><span class="linenos"> 143</span></a>        <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;fvinfo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fvinfo</span>
</span><span id="L-144"><a href="#L-144"><span class="linenos"> 144</span></a>        <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;fradinfo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fradinfo</span>
</span><span id="L-145"><a href="#L-145"><span class="linenos"> 145</span></a>
</span><span id="L-146"><a href="#L-146"><span class="linenos"> 146</span></a>        <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="L-147"><a href="#L-147"><span class="linenos"> 147</span></a>
</span><span id="L-148"><a href="#L-148"><span class="linenos"> 148</span></a>    <span class="k">def</span> <span class="nf">calc_rmax</span><span class="p">(</span>
</span><span id="L-149"><a href="#L-149"><span class="linenos"> 149</span></a>        <span class="bp">self</span><span class="p">,</span> 
</span><span id="L-150"><a href="#L-150"><span class="linenos"> 150</span></a>        <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;H80&#39;</span><span class="p">,</span> <span class="s1">&#39;E11&#39;</span><span class="p">],</span> 
</span><span id="L-151"><a href="#L-151"><span class="linenos"> 151</span></a>        <span class="n">use_rmax_info</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
</span><span id="L-152"><a href="#L-152"><span class="linenos"> 152</span></a>        <span class="n">vlimit</span><span class="o">=</span><span class="p">[</span><span class="mi">20</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">],</span>
</span><span id="L-153"><a href="#L-153"><span class="linenos"> 153</span></a>        <span class="n">kw_atmos</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;pn&#39;</span><span class="p">:</span><span class="mi">101325</span><span class="p">,</span> <span class="s1">&#39;rhoair&#39;</span><span class="p">:</span><span class="mf">1.15</span><span class="p">},</span>
</span><span id="L-154"><a href="#L-154"><span class="linenos"> 154</span></a>        <span class="n">kw_h80</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;bmax&#39;</span><span class="p">:</span><span class="mf">2.5</span><span class="p">,</span> <span class="s1">&#39;bmin&#39;</span><span class="p">:</span><span class="mf">0.5</span><span class="p">,</span> <span class="s1">&#39;solver&#39;</span><span class="p">:</span><span class="s1">&#39;fsolve&#39;</span><span class="p">,</span> <span class="s1">&#39;limit&#39;</span><span class="p">:[</span><span class="mi">5000</span><span class="p">,</span> <span class="mi">500000</span><span class="p">],</span> <span class="s1">&#39;step&#39;</span><span class="p">:</span><span class="mi">100</span><span class="p">},</span>
</span><span id="L-155"><a href="#L-155"><span class="linenos"> 155</span></a>        <span class="n">kw_e11</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;solver&#39;</span><span class="p">:</span><span class="s1">&#39;fsolve&#39;</span><span class="p">,</span> <span class="s1">&#39;limit&#39;</span><span class="p">:[</span><span class="mi">5000</span><span class="p">,</span> <span class="mi">500000</span><span class="p">],</span> <span class="s1">&#39;step&#39;</span><span class="p">:</span><span class="mi">100</span><span class="p">}</span>
</span><span id="L-156"><a href="#L-156"><span class="linenos"> 156</span></a>    <span class="p">):</span>
</span><span id="L-157"><a href="#L-157"><span class="linenos"> 157</span></a><span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="L-158"><a href="#L-158"><span class="linenos"> 158</span></a><span class="sd">        Calculate Radius of maximum wind based on a given method on the selected</span>
</span><span id="L-159"><a href="#L-159"><span class="linenos"> 159</span></a><span class="sd">        radial informations.</span>
</span><span id="L-160"><a href="#L-160"><span class="linenos"> 160</span></a>
</span><span id="L-161"><a href="#L-161"><span class="linenos"> 161</span></a><span class="sd">        methods: list, list of methods to try one after another</span>
</span><span id="L-162"><a href="#L-162"><span class="linenos"> 162</span></a><span class="sd">        use_rmax_info: bool, existing rmax to be used directly or not</span>
</span><span id="L-163"><a href="#L-163"><span class="linenos"> 163</span></a><span class="sd">        vlimit: list of maximum limit of v for method to be used, </span>
</span><span id="L-164"><a href="#L-164"><span class="linenos"> 164</span></a><span class="sd">                last one must be np.inf, vlimit is right open )</span>
</span><span id="L-165"><a href="#L-165"><span class="linenos"> 165</span></a><span class="sd">        kw_atmos: dict, atmospheric information, generally needed for H80 model</span>
</span><span id="L-166"><a href="#L-166"><span class="linenos"> 166</span></a><span class="sd">        kw_h80: dict, solver options for H80 model</span>
</span><span id="L-167"><a href="#L-167"><span class="linenos"> 167</span></a><span class="sd">        kw_e11: dict, solver options for E11 model</span>
</span><span id="L-168"><a href="#L-168"><span class="linenos"> 168</span></a>
</span><span id="L-169"><a href="#L-169"><span class="linenos"> 169</span></a><span class="sd">        Following methods are implemented - </span>
</span><span id="L-170"><a href="#L-170"><span class="linenos"> 170</span></a><span class="sd">            &#39;E11&#39; : Emanuel 2011 model as described in Lin and Chavas 2012</span>
</span><span id="L-171"><a href="#L-171"><span class="linenos"> 171</span></a><span class="sd">            &#39;H80&#39; : Holland 1980 model based on radial info</span>
</span><span id="L-172"><a href="#L-172"><span class="linenos"> 172</span></a><span class="sd">            &#39;S02&#39; : Silva et al. 2002 based on regression of central pressure</span>
</span><span id="L-173"><a href="#L-173"><span class="linenos"> 173</span></a><span class="sd">                    rmax = 0.4785 * Pc (mb) - 413 (km)</span>
</span><span id="L-174"><a href="#L-174"><span class="linenos"> 174</span></a><span class="sd">            &#39;W04&#39; : Willoughby and Rahn (2004) regression of Vmax</span>
</span><span id="L-175"><a href="#L-175"><span class="linenos"> 175</span></a><span class="sd">                    rmax = 51.6*exp(-0.0223*Vmax + 0.0281*lat) (km)</span>
</span><span id="L-176"><a href="#L-176"><span class="linenos"> 176</span></a>
</span><span id="L-177"><a href="#L-177"><span class="linenos"> 177</span></a><span class="sd">        Models to be implemented in the future - </span>
</span><span id="L-178"><a href="#L-178"><span class="linenos"> 178</span></a><span class="sd">            &#39;H80c&#39; : Holland 1980c (f related values are removed)</span>
</span><span id="L-179"><a href="#L-179"><span class="linenos"> 179</span></a><span class="sd">            &#39;S92&#39; : Slosh model, by jeleniaski et al . 1992</span>
</span><span id="L-180"><a href="#L-180"><span class="linenos"> 180</span></a><span class="sd">            &#39;E04&#39; : Emanuel 2004 model</span>
</span><span id="L-181"><a href="#L-181"><span class="linenos"> 181</span></a><span class="sd">            &#39;M16&#39; : Murty et al 2016 model</span>
</span><span id="L-182"><a href="#L-182"><span class="linenos"> 182</span></a><span class="sd">            &#39;W06&#39; : Willoughby et al. 2006 model </span>
</span><span id="L-183"><a href="#L-183"><span class="linenos"> 183</span></a><span class="sd">        </span>
</span><span id="L-184"><a href="#L-184"><span class="linenos"> 184</span></a><span class="sd">        &#39;&#39;&#39;</span>
</span><span id="L-185"><a href="#L-185"><span class="linenos"> 185</span></a>        <span class="n">methods</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">methods</span><span class="p">)</span>
</span><span id="L-186"><a href="#L-186"><span class="linenos"> 186</span></a>
</span><span id="L-187"><a href="#L-187"><span class="linenos"> 187</span></a>        <span class="n">calc_rmax</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-188"><a href="#L-188"><span class="linenos"> 188</span></a>            <span class="s1">&#39;E11&#39;</span><span class="p">:</span> <span class="n">calc_rmax_e11</span><span class="p">,</span>
</span><span id="L-189"><a href="#L-189"><span class="linenos"> 189</span></a>            <span class="s1">&#39;H80&#39;</span><span class="p">:</span> <span class="n">calc_rmax_h80</span><span class="p">,</span>
</span><span id="L-190"><a href="#L-190"><span class="linenos"> 190</span></a>            <span class="s1">&#39;S02&#39;</span><span class="p">:</span> <span class="n">calc_rmax_s02</span><span class="p">,</span>
</span><span id="L-191"><a href="#L-191"><span class="linenos"> 191</span></a>            <span class="s1">&#39;W04&#39;</span><span class="p">:</span> <span class="n">calc_rmax_w04</span>
</span><span id="L-192"><a href="#L-192"><span class="linenos"> 192</span></a>        <span class="p">}</span>
</span><span id="L-193"><a href="#L-193"><span class="linenos"> 193</span></a>        
</span><span id="L-194"><a href="#L-194"><span class="linenos"> 194</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-195"><a href="#L-195"><span class="linenos"> 195</span></a>            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">vlimit</span><span class="p">))</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">methods</span><span class="p">)</span>
</span><span id="L-196"><a href="#L-196"><span class="linenos"> 196</span></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="L-197"><a href="#L-197"><span class="linenos"> 197</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;vlimit must be the size of methods.&#39;</span><span class="p">)</span>
</span><span id="L-198"><a href="#L-198"><span class="linenos"> 198</span></a>
</span><span id="L-199"><a href="#L-199"><span class="linenos"> 199</span></a>        <span class="n">vlimit_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">vlimit</span><span class="p">)[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="c1"># Starts from 0 m/s</span>
</span><span id="L-200"><a href="#L-200"><span class="linenos"> 200</span></a>        <span class="n">vlimit_max</span> <span class="o">=</span> <span class="n">vlimit</span>
</span><span id="L-201"><a href="#L-201"><span class="linenos"> 201</span></a>
</span><span id="L-202"><a href="#L-202"><span class="linenos"> 202</span></a>        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">([</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;rmax&#39;</span><span class="p">]),</span> <span class="n">use_rmax_info</span><span class="p">]):</span>
</span><span id="L-203"><a href="#L-203"><span class="linenos"> 203</span></a>            <span class="c1"># Use the provided vmax</span>
</span><span id="L-204"><a href="#L-204"><span class="linenos"> 204</span></a>            <span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
</span><span id="L-205"><a href="#L-205"><span class="linenos"> 205</span></a>            <span class="n">rmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;rmax&#39;</span><span class="p">]</span>
</span><span id="L-206"><a href="#L-206"><span class="linenos"> 206</span></a>            <span class="n">frmax</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">rmax</span><span class="p">)</span>
</span><span id="L-207"><a href="#L-207"><span class="linenos"> 207</span></a>            <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;frmax&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">frmax</span>
</span><span id="L-208"><a href="#L-208"><span class="linenos"> 208</span></a>        <span class="k">elif</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;vinfo&#39;</span><span class="p">])):</span>
</span><span id="L-209"><a href="#L-209"><span class="linenos"> 209</span></a>            <span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
</span><span id="L-210"><a href="#L-210"><span class="linenos"> 210</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;mslp&#39;</span><span class="p">]):</span>
</span><span id="L-211"><a href="#L-211"><span class="linenos"> 211</span></a>                <span class="c1"># Use S02 regression method for rmax</span>
</span><span id="L-212"><a href="#L-212"><span class="linenos"> 212</span></a>                <span class="n">rmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span><span class="o">*</span><span class="n">calc_rmax_s02</span><span class="p">(</span><span class="n">mslp</span><span class="o">=</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;mslp&#39;</span><span class="p">])</span>
</span><span id="L-213"><a href="#L-213"><span class="linenos"> 213</span></a>            <span class="k">elif</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;vmax&#39;</span><span class="p">]):</span>
</span><span id="L-214"><a href="#L-214"><span class="linenos"> 214</span></a>                <span class="c1"># Use W04 regression method for rmax</span>
</span><span id="L-215"><a href="#L-215"><span class="linenos"> 215</span></a>                <span class="n">rmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span><span class="o">*</span><span class="n">calc_rmax_w04</span><span class="p">(</span><span class="n">vmax</span><span class="o">=</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;vmax&#39;</span><span class="p">],</span> <span class="n">lat</span><span class="o">=</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">])</span>
</span><span id="L-216"><a href="#L-216"><span class="linenos"> 216</span></a>            
</span><span id="L-217"><a href="#L-217"><span class="linenos"> 217</span></a>            <span class="n">frmax</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">rmax</span><span class="p">)</span>
</span><span id="L-218"><a href="#L-218"><span class="linenos"> 218</span></a>            <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;frmax&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">frmax</span>
</span><span id="L-219"><a href="#L-219"><span class="linenos"> 219</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-220"><a href="#L-220"><span class="linenos"> 220</span></a>            <span class="n">frmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span> <span class="c1"># length of fvinfo or atleast 1</span>
</span><span id="L-221"><a href="#L-221"><span class="linenos"> 221</span></a>            <span class="n">rmax_method</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span> <span class="c1"># Keeping the rmax_method used</span>
</span><span id="L-222"><a href="#L-222"><span class="linenos"> 222</span></a>            <span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
</span><span id="L-223"><a href="#L-223"><span class="linenos"> 223</span></a>            
</span><span id="L-224"><a href="#L-224"><span class="linenos"> 224</span></a>            <span class="c1"># Radial info is available and rmax is to be calculated from radinfo</span>
</span><span id="L-225"><a href="#L-225"><span class="linenos"> 225</span></a>            <span class="k">for</span> <span class="n">fv</span><span class="p">,</span> <span class="n">fr</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;fvinfo&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;fradinfo&#39;</span><span class="p">]):</span>
</span><span id="L-226"><a href="#L-226"><span class="linenos"> 226</span></a>                <span class="n">rmax_fv_theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="c1"># Placeholder</span>
</span><span id="L-227"><a href="#L-227"><span class="linenos"> 227</span></a>                
</span><span id="L-228"><a href="#L-228"><span class="linenos"> 228</span></a>                <span class="c1"># Iterating over all the values interpolated by theta</span>
</span><span id="L-229"><a href="#L-229"><span class="linenos"> 229</span></a>                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">thetai</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">theta</span><span class="p">):</span>
</span><span id="L-230"><a href="#L-230"><span class="linenos"> 230</span></a>                    <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">method</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">methods</span><span class="p">):</span>
</span><span id="L-231"><a href="#L-231"><span class="linenos"> 231</span></a>                        <span class="k">try</span><span class="p">:</span>
</span><span id="L-232"><a href="#L-232"><span class="linenos"> 232</span></a>                            <span class="c1"># Check the vlimit_min vlimit_max</span>
</span><span id="L-233"><a href="#L-233"><span class="linenos"> 233</span></a>                            <span class="k">assert</span> <span class="n">fv</span><span class="p">(</span><span class="n">thetai</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">vlimit_min</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
</span><span id="L-234"><a href="#L-234"><span class="linenos"> 234</span></a>                            <span class="k">assert</span> <span class="n">fv</span><span class="p">(</span><span class="n">thetai</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">vlimit_max</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
</span><span id="L-235"><a href="#L-235"><span class="linenos"> 235</span></a>                            
</span><span id="L-236"><a href="#L-236"><span class="linenos"> 236</span></a>                            <span class="c1"># Trying each methods</span>
</span><span id="L-237"><a href="#L-237"><span class="linenos"> 237</span></a>                            <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;E11&#39;</span><span class="p">:</span>
</span><span id="L-238"><a href="#L-238"><span class="linenos"> 238</span></a>                                <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-239"><a href="#L-239"><span class="linenos"> 239</span></a>                                    <span class="s1">&#39;v&#39;</span><span class="p">:</span><span class="n">fv</span><span class="p">(</span><span class="n">thetai</span><span class="p">),</span> 
</span><span id="L-240"><a href="#L-240"><span class="linenos"> 240</span></a>                                    <span class="s1">&#39;r&#39;</span><span class="p">:</span><span class="n">fr</span><span class="p">(</span><span class="n">thetai</span><span class="p">),</span> 
</span><span id="L-241"><a href="#L-241"><span class="linenos"> 241</span></a>                                    <span class="s1">&#39;vmax&#39;</span><span class="p">:</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;fvmax&#39;</span><span class="p">](</span><span class="n">thetai</span><span class="p">),</span> 
</span><span id="L-242"><a href="#L-242"><span class="linenos"> 242</span></a>                                    <span class="s1">&#39;f&#39;</span><span class="p">:</span><span class="n">coriolis</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">]),</span> 
</span><span id="L-243"><a href="#L-243"><span class="linenos"> 243</span></a>                                    <span class="s1">&#39;solver&#39;</span><span class="p">:</span><span class="n">kw_e11</span><span class="p">[</span><span class="s1">&#39;solver&#39;</span><span class="p">],</span> 
</span><span id="L-244"><a href="#L-244"><span class="linenos"> 244</span></a>                                    <span class="s1">&#39;limit&#39;</span><span class="p">:</span><span class="n">kw_e11</span><span class="p">[</span><span class="s1">&#39;limit&#39;</span><span class="p">],</span> 
</span><span id="L-245"><a href="#L-245"><span class="linenos"> 245</span></a>                                    <span class="s1">&#39;step&#39;</span><span class="p">:</span><span class="n">kw_e11</span><span class="p">[</span><span class="s1">&#39;step&#39;</span><span class="p">]</span>
</span><span id="L-246"><a href="#L-246"><span class="linenos"> 246</span></a>                                <span class="p">}</span>
</span><span id="L-247"><a href="#L-247"><span class="linenos"> 247</span></a>                                <span class="n">rmax_fv_theta</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">calc_rmax</span><span class="p">[</span><span class="n">method</span><span class="p">](</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="L-248"><a href="#L-248"><span class="linenos"> 248</span></a>
</span><span id="L-249"><a href="#L-249"><span class="linenos"> 249</span></a>                            <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;H80&#39;</span><span class="p">:</span>
</span><span id="L-250"><a href="#L-250"><span class="linenos"> 250</span></a>                                <span class="c1"># First calculate holland B parameter</span>
</span><span id="L-251"><a href="#L-251"><span class="linenos"> 251</span></a>                                <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-252"><a href="#L-252"><span class="linenos"> 252</span></a>                                    <span class="s1">&#39;vmax&#39;</span><span class="p">:</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;fvmax&#39;</span><span class="p">](</span><span class="n">thetai</span><span class="p">),</span>
</span><span id="L-253"><a href="#L-253"><span class="linenos"> 253</span></a>                                    <span class="s1">&#39;pc&#39;</span><span class="p">:</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;mslp&#39;</span><span class="p">],</span>
</span><span id="L-254"><a href="#L-254"><span class="linenos"> 254</span></a>                                    <span class="s1">&#39;pn&#39;</span><span class="p">:</span><span class="n">kw_atmos</span><span class="p">[</span><span class="s1">&#39;pn&#39;</span><span class="p">],</span>
</span><span id="L-255"><a href="#L-255"><span class="linenos"> 255</span></a>                                    <span class="s1">&#39;rhoair&#39;</span><span class="p">:</span><span class="n">kw_atmos</span><span class="p">[</span><span class="s1">&#39;rhoair&#39;</span><span class="p">],</span>
</span><span id="L-256"><a href="#L-256"><span class="linenos"> 256</span></a>                                    <span class="s1">&#39;bmax&#39;</span><span class="p">:</span><span class="n">kw_h80</span><span class="p">[</span><span class="s1">&#39;bmax&#39;</span><span class="p">],</span>
</span><span id="L-257"><a href="#L-257"><span class="linenos"> 257</span></a>                                    <span class="s1">&#39;bmin&#39;</span><span class="p">:</span><span class="n">kw_h80</span><span class="p">[</span><span class="s1">&#39;bmin&#39;</span><span class="p">]</span>
</span><span id="L-258"><a href="#L-258"><span class="linenos"> 258</span></a>                                <span class="p">}</span>
</span><span id="L-259"><a href="#L-259"><span class="linenos"> 259</span></a>                                <span class="n">B</span> <span class="o">=</span> <span class="n">calc_holland_B</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="L-260"><a href="#L-260"><span class="linenos"> 260</span></a>
</span><span id="L-261"><a href="#L-261"><span class="linenos"> 261</span></a>                                <span class="c1"># Then calculate the rmax</span>
</span><span id="L-262"><a href="#L-262"><span class="linenos"> 262</span></a>                                <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-263"><a href="#L-263"><span class="linenos"> 263</span></a>                                    <span class="s1">&#39;v&#39;</span><span class="p">:</span><span class="n">fv</span><span class="p">(</span><span class="n">thetai</span><span class="p">),</span> 
</span><span id="L-264"><a href="#L-264"><span class="linenos"> 264</span></a>                                    <span class="s1">&#39;r&#39;</span><span class="p">:</span><span class="n">fr</span><span class="p">(</span><span class="n">thetai</span><span class="p">),</span> 
</span><span id="L-265"><a href="#L-265"><span class="linenos"> 265</span></a>                                    <span class="s1">&#39;pc&#39;</span><span class="p">:</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;mslp&#39;</span><span class="p">],</span> 
</span><span id="L-266"><a href="#L-266"><span class="linenos"> 266</span></a>                                    <span class="s1">&#39;B&#39;</span><span class="p">:</span><span class="n">B</span><span class="p">,</span> 
</span><span id="L-267"><a href="#L-267"><span class="linenos"> 267</span></a>                                    <span class="s1">&#39;f&#39;</span><span class="p">:</span><span class="n">coriolis</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">]),</span> 
</span><span id="L-268"><a href="#L-268"><span class="linenos"> 268</span></a>                                    <span class="s1">&#39;pn&#39;</span><span class="p">:</span><span class="n">kw_atmos</span><span class="p">[</span><span class="s1">&#39;pn&#39;</span><span class="p">],</span> 
</span><span id="L-269"><a href="#L-269"><span class="linenos"> 269</span></a>                                    <span class="s1">&#39;rhoair&#39;</span><span class="p">:</span><span class="n">kw_atmos</span><span class="p">[</span><span class="s1">&#39;rhoair&#39;</span><span class="p">],</span> 
</span><span id="L-270"><a href="#L-270"><span class="linenos"> 270</span></a>                                    <span class="s1">&#39;solver&#39;</span><span class="p">:</span><span class="n">kw_h80</span><span class="p">[</span><span class="s1">&#39;solver&#39;</span><span class="p">],</span> 
</span><span id="L-271"><a href="#L-271"><span class="linenos"> 271</span></a>                                    <span class="s1">&#39;limit&#39;</span><span class="p">:</span><span class="n">kw_h80</span><span class="p">[</span><span class="s1">&#39;limit&#39;</span><span class="p">],</span> 
</span><span id="L-272"><a href="#L-272"><span class="linenos"> 272</span></a>                                    <span class="s1">&#39;step&#39;</span><span class="p">:</span><span class="n">kw_h80</span><span class="p">[</span><span class="s1">&#39;step&#39;</span><span class="p">]</span>
</span><span id="L-273"><a href="#L-273"><span class="linenos"> 273</span></a>                                <span class="p">}</span>
</span><span id="L-274"><a href="#L-274"><span class="linenos"> 274</span></a>                                <span class="n">rmax_fv_theta</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">calc_rmax</span><span class="p">[</span><span class="n">method</span><span class="p">](</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="L-275"><a href="#L-275"><span class="linenos"> 275</span></a>
</span><span id="L-276"><a href="#L-276"><span class="linenos"> 276</span></a>                            <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;S02&#39;</span><span class="p">:</span>
</span><span id="L-277"><a href="#L-277"><span class="linenos"> 277</span></a>                                <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-278"><a href="#L-278"><span class="linenos"> 278</span></a>                                    <span class="s1">&#39;mslp&#39;</span><span class="p">:</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;mslp&#39;</span><span class="p">]</span>
</span><span id="L-279"><a href="#L-279"><span class="linenos"> 279</span></a>                                <span class="p">}</span>
</span><span id="L-280"><a href="#L-280"><span class="linenos"> 280</span></a>                                <span class="n">rmax_fv_theta</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">calc_rmax</span><span class="p">[</span><span class="n">method</span><span class="p">](</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="L-281"><a href="#L-281"><span class="linenos"> 281</span></a>
</span><span id="L-282"><a href="#L-282"><span class="linenos"> 282</span></a>                            <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;W04&#39;</span><span class="p">:</span>
</span><span id="L-283"><a href="#L-283"><span class="linenos"> 283</span></a>                                <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-284"><a href="#L-284"><span class="linenos"> 284</span></a>                                    <span class="s1">&#39;vmax&#39;</span><span class="p">:</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;fvmax&#39;</span><span class="p">](</span><span class="n">thetai</span><span class="p">),</span>
</span><span id="L-285"><a href="#L-285"><span class="linenos"> 285</span></a>                                    <span class="s1">&#39;lat&#39;</span><span class="p">:</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span>
</span><span id="L-286"><a href="#L-286"><span class="linenos"> 286</span></a>                                <span class="p">}</span>
</span><span id="L-287"><a href="#L-287"><span class="linenos"> 287</span></a>                                <span class="n">rmax_fv_theta</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">calc_rmax</span><span class="p">[</span><span class="n">method</span><span class="p">](</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>                            
</span><span id="L-288"><a href="#L-288"><span class="linenos"> 288</span></a>
</span><span id="L-289"><a href="#L-289"><span class="linenos"> 289</span></a>                            <span class="c1"># When successful break the loop</span>
</span><span id="L-290"><a href="#L-290"><span class="linenos"> 290</span></a>                            <span class="k">break</span>
</span><span id="L-291"><a href="#L-291"><span class="linenos"> 291</span></a>                        <span class="k">except</span><span class="p">:</span>
</span><span id="L-292"><a href="#L-292"><span class="linenos"> 292</span></a>                            <span class="c1"># Otherwise continue with the methods</span>
</span><span id="L-293"><a href="#L-293"><span class="linenos"> 293</span></a>                            <span class="k">continue</span>
</span><span id="L-294"><a href="#L-294"><span class="linenos"> 294</span></a>                
</span><span id="L-295"><a href="#L-295"><span class="linenos"> 295</span></a>                <span class="c1"># For a particular vinfo create the interpolation function</span>
</span><span id="L-296"><a href="#L-296"><span class="linenos"> 296</span></a>                <span class="c1"># append to frmax</span>
</span><span id="L-297"><a href="#L-297"><span class="linenos"> 297</span></a>                <span class="n">frmax_fv</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">rmax_fv_theta</span><span class="p">)</span>
</span><span id="L-298"><a href="#L-298"><span class="linenos"> 298</span></a>                <span class="n">frmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">frmax</span><span class="p">,</span> <span class="n">frmax_fv</span><span class="p">)</span>
</span><span id="L-299"><a href="#L-299"><span class="linenos"> 299</span></a>            
</span><span id="L-300"><a href="#L-300"><span class="linenos"> 300</span></a>            <span class="c1"># Save to Record dictionary</span>
</span><span id="L-301"><a href="#L-301"><span class="linenos"> 301</span></a>            <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;frmax&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">frmax</span>  
</span><span id="L-302"><a href="#L-302"><span class="linenos"> 302</span></a>            <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;rmax_method&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rmax_method</span>
</span><span id="L-303"><a href="#L-303"><span class="linenos"> 303</span></a>        
</span><span id="L-304"><a href="#L-304"><span class="linenos"> 304</span></a>        <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>        
</span><span id="L-305"><a href="#L-305"><span class="linenos"> 305</span></a>
</span><span id="L-306"><a href="#L-306"><span class="linenos"> 306</span></a>    <span class="k">def</span> <span class="nf">calculate_wind</span><span class="p">(</span>
</span><span id="L-307"><a href="#L-307"><span class="linenos"> 307</span></a>        <span class="bp">self</span><span class="p">,</span> 
</span><span id="L-308"><a href="#L-308"><span class="linenos"> 308</span></a>        <span class="n">at</span><span class="p">,</span> 
</span><span id="L-309"><a href="#L-309"><span class="linenos"> 309</span></a>        <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;E11&#39;</span><span class="p">,</span><span class="s1">&#39;H80&#39;</span><span class="p">],</span>
</span><span id="L-310"><a href="#L-310"><span class="linenos"> 310</span></a>        <span class="n">rmax_frac</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">],</span>
</span><span id="L-311"><a href="#L-311"><span class="linenos"> 311</span></a>        <span class="n">rmax_select</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span>
</span><span id="L-312"><a href="#L-312"><span class="linenos"> 312</span></a>        <span class="n">kw_corr</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;fraction&#39;</span><span class="p">:</span><span class="mf">0.56</span><span class="p">,</span> <span class="s1">&#39;angle&#39;</span><span class="p">:</span><span class="mf">19.2</span><span class="p">,</span> <span class="s1">&#39;swrf&#39;</span><span class="p">:</span><span class="mf">0.9</span><span class="p">,</span> <span class="s1">&#39;tfac&#39;</span><span class="p">:</span><span class="mf">0.88</span><span class="p">},</span>
</span><span id="L-313"><a href="#L-313"><span class="linenos"> 313</span></a>        <span class="n">kw_atmos</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;pn&#39;</span><span class="p">:</span><span class="mi">101325</span><span class="p">,</span> <span class="s1">&#39;rhoair&#39;</span><span class="p">:</span><span class="mf">1.15</span><span class="p">},</span>
</span><span id="L-314"><a href="#L-314"><span class="linenos"> 314</span></a>        <span class="n">kw_h80</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;bmax&#39;</span><span class="p">:</span><span class="mf">2.5</span><span class="p">,</span> <span class="s1">&#39;bmin&#39;</span><span class="p">:</span><span class="mf">0.5</span><span class="p">},</span>
</span><span id="L-315"><a href="#L-315"><span class="linenos"> 315</span></a>        <span class="n">kw_e04</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;b&#39;</span><span class="p">:</span><span class="mf">0.25</span><span class="p">,</span> <span class="s1">&#39;m&#39;</span><span class="p">:</span><span class="mf">1.6</span><span class="p">,</span> <span class="s1">&#39;n&#39;</span><span class="p">:</span><span class="mf">0.9</span><span class="p">,</span> <span class="s1">&#39;R0&#39;</span><span class="p">:</span><span class="mi">420000</span><span class="p">},</span>
</span><span id="L-316"><a href="#L-316"><span class="linenos"> 316</span></a>        <span class="n">kw_w06</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;n&#39;</span><span class="p">:</span><span class="mf">0.79</span><span class="p">,</span> <span class="s1">&#39;X&#39;</span><span class="p">:</span><span class="mi">243000</span><span class="p">},</span>
</span><span id="L-317"><a href="#L-317"><span class="linenos"> 317</span></a>        <span class="n">kw_m16</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;n&#39;</span><span class="p">:</span><span class="mf">0.6</span><span class="p">}</span>
</span><span id="L-318"><a href="#L-318"><span class="linenos"> 318</span></a>    <span class="p">):</span>
</span><span id="L-319"><a href="#L-319"><span class="linenos"> 319</span></a><span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="L-320"><a href="#L-320"><span class="linenos"> 320</span></a><span class="sd">        Calculate wind field using given method till a fractional distance of </span>
</span><span id="L-321"><a href="#L-321"><span class="linenos"> 321</span></a><span class="sd">        rmax.</span>
</span><span id="L-322"><a href="#L-322"><span class="linenos"> 322</span></a>
</span><span id="L-323"><a href="#L-323"><span class="linenos"> 323</span></a><span class="sd">        at: (r, theta) location where the wind is calculated,</span>
</span><span id="L-324"><a href="#L-324"><span class="linenos"> 324</span></a><span class="sd">            r, float, distance in m </span>
</span><span id="L-325"><a href="#L-325"><span class="linenos"> 325</span></a><span class="sd">            theta, float, is -2*np.pi, 2*np.pi radians</span>
</span><span id="L-326"><a href="#L-326"><span class="linenos"> 326</span></a><span class="sd">            Essentially theta is expected to be output from np.arctan2(y,x)</span>
</span><span id="L-327"><a href="#L-327"><span class="linenos"> 327</span></a><span class="sd">            Theis counter-clockwise from x-axis angle is converted to a clockwise</span>
</span><span id="L-328"><a href="#L-328"><span class="linenos"> 328</span></a><span class="sd">            angle from y axis to match the interpolation grid of the storm paramters. </span>
</span><span id="L-329"><a href="#L-329"><span class="linenos"> 329</span></a><span class="sd">        methods: array, list of methods to be used. Currently implemented methods</span>
</span><span id="L-330"><a href="#L-330"><span class="linenos"> 330</span></a><span class="sd">                are - H80, H80c, J92, W06, E04, E11, M16</span>
</span><span id="L-331"><a href="#L-331"><span class="linenos"> 331</span></a><span class="sd">        rmax_frac: array, till which fraction of rmax, the method to be used,</span>
</span><span id="L-332"><a href="#L-332"><span class="linenos"> 332</span></a><span class="sd">                np.inf for whole</span>
</span><span id="L-333"><a href="#L-333"><span class="linenos"> 333</span></a><span class="sd">        rmax_select: which rmax to select, int, str</span>
</span><span id="L-334"><a href="#L-334"><span class="linenos"> 334</span></a><span class="sd">                    &#39;mean&#39;: mean value of the rmax</span>
</span><span id="L-335"><a href="#L-335"><span class="linenos"> 335</span></a><span class="sd">                    &#39;nearest&#39;: rmax calculated from nearest frmax</span>
</span><span id="L-336"><a href="#L-336"><span class="linenos"> 336</span></a><span class="sd">                    &#39;linear&#39;: rmax calculated from a linear interpolation</span>
</span><span id="L-337"><a href="#L-337"><span class="linenos"> 337</span></a><span class="sd">                    int: number corresponding to selected rmax &gt;1</span>
</span><span id="L-338"><a href="#L-338"><span class="linenos"> 338</span></a><span class="sd">        kw_corr: corrections applied for translation and surface wind reduction</span>
</span><span id="L-339"><a href="#L-339"><span class="linenos"> 339</span></a><span class="sd">                fraction: fraction of translation wind, 0.56 default</span>
</span><span id="L-340"><a href="#L-340"><span class="linenos"> 340</span></a><span class="sd">                angle: angle of ratation, 19.2 degree default</span>
</span><span id="L-341"><a href="#L-341"><span class="linenos"> 341</span></a><span class="sd">                swrf: surface wind reduction factor, 0.9 default</span>
</span><span id="L-342"><a href="#L-342"><span class="linenos"> 342</span></a><span class="sd">                tfac: convertion factor to from x minute to 10 minute wind</span>
</span><span id="L-343"><a href="#L-343"><span class="linenos"> 343</span></a><span class="sd">                    0.88 for conversion from 1minute to 10minute</span>
</span><span id="L-344"><a href="#L-344"><span class="linenos"> 344</span></a><span class="sd">        kw_atmos: constant atmospheric values</span>
</span><span id="L-345"><a href="#L-345"><span class="linenos"> 345</span></a><span class="sd">            pn: nominal or environmental pressure, default 101325 Pa</span>
</span><span id="L-346"><a href="#L-346"><span class="linenos"> 346</span></a><span class="sd">            rhoair: air density, default 1.15 km/m^3</span>
</span><span id="L-347"><a href="#L-347"><span class="linenos"> 347</span></a><span class="sd">        kw_h80: extra argument for H80 model</span>
</span><span id="L-348"><a href="#L-348"><span class="linenos"> 348</span></a><span class="sd">            bmin: Minimum B value</span>
</span><span id="L-349"><a href="#L-349"><span class="linenos"> 349</span></a><span class="sd">            bmax: Maximum B value</span>
</span><span id="L-350"><a href="#L-350"><span class="linenos"> 350</span></a><span class="sd">        kw_e04: extra argument for E04 model</span>
</span><span id="L-351"><a href="#L-351"><span class="linenos"> 351</span></a><span class="sd">            b: default 0.25</span>
</span><span id="L-352"><a href="#L-352"><span class="linenos"> 352</span></a><span class="sd">            m: default 1.6</span>
</span><span id="L-353"><a href="#L-353"><span class="linenos"> 353</span></a><span class="sd">            n: default 0.9</span>
</span><span id="L-354"><a href="#L-354"><span class="linenos"> 354</span></a><span class="sd">            R0: default 420000m (420km)</span>
</span><span id="L-355"><a href="#L-355"><span class="linenos"> 355</span></a><span class="sd">        kw_w06: extra argument for W06 model</span>
</span><span id="L-356"><a href="#L-356"><span class="linenos"> 356</span></a><span class="sd">            n: default 0.79</span>
</span><span id="L-357"><a href="#L-357"><span class="linenos"> 357</span></a><span class="sd">            X: default 243000m (243km)</span>
</span><span id="L-358"><a href="#L-358"><span class="linenos"> 358</span></a><span class="sd">        kw_m16: extra argument for M16 model</span>
</span><span id="L-359"><a href="#L-359"><span class="linenos"> 359</span></a><span class="sd">            n: default 0.6</span>
</span><span id="L-360"><a href="#L-360"><span class="linenos"> 360</span></a><span class="sd">        &#39;&#39;&#39;</span>
</span><span id="L-361"><a href="#L-361"><span class="linenos"> 361</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-362"><a href="#L-362"><span class="linenos"> 362</span></a>            <span class="n">r</span><span class="p">,</span> <span class="n">theta_input</span> <span class="o">=</span> <span class="n">at</span>
</span><span id="L-363"><a href="#L-363"><span class="linenos"> 363</span></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="L-364"><a href="#L-364"><span class="linenos"> 364</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;the at must be in (r, theta) as list/array of size 2&#39;</span><span class="p">)</span>
</span><span id="L-365"><a href="#L-365"><span class="linenos"> 365</span></a>        
</span><span id="L-366"><a href="#L-366"><span class="linenos"> 366</span></a>        <span class="c1"># Convert theta from x-axis counter clock to y-axis clock wise</span>
</span><span id="L-367"><a href="#L-367"><span class="linenos"> 367</span></a>        <span class="n">theta</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="o">*</span><span class="n">theta_input</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span>
</span><span id="L-368"><a href="#L-368"><span class="linenos"> 368</span></a>
</span><span id="L-369"><a href="#L-369"><span class="linenos"> 369</span></a>        <span class="c1"># Theta -180:180 to 0:360 format, clockwise from 0N</span>
</span><span id="L-370"><a href="#L-370"><span class="linenos"> 370</span></a>        <span class="k">if</span> <span class="n">theta_input</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-371"><a href="#L-371"><span class="linenos"> 371</span></a>            <span class="n">theta</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">+</span> <span class="n">theta_input</span>
</span><span id="L-372"><a href="#L-372"><span class="linenos"> 372</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-373"><a href="#L-373"><span class="linenos"> 373</span></a>            <span class="n">theta</span> <span class="o">=</span> <span class="n">theta_input</span>
</span><span id="L-374"><a href="#L-374"><span class="linenos"> 374</span></a>
</span><span id="L-375"><a href="#L-375"><span class="linenos"> 375</span></a>        <span class="n">calc_vcirc</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-376"><a href="#L-376"><span class="linenos"> 376</span></a>            <span class="s1">&#39;H80&#39;</span><span class="p">:</span><span class="n">calc_vcirc_h80</span><span class="p">,</span>
</span><span id="L-377"><a href="#L-377"><span class="linenos"> 377</span></a>            <span class="s1">&#39;H80c&#39;</span><span class="p">:</span><span class="n">calc_vcirc_h80c</span><span class="p">,</span>
</span><span id="L-378"><a href="#L-378"><span class="linenos"> 378</span></a>            <span class="s1">&#39;J92&#39;</span><span class="p">:</span><span class="n">calc_vcirc_j92</span><span class="p">,</span>
</span><span id="L-379"><a href="#L-379"><span class="linenos"> 379</span></a>            <span class="s1">&#39;W06&#39;</span><span class="p">:</span><span class="n">calc_vcirc_w06</span><span class="p">,</span>
</span><span id="L-380"><a href="#L-380"><span class="linenos"> 380</span></a>            <span class="s1">&#39;E04&#39;</span><span class="p">:</span><span class="n">calc_vcirc_e04</span><span class="p">,</span>
</span><span id="L-381"><a href="#L-381"><span class="linenos"> 381</span></a>            <span class="s1">&#39;E11&#39;</span><span class="p">:</span><span class="n">calc_vcirc_e11</span><span class="p">,</span>
</span><span id="L-382"><a href="#L-382"><span class="linenos"> 382</span></a>            <span class="s1">&#39;M16&#39;</span><span class="p">:</span><span class="n">calc_vcirc_m16</span>
</span><span id="L-383"><a href="#L-383"><span class="linenos"> 383</span></a>        <span class="p">}</span>
</span><span id="L-384"><a href="#L-384"><span class="linenos"> 384</span></a>
</span><span id="L-385"><a href="#L-385"><span class="linenos"> 385</span></a>        <span class="c1"># Calculate vmax for further calculation</span>
</span><span id="L-386"><a href="#L-386"><span class="linenos"> 386</span></a>        <span class="n">vmax</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;fvmax&#39;</span><span class="p">](</span><span class="n">theta</span><span class="p">)</span>
</span><span id="L-387"><a href="#L-387"><span class="linenos"> 387</span></a>
</span><span id="L-388"><a href="#L-388"><span class="linenos"> 388</span></a>        <span class="c1"># Find appropriate rmax function to be used</span>
</span><span id="L-389"><a href="#L-389"><span class="linenos"> 389</span></a>        <span class="c1"># and calculate rmax</span>
</span><span id="L-390"><a href="#L-390"><span class="linenos"> 390</span></a>        <span class="n">rmax_select_methods_available</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;nearest&#39;</span><span class="p">,</span> <span class="s1">&#39;linear&#39;</span><span class="p">]</span>
</span><span id="L-391"><a href="#L-391"><span class="linenos"> 391</span></a>
</span><span id="L-392"><a href="#L-392"><span class="linenos"> 392</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rmax_select</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="L-393"><a href="#L-393"><span class="linenos"> 393</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="L-394"><a href="#L-394"><span class="linenos"> 394</span></a>                <span class="k">assert</span> <span class="n">rmax_select</span> <span class="ow">in</span> <span class="n">rmax_select_methods_available</span>
</span><span id="L-395"><a href="#L-395"><span class="linenos"> 395</span></a>
</span><span id="L-396"><a href="#L-396"><span class="linenos"> 396</span></a>                <span class="k">if</span> <span class="n">rmax_select</span><span class="o">==</span><span class="s1">&#39;mean&#39;</span><span class="p">:</span>
</span><span id="L-397"><a href="#L-397"><span class="linenos"> 397</span></a>                    <span class="n">rmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">([</span><span class="n">f</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;frmax&#39;</span><span class="p">])])</span>
</span><span id="L-398"><a href="#L-398"><span class="linenos"> 398</span></a>                
</span><span id="L-399"><a href="#L-399"><span class="linenos"> 399</span></a>                <span class="k">if</span> <span class="n">rmax_select</span><span class="o">==</span><span class="s1">&#39;nearest&#39;</span><span class="p">:</span>
</span><span id="L-400"><a href="#L-400"><span class="linenos"> 400</span></a>                    <span class="k">try</span><span class="p">:</span>
</span><span id="L-401"><a href="#L-401"><span class="linenos"> 401</span></a>                        <span class="n">radinfo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">radi</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="k">for</span> <span class="n">radi</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;fradinfo&#39;</span><span class="p">]])</span>
</span><span id="L-402"><a href="#L-402"><span class="linenos"> 402</span></a>                        <span class="n">radnn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">radinfo</span><span class="o">-</span><span class="n">r</span><span class="p">))</span>
</span><span id="L-403"><a href="#L-403"><span class="linenos"> 403</span></a>                        <span class="n">rmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">f</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;frmax&#39;</span><span class="p">])])[</span><span class="n">radnn</span><span class="p">]</span>
</span><span id="L-404"><a href="#L-404"><span class="linenos"> 404</span></a>                    <span class="k">except</span><span class="p">:</span>
</span><span id="L-405"><a href="#L-405"><span class="linenos"> 405</span></a>                        <span class="n">rmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;frmax&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">](</span><span class="n">theta</span><span class="p">)</span>
</span><span id="L-406"><a href="#L-406"><span class="linenos"> 406</span></a>                        <span class="k">raise</span> <span class="ne">Warning</span><span class="p">(</span><span class="s1">&#39;nearest not possible, first rmax selected&#39;</span><span class="p">)</span>
</span><span id="L-407"><a href="#L-407"><span class="linenos"> 407</span></a>
</span><span id="L-408"><a href="#L-408"><span class="linenos"> 408</span></a>                <span class="k">if</span> <span class="n">rmax_select</span><span class="o">==</span><span class="s1">&#39;linear&#39;</span><span class="p">:</span>
</span><span id="L-409"><a href="#L-409"><span class="linenos"> 409</span></a>                    <span class="k">try</span><span class="p">:</span>
</span><span id="L-410"><a href="#L-410"><span class="linenos"> 410</span></a>                        <span class="c1"># x field from -inf to +inf</span>
</span><span id="L-411"><a href="#L-411"><span class="linenos"> 411</span></a>                        <span class="n">radinfo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">radi</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="k">for</span> <span class="n">radi</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;fradinfo&#39;</span><span class="p">]])</span>
</span><span id="L-412"><a href="#L-412"><span class="linenos"> 412</span></a>                        <span class="n">radinfo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">radinfo</span><span class="p">)</span>
</span><span id="L-413"><a href="#L-413"><span class="linenos"> 413</span></a>                        <span class="n">radinfo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">radinfo</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
</span><span id="L-414"><a href="#L-414"><span class="linenos"> 414</span></a>                        <span class="c1"># y field </span>
</span><span id="L-415"><a href="#L-415"><span class="linenos"> 415</span></a>                        <span class="n">rmaxinfo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">f</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;frmax&#39;</span><span class="p">])])</span>
</span><span id="L-416"><a href="#L-416"><span class="linenos"> 416</span></a>                        <span class="n">rmaxinfo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rmaxinfo</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">rmaxinfo</span><span class="p">)</span>
</span><span id="L-417"><a href="#L-417"><span class="linenos"> 417</span></a>                        <span class="n">rmaxinfo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rmaxinfo</span><span class="p">,</span> <span class="n">rmaxinfo</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</span><span id="L-418"><a href="#L-418"><span class="linenos"> 418</span></a>                        <span class="n">int_f</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">radinfo</span><span class="p">,</span> <span class="n">rmaxinfo</span><span class="p">)</span>
</span><span id="L-419"><a href="#L-419"><span class="linenos"> 419</span></a>                        <span class="n">rmax</span> <span class="o">=</span> <span class="n">int_f</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
</span><span id="L-420"><a href="#L-420"><span class="linenos"> 420</span></a>                    <span class="k">except</span><span class="p">:</span>
</span><span id="L-421"><a href="#L-421"><span class="linenos"> 421</span></a>                        <span class="n">rmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;frmax&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">](</span><span class="n">theta</span><span class="p">)</span>
</span><span id="L-422"><a href="#L-422"><span class="linenos"> 422</span></a>                        <span class="k">raise</span> <span class="ne">Warning</span><span class="p">(</span><span class="s1">&#39;linear not possible, first rmax selected&#39;</span><span class="p">)</span>
</span><span id="L-423"><a href="#L-423"><span class="linenos"> 423</span></a>            <span class="k">except</span><span class="p">:</span>
</span><span id="L-424"><a href="#L-424"><span class="linenos"> 424</span></a>                <span class="n">rmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;frmax&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">](</span><span class="n">theta</span><span class="p">)</span>
</span><span id="L-425"><a href="#L-425"><span class="linenos"> 425</span></a>                <span class="k">raise</span> <span class="ne">Warning</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Wrong keyword for rmax method. First frmax is used&#39;</span><span class="p">)</span>
</span><span id="L-426"><a href="#L-426"><span class="linenos"> 426</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rmax_select</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="L-427"><a href="#L-427"><span class="linenos"> 427</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="L-428"><a href="#L-428"><span class="linenos"> 428</span></a>                <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">f</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;frmax&#39;</span><span class="p">])])[</span><span class="n">rmax_select</span><span class="p">]</span>
</span><span id="L-429"><a href="#L-429"><span class="linenos"> 429</span></a>            <span class="k">except</span><span class="p">:</span>
</span><span id="L-430"><a href="#L-430"><span class="linenos"> 430</span></a>                <span class="n">rmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;frmax&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">](</span><span class="n">theta</span><span class="p">)</span>
</span><span id="L-431"><a href="#L-431"><span class="linenos"> 431</span></a>                <span class="k">raise</span> <span class="ne">Warning</span><span class="p">(</span><span class="s1">&#39;Wrong rmax index. First frmax is used&#39;</span><span class="p">)</span>
</span><span id="L-432"><a href="#L-432"><span class="linenos"> 432</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-433"><a href="#L-433"><span class="linenos"> 433</span></a>            <span class="n">rmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;frmax&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">](</span><span class="n">theta</span><span class="p">)</span>
</span><span id="L-434"><a href="#L-434"><span class="linenos"> 434</span></a>            <span class="k">raise</span> <span class="ne">Warning</span><span class="p">(</span><span class="s1">&#39;Wrong rmax selection keyword/index. First frmax is used&#39;</span><span class="p">)</span>
</span><span id="L-435"><a href="#L-435"><span class="linenos"> 435</span></a>
</span><span id="L-436"><a href="#L-436"><span class="linenos"> 436</span></a>        <span class="c1"># Now check methods and rmax_frac and apply method as required</span>
</span><span id="L-437"><a href="#L-437"><span class="linenos"> 437</span></a>        <span class="c1"># Avoid wrong input of rmax_frac</span>
</span><span id="L-438"><a href="#L-438"><span class="linenos"> 438</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-439"><a href="#L-439"><span class="linenos"> 439</span></a>            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">rmax_frac</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">methods</span><span class="p">)</span>
</span><span id="L-440"><a href="#L-440"><span class="linenos"> 440</span></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="L-441"><a href="#L-441"><span class="linenos"> 441</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;rmax_frac must corresponds to each listed method&#39;</span><span class="p">)</span>
</span><span id="L-442"><a href="#L-442"><span class="linenos"> 442</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-443"><a href="#L-443"><span class="linenos"> 443</span></a>            <span class="n">rmax_frac</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">rmax_frac</span><span class="p">)</span>
</span><span id="L-444"><a href="#L-444"><span class="linenos"> 444</span></a>        
</span><span id="L-445"><a href="#L-445"><span class="linenos"> 445</span></a>        <span class="n">rlim_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">rmax_frac</span><span class="p">)[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">rmax</span> <span class="c1"># Starts from 0</span>
</span><span id="L-446"><a href="#L-446"><span class="linenos"> 446</span></a>        <span class="n">rlim_max</span> <span class="o">=</span> <span class="n">rmax_frac</span><span class="o">*</span><span class="n">rmax</span>
</span><span id="L-447"><a href="#L-447"><span class="linenos"> 447</span></a>
</span><span id="L-448"><a href="#L-448"><span class="linenos"> 448</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">method</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">methods</span><span class="p">):</span>
</span><span id="L-449"><a href="#L-449"><span class="linenos"> 449</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="L-450"><a href="#L-450"><span class="linenos"> 450</span></a>                <span class="k">assert</span> <span class="n">r</span> <span class="o">&gt;=</span> <span class="n">rlim_min</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="L-451"><a href="#L-451"><span class="linenos"> 451</span></a>                <span class="k">assert</span> <span class="n">r</span> <span class="o">&lt;</span> <span class="n">rlim_max</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="L-452"><a href="#L-452"><span class="linenos"> 452</span></a>
</span><span id="L-453"><a href="#L-453"><span class="linenos"> 453</span></a>                <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;H80&#39;</span><span class="p">:</span>
</span><span id="L-454"><a href="#L-454"><span class="linenos"> 454</span></a>                    <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-455"><a href="#L-455"><span class="linenos"> 455</span></a>                        <span class="s1">&#39;vmax&#39;</span><span class="p">:</span><span class="n">vmax</span><span class="p">,</span> 
</span><span id="L-456"><a href="#L-456"><span class="linenos"> 456</span></a>                        <span class="s1">&#39;rmax&#39;</span><span class="p">:</span><span class="n">rmax</span><span class="p">,</span>
</span><span id="L-457"><a href="#L-457"><span class="linenos"> 457</span></a>                        <span class="s1">&#39;pc&#39;</span><span class="p">:</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;mslp&#39;</span><span class="p">],</span>
</span><span id="L-458"><a href="#L-458"><span class="linenos"> 458</span></a>                        <span class="s1">&#39;f&#39;</span><span class="p">:</span><span class="n">coriolis</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">]),</span>
</span><span id="L-459"><a href="#L-459"><span class="linenos"> 459</span></a>                        <span class="s1">&#39;pn&#39;</span><span class="p">:</span><span class="n">kw_atmos</span><span class="p">[</span><span class="s1">&#39;pn&#39;</span><span class="p">],</span>
</span><span id="L-460"><a href="#L-460"><span class="linenos"> 460</span></a>                        <span class="s1">&#39;rhoair&#39;</span><span class="p">:</span><span class="n">kw_atmos</span><span class="p">[</span><span class="s1">&#39;rhoair&#39;</span><span class="p">],</span>
</span><span id="L-461"><a href="#L-461"><span class="linenos"> 461</span></a>                        <span class="s1">&#39;bmax&#39;</span><span class="p">:</span><span class="n">kw_h80</span><span class="p">[</span><span class="s1">&#39;bmax&#39;</span><span class="p">],</span>
</span><span id="L-462"><a href="#L-462"><span class="linenos"> 462</span></a>                        <span class="s1">&#39;bmin&#39;</span><span class="p">:</span><span class="n">kw_h80</span><span class="p">[</span><span class="s1">&#39;bmin&#39;</span><span class="p">]</span>
</span><span id="L-463"><a href="#L-463"><span class="linenos"> 463</span></a>                    <span class="p">}</span>
</span><span id="L-464"><a href="#L-464"><span class="linenos"> 464</span></a>                    <span class="n">B</span> <span class="o">=</span> <span class="n">calc_holland_B_full</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="L-465"><a href="#L-465"><span class="linenos"> 465</span></a>                    <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-466"><a href="#L-466"><span class="linenos"> 466</span></a>                        <span class="s1">&#39;r&#39;</span><span class="p">:</span><span class="n">r</span><span class="p">,</span>
</span><span id="L-467"><a href="#L-467"><span class="linenos"> 467</span></a>                        <span class="s1">&#39;Rm&#39;</span><span class="p">:</span><span class="n">rmax</span><span class="p">,</span>
</span><span id="L-468"><a href="#L-468"><span class="linenos"> 468</span></a>                        <span class="s1">&#39;pc&#39;</span><span class="p">:</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;mslp&#39;</span><span class="p">],</span>
</span><span id="L-469"><a href="#L-469"><span class="linenos"> 469</span></a>                        <span class="s1">&#39;B&#39;</span><span class="p">:</span><span class="n">B</span><span class="p">,</span>
</span><span id="L-470"><a href="#L-470"><span class="linenos"> 470</span></a>                        <span class="s1">&#39;pn&#39;</span><span class="p">:</span><span class="n">kw_atmos</span><span class="p">[</span><span class="s1">&#39;pn&#39;</span><span class="p">],</span>
</span><span id="L-471"><a href="#L-471"><span class="linenos"> 471</span></a>                        <span class="s1">&#39;rhoair&#39;</span><span class="p">:</span><span class="n">kw_atmos</span><span class="p">[</span><span class="s1">&#39;rhoair&#39;</span><span class="p">],</span>
</span><span id="L-472"><a href="#L-472"><span class="linenos"> 472</span></a>                        <span class="s1">&#39;f&#39;</span><span class="p">:</span><span class="n">coriolis</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">])</span>
</span><span id="L-473"><a href="#L-473"><span class="linenos"> 473</span></a>                    <span class="p">}</span>
</span><span id="L-474"><a href="#L-474"><span class="linenos"> 474</span></a>                    <span class="n">vcirc</span> <span class="o">=</span> <span class="n">calc_vcirc</span><span class="p">[</span><span class="n">method</span><span class="p">](</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="L-475"><a href="#L-475"><span class="linenos"> 475</span></a>                
</span><span id="L-476"><a href="#L-476"><span class="linenos"> 476</span></a>                <span class="k">if</span> <span class="n">method</span><span class="o">==</span><span class="s1">&#39;H80c&#39;</span><span class="p">:</span>
</span><span id="L-477"><a href="#L-477"><span class="linenos"> 477</span></a>                    <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-478"><a href="#L-478"><span class="linenos"> 478</span></a>                        <span class="s1">&#39;vmax&#39;</span><span class="p">:</span><span class="n">vmax</span><span class="p">,</span> 
</span><span id="L-479"><a href="#L-479"><span class="linenos"> 479</span></a>                        <span class="s1">&#39;pc&#39;</span><span class="p">:</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;mslp&#39;</span><span class="p">],</span>
</span><span id="L-480"><a href="#L-480"><span class="linenos"> 480</span></a>                        <span class="s1">&#39;pn&#39;</span><span class="p">:</span><span class="n">kw_atmos</span><span class="p">[</span><span class="s1">&#39;pn&#39;</span><span class="p">],</span>
</span><span id="L-481"><a href="#L-481"><span class="linenos"> 481</span></a>                        <span class="s1">&#39;rhoair&#39;</span><span class="p">:</span><span class="n">kw_atmos</span><span class="p">[</span><span class="s1">&#39;rhoair&#39;</span><span class="p">],</span>
</span><span id="L-482"><a href="#L-482"><span class="linenos"> 482</span></a>                        <span class="s1">&#39;bmax&#39;</span><span class="p">:</span><span class="n">kw_h80</span><span class="p">[</span><span class="s1">&#39;bmax&#39;</span><span class="p">],</span>
</span><span id="L-483"><a href="#L-483"><span class="linenos"> 483</span></a>                        <span class="s1">&#39;bmin&#39;</span><span class="p">:</span><span class="n">kw_h80</span><span class="p">[</span><span class="s1">&#39;bmin&#39;</span><span class="p">]</span>
</span><span id="L-484"><a href="#L-484"><span class="linenos"> 484</span></a>                    <span class="p">}</span>
</span><span id="L-485"><a href="#L-485"><span class="linenos"> 485</span></a>                    <span class="n">B</span> <span class="o">=</span> <span class="n">calc_holland_B</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="L-486"><a href="#L-486"><span class="linenos"> 486</span></a>                    <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-487"><a href="#L-487"><span class="linenos"> 487</span></a>                        <span class="s1">&#39;r&#39;</span><span class="p">:</span><span class="n">r</span><span class="p">,</span>
</span><span id="L-488"><a href="#L-488"><span class="linenos"> 488</span></a>                        <span class="s1">&#39;Rm&#39;</span><span class="p">:</span><span class="n">rmax</span><span class="p">,</span>
</span><span id="L-489"><a href="#L-489"><span class="linenos"> 489</span></a>                        <span class="s1">&#39;pc&#39;</span><span class="p">:</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;mslp&#39;</span><span class="p">],</span>
</span><span id="L-490"><a href="#L-490"><span class="linenos"> 490</span></a>                        <span class="s1">&#39;B&#39;</span><span class="p">:</span><span class="n">B</span><span class="p">,</span>
</span><span id="L-491"><a href="#L-491"><span class="linenos"> 491</span></a>                        <span class="s1">&#39;pn&#39;</span><span class="p">:</span><span class="n">kw_atmos</span><span class="p">[</span><span class="s1">&#39;pn&#39;</span><span class="p">],</span>
</span><span id="L-492"><a href="#L-492"><span class="linenos"> 492</span></a>                        <span class="s1">&#39;rhoair&#39;</span><span class="p">:</span><span class="n">kw_atmos</span><span class="p">[</span><span class="s1">&#39;rhoair&#39;</span><span class="p">]</span>
</span><span id="L-493"><a href="#L-493"><span class="linenos"> 493</span></a>                    <span class="p">}</span>
</span><span id="L-494"><a href="#L-494"><span class="linenos"> 494</span></a>                    <span class="n">vcirc</span> <span class="o">=</span> <span class="n">calc_vcirc</span><span class="p">[</span><span class="n">method</span><span class="p">](</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="L-495"><a href="#L-495"><span class="linenos"> 495</span></a>
</span><span id="L-496"><a href="#L-496"><span class="linenos"> 496</span></a>                <span class="k">if</span> <span class="n">method</span><span class="o">==</span><span class="s1">&#39;J92&#39;</span><span class="p">:</span>
</span><span id="L-497"><a href="#L-497"><span class="linenos"> 497</span></a>                    <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-498"><a href="#L-498"><span class="linenos"> 498</span></a>                        <span class="s1">&#39;r&#39;</span><span class="p">:</span> <span class="n">r</span><span class="p">,</span>
</span><span id="L-499"><a href="#L-499"><span class="linenos"> 499</span></a>                        <span class="s1">&#39;Rm&#39;</span><span class="p">:</span><span class="n">rmax</span><span class="p">,</span>
</span><span id="L-500"><a href="#L-500"><span class="linenos"> 500</span></a>                        <span class="s1">&#39;Vm&#39;</span><span class="p">:</span><span class="n">vmax</span>
</span><span id="L-501"><a href="#L-501"><span class="linenos"> 501</span></a>                    <span class="p">}</span>
</span><span id="L-502"><a href="#L-502"><span class="linenos"> 502</span></a>                    <span class="n">vcirc</span> <span class="o">=</span> <span class="n">calc_vcirc</span><span class="p">[</span><span class="n">method</span><span class="p">](</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="L-503"><a href="#L-503"><span class="linenos"> 503</span></a>
</span><span id="L-504"><a href="#L-504"><span class="linenos"> 504</span></a>                <span class="k">if</span> <span class="n">method</span><span class="o">==</span><span class="s1">&#39;W06&#39;</span><span class="p">:</span>
</span><span id="L-505"><a href="#L-505"><span class="linenos"> 505</span></a>                    <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-506"><a href="#L-506"><span class="linenos"> 506</span></a>                        <span class="s1">&#39;r&#39;</span><span class="p">:</span><span class="n">r</span><span class="p">,</span>
</span><span id="L-507"><a href="#L-507"><span class="linenos"> 507</span></a>                        <span class="s1">&#39;Rm&#39;</span><span class="p">:</span><span class="n">rmax</span><span class="p">,</span>
</span><span id="L-508"><a href="#L-508"><span class="linenos"> 508</span></a>                        <span class="s1">&#39;Vm&#39;</span><span class="p">:</span><span class="n">vmax</span><span class="p">,</span>
</span><span id="L-509"><a href="#L-509"><span class="linenos"> 509</span></a>                        <span class="s1">&#39;n&#39;</span><span class="p">:</span><span class="n">kw_w06</span><span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">],</span>
</span><span id="L-510"><a href="#L-510"><span class="linenos"> 510</span></a>                        <span class="s1">&#39;X&#39;</span><span class="p">:</span><span class="n">kw_w06</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">]</span>
</span><span id="L-511"><a href="#L-511"><span class="linenos"> 511</span></a>                    <span class="p">}</span>
</span><span id="L-512"><a href="#L-512"><span class="linenos"> 512</span></a>                    <span class="n">vcirc</span> <span class="o">=</span> <span class="n">calc_vcirc</span><span class="p">[</span><span class="n">method</span><span class="p">](</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="L-513"><a href="#L-513"><span class="linenos"> 513</span></a>
</span><span id="L-514"><a href="#L-514"><span class="linenos"> 514</span></a>                <span class="k">if</span> <span class="n">method</span><span class="o">==</span><span class="s1">&#39;E04&#39;</span><span class="p">:</span>
</span><span id="L-515"><a href="#L-515"><span class="linenos"> 515</span></a>                    <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-516"><a href="#L-516"><span class="linenos"> 516</span></a>                        <span class="s1">&#39;r&#39;</span><span class="p">:</span><span class="n">r</span><span class="p">,</span>
</span><span id="L-517"><a href="#L-517"><span class="linenos"> 517</span></a>                        <span class="s1">&#39;Rm&#39;</span><span class="p">:</span><span class="n">rmax</span><span class="p">,</span>
</span><span id="L-518"><a href="#L-518"><span class="linenos"> 518</span></a>                        <span class="s1">&#39;Vm&#39;</span><span class="p">:</span><span class="n">vmax</span><span class="p">,</span>
</span><span id="L-519"><a href="#L-519"><span class="linenos"> 519</span></a>                        <span class="s1">&#39;b&#39;</span><span class="p">:</span><span class="n">kw_e04</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">],</span>
</span><span id="L-520"><a href="#L-520"><span class="linenos"> 520</span></a>                        <span class="s1">&#39;m&#39;</span><span class="p">:</span><span class="n">kw_e04</span><span class="p">[</span><span class="s1">&#39;m&#39;</span><span class="p">],</span>
</span><span id="L-521"><a href="#L-521"><span class="linenos"> 521</span></a>                        <span class="s1">&#39;n&#39;</span><span class="p">:</span><span class="n">kw_e04</span><span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">],</span>
</span><span id="L-522"><a href="#L-522"><span class="linenos"> 522</span></a>                        <span class="s1">&#39;R0&#39;</span><span class="p">:</span><span class="n">kw_e04</span><span class="p">[</span><span class="s1">&#39;R0&#39;</span><span class="p">]</span>
</span><span id="L-523"><a href="#L-523"><span class="linenos"> 523</span></a>                    <span class="p">}</span>
</span><span id="L-524"><a href="#L-524"><span class="linenos"> 524</span></a>                    <span class="n">vcirc</span> <span class="o">=</span> <span class="n">calc_vcirc</span><span class="p">[</span><span class="n">method</span><span class="p">](</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="L-525"><a href="#L-525"><span class="linenos"> 525</span></a>                    <span class="k">if</span> <span class="n">vcirc</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-526"><a href="#L-526"><span class="linenos"> 526</span></a>                        <span class="n">vcirc</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-527"><a href="#L-527"><span class="linenos"> 527</span></a>
</span><span id="L-528"><a href="#L-528"><span class="linenos"> 528</span></a>                <span class="k">if</span> <span class="n">method</span><span class="o">==</span><span class="s1">&#39;E11&#39;</span><span class="p">:</span>
</span><span id="L-529"><a href="#L-529"><span class="linenos"> 529</span></a>                    <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-530"><a href="#L-530"><span class="linenos"> 530</span></a>                        <span class="s1">&#39;r&#39;</span><span class="p">:</span><span class="n">r</span><span class="p">,</span>
</span><span id="L-531"><a href="#L-531"><span class="linenos"> 531</span></a>                        <span class="s1">&#39;Rm&#39;</span><span class="p">:</span><span class="n">rmax</span><span class="p">,</span>
</span><span id="L-532"><a href="#L-532"><span class="linenos"> 532</span></a>                        <span class="s1">&#39;Vm&#39;</span><span class="p">:</span><span class="n">vmax</span><span class="p">,</span>
</span><span id="L-533"><a href="#L-533"><span class="linenos"> 533</span></a>                        <span class="s1">&#39;f&#39;</span><span class="p">:</span><span class="n">coriolis</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">])</span>
</span><span id="L-534"><a href="#L-534"><span class="linenos"> 534</span></a>                    <span class="p">}</span>
</span><span id="L-535"><a href="#L-535"><span class="linenos"> 535</span></a>                    <span class="n">vcirc</span> <span class="o">=</span> <span class="n">calc_vcirc</span><span class="p">[</span><span class="n">method</span><span class="p">](</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="L-536"><a href="#L-536"><span class="linenos"> 536</span></a>                    <span class="k">if</span> <span class="n">vcirc</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-537"><a href="#L-537"><span class="linenos"> 537</span></a>                        <span class="n">vcirc</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-538"><a href="#L-538"><span class="linenos"> 538</span></a>
</span><span id="L-539"><a href="#L-539"><span class="linenos"> 539</span></a>                <span class="k">if</span> <span class="n">method</span><span class="o">==</span><span class="s1">&#39;M16&#39;</span><span class="p">:</span>
</span><span id="L-540"><a href="#L-540"><span class="linenos"> 540</span></a>                    <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-541"><a href="#L-541"><span class="linenos"> 541</span></a>                        <span class="s1">&#39;r&#39;</span><span class="p">:</span><span class="n">r</span><span class="p">,</span>
</span><span id="L-542"><a href="#L-542"><span class="linenos"> 542</span></a>                        <span class="s1">&#39;Rm&#39;</span><span class="p">:</span><span class="n">rmax</span><span class="p">,</span>
</span><span id="L-543"><a href="#L-543"><span class="linenos"> 543</span></a>                        <span class="s1">&#39;Vm&#39;</span><span class="p">:</span><span class="n">vmax</span><span class="p">,</span>
</span><span id="L-544"><a href="#L-544"><span class="linenos"> 544</span></a>                        <span class="s1">&#39;n&#39;</span><span class="p">:</span><span class="n">kw_m16</span><span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">]</span>
</span><span id="L-545"><a href="#L-545"><span class="linenos"> 545</span></a>                    <span class="p">}</span>
</span><span id="L-546"><a href="#L-546"><span class="linenos"> 546</span></a>                    <span class="n">vcirc</span> <span class="o">=</span> <span class="n">calc_vcirc</span><span class="p">[</span><span class="n">method</span><span class="p">](</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="L-547"><a href="#L-547"><span class="linenos"> 547</span></a>                <span class="k">break</span>
</span><span id="L-548"><a href="#L-548"><span class="linenos"> 548</span></a>            <span class="k">except</span><span class="p">:</span>
</span><span id="L-549"><a href="#L-549"><span class="linenos"> 549</span></a>                <span class="k">continue</span>
</span><span id="L-550"><a href="#L-550"><span class="linenos"> 550</span></a>        
</span><span id="L-551"><a href="#L-551"><span class="linenos"> 551</span></a>        <span class="c1"># Calculating u,v wind with translation correction</span>
</span><span id="L-552"><a href="#L-552"><span class="linenos"> 552</span></a>        <span class="n">vcirc</span> <span class="o">=</span> <span class="n">vcirc</span> <span class="o">*</span> <span class="n">kw_corr</span><span class="p">[</span><span class="s1">&#39;swrf&#39;</span><span class="p">]</span>
</span><span id="L-553"><a href="#L-553"><span class="linenos"> 553</span></a>
</span><span id="L-554"><a href="#L-554"><span class="linenos"> 554</span></a>        <span class="n">u</span> <span class="o">=</span> <span class="o">-</span><span class="n">vcirc</span><span class="o">*</span><span class="n">r</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta_input</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">([</span><span class="n">r</span><span class="p">,</span> <span class="mf">1e-8</span><span class="p">])</span> <span class="c1"># 1e-8 avoids x/0</span>
</span><span id="L-555"><a href="#L-555"><span class="linenos"> 555</span></a>        <span class="n">v</span> <span class="o">=</span> <span class="n">vcirc</span><span class="o">*</span><span class="n">r</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta_input</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">([</span><span class="n">r</span><span class="p">,</span> <span class="mf">1e-8</span><span class="p">])</span>
</span><span id="L-556"><a href="#L-556"><span class="linenos"> 556</span></a>
</span><span id="L-557"><a href="#L-557"><span class="linenos"> 557</span></a>        <span class="n">utrans</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;ustorm&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">kw_corr</span><span class="p">[</span><span class="s1">&#39;angle&#39;</span><span class="p">]))</span> <span class="o">-</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;vstorm&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">kw_corr</span><span class="p">[</span><span class="s1">&#39;angle&#39;</span><span class="p">]))</span>
</span><span id="L-558"><a href="#L-558"><span class="linenos"> 558</span></a>        <span class="n">vtrans</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;ustorm&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">kw_corr</span><span class="p">[</span><span class="s1">&#39;angle&#39;</span><span class="p">]))</span> <span class="o">+</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;vstorm&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">kw_corr</span><span class="p">[</span><span class="s1">&#39;angle&#39;</span><span class="p">]))</span>
</span><span id="L-559"><a href="#L-559"><span class="linenos"> 559</span></a>
</span><span id="L-560"><a href="#L-560"><span class="linenos"> 560</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-561"><a href="#L-561"><span class="linenos"> 561</span></a>            <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_not</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">utrans</span><span class="p">)))</span>
</span><span id="L-562"><a href="#L-562"><span class="linenos"> 562</span></a>            <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_not</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">vtrans</span><span class="p">)))</span>
</span><span id="L-563"><a href="#L-563"><span class="linenos"> 563</span></a>
</span><span id="L-564"><a href="#L-564"><span class="linenos"> 564</span></a>            <span class="n">u</span> <span class="o">=</span> <span class="n">u</span> <span class="o">+</span> <span class="n">kw_corr</span><span class="p">[</span><span class="s1">&#39;fraction&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">utrans</span>
</span><span id="L-565"><a href="#L-565"><span class="linenos"> 565</span></a>            <span class="n">v</span> <span class="o">=</span> <span class="n">v</span> <span class="o">+</span> <span class="n">kw_corr</span><span class="p">[</span><span class="s1">&#39;fraction&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">vtrans</span>
</span><span id="L-566"><a href="#L-566"><span class="linenos"> 566</span></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="L-567"><a href="#L-567"><span class="linenos"> 567</span></a>            <span class="n">u</span> <span class="o">=</span> <span class="n">u</span>
</span><span id="L-568"><a href="#L-568"><span class="linenos"> 568</span></a>            <span class="n">v</span> <span class="o">=</span> <span class="n">v</span>
</span><span id="L-569"><a href="#L-569"><span class="linenos"> 569</span></a>
</span><span id="L-570"><a href="#L-570"><span class="linenos"> 570</span></a>        <span class="n">u</span> <span class="o">=</span> <span class="n">u</span> <span class="o">*</span> <span class="n">kw_corr</span><span class="p">[</span><span class="s1">&#39;tfac&#39;</span><span class="p">]</span>
</span><span id="L-571"><a href="#L-571"><span class="linenos"> 571</span></a>        <span class="n">v</span> <span class="o">=</span> <span class="n">v</span> <span class="o">*</span> <span class="n">kw_corr</span><span class="p">[</span><span class="s1">&#39;tfac&#39;</span><span class="p">]</span>
</span><span id="L-572"><a href="#L-572"><span class="linenos"> 572</span></a>
</span><span id="L-573"><a href="#L-573"><span class="linenos"> 573</span></a>        <span class="k">return</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
</span><span id="L-574"><a href="#L-574"><span class="linenos"> 574</span></a>    
</span><span id="L-575"><a href="#L-575"><span class="linenos"> 575</span></a>    <span class="k">def</span> <span class="nf">calculate_pressure</span><span class="p">(</span>
</span><span id="L-576"><a href="#L-576"><span class="linenos"> 576</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-577"><a href="#L-577"><span class="linenos"> 577</span></a>        <span class="n">at</span><span class="p">,</span>
</span><span id="L-578"><a href="#L-578"><span class="linenos"> 578</span></a>        <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;H80&#39;</span><span class="p">],</span>
</span><span id="L-579"><a href="#L-579"><span class="linenos"> 579</span></a>        <span class="n">rmax_frac</span><span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">],</span>
</span><span id="L-580"><a href="#L-580"><span class="linenos"> 580</span></a>        <span class="n">rmax_select</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span>
</span><span id="L-581"><a href="#L-581"><span class="linenos"> 581</span></a>        <span class="n">kw_atmos</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;pn&#39;</span><span class="p">:</span><span class="mi">101325</span><span class="p">,</span> <span class="s1">&#39;rhoair&#39;</span><span class="p">:</span><span class="mf">1.15</span><span class="p">},</span>
</span><span id="L-582"><a href="#L-582"><span class="linenos"> 582</span></a>        <span class="n">kw_h80</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;bmax&#39;</span><span class="p">:</span><span class="mf">2.5</span><span class="p">,</span> <span class="s1">&#39;bmin&#39;</span><span class="p">:</span><span class="mf">0.5</span><span class="p">}</span>
</span><span id="L-583"><a href="#L-583"><span class="linenos"> 583</span></a>    <span class="p">):</span>
</span><span id="L-584"><a href="#L-584"><span class="linenos"> 584</span></a><span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="L-585"><a href="#L-585"><span class="linenos"> 585</span></a><span class="sd">        Calculate pressure field using given method till a fractional distance of </span>
</span><span id="L-586"><a href="#L-586"><span class="linenos"> 586</span></a><span class="sd">        rmax.</span>
</span><span id="L-587"><a href="#L-587"><span class="linenos"> 587</span></a>
</span><span id="L-588"><a href="#L-588"><span class="linenos"> 588</span></a><span class="sd">        at: (r, theta) location where the wind is calculated,</span>
</span><span id="L-589"><a href="#L-589"><span class="linenos"> 589</span></a><span class="sd">            r, float, distance in m </span>
</span><span id="L-590"><a href="#L-590"><span class="linenos"> 590</span></a><span class="sd">            theta, float, is -2*np.pi, 2*np.pi radians</span>
</span><span id="L-591"><a href="#L-591"><span class="linenos"> 591</span></a><span class="sd">            Essentially theta is expected to be output from np.arctan2(y,x)</span>
</span><span id="L-592"><a href="#L-592"><span class="linenos"> 592</span></a><span class="sd">            This is counter-clockwise from x-axis angle is converted to a clockwise</span>
</span><span id="L-593"><a href="#L-593"><span class="linenos"> 593</span></a><span class="sd">            angle from y axis to match the interpolation grid of the storm paramters. </span>
</span><span id="L-594"><a href="#L-594"><span class="linenos"> 594</span></a><span class="sd">        methods: array, list of methods to be used. Currently implemented methods</span>
</span><span id="L-595"><a href="#L-595"><span class="linenos"> 595</span></a><span class="sd">                are - H80, H80c</span>
</span><span id="L-596"><a href="#L-596"><span class="linenos"> 596</span></a><span class="sd">        rmax_frac: array, till which fraction of rmax, the method to be used,</span>
</span><span id="L-597"><a href="#L-597"><span class="linenos"> 597</span></a><span class="sd">                np.inf for whole</span>
</span><span id="L-598"><a href="#L-598"><span class="linenos"> 598</span></a><span class="sd">        rmax_select: which rmax to select, int, str</span>
</span><span id="L-599"><a href="#L-599"><span class="linenos"> 599</span></a><span class="sd">                    &#39;mean&#39;: mean value of the rmax</span>
</span><span id="L-600"><a href="#L-600"><span class="linenos"> 600</span></a><span class="sd">                    &#39;nearest&#39;: rmax calculated from nearest frmax</span>
</span><span id="L-601"><a href="#L-601"><span class="linenos"> 601</span></a><span class="sd">                    &#39;linear&#39;: rmax calculated from a linear interpolation</span>
</span><span id="L-602"><a href="#L-602"><span class="linenos"> 602</span></a><span class="sd">                    int: number corresponding to selected rmax &gt;1</span>
</span><span id="L-603"><a href="#L-603"><span class="linenos"> 603</span></a><span class="sd">        kw_atmos: constant atmospheric values</span>
</span><span id="L-604"><a href="#L-604"><span class="linenos"> 604</span></a><span class="sd">            pn: nominal or environmental pressure, default 101325 Pa</span>
</span><span id="L-605"><a href="#L-605"><span class="linenos"> 605</span></a><span class="sd">            rhoair: air density, default 1.15 kg/m^3</span>
</span><span id="L-606"><a href="#L-606"><span class="linenos"> 606</span></a><span class="sd">        kw_h80: extra argument for H80 model</span>
</span><span id="L-607"><a href="#L-607"><span class="linenos"> 607</span></a><span class="sd">            bmin: min value of B</span>
</span><span id="L-608"><a href="#L-608"><span class="linenos"> 608</span></a><span class="sd">            bmax: max value of B</span>
</span><span id="L-609"><a href="#L-609"><span class="linenos"> 609</span></a><span class="sd">        &#39;&#39;&#39;</span>
</span><span id="L-610"><a href="#L-610"><span class="linenos"> 610</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-611"><a href="#L-611"><span class="linenos"> 611</span></a>            <span class="n">r</span><span class="p">,</span> <span class="n">theta_input</span> <span class="o">=</span> <span class="n">at</span>
</span><span id="L-612"><a href="#L-612"><span class="linenos"> 612</span></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="L-613"><a href="#L-613"><span class="linenos"> 613</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;the at must be in (r, theta) as list/array of size 2&#39;</span><span class="p">)</span>
</span><span id="L-614"><a href="#L-614"><span class="linenos"> 614</span></a>        
</span><span id="L-615"><a href="#L-615"><span class="linenos"> 615</span></a>        <span class="c1"># Convert theta from x-axis counter clock to y-axis clock wise</span>
</span><span id="L-616"><a href="#L-616"><span class="linenos"> 616</span></a>        <span class="n">theta</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="o">*</span><span class="n">theta_input</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span>
</span><span id="L-617"><a href="#L-617"><span class="linenos"> 617</span></a>
</span><span id="L-618"><a href="#L-618"><span class="linenos"> 618</span></a>        <span class="c1"># Theta -180:180 to 0:360 format, clockwise from 0N</span>
</span><span id="L-619"><a href="#L-619"><span class="linenos"> 619</span></a>        <span class="k">if</span> <span class="n">theta_input</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-620"><a href="#L-620"><span class="linenos"> 620</span></a>            <span class="n">theta</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">+</span> <span class="n">theta_input</span>
</span><span id="L-621"><a href="#L-621"><span class="linenos"> 621</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-622"><a href="#L-622"><span class="linenos"> 622</span></a>            <span class="n">theta</span> <span class="o">=</span> <span class="n">theta_input</span>
</span><span id="L-623"><a href="#L-623"><span class="linenos"> 623</span></a>
</span><span id="L-624"><a href="#L-624"><span class="linenos"> 624</span></a>        <span class="n">calc_mslp</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-625"><a href="#L-625"><span class="linenos"> 625</span></a>            <span class="s1">&#39;H80&#39;</span><span class="p">:</span><span class="n">calc_mslp_h80</span><span class="p">,</span>
</span><span id="L-626"><a href="#L-626"><span class="linenos"> 626</span></a>            <span class="s1">&#39;H80c&#39;</span><span class="p">:</span><span class="n">calc_mslp_h80</span> <span class="c1"># Only B calculation differs</span>
</span><span id="L-627"><a href="#L-627"><span class="linenos"> 627</span></a>        <span class="p">}</span>
</span><span id="L-628"><a href="#L-628"><span class="linenos"> 628</span></a>
</span><span id="L-629"><a href="#L-629"><span class="linenos"> 629</span></a>        <span class="c1"># Calculate vmax for further calculation</span>
</span><span id="L-630"><a href="#L-630"><span class="linenos"> 630</span></a>        <span class="n">vmax</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;fvmax&#39;</span><span class="p">](</span><span class="n">theta</span><span class="p">)</span>
</span><span id="L-631"><a href="#L-631"><span class="linenos"> 631</span></a>
</span><span id="L-632"><a href="#L-632"><span class="linenos"> 632</span></a>        <span class="c1"># Find appropriate rmax function to be used</span>
</span><span id="L-633"><a href="#L-633"><span class="linenos"> 633</span></a>        <span class="c1"># and calculate rmax</span>
</span><span id="L-634"><a href="#L-634"><span class="linenos"> 634</span></a>        <span class="n">rmax_select_methods_available</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;nearest&#39;</span><span class="p">,</span> <span class="s1">&#39;linear&#39;</span><span class="p">]</span>
</span><span id="L-635"><a href="#L-635"><span class="linenos"> 635</span></a>
</span><span id="L-636"><a href="#L-636"><span class="linenos"> 636</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rmax_select</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="L-637"><a href="#L-637"><span class="linenos"> 637</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="L-638"><a href="#L-638"><span class="linenos"> 638</span></a>                <span class="k">assert</span> <span class="n">rmax_select</span> <span class="ow">in</span> <span class="n">rmax_select_methods_available</span>
</span><span id="L-639"><a href="#L-639"><span class="linenos"> 639</span></a>
</span><span id="L-640"><a href="#L-640"><span class="linenos"> 640</span></a>                <span class="k">if</span> <span class="n">rmax_select</span><span class="o">==</span><span class="s1">&#39;mean&#39;</span><span class="p">:</span>
</span><span id="L-641"><a href="#L-641"><span class="linenos"> 641</span></a>                    <span class="n">rmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">([</span><span class="n">f</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;frmax&#39;</span><span class="p">])])</span>
</span><span id="L-642"><a href="#L-642"><span class="linenos"> 642</span></a>                
</span><span id="L-643"><a href="#L-643"><span class="linenos"> 643</span></a>                <span class="k">if</span> <span class="n">rmax_select</span><span class="o">==</span><span class="s1">&#39;nearest&#39;</span><span class="p">:</span>
</span><span id="L-644"><a href="#L-644"><span class="linenos"> 644</span></a>                    <span class="k">try</span><span class="p">:</span>
</span><span id="L-645"><a href="#L-645"><span class="linenos"> 645</span></a>                        <span class="n">radinfo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">radi</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="k">for</span> <span class="n">radi</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;fradinfo&#39;</span><span class="p">]])</span>
</span><span id="L-646"><a href="#L-646"><span class="linenos"> 646</span></a>                        <span class="n">radnn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">radinfo</span><span class="o">-</span><span class="n">r</span><span class="p">))</span>
</span><span id="L-647"><a href="#L-647"><span class="linenos"> 647</span></a>                        <span class="n">rmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">f</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;frmax&#39;</span><span class="p">])])[</span><span class="n">radnn</span><span class="p">]</span>
</span><span id="L-648"><a href="#L-648"><span class="linenos"> 648</span></a>                    <span class="k">except</span><span class="p">:</span>
</span><span id="L-649"><a href="#L-649"><span class="linenos"> 649</span></a>                        <span class="n">rmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;frmax&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">](</span><span class="n">theta</span><span class="p">)</span>
</span><span id="L-650"><a href="#L-650"><span class="linenos"> 650</span></a>                        <span class="k">raise</span> <span class="ne">Warning</span><span class="p">(</span><span class="s1">&#39;nearest not possible, first rmax selected&#39;</span><span class="p">)</span>
</span><span id="L-651"><a href="#L-651"><span class="linenos"> 651</span></a>
</span><span id="L-652"><a href="#L-652"><span class="linenos"> 652</span></a>                <span class="k">if</span> <span class="n">rmax_select</span><span class="o">==</span><span class="s1">&#39;linear&#39;</span><span class="p">:</span>
</span><span id="L-653"><a href="#L-653"><span class="linenos"> 653</span></a>                    <span class="k">try</span><span class="p">:</span>
</span><span id="L-654"><a href="#L-654"><span class="linenos"> 654</span></a>                        <span class="c1"># x field from -inf to +inf</span>
</span><span id="L-655"><a href="#L-655"><span class="linenos"> 655</span></a>                        <span class="n">radinfo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">radi</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="k">for</span> <span class="n">radi</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;fradinfo&#39;</span><span class="p">]])</span>
</span><span id="L-656"><a href="#L-656"><span class="linenos"> 656</span></a>                        <span class="n">radinfo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">radinfo</span><span class="p">)</span>
</span><span id="L-657"><a href="#L-657"><span class="linenos"> 657</span></a>                        <span class="n">radinfo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">radinfo</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
</span><span id="L-658"><a href="#L-658"><span class="linenos"> 658</span></a>                        <span class="c1"># y field </span>
</span><span id="L-659"><a href="#L-659"><span class="linenos"> 659</span></a>                        <span class="n">rmaxinfo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">f</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;frmax&#39;</span><span class="p">])])</span>
</span><span id="L-660"><a href="#L-660"><span class="linenos"> 660</span></a>                        <span class="n">rmaxinfo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rmaxinfo</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">rmaxinfo</span><span class="p">)</span>
</span><span id="L-661"><a href="#L-661"><span class="linenos"> 661</span></a>                        <span class="n">rmaxinfo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rmaxinfo</span><span class="p">,</span> <span class="n">rmaxinfo</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</span><span id="L-662"><a href="#L-662"><span class="linenos"> 662</span></a>                        <span class="n">int_f</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">radinfo</span><span class="p">,</span> <span class="n">rmaxinfo</span><span class="p">)</span>
</span><span id="L-663"><a href="#L-663"><span class="linenos"> 663</span></a>                        <span class="n">rmax</span> <span class="o">=</span> <span class="n">int_f</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
</span><span id="L-664"><a href="#L-664"><span class="linenos"> 664</span></a>                    <span class="k">except</span><span class="p">:</span>
</span><span id="L-665"><a href="#L-665"><span class="linenos"> 665</span></a>                        <span class="n">rmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;frmax&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">](</span><span class="n">theta</span><span class="p">)</span>
</span><span id="L-666"><a href="#L-666"><span class="linenos"> 666</span></a>                        <span class="k">raise</span> <span class="ne">Warning</span><span class="p">(</span><span class="s1">&#39;linear not possible, first rmax selected&#39;</span><span class="p">)</span>
</span><span id="L-667"><a href="#L-667"><span class="linenos"> 667</span></a>            <span class="k">except</span><span class="p">:</span>
</span><span id="L-668"><a href="#L-668"><span class="linenos"> 668</span></a>                <span class="n">rmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;frmax&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">](</span><span class="n">theta</span><span class="p">)</span>
</span><span id="L-669"><a href="#L-669"><span class="linenos"> 669</span></a>                <span class="k">raise</span> <span class="ne">Warning</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Wrong keyword for rmax method. First frmax is used&#39;</span><span class="p">)</span>
</span><span id="L-670"><a href="#L-670"><span class="linenos"> 670</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rmax_select</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="L-671"><a href="#L-671"><span class="linenos"> 671</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="L-672"><a href="#L-672"><span class="linenos"> 672</span></a>                <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">f</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;frmax&#39;</span><span class="p">])])[</span><span class="n">rmax_select</span><span class="p">]</span>
</span><span id="L-673"><a href="#L-673"><span class="linenos"> 673</span></a>            <span class="k">except</span><span class="p">:</span>
</span><span id="L-674"><a href="#L-674"><span class="linenos"> 674</span></a>                <span class="n">rmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;frmax&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">](</span><span class="n">theta</span><span class="p">)</span>
</span><span id="L-675"><a href="#L-675"><span class="linenos"> 675</span></a>                <span class="k">raise</span> <span class="ne">Warning</span><span class="p">(</span><span class="s1">&#39;Wrong rmax index. First frmax is used&#39;</span><span class="p">)</span>
</span><span id="L-676"><a href="#L-676"><span class="linenos"> 676</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-677"><a href="#L-677"><span class="linenos"> 677</span></a>            <span class="n">rmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;frmax&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">](</span><span class="n">theta</span><span class="p">)</span>
</span><span id="L-678"><a href="#L-678"><span class="linenos"> 678</span></a>            <span class="k">raise</span> <span class="ne">Warning</span><span class="p">(</span><span class="s1">&#39;Wrong rmax selection keyword/index. First frmax is used&#39;</span><span class="p">)</span>
</span><span id="L-679"><a href="#L-679"><span class="linenos"> 679</span></a>
</span><span id="L-680"><a href="#L-680"><span class="linenos"> 680</span></a>        <span class="c1"># Now check methods and rmax_frac and apply method as required</span>
</span><span id="L-681"><a href="#L-681"><span class="linenos"> 681</span></a>        <span class="c1"># Avoid wrong input of rmax_frac</span>
</span><span id="L-682"><a href="#L-682"><span class="linenos"> 682</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-683"><a href="#L-683"><span class="linenos"> 683</span></a>            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">rmax_frac</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">methods</span><span class="p">)</span>
</span><span id="L-684"><a href="#L-684"><span class="linenos"> 684</span></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="L-685"><a href="#L-685"><span class="linenos"> 685</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;rmax_frac must corresponds to each listed method&#39;</span><span class="p">)</span>
</span><span id="L-686"><a href="#L-686"><span class="linenos"> 686</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-687"><a href="#L-687"><span class="linenos"> 687</span></a>            <span class="n">rmax_frac</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">rmax_frac</span><span class="p">)</span> <span class="c1"># accomodates * of np.inf</span>
</span><span id="L-688"><a href="#L-688"><span class="linenos"> 688</span></a>        
</span><span id="L-689"><a href="#L-689"><span class="linenos"> 689</span></a>        <span class="n">rlim_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">rmax_frac</span><span class="p">)[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">rmax</span> <span class="c1"># Starts from 0</span>
</span><span id="L-690"><a href="#L-690"><span class="linenos"> 690</span></a>        <span class="n">rlim_max</span> <span class="o">=</span> <span class="n">rmax_frac</span><span class="o">*</span><span class="n">rmax</span>
</span><span id="L-691"><a href="#L-691"><span class="linenos"> 691</span></a>
</span><span id="L-692"><a href="#L-692"><span class="linenos"> 692</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">method</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">methods</span><span class="p">):</span>
</span><span id="L-693"><a href="#L-693"><span class="linenos"> 693</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="L-694"><a href="#L-694"><span class="linenos"> 694</span></a>                <span class="k">assert</span> <span class="n">r</span> <span class="o">&gt;=</span> <span class="n">rlim_min</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="L-695"><a href="#L-695"><span class="linenos"> 695</span></a>                <span class="k">assert</span> <span class="n">r</span> <span class="o">&lt;</span> <span class="n">rlim_max</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="L-696"><a href="#L-696"><span class="linenos"> 696</span></a>
</span><span id="L-697"><a href="#L-697"><span class="linenos"> 697</span></a>                <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;H80&#39;</span><span class="p">:</span>
</span><span id="L-698"><a href="#L-698"><span class="linenos"> 698</span></a>                    <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-699"><a href="#L-699"><span class="linenos"> 699</span></a>                        <span class="s1">&#39;vmax&#39;</span><span class="p">:</span><span class="n">vmax</span><span class="p">,</span> 
</span><span id="L-700"><a href="#L-700"><span class="linenos"> 700</span></a>                        <span class="s1">&#39;rmax&#39;</span><span class="p">:</span><span class="n">rmax</span><span class="p">,</span>
</span><span id="L-701"><a href="#L-701"><span class="linenos"> 701</span></a>                        <span class="s1">&#39;pc&#39;</span><span class="p">:</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;mslp&#39;</span><span class="p">],</span>
</span><span id="L-702"><a href="#L-702"><span class="linenos"> 702</span></a>                        <span class="s1">&#39;f&#39;</span><span class="p">:</span><span class="n">coriolis</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">]),</span>
</span><span id="L-703"><a href="#L-703"><span class="linenos"> 703</span></a>                        <span class="s1">&#39;pn&#39;</span><span class="p">:</span><span class="n">kw_atmos</span><span class="p">[</span><span class="s1">&#39;pn&#39;</span><span class="p">],</span>
</span><span id="L-704"><a href="#L-704"><span class="linenos"> 704</span></a>                        <span class="s1">&#39;rhoair&#39;</span><span class="p">:</span><span class="n">kw_atmos</span><span class="p">[</span><span class="s1">&#39;rhoair&#39;</span><span class="p">],</span>
</span><span id="L-705"><a href="#L-705"><span class="linenos"> 705</span></a>                        <span class="s1">&#39;bmax&#39;</span><span class="p">:</span><span class="n">kw_h80</span><span class="p">[</span><span class="s1">&#39;bmax&#39;</span><span class="p">],</span>
</span><span id="L-706"><a href="#L-706"><span class="linenos"> 706</span></a>                        <span class="s1">&#39;bmin&#39;</span><span class="p">:</span><span class="n">kw_h80</span><span class="p">[</span><span class="s1">&#39;bmin&#39;</span><span class="p">]</span>
</span><span id="L-707"><a href="#L-707"><span class="linenos"> 707</span></a>                    <span class="p">}</span>
</span><span id="L-708"><a href="#L-708"><span class="linenos"> 708</span></a>                    <span class="n">B</span> <span class="o">=</span> <span class="n">calc_holland_B_full</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="L-709"><a href="#L-709"><span class="linenos"> 709</span></a>                    <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-710"><a href="#L-710"><span class="linenos"> 710</span></a>                        <span class="s1">&#39;r&#39;</span><span class="p">:</span><span class="n">r</span><span class="p">,</span>
</span><span id="L-711"><a href="#L-711"><span class="linenos"> 711</span></a>                        <span class="s1">&#39;Rm&#39;</span><span class="p">:</span><span class="n">rmax</span><span class="p">,</span>
</span><span id="L-712"><a href="#L-712"><span class="linenos"> 712</span></a>                        <span class="s1">&#39;pc&#39;</span><span class="p">:</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;mslp&#39;</span><span class="p">],</span>
</span><span id="L-713"><a href="#L-713"><span class="linenos"> 713</span></a>                        <span class="s1">&#39;B&#39;</span><span class="p">:</span><span class="n">B</span><span class="p">,</span>
</span><span id="L-714"><a href="#L-714"><span class="linenos"> 714</span></a>                        <span class="s1">&#39;pn&#39;</span><span class="p">:</span><span class="n">kw_atmos</span><span class="p">[</span><span class="s1">&#39;pn&#39;</span><span class="p">]</span>
</span><span id="L-715"><a href="#L-715"><span class="linenos"> 715</span></a>                    <span class="p">}</span>
</span><span id="L-716"><a href="#L-716"><span class="linenos"> 716</span></a>                    <span class="n">mslp</span> <span class="o">=</span> <span class="n">calc_mslp</span><span class="p">[</span><span class="n">method</span><span class="p">](</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="L-717"><a href="#L-717"><span class="linenos"> 717</span></a>                
</span><span id="L-718"><a href="#L-718"><span class="linenos"> 718</span></a>                <span class="k">if</span> <span class="n">method</span><span class="o">==</span><span class="s1">&#39;H80c&#39;</span><span class="p">:</span>
</span><span id="L-719"><a href="#L-719"><span class="linenos"> 719</span></a>                    <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-720"><a href="#L-720"><span class="linenos"> 720</span></a>                        <span class="s1">&#39;vmax&#39;</span><span class="p">:</span><span class="n">vmax</span><span class="p">,</span> 
</span><span id="L-721"><a href="#L-721"><span class="linenos"> 721</span></a>                        <span class="s1">&#39;pc&#39;</span><span class="p">:</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;mslp&#39;</span><span class="p">],</span>
</span><span id="L-722"><a href="#L-722"><span class="linenos"> 722</span></a>                        <span class="s1">&#39;pn&#39;</span><span class="p">:</span><span class="n">kw_atmos</span><span class="p">[</span><span class="s1">&#39;pn&#39;</span><span class="p">],</span>
</span><span id="L-723"><a href="#L-723"><span class="linenos"> 723</span></a>                        <span class="s1">&#39;rhoair&#39;</span><span class="p">:</span><span class="n">kw_atmos</span><span class="p">[</span><span class="s1">&#39;rhoair&#39;</span><span class="p">],</span>
</span><span id="L-724"><a href="#L-724"><span class="linenos"> 724</span></a>                        <span class="s1">&#39;bmax&#39;</span><span class="p">:</span><span class="n">kw_h80</span><span class="p">[</span><span class="s1">&#39;bmax&#39;</span><span class="p">],</span>
</span><span id="L-725"><a href="#L-725"><span class="linenos"> 725</span></a>                        <span class="s1">&#39;bmin&#39;</span><span class="p">:</span><span class="n">kw_h80</span><span class="p">[</span><span class="s1">&#39;bmin&#39;</span><span class="p">]</span>
</span><span id="L-726"><a href="#L-726"><span class="linenos"> 726</span></a>                    <span class="p">}</span>
</span><span id="L-727"><a href="#L-727"><span class="linenos"> 727</span></a>                    <span class="n">B</span> <span class="o">=</span> <span class="n">calc_holland_B</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="L-728"><a href="#L-728"><span class="linenos"> 728</span></a>                    <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-729"><a href="#L-729"><span class="linenos"> 729</span></a>                        <span class="s1">&#39;r&#39;</span><span class="p">:</span><span class="n">r</span><span class="p">,</span>
</span><span id="L-730"><a href="#L-730"><span class="linenos"> 730</span></a>                        <span class="s1">&#39;Rm&#39;</span><span class="p">:</span><span class="n">rmax</span><span class="p">,</span>
</span><span id="L-731"><a href="#L-731"><span class="linenos"> 731</span></a>                        <span class="s1">&#39;pc&#39;</span><span class="p">:</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;mslp&#39;</span><span class="p">],</span>
</span><span id="L-732"><a href="#L-732"><span class="linenos"> 732</span></a>                        <span class="s1">&#39;B&#39;</span><span class="p">:</span><span class="n">B</span><span class="p">,</span>
</span><span id="L-733"><a href="#L-733"><span class="linenos"> 733</span></a>                        <span class="s1">&#39;pn&#39;</span><span class="p">:</span><span class="n">kw_atmos</span><span class="p">[</span><span class="s1">&#39;pn&#39;</span><span class="p">]</span>
</span><span id="L-734"><a href="#L-734"><span class="linenos"> 734</span></a>                    <span class="p">}</span>
</span><span id="L-735"><a href="#L-735"><span class="linenos"> 735</span></a>                    <span class="n">mslp</span> <span class="o">=</span> <span class="n">calc_mslp</span><span class="p">[</span><span class="n">method</span><span class="p">](</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="L-736"><a href="#L-736"><span class="linenos"> 736</span></a>                
</span><span id="L-737"><a href="#L-737"><span class="linenos"> 737</span></a>                <span class="k">break</span>
</span><span id="L-738"><a href="#L-738"><span class="linenos"> 738</span></a>            <span class="k">except</span><span class="p">:</span>
</span><span id="L-739"><a href="#L-739"><span class="linenos"> 739</span></a>                <span class="k">continue</span>
</span><span id="L-740"><a href="#L-740"><span class="linenos"> 740</span></a>        
</span><span id="L-741"><a href="#L-741"><span class="linenos"> 741</span></a>        <span class="k">return</span><span class="p">(</span><span class="n">mslp</span><span class="p">)</span>
</span><span id="L-742"><a href="#L-742"><span class="linenos"> 742</span></a>    
</span><span id="L-743"><a href="#L-743"><span class="linenos"> 743</span></a>    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-744"><a href="#L-744"><span class="linenos"> 744</span></a>        <span class="n">repr_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">key</span><span class="p">])</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">])</span>
</span><span id="L-745"><a href="#L-745"><span class="linenos"> 745</span></a>        <span class="k">return</span><span class="p">(</span><span class="n">repr_str</span><span class="p">)</span>
</span><span id="L-746"><a href="#L-746"><span class="linenos"> 746</span></a>
</span><span id="L-747"><a href="#L-747"><span class="linenos"> 747</span></a><span class="k">class</span> <span class="nc">Track</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
</span><span id="L-748"><a href="#L-748"><span class="linenos"> 748</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">records</span><span class="p">):</span>
</span><span id="L-749"><a href="#L-749"><span class="linenos"> 749</span></a><span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="L-750"><a href="#L-750"><span class="linenos"> 750</span></a><span class="sd">        Take a record or an array of record and provide track related functionalities.</span>
</span><span id="L-751"><a href="#L-751"><span class="linenos"> 751</span></a><span class="sd">        &#39;&#39;&#39;</span>
</span><span id="L-752"><a href="#L-752"><span class="linenos"> 752</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-753"><a href="#L-753"><span class="linenos"> 753</span></a>            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">records</span><span class="p">,</span> <span class="p">(</span><span class="n">Record</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">))</span>
</span><span id="L-754"><a href="#L-754"><span class="linenos"> 754</span></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="L-755"><a href="#L-755"><span class="linenos"> 755</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Records must be a single or an array of records&#39;</span><span class="p">)</span>
</span><span id="L-756"><a href="#L-756"><span class="linenos"> 756</span></a>
</span><span id="L-757"><a href="#L-757"><span class="linenos"> 757</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">records</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">records</span><span class="p">)</span>
</span><span id="L-758"><a href="#L-758"><span class="linenos"> 758</span></a>
</span><span id="L-759"><a href="#L-759"><span class="linenos"> 759</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-760"><a href="#L-760"><span class="linenos"> 760</span></a>            <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">([</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">Record</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">records</span><span class="p">])</span>
</span><span id="L-761"><a href="#L-761"><span class="linenos"> 761</span></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="L-762"><a href="#L-762"><span class="linenos"> 762</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The records must be an array of Record object&#39;</span><span class="p">)</span>
</span><span id="L-763"><a href="#L-763"><span class="linenos"> 763</span></a>
</span><span id="L-764"><a href="#L-764"><span class="linenos"> 764</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">timeindex</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">([</span><span class="n">record</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">records</span><span class="p">])</span>
</span><span id="L-765"><a href="#L-765"><span class="linenos"> 765</span></a>
</span><span id="L-766"><a href="#L-766"><span class="linenos"> 766</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span> <span class="c1"># To put all records in ascending order</span>
</span><span id="L-767"><a href="#L-767"><span class="linenos"> 767</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">calc_translation</span><span class="p">()</span> <span class="c1"># Recalculate translation speed</span>
</span><span id="L-768"><a href="#L-768"><span class="linenos"> 768</span></a>
</span><span id="L-769"><a href="#L-769"><span class="linenos"> 769</span></a>    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-770"><a href="#L-770"><span class="linenos"> 770</span></a><span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="L-771"><a href="#L-771"><span class="linenos"> 771</span></a><span class="sd">        Called and return the timeindex for invoke like - for t in track</span>
</span><span id="L-772"><a href="#L-772"><span class="linenos"> 772</span></a><span class="sd">        &#39;&#39;&#39;</span>
</span><span id="L-773"><a href="#L-773"><span class="linenos"> 773</span></a>        <span class="k">return</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timeindex</span><span class="p">)</span>
</span><span id="L-774"><a href="#L-774"><span class="linenos"> 774</span></a>
</span><span id="L-775"><a href="#L-775"><span class="linenos"> 775</span></a>    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
</span><span id="L-776"><a href="#L-776"><span class="linenos"> 776</span></a><span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="L-777"><a href="#L-777"><span class="linenos"> 777</span></a><span class="sd">        Get an item at a given timeindex</span>
</span><span id="L-778"><a href="#L-778"><span class="linenos"> 778</span></a><span class="sd">        &#39;&#39;&#39;</span>
</span><span id="L-779"><a href="#L-779"><span class="linenos"> 779</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="L-780"><a href="#L-780"><span class="linenos"> 780</span></a>            <span class="n">track</span> <span class="o">=</span> <span class="n">Track</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">records</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
</span><span id="L-781"><a href="#L-781"><span class="linenos"> 781</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
</span><span id="L-782"><a href="#L-782"><span class="linenos"> 782</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="L-783"><a href="#L-783"><span class="linenos"> 783</span></a>                <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">([</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">key</span><span class="p">])</span>
</span><span id="L-784"><a href="#L-784"><span class="linenos"> 784</span></a>            <span class="k">except</span><span class="p">:</span>
</span><span id="L-785"><a href="#L-785"><span class="linenos"> 785</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Integer indexing array expected&#39;</span><span class="p">)</span>
</span><span id="L-786"><a href="#L-786"><span class="linenos"> 786</span></a>            
</span><span id="L-787"><a href="#L-787"><span class="linenos"> 787</span></a>            <span class="n">track</span> <span class="o">=</span> <span class="n">Track</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">records</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
</span><span id="L-788"><a href="#L-788"><span class="linenos"> 788</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">slice</span><span class="p">):</span>
</span><span id="L-789"><a href="#L-789"><span class="linenos"> 789</span></a>            <span class="n">track</span> <span class="o">=</span> <span class="n">Track</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">records</span><span class="p">[</span><span class="n">key</span><span class="o">.</span><span class="n">start</span><span class="p">:</span><span class="n">key</span><span class="o">.</span><span class="n">stop</span><span class="p">:</span><span class="n">key</span><span class="o">.</span><span class="n">step</span><span class="p">])</span>
</span><span id="L-790"><a href="#L-790"><span class="linenos"> 790</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-791"><a href="#L-791"><span class="linenos"> 791</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="L-792"><a href="#L-792"><span class="linenos"> 792</span></a>                <span class="n">key</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</span><span id="L-793"><a href="#L-793"><span class="linenos"> 793</span></a>            <span class="k">except</span><span class="p">:</span>
</span><span id="L-794"><a href="#L-794"><span class="linenos"> 794</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Accessor must be parsable by pd.to_datetime&#39;</span><span class="p">)</span>
</span><span id="L-795"><a href="#L-795"><span class="linenos"> 795</span></a>
</span><span id="L-796"><a href="#L-796"><span class="linenos"> 796</span></a>            <span class="n">track</span> <span class="o">=</span> <span class="n">Track</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">records</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">timeindex</span> <span class="o">==</span> <span class="n">key</span><span class="p">])</span>
</span><span id="L-797"><a href="#L-797"><span class="linenos"> 797</span></a>
</span><span id="L-798"><a href="#L-798"><span class="linenos"> 798</span></a>        <span class="k">return</span> <span class="n">track</span>
</span><span id="L-799"><a href="#L-799"><span class="linenos"> 799</span></a>
</span><span id="L-800"><a href="#L-800"><span class="linenos"> 800</span></a>    <span class="k">def</span> <span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
</span><span id="L-801"><a href="#L-801"><span class="linenos"> 801</span></a><span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="L-802"><a href="#L-802"><span class="linenos"> 802</span></a><span class="sd">        Set an item at a given time index</span>
</span><span id="L-803"><a href="#L-803"><span class="linenos"> 803</span></a><span class="sd">        &#39;&#39;&#39;</span>
</span><span id="L-804"><a href="#L-804"><span class="linenos"> 804</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-805"><a href="#L-805"><span class="linenos"> 805</span></a>            <span class="n">key</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</span><span id="L-806"><a href="#L-806"><span class="linenos"> 806</span></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="L-807"><a href="#L-807"><span class="linenos"> 807</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Accessor must be parsable by pd.to_datetime&#39;</span><span class="p">)</span>
</span><span id="L-808"><a href="#L-808"><span class="linenos"> 808</span></a>
</span><span id="L-809"><a href="#L-809"><span class="linenos"> 809</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">records</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">timeindex</span> <span class="o">==</span> <span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="L-810"><a href="#L-810"><span class="linenos"> 810</span></a>
</span><span id="L-811"><a href="#L-811"><span class="linenos"> 811</span></a>    <span class="k">def</span> <span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
</span><span id="L-812"><a href="#L-812"><span class="linenos"> 812</span></a><span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="L-813"><a href="#L-813"><span class="linenos"> 813</span></a><span class="sd">        Implements checking of a record</span>
</span><span id="L-814"><a href="#L-814"><span class="linenos"> 814</span></a><span class="sd">        &#39;&#39;&#39;</span>
</span><span id="L-815"><a href="#L-815"><span class="linenos"> 815</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-816"><a href="#L-816"><span class="linenos"> 816</span></a>            <span class="n">key</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</span><span id="L-817"><a href="#L-817"><span class="linenos"> 817</span></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="L-818"><a href="#L-818"><span class="linenos"> 818</span></a>            <span class="n">key</span> <span class="o">=</span> <span class="n">key</span>
</span><span id="L-819"><a href="#L-819"><span class="linenos"> 819</span></a>        
</span><span id="L-820"><a href="#L-820"><span class="linenos"> 820</span></a>        <span class="k">return</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeindex</span>
</span><span id="L-821"><a href="#L-821"><span class="linenos"> 821</span></a>
</span><span id="L-822"><a href="#L-822"><span class="linenos"> 822</span></a>    <span class="k">def</span> <span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
</span><span id="L-823"><a href="#L-823"><span class="linenos"> 823</span></a><span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="L-824"><a href="#L-824"><span class="linenos"> 824</span></a><span class="sd">        Implements accessing the the dictionary objects as array.</span>
</span><span id="L-825"><a href="#L-825"><span class="linenos"> 825</span></a><span class="sd">        &#39;&#39;&#39;</span>
</span><span id="L-826"><a href="#L-826"><span class="linenos"> 826</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-827"><a href="#L-827"><span class="linenos"> 827</span></a>            <span class="n">attr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">record</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">records</span><span class="p">])</span>
</span><span id="L-828"><a href="#L-828"><span class="linenos"> 828</span></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="L-829"><a href="#L-829"><span class="linenos"> 829</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1"> not found in the records&#39;</span><span class="p">)</span>
</span><span id="L-830"><a href="#L-830"><span class="linenos"> 830</span></a>        
</span><span id="L-831"><a href="#L-831"><span class="linenos"> 831</span></a>        <span class="k">return</span> <span class="n">attr</span>
</span><span id="L-832"><a href="#L-832"><span class="linenos"> 832</span></a>
</span><span id="L-833"><a href="#L-833"><span class="linenos"> 833</span></a>    <span class="k">def</span> <span class="nf">sort</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-834"><a href="#L-834"><span class="linenos"> 834</span></a><span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="L-835"><a href="#L-835"><span class="linenos"> 835</span></a><span class="sd">        Apply time sorting and sort the records</span>
</span><span id="L-836"><a href="#L-836"><span class="linenos"> 836</span></a><span class="sd">        &#39;&#39;&#39;</span>
</span><span id="L-837"><a href="#L-837"><span class="linenos"> 837</span></a>        <span class="n">isort</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timeindex</span><span class="p">)</span>
</span><span id="L-838"><a href="#L-838"><span class="linenos"> 838</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">timeindex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeindex</span><span class="p">[</span><span class="n">isort</span><span class="p">]</span>
</span><span id="L-839"><a href="#L-839"><span class="linenos"> 839</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">records</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">records</span><span class="p">[</span><span class="n">isort</span><span class="p">]</span>
</span><span id="L-840"><a href="#L-840"><span class="linenos"> 840</span></a>
</span><span id="L-841"><a href="#L-841"><span class="linenos"> 841</span></a>    <span class="k">def</span> <span class="nf">calc_translation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-842"><a href="#L-842"><span class="linenos"> 842</span></a><span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="L-843"><a href="#L-843"><span class="linenos"> 843</span></a><span class="sd">        Calculate and update the ustorm, vstorm fields.</span>
</span><span id="L-844"><a href="#L-844"><span class="linenos"> 844</span></a><span class="sd">        &#39;&#39;&#39;</span>
</span><span id="L-845"><a href="#L-845"><span class="linenos"> 845</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">records</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
</span><span id="L-846"><a href="#L-846"><span class="linenos"> 846</span></a>            <span class="n">dt</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timeindex</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeindex</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span>
</span><span id="L-847"><a href="#L-847"><span class="linenos"> 847</span></a>            <span class="n">dtrans_x</span><span class="p">,</span> <span class="n">dtrans_y</span> <span class="o">=</span> <span class="n">gc_distance</span><span class="p">(</span>
</span><span id="L-848"><a href="#L-848"><span class="linenos"> 848</span></a>                <span class="n">of_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">records</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;lon&#39;</span><span class="p">],</span>
</span><span id="L-849"><a href="#L-849"><span class="linenos"> 849</span></a>                <span class="n">of_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">records</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;lat&#39;</span><span class="p">],</span>
</span><span id="L-850"><a href="#L-850"><span class="linenos"> 850</span></a>                <span class="n">origin_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">records</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;lon&#39;</span><span class="p">],</span>
</span><span id="L-851"><a href="#L-851"><span class="linenos"> 851</span></a>                <span class="n">origin_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">records</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span>
</span><span id="L-852"><a href="#L-852"><span class="linenos"> 852</span></a>            <span class="p">)</span>
</span><span id="L-853"><a href="#L-853"><span class="linenos"> 853</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">records</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;ustorm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dtrans_x</span><span class="o">/</span><span class="n">dt</span>
</span><span id="L-854"><a href="#L-854"><span class="linenos"> 854</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">records</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;vstorm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dtrans_y</span><span class="o">/</span><span class="n">dt</span>
</span><span id="L-855"><a href="#L-855"><span class="linenos"> 855</span></a>
</span><span id="L-856"><a href="#L-856"><span class="linenos"> 856</span></a>            <span class="c1"># For the last time step, we are keeping it to the same</span>
</span><span id="L-857"><a href="#L-857"><span class="linenos"> 857</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">records</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;ustorm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">records</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">][</span><span class="s1">&#39;ustorm&#39;</span><span class="p">]</span>
</span><span id="L-858"><a href="#L-858"><span class="linenos"> 858</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">records</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;vstorm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">records</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">][</span><span class="s1">&#39;vstorm&#39;</span><span class="p">]</span>
</span><span id="L-859"><a href="#L-859"><span class="linenos"> 859</span></a>
</span><span id="L-860"><a href="#L-860"><span class="linenos"> 860</span></a>    <span class="k">def</span> <span class="nf">append</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">records</span><span class="p">):</span>
</span><span id="L-861"><a href="#L-861"><span class="linenos"> 861</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-862"><a href="#L-862"><span class="linenos"> 862</span></a>            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">records</span><span class="p">,</span> <span class="p">(</span><span class="n">Record</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">))</span>
</span><span id="L-863"><a href="#L-863"><span class="linenos"> 863</span></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="L-864"><a href="#L-864"><span class="linenos"> 864</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Records must be a single or an array of records&#39;</span><span class="p">)</span>
</span><span id="L-865"><a href="#L-865"><span class="linenos"> 865</span></a>
</span><span id="L-866"><a href="#L-866"><span class="linenos"> 866</span></a>        <span class="n">records</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">records</span><span class="p">)</span>
</span><span id="L-867"><a href="#L-867"><span class="linenos"> 867</span></a>
</span><span id="L-868"><a href="#L-868"><span class="linenos"> 868</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-869"><a href="#L-869"><span class="linenos"> 869</span></a>            <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">([</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">Record</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">records</span><span class="p">])</span>
</span><span id="L-870"><a href="#L-870"><span class="linenos"> 870</span></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="L-871"><a href="#L-871"><span class="linenos"> 871</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The records must be an array of Record object&#39;</span><span class="p">)</span>
</span><span id="L-872"><a href="#L-872"><span class="linenos"> 872</span></a>
</span><span id="L-873"><a href="#L-873"><span class="linenos"> 873</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">records</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">records</span><span class="p">,</span> <span class="n">records</span><span class="p">)</span>
</span><span id="L-874"><a href="#L-874"><span class="linenos"> 874</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">timeindex</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">([</span><span class="n">record</span><span class="o">.</span><span class="n">timestamp</span> <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">records</span><span class="p">])</span>
</span><span id="L-875"><a href="#L-875"><span class="linenos"> 875</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span> <span class="c1"># To put all record in ascending order</span>
</span><span id="L-876"><a href="#L-876"><span class="linenos"> 876</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">calc_translation</span><span class="p">()</span> <span class="c1"># Recalculate translation speed</span>
</span><span id="L-877"><a href="#L-877"><span class="linenos"> 877</span></a>
</span><span id="L-878"><a href="#L-878"><span class="linenos"> 878</span></a>    <span class="k">def</span> <span class="nf">interpolate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">at</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="L-879"><a href="#L-879"><span class="linenos"> 879</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-880"><a href="#L-880"><span class="linenos"> 880</span></a>            <span class="n">at</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">at</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="L-881"><a href="#L-881"><span class="linenos"> 881</span></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="L-882"><a href="#L-882"><span class="linenos"> 882</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;`at` must be parsable by pd.to_datetime&#39;</span><span class="p">)</span>
</span><span id="L-883"><a href="#L-883"><span class="linenos"> 883</span></a>
</span><span id="L-884"><a href="#L-884"><span class="linenos"> 884</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-885"><a href="#L-885"><span class="linenos"> 885</span></a>            <span class="k">assert</span> <span class="n">at</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeindex</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-886"><a href="#L-886"><span class="linenos"> 886</span></a>            <span class="k">assert</span> <span class="n">at</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeindex</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-887"><a href="#L-887"><span class="linenos"> 887</span></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="L-888"><a href="#L-888"><span class="linenos"> 888</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Out of interpolation range&#39;</span><span class="p">)</span>
</span><span id="L-889"><a href="#L-889"><span class="linenos"> 889</span></a>
</span><span id="L-890"><a href="#L-890"><span class="linenos"> 890</span></a>        <span class="c1"># Calculate the corresponding indices</span>
</span><span id="L-891"><a href="#L-891"><span class="linenos"> 891</span></a>        <span class="n">i_right</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">timeindex</span><span class="p">,</span> <span class="n">v</span><span class="o">=</span><span class="n">at</span><span class="p">,</span> <span class="n">side</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
</span><span id="L-892"><a href="#L-892"><span class="linenos"> 892</span></a>
</span><span id="L-893"><a href="#L-893"><span class="linenos"> 893</span></a>        <span class="k">if</span> <span class="n">i_right</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-894"><a href="#L-894"><span class="linenos"> 894</span></a>            <span class="n">i_left</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-895"><a href="#L-895"><span class="linenos"> 895</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-896"><a href="#L-896"><span class="linenos"> 896</span></a>            <span class="n">i_left</span> <span class="o">=</span> <span class="n">i_right</span> <span class="o">-</span> <span class="mi">1</span>
</span><span id="L-897"><a href="#L-897"><span class="linenos"> 897</span></a>
</span><span id="L-898"><a href="#L-898"><span class="linenos"> 898</span></a>        <span class="c1"># Calculate the corresponding weights</span>
</span><span id="L-899"><a href="#L-899"><span class="linenos"> 899</span></a>        <span class="n">v_left</span><span class="p">,</span> <span class="n">v_right</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeindex</span><span class="p">[[</span><span class="n">i_left</span><span class="p">,</span> <span class="n">i_right</span><span class="p">]]</span>
</span><span id="L-900"><a href="#L-900"><span class="linenos"> 900</span></a>        
</span><span id="L-901"><a href="#L-901"><span class="linenos"> 901</span></a>        <span class="k">if</span><span class="p">(</span><span class="n">i_left</span> <span class="o">&lt;</span> <span class="n">i_right</span><span class="p">):</span>
</span><span id="L-902"><a href="#L-902"><span class="linenos"> 902</span></a>            <span class="n">td_right</span> <span class="o">=</span> <span class="p">(</span><span class="n">v_right</span> <span class="o">-</span> <span class="n">at</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span> <span class="c1"># Timedelta to seconds</span>
</span><span id="L-903"><a href="#L-903"><span class="linenos"> 903</span></a>            <span class="n">td_total</span> <span class="o">=</span>  <span class="p">(</span><span class="n">v_right</span> <span class="o">-</span> <span class="n">v_left</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span> <span class="c1"># Timedelta to seconds</span>
</span><span id="L-904"><a href="#L-904"><span class="linenos"> 904</span></a>            <span class="n">w_left</span> <span class="o">=</span> <span class="n">td_right</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">td_total</span><span class="p">)</span>
</span><span id="L-905"><a href="#L-905"><span class="linenos"> 905</span></a>            <span class="n">w_right</span> <span class="o">=</span> <span class="mi">1</span><span class="o">-</span><span class="n">w_left</span>
</span><span id="L-906"><a href="#L-906"><span class="linenos"> 906</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-907"><a href="#L-907"><span class="linenos"> 907</span></a>            <span class="n">w_left</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-908"><a href="#L-908"><span class="linenos"> 908</span></a>            <span class="n">w_right</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-909"><a href="#L-909"><span class="linenos"> 909</span></a>
</span><span id="L-910"><a href="#L-910"><span class="linenos"> 910</span></a>        <span class="c1"># Create Record for the necessary fields with direct interpolation</span>
</span><span id="L-911"><a href="#L-911"><span class="linenos"> 911</span></a>        <span class="n">int_record</span> <span class="o">=</span> <span class="n">Record</span><span class="p">(</span>
</span><span id="L-912"><a href="#L-912"><span class="linenos"> 912</span></a>            <span class="n">timestamp</span><span class="o">=</span><span class="n">at</span><span class="p">,</span>
</span><span id="L-913"><a href="#L-913"><span class="linenos"> 913</span></a>            <span class="n">lon</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">records</span><span class="p">[</span><span class="n">i_left</span><span class="p">][</span><span class="s1">&#39;lon&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">w_left</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">records</span><span class="p">[</span><span class="n">i_right</span><span class="p">][</span><span class="s1">&#39;lon&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">w_right</span><span class="p">,</span>
</span><span id="L-914"><a href="#L-914"><span class="linenos"> 914</span></a>            <span class="n">lat</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">records</span><span class="p">[</span><span class="n">i_left</span><span class="p">][</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">w_left</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">records</span><span class="p">[</span><span class="n">i_right</span><span class="p">][</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">w_right</span><span class="p">,</span>
</span><span id="L-915"><a href="#L-915"><span class="linenos"> 915</span></a>            <span class="n">mslp</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">records</span><span class="p">[</span><span class="n">i_left</span><span class="p">][</span><span class="s1">&#39;mslp&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">w_left</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">records</span><span class="p">[</span><span class="n">i_right</span><span class="p">][</span><span class="s1">&#39;mslp&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">w_right</span><span class="p">,</span>
</span><span id="L-916"><a href="#L-916"><span class="linenos"> 916</span></a>            <span class="n">vmax</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">records</span><span class="p">[</span><span class="n">i_left</span><span class="p">][</span><span class="s1">&#39;vmax&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">w_left</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">records</span><span class="p">[</span><span class="n">i_right</span><span class="p">][</span><span class="s1">&#39;vmax&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">w_right</span><span class="p">,</span>
</span><span id="L-917"><a href="#L-917"><span class="linenos"> 917</span></a>            <span class="n">rmax</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">records</span><span class="p">[</span><span class="n">i_left</span><span class="p">][</span><span class="s1">&#39;rmax&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">w_left</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">records</span><span class="p">[</span><span class="n">i_right</span><span class="p">][</span><span class="s1">&#39;rmax&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">w_right</span><span class="p">,</span>
</span><span id="L-918"><a href="#L-918"><span class="linenos"> 918</span></a>            <span class="n">ustorm</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">records</span><span class="p">[</span><span class="n">i_left</span><span class="p">][</span><span class="s1">&#39;ustorm&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">w_left</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">records</span><span class="p">[</span><span class="n">i_right</span><span class="p">][</span><span class="s1">&#39;ustorm&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">w_right</span><span class="p">,</span>
</span><span id="L-919"><a href="#L-919"><span class="linenos"> 919</span></a>            <span class="n">vstorm</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">records</span><span class="p">[</span><span class="n">i_left</span><span class="p">][</span><span class="s1">&#39;vstorm&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">w_left</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">records</span><span class="p">[</span><span class="n">i_right</span><span class="p">][</span><span class="s1">&#39;vstorm&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">w_right</span>
</span><span id="L-920"><a href="#L-920"><span class="linenos"> 920</span></a>        <span class="p">)</span>
</span><span id="L-921"><a href="#L-921"><span class="linenos"> 921</span></a>
</span><span id="L-922"><a href="#L-922"><span class="linenos"> 922</span></a>        <span class="c1"># now interpolate vinfo and radinfo</span>
</span><span id="L-923"><a href="#L-923"><span class="linenos"> 923</span></a>        <span class="c1"># export np.nan if not available</span>
</span><span id="L-924"><a href="#L-924"><span class="linenos"> 924</span></a>        <span class="n">vinfo_left</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">records</span><span class="p">[</span><span class="n">i_left</span><span class="p">][</span><span class="s1">&#39;vinfo&#39;</span><span class="p">]</span>
</span><span id="L-925"><a href="#L-925"><span class="linenos"> 925</span></a>        <span class="n">lvinfo_left</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">vinfo_left</span><span class="p">)</span>
</span><span id="L-926"><a href="#L-926"><span class="linenos"> 926</span></a>        <span class="n">vinfo_right</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">records</span><span class="p">[</span><span class="n">i_right</span><span class="p">][</span><span class="s1">&#39;vinfo&#39;</span><span class="p">]</span>
</span><span id="L-927"><a href="#L-927"><span class="linenos"> 927</span></a>        <span class="n">lvinfo_right</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">vinfo_right</span><span class="p">)</span>
</span><span id="L-928"><a href="#L-928"><span class="linenos"> 928</span></a>        <span class="n">radinfo_left</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_2d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">records</span><span class="p">[</span><span class="n">i_left</span><span class="p">][</span><span class="s1">&#39;radinfo&#39;</span><span class="p">])</span>
</span><span id="L-929"><a href="#L-929"><span class="linenos"> 929</span></a>        <span class="n">sradinfo_left</span> <span class="o">=</span> <span class="n">radinfo_left</span><span class="o">.</span><span class="n">shape</span>
</span><span id="L-930"><a href="#L-930"><span class="linenos"> 930</span></a>        <span class="n">radinfo_right</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_2d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">records</span><span class="p">[</span><span class="n">i_right</span><span class="p">][</span><span class="s1">&#39;radinfo&#39;</span><span class="p">])</span>
</span><span id="L-931"><a href="#L-931"><span class="linenos"> 931</span></a>        <span class="n">sradinfo_right</span> <span class="o">=</span> <span class="n">radinfo_right</span><span class="o">.</span><span class="n">shape</span>
</span><span id="L-932"><a href="#L-932"><span class="linenos"> 932</span></a>
</span><span id="L-933"><a href="#L-933"><span class="linenos"> 933</span></a>        <span class="c1"># Checking if the left and right are same size</span>
</span><span id="L-934"><a href="#L-934"><span class="linenos"> 934</span></a>        <span class="k">if</span> <span class="n">lvinfo_left</span> <span class="o">==</span> <span class="n">lvinfo_right</span><span class="p">:</span>
</span><span id="L-935"><a href="#L-935"><span class="linenos"> 935</span></a>            <span class="n">vinfo_diff</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-936"><a href="#L-936"><span class="linenos"> 936</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-937"><a href="#L-937"><span class="linenos"> 937</span></a>            <span class="n">vinfo_diff</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-938"><a href="#L-938"><span class="linenos"> 938</span></a>
</span><span id="L-939"><a href="#L-939"><span class="linenos"> 939</span></a>        <span class="c1"># Interpolating</span>
</span><span id="L-940"><a href="#L-940"><span class="linenos"> 940</span></a>        <span class="k">if</span> <span class="n">vinfo_diff</span><span class="p">:</span>
</span><span id="L-941"><a href="#L-941"><span class="linenos"> 941</span></a>            <span class="c1"># vinfo size is different more check is needed</span>
</span><span id="L-942"><a href="#L-942"><span class="linenos"> 942</span></a>            <span class="n">min_vinfo_length</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">([</span><span class="n">lvinfo_left</span><span class="p">,</span> <span class="n">lvinfo_right</span><span class="p">])</span>
</span><span id="L-943"><a href="#L-943"><span class="linenos"> 943</span></a>            <span class="n">vinfo</span> <span class="o">=</span> <span class="n">vinfo_left</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">min_vinfo_length</span><span class="p">]</span>
</span><span id="L-944"><a href="#L-944"><span class="linenos"> 944</span></a>
</span><span id="L-945"><a href="#L-945"><span class="linenos"> 945</span></a>            <span class="c1"># First find which one is the longer and set radinfo size</span>
</span><span id="L-946"><a href="#L-946"><span class="linenos"> 946</span></a>            <span class="k">if</span> <span class="n">lvinfo_left</span> <span class="o">&gt;</span> <span class="n">lvinfo_right</span><span class="p">:</span>
</span><span id="L-947"><a href="#L-947"><span class="linenos"> 947</span></a>                <span class="n">radinfo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">min_vinfo_length</span><span class="p">,</span> <span class="n">sradinfo_left</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
</span><span id="L-948"><a href="#L-948"><span class="linenos"> 948</span></a>            <span class="k">elif</span> <span class="n">lvinfo_left</span> <span class="o">&lt;</span> <span class="n">lvinfo_right</span><span class="p">:</span>
</span><span id="L-949"><a href="#L-949"><span class="linenos"> 949</span></a>                <span class="n">radinfo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">min_vinfo_length</span><span class="p">,</span> <span class="n">sradinfo_right</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
</span><span id="L-950"><a href="#L-950"><span class="linenos"> 950</span></a>
</span><span id="L-951"><a href="#L-951"><span class="linenos"> 951</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">min_vinfo_length</span><span class="p">):</span>
</span><span id="L-952"><a href="#L-952"><span class="linenos"> 952</span></a>                    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">vinfo_left</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">vinfo_right</span><span class="p">[</span><span class="n">i</span><span class="p">])]):</span>
</span><span id="L-953"><a href="#L-953"><span class="linenos"> 953</span></a>                        <span class="n">radinfo</span> <span class="o">=</span> <span class="n">radinfo</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span>
</span><span id="L-954"><a href="#L-954"><span class="linenos"> 954</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="L-955"><a href="#L-955"><span class="linenos"> 955</span></a>                        <span class="n">vinfo</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">vinfo_left</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="L-956"><a href="#L-956"><span class="linenos"> 956</span></a>                        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">radinfo</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
</span><span id="L-957"><a href="#L-957"><span class="linenos"> 957</span></a>                            <span class="n">radinfo</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">radinfo_left</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="n">w_left</span> <span class="o">+</span> <span class="n">radinfo_right</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="n">w_right</span>
</span><span id="L-958"><a href="#L-958"><span class="linenos"> 958</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-959"><a href="#L-959"><span class="linenos"> 959</span></a>            <span class="c1"># vinfo size is same</span>
</span><span id="L-960"><a href="#L-960"><span class="linenos"> 960</span></a>            <span class="n">len_vinfo</span> <span class="o">=</span> <span class="n">lvinfo_left</span>
</span><span id="L-961"><a href="#L-961"><span class="linenos"> 961</span></a>            <span class="c1"># If the both of them has length 1</span>
</span><span id="L-962"><a href="#L-962"><span class="linenos"> 962</span></a>            <span class="k">if</span> <span class="n">len_vinfo</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-963"><a href="#L-963"><span class="linenos"> 963</span></a>                <span class="c1"># Return missing if vinfo itselft is missing</span>
</span><span id="L-964"><a href="#L-964"><span class="linenos"> 964</span></a>                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">vinfo_left</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">vinfo_right</span><span class="p">[</span><span class="mi">0</span><span class="p">])]):</span>
</span><span id="L-965"><a href="#L-965"><span class="linenos"> 965</span></a>                    <span class="n">vinfo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
</span><span id="L-966"><a href="#L-966"><span class="linenos"> 966</span></a>                    <span class="n">radinfo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
</span><span id="L-967"><a href="#L-967"><span class="linenos"> 967</span></a>                <span class="c1"># Or set to zero</span>
</span><span id="L-968"><a href="#L-968"><span class="linenos"> 968</span></a>                <span class="k">elif</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">([</span><span class="n">vinfo_left</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">,</span> <span class="n">vinfo_right</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="L-969"><a href="#L-969"><span class="linenos"> 969</span></a>                    <span class="n">vinfo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
</span><span id="L-970"><a href="#L-970"><span class="linenos"> 970</span></a>                    <span class="n">radinfo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
</span><span id="L-971"><a href="#L-971"><span class="linenos"> 971</span></a>                <span class="c1"># Otherwise calculate the linear interpolation</span>
</span><span id="L-972"><a href="#L-972"><span class="linenos"> 972</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-973"><a href="#L-973"><span class="linenos"> 973</span></a>                    <span class="n">vinfo</span> <span class="o">=</span> <span class="n">vinfo_left</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-974"><a href="#L-974"><span class="linenos"> 974</span></a>                    <span class="n">radinfo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">radinfo_left</span><span class="p">)</span>
</span><span id="L-975"><a href="#L-975"><span class="linenos"> 975</span></a>                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">sradinfo_left</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="L-976"><a href="#L-976"><span class="linenos"> 976</span></a>                        <span class="n">radinfo</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">radinfo_left</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="n">w_left</span> <span class="o">+</span> <span class="n">radinfo_right</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="n">w_right</span>
</span><span id="L-977"><a href="#L-977"><span class="linenos"> 977</span></a>            <span class="k">elif</span> <span class="n">len_vinfo</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-978"><a href="#L-978"><span class="linenos"> 978</span></a>                <span class="c1"># If both of them as length &gt; 1</span>
</span><span id="L-979"><a href="#L-979"><span class="linenos"> 979</span></a>                <span class="n">vinfo</span> <span class="o">=</span> <span class="n">vinfo_left</span>
</span><span id="L-980"><a href="#L-980"><span class="linenos"> 980</span></a>                <span class="n">shape_radinfo</span> <span class="o">=</span> <span class="p">(</span><span class="n">lvinfo_left</span><span class="p">,</span> <span class="n">sradinfo_left</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="L-981"><a href="#L-981"><span class="linenos"> 981</span></a>                <span class="n">radinfo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">shape_radinfo</span><span class="p">)</span>
</span><span id="L-982"><a href="#L-982"><span class="linenos"> 982</span></a>                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">vinfo</span><span class="p">):</span>
</span><span id="L-983"><a href="#L-983"><span class="linenos"> 983</span></a>                    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">vinfo_left</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">vinfo_right</span><span class="p">[</span><span class="n">i</span><span class="p">])]):</span>
</span><span id="L-984"><a href="#L-984"><span class="linenos"> 984</span></a>                        <span class="n">radinfo</span> <span class="o">=</span> <span class="n">radinfo</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span>
</span><span id="L-985"><a href="#L-985"><span class="linenos"> 985</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="L-986"><a href="#L-986"><span class="linenos"> 986</span></a>                        <span class="n">vinfo</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">vinfo_left</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="L-987"><a href="#L-987"><span class="linenos"> 987</span></a>                        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">shape_radinfo</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
</span><span id="L-988"><a href="#L-988"><span class="linenos"> 988</span></a>                            <span class="n">radinfo</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">radinfo_left</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="n">w_left</span> <span class="o">+</span> <span class="n">radinfo_right</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="n">w_right</span>
</span><span id="L-989"><a href="#L-989"><span class="linenos"> 989</span></a>        
</span><span id="L-990"><a href="#L-990"><span class="linenos"> 990</span></a>        <span class="c1"># Providing the same as the dataset if interpolated on a given time</span>
</span><span id="L-991"><a href="#L-991"><span class="linenos"> 991</span></a>        <span class="k">if</span> <span class="n">w_right</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-992"><a href="#L-992"><span class="linenos"> 992</span></a>            <span class="n">vinfo</span> <span class="o">=</span> <span class="n">vinfo_right</span>
</span><span id="L-993"><a href="#L-993"><span class="linenos"> 993</span></a>            <span class="n">radinfo</span> <span class="o">=</span> <span class="n">radinfo_right</span>
</span><span id="L-994"><a href="#L-994"><span class="linenos"> 994</span></a>        <span class="k">elif</span> <span class="n">w_left</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-995"><a href="#L-995"><span class="linenos"> 995</span></a>            <span class="n">vinfo</span> <span class="o">=</span> <span class="n">vinfo_left</span>
</span><span id="L-996"><a href="#L-996"><span class="linenos"> 996</span></a>            <span class="n">radinfo</span> <span class="o">=</span> <span class="n">radinfo_left</span>
</span><span id="L-997"><a href="#L-997"><span class="linenos"> 997</span></a>
</span><span id="L-998"><a href="#L-998"><span class="linenos"> 998</span></a>        <span class="c1"># Updating int_record with vinfo, radinfo</span>
</span><span id="L-999"><a href="#L-999"><span class="linenos"> 999</span></a>        <span class="n">int_record</span><span class="p">[</span><span class="s1">&#39;vinfo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">vinfo</span>
</span><span id="L-1000"><a href="#L-1000"><span class="linenos">1000</span></a>        <span class="n">int_record</span><span class="p">[</span><span class="s1">&#39;radinfo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">radinfo</span>
</span><span id="L-1001"><a href="#L-1001"><span class="linenos">1001</span></a>
</span><span id="L-1002"><a href="#L-1002"><span class="linenos">1002</span></a>        <span class="c1"># Return the record file for rest of the calculations</span>
</span><span id="L-1003"><a href="#L-1003"><span class="linenos">1003</span></a>        <span class="k">return</span><span class="p">(</span><span class="n">int_record</span><span class="p">)</span>
</span><span id="L-1004"><a href="#L-1004"><span class="linenos">1004</span></a>
</span><span id="L-1005"><a href="#L-1005"><span class="linenos">1005</span></a>    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">subplot_kw</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;projection&#39;</span><span class="p">:</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">()}):</span>
</span><span id="L-1006"><a href="#L-1006"><span class="linenos">1006</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">plt</span><span class="o">.</span><span class="n">Axes</span><span class="p">):</span>
</span><span id="L-1007"><a href="#L-1007"><span class="linenos">1007</span></a>            <span class="n">_</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">subplot_kw</span><span class="o">=</span><span class="n">subplot_kw</span><span class="p">)</span>
</span><span id="L-1008"><a href="#L-1008"><span class="linenos">1008</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1009"><a href="#L-1009"><span class="linenos">1009</span></a>            <span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span>
</span><span id="L-1010"><a href="#L-1010"><span class="linenos">1010</span></a>        
</span><span id="L-1011"><a href="#L-1011"><span class="linenos">1011</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lon</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lat</span><span class="p">,</span> <span class="s1">&#39;.-&#39;</span><span class="p">)</span>
</span><span id="L-1012"><a href="#L-1012"><span class="linenos">1012</span></a>        
</span><span id="L-1013"><a href="#L-1013"><span class="linenos">1013</span></a>        <span class="k">return</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
</span><span id="L-1014"><a href="#L-1014"><span class="linenos">1014</span></a>
</span><span id="L-1015"><a href="#L-1015"><span class="linenos">1015</span></a>    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-1016"><a href="#L-1016"><span class="linenos">1016</span></a><span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="L-1017"><a href="#L-1017"><span class="linenos">1017</span></a><span class="sd">        String representation for print function.</span>
</span><span id="L-1018"><a href="#L-1018"><span class="linenos">1018</span></a><span class="sd">        &#39;&#39;&#39;</span>
</span><span id="L-1019"><a href="#L-1019"><span class="linenos">1019</span></a>        <span class="n">out_str</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">record</span><span class="p">)</span> <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">records</span><span class="p">)</span>
</span><span id="L-1020"><a href="#L-1020"><span class="linenos">1020</span></a>        <span class="k">return</span><span class="p">(</span><span class="n">out_str</span><span class="p">)</span>
</span></pre></div>


            </section>
                <section id="Record">
                            <input id="Record-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">Record</span><wbr>(<span class="base">builtins.dict</span>):

                <label class="view-source-button" for="Record-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Record"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Record-20"><a href="#Record-20"><span class="linenos"> 20</span></a><span class="k">class</span> <span class="nc">Record</span><span class="p">(</span><span class="nb">dict</span><span class="p">):</span>
</span><span id="Record-21"><a href="#Record-21"><span class="linenos"> 21</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="Record-22"><a href="#Record-22"><span class="linenos"> 22</span></a><span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="Record-23"><a href="#Record-23"><span class="linenos"> 23</span></a><span class="sd">        A recrod object takes keyworded input as arguments by entending the python</span>
</span><span id="Record-24"><a href="#Record-24"><span class="linenos"> 24</span></a><span class="sd">        dictionary object. </span>
</span><span id="Record-25"><a href="#Record-25"><span class="linenos"> 25</span></a>
</span><span id="Record-26"><a href="#Record-26"><span class="linenos"> 26</span></a><span class="sd">        The required fields are - </span>
</span><span id="Record-27"><a href="#Record-27"><span class="linenos"> 27</span></a><span class="sd">            : timestamp:    datetime, pd.Datetimeindex</span>
</span><span id="Record-28"><a href="#Record-28"><span class="linenos"> 28</span></a><span class="sd">            : lon:          longitude, 0-359, float</span>
</span><span id="Record-29"><a href="#Record-29"><span class="linenos"> 29</span></a><span class="sd">            : lat:          latitude, -180, 180, float</span>
</span><span id="Record-30"><a href="#Record-30"><span class="linenos"> 30</span></a><span class="sd">            : mslp:         central pressure, Pa, float</span>
</span><span id="Record-31"><a href="#Record-31"><span class="linenos"> 31</span></a><span class="sd">            : vmax:         maximum velocity, m/s, float</span>
</span><span id="Record-32"><a href="#Record-32"><span class="linenos"> 32</span></a><span class="sd">        </span>
</span><span id="Record-33"><a href="#Record-33"><span class="linenos"> 33</span></a><span class="sd">        The optional (but recommended) fields are - </span>
</span><span id="Record-34"><a href="#Record-34"><span class="linenos"> 34</span></a><span class="sd">            : rmax:         radius of maximum wind, m, float</span>
</span><span id="Record-35"><a href="#Record-35"><span class="linenos"> 35</span></a><span class="sd">            : vinfo:        list of velocity, m/s, list or numpy array, size n</span>
</span><span id="Record-36"><a href="#Record-36"><span class="linenos"> 36</span></a><span class="sd">            : radinfo:      2d list of radial info, m, list or numpy array, size nx4</span>
</span><span id="Record-37"><a href="#Record-37"><span class="linenos"> 37</span></a><span class="sd">            : ustorm:       speed of storm in x-direction, m/s</span>
</span><span id="Record-38"><a href="#Record-38"><span class="linenos"> 38</span></a><span class="sd">            : vstorm:       speed of strom in y-direction, m/s</span>
</span><span id="Record-39"><a href="#Record-39"><span class="linenos"> 39</span></a><span class="sd">        &#39;&#39;&#39;</span>
</span><span id="Record-40"><a href="#Record-40"><span class="linenos"> 40</span></a>        <span class="n">req_kw</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">,</span> <span class="s1">&#39;lon&#39;</span><span class="p">,</span> <span class="s1">&#39;lat&#39;</span><span class="p">,</span> <span class="s1">&#39;mslp&#39;</span><span class="p">,</span> <span class="s1">&#39;vmax&#39;</span><span class="p">]</span>
</span><span id="Record-41"><a href="#Record-41"><span class="linenos"> 41</span></a>        <span class="n">opt_kw</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;rmax&#39;</span><span class="p">,</span> <span class="s1">&#39;vinfo&#39;</span><span class="p">,</span> <span class="s1">&#39;radinfo&#39;</span><span class="p">,</span> <span class="s1">&#39;ustorm&#39;</span><span class="p">,</span> <span class="s1">&#39;vstorm&#39;</span><span class="p">]</span>
</span><span id="Record-42"><a href="#Record-42"><span class="linenos"> 42</span></a>
</span><span id="Record-43"><a href="#Record-43"><span class="linenos"> 43</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="Record-44"><a href="#Record-44"><span class="linenos"> 44</span></a>            <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">([</span><span class="n">kw</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">for</span> <span class="n">kw</span> <span class="ow">in</span> <span class="n">req_kw</span><span class="p">])</span>
</span><span id="Record-45"><a href="#Record-45"><span class="linenos"> 45</span></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="Record-46"><a href="#Record-46"><span class="linenos"> 46</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;All required fields are not provided&#39;</span><span class="p">)</span>
</span><span id="Record-47"><a href="#Record-47"><span class="linenos"> 47</span></a>
</span><span id="Record-48"><a href="#Record-48"><span class="linenos"> 48</span></a>        <span class="k">for</span> <span class="n">kw</span> <span class="ow">in</span> <span class="n">opt_kw</span><span class="p">:</span>
</span><span id="Record-49"><a href="#Record-49"><span class="linenos"> 49</span></a>            <span class="k">if</span> <span class="n">kw</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
</span><span id="Record-50"><a href="#Record-50"><span class="linenos"> 50</span></a>                <span class="n">kwargs</span><span class="p">[</span><span class="n">kw</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
</span><span id="Record-51"><a href="#Record-51"><span class="linenos"> 51</span></a>
</span><span id="Record-52"><a href="#Record-52"><span class="linenos"> 52</span></a>        <span class="c1"># Correcting datetime and convert to pandas datetime object</span>
</span><span id="Record-53"><a href="#Record-53"><span class="linenos"> 53</span></a>        <span class="n">allowed_datetime</span> <span class="o">=</span> <span class="p">(</span><span class="n">datetime</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
</span><span id="Record-54"><a href="#Record-54"><span class="linenos"> 54</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="Record-55"><a href="#Record-55"><span class="linenos"> 55</span></a>            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">],</span> <span class="n">allowed_datetime</span><span class="p">)</span>
</span><span id="Record-56"><a href="#Record-56"><span class="linenos"> 56</span></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="Record-57"><a href="#Record-57"><span class="linenos"> 57</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;timestamp must be parsable by pd.to_datetime&#39;</span><span class="p">)</span>
</span><span id="Record-58"><a href="#Record-58"><span class="linenos"> 58</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Record-59"><a href="#Record-59"><span class="linenos"> 59</span></a>            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">])</span>
</span><span id="Record-60"><a href="#Record-60"><span class="linenos"> 60</span></a>
</span><span id="Record-61"><a href="#Record-61"><span class="linenos"> 61</span></a>        <span class="c1"># Initiate the dictionary</span>
</span><span id="Record-62"><a href="#Record-62"><span class="linenos"> 62</span></a>        <span class="nb">super</span><span class="p">(</span><span class="n">Record</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="Record-63"><a href="#Record-63"><span class="linenos"> 63</span></a>    
</span><span id="Record-64"><a href="#Record-64"><span class="linenos"> 64</span></a>    <span class="k">def</span> <span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
</span><span id="Record-65"><a href="#Record-65"><span class="linenos"> 65</span></a>        <span class="nb">super</span><span class="p">(</span><span class="n">Record</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__setitem__</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</span><span id="Record-66"><a href="#Record-66"><span class="linenos"> 66</span></a>
</span><span id="Record-67"><a href="#Record-67"><span class="linenos"> 67</span></a>    <span class="nd">@property</span>
</span><span id="Record-68"><a href="#Record-68"><span class="linenos"> 68</span></a>    <span class="k">def</span> <span class="nf">center</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Record-69"><a href="#Record-69"><span class="linenos"> 69</span></a>        <span class="k">return</span><span class="p">((</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">]))</span>
</span><span id="Record-70"><a href="#Record-70"><span class="linenos"> 70</span></a>
</span><span id="Record-71"><a href="#Record-71"><span class="linenos"> 71</span></a>    <span class="k">def</span> <span class="nf">gen_radial_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fraction</span><span class="o">=</span><span class="mf">0.56</span><span class="p">,</span> <span class="n">angle</span><span class="o">=</span><span class="mf">19.2</span><span class="p">,</span> <span class="n">swrf</span><span class="o">=</span><span class="mf">0.9</span><span class="p">):</span>
</span><span id="Record-72"><a href="#Record-72"><span class="linenos"> 72</span></a><span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="Record-73"><a href="#Record-73"><span class="linenos"> 73</span></a><span class="sd">        Generate the interpolator for radial field for exisiting radial informations.</span>
</span><span id="Record-74"><a href="#Record-74"><span class="linenos"> 74</span></a><span class="sd">        To get correct radial field, atmospheric background is removed and</span>
</span><span id="Record-75"><a href="#Record-75"><span class="linenos"> 75</span></a><span class="sd">        the amount to be removed is controlled by fraction, and angle.  </span>
</span><span id="Record-76"><a href="#Record-76"><span class="linenos"> 76</span></a>
</span><span id="Record-77"><a href="#Record-77"><span class="linenos"> 77</span></a><span class="sd">        Arguments:</span>
</span><span id="Record-78"><a href="#Record-78"><span class="linenos"> 78</span></a><span class="sd">            fraction: float, fraction of translation speed to remove</span>
</span><span id="Record-79"><a href="#Record-79"><span class="linenos"> 79</span></a><span class="sd">            angle: float, angle of translation velocity change in degree</span>
</span><span id="Record-80"><a href="#Record-80"><span class="linenos"> 80</span></a><span class="sd">            swrf: float, surface wind reduction factor</span>
</span><span id="Record-81"><a href="#Record-81"><span class="linenos"> 81</span></a>
</span><span id="Record-82"><a href="#Record-82"><span class="linenos"> 82</span></a><span class="sd">        Due to translation a fraction of the wind-speed is embadded to the axysymmetric</span>
</span><span id="Record-83"><a href="#Record-83"><span class="linenos"> 83</span></a><span class="sd">        wind structure. To get the radial wind structure, we need to remove this</span>
</span><span id="Record-84"><a href="#Record-84"><span class="linenos"> 84</span></a><span class="sd">        translation velocity from the recorded wind velocity.</span>
</span><span id="Record-85"><a href="#Record-85"><span class="linenos"> 85</span></a><span class="sd">        </span>
</span><span id="Record-86"><a href="#Record-86"><span class="linenos"> 86</span></a><span class="sd">        The fraction is historically taken as unity (1). However, as shown in </span>
</span><span id="Record-87"><a href="#Record-87"><span class="linenos"> 87</span></a><span class="sd">        lin and chavas (2012), more statistically consistent value of this fraction</span>
</span><span id="Record-88"><a href="#Record-88"><span class="linenos"> 88</span></a><span class="sd">        is 0.56 (default)</span>
</span><span id="Record-89"><a href="#Record-89"><span class="linenos"> 89</span></a>
</span><span id="Record-90"><a href="#Record-90"><span class="linenos"> 90</span></a><span class="sd">        Similarly, the translation is not fully forward (angle=0), rather the </span>
</span><span id="Record-91"><a href="#Record-91"><span class="linenos"> 91</span></a><span class="sd">        background wind is slightly on southerly direction if we consider the</span>
</span><span id="Record-92"><a href="#Record-92"><span class="linenos"> 92</span></a><span class="sd">        storm is westerly. The angle is found around 19.2 degrees from statistical</span>
</span><span id="Record-93"><a href="#Record-93"><span class="linenos"> 93</span></a><span class="sd">        analysis. Thus the background wind is rotated anti-clockwise and needs </span>
</span><span id="Record-94"><a href="#Record-94"><span class="linenos"> 94</span></a><span class="sd">        to be updated before applying as fraction to the wind values.</span>
</span><span id="Record-95"><a href="#Record-95"><span class="linenos"> 95</span></a>
</span><span id="Record-96"><a href="#Record-96"><span class="linenos"> 96</span></a><span class="sd">        In the advisories, radial fields are defined at 10m level, whereas </span>
</span><span id="Record-97"><a href="#Record-97"><span class="linenos"> 97</span></a><span class="sd">        the analytical fields are defined at the boundary layer. Thus the velocity</span>
</span><span id="Record-98"><a href="#Record-98"><span class="linenos"> 98</span></a><span class="sd">        is needed to be divided by SWRF to shift it to boundary layer and multiplied</span>
</span><span id="Record-99"><a href="#Record-99"><span class="linenos"> 99</span></a><span class="sd">        by SWRF to get it back to 10m level.</span>
</span><span id="Record-100"><a href="#Record-100"><span class="linenos">100</span></a><span class="sd">        &#39;&#39;&#39;</span>
</span><span id="Record-101"><a href="#Record-101"><span class="linenos">101</span></a>        <span class="c1"># Rotating ustorm vstorm by 19.2 degree anti-clockwise</span>
</span><span id="Record-102"><a href="#Record-102"><span class="linenos">102</span></a>        <span class="c1"># Same operation as rotating a cartesian coordinate by 19.2 degree</span>
</span><span id="Record-103"><a href="#Record-103"><span class="linenos">103</span></a>        <span class="n">angle_rad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>
</span><span id="Record-104"><a href="#Record-104"><span class="linenos">104</span></a>        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">([</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;ustorm&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;vstorm&#39;</span><span class="p">]])):</span>
</span><span id="Record-105"><a href="#Record-105"><span class="linenos">105</span></a>            <span class="n">ustorm</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Record-106"><a href="#Record-106"><span class="linenos">106</span></a>            <span class="n">vstorm</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Record-107"><a href="#Record-107"><span class="linenos">107</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Record-108"><a href="#Record-108"><span class="linenos">108</span></a>            <span class="n">ustorm</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;ustorm&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle_rad</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;vstorm&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angle_rad</span><span class="p">)</span>
</span><span id="Record-109"><a href="#Record-109"><span class="linenos">109</span></a>            <span class="n">vstorm</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;ustorm&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angle_rad</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;vstorm&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle_rad</span><span class="p">)</span>
</span><span id="Record-110"><a href="#Record-110"><span class="linenos">110</span></a>
</span><span id="Record-111"><a href="#Record-111"><span class="linenos">111</span></a>        <span class="c1"># Apply correction to vmax for 4 quadrant clockwise from 0N</span>
</span><span id="Record-112"><a href="#Record-112"><span class="linenos">112</span></a>        <span class="c1"># Careful about the sin/cos from north</span>
</span><span id="Record-113"><a href="#Record-113"><span class="linenos">113</span></a>        <span class="c1">#            N</span>
</span><span id="Record-114"><a href="#Record-114"><span class="linenos">114</span></a>        <span class="c1">#            | t /</span>
</span><span id="Record-115"><a href="#Record-115"><span class="linenos">115</span></a>        <span class="c1">#            | /</span>
</span><span id="Record-116"><a href="#Record-116"><span class="linenos">116</span></a>        <span class="c1">#    W ------*------- E</span>
</span><span id="Record-117"><a href="#Record-117"><span class="linenos">117</span></a>        <span class="c1">#            |</span>
</span><span id="Record-118"><a href="#Record-118"><span class="linenos">118</span></a>        <span class="c1">#            |</span>
</span><span id="Record-119"><a href="#Record-119"><span class="linenos">119</span></a>        <span class="c1">#            S</span>
</span><span id="Record-120"><a href="#Record-120"><span class="linenos">120</span></a>        <span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
</span><span id="Record-121"><a href="#Record-121"><span class="linenos">121</span></a>        <span class="n">vmax_x</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;vmax&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">fraction</span><span class="o">*</span><span class="n">ustorm</span> 
</span><span id="Record-122"><a href="#Record-122"><span class="linenos">122</span></a>        <span class="n">vmax_y</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;vmax&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="o">-</span> <span class="n">fraction</span><span class="o">*</span><span class="n">vstorm</span>
</span><span id="Record-123"><a href="#Record-123"><span class="linenos">123</span></a>        <span class="n">vmax_amp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">vmax_x</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">vmax_y</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="n">swrf</span>
</span><span id="Record-124"><a href="#Record-124"><span class="linenos">124</span></a>        <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;fvmax&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">vmax_amp</span><span class="p">)</span>
</span><span id="Record-125"><a href="#Record-125"><span class="linenos">125</span></a>
</span><span id="Record-126"><a href="#Record-126"><span class="linenos">126</span></a>        <span class="c1"># Apply correction to vinfo for 4 quadrant</span>
</span><span id="Record-127"><a href="#Record-127"><span class="linenos">127</span></a>        <span class="n">fvinfo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
</span><span id="Record-128"><a href="#Record-128"><span class="linenos">128</span></a>        <span class="n">fradinfo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
</span><span id="Record-129"><a href="#Record-129"><span class="linenos">129</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">vinfo</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;vinfo&#39;</span><span class="p">])):</span>
</span><span id="Record-130"><a href="#Record-130"><span class="linenos">130</span></a>            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">vinfo</span><span class="p">):</span>
</span><span id="Record-131"><a href="#Record-131"><span class="linenos">131</span></a>                <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;vinfo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
</span><span id="Record-132"><a href="#Record-132"><span class="linenos">132</span></a>                <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;radinfo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
</span><span id="Record-133"><a href="#Record-133"><span class="linenos">133</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Record-134"><a href="#Record-134"><span class="linenos">134</span></a>                <span class="n">vinfo_x</span> <span class="o">=</span> <span class="n">vinfo</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">fraction</span><span class="o">*</span><span class="n">ustorm</span>
</span><span id="Record-135"><a href="#Record-135"><span class="linenos">135</span></a>                <span class="n">vinfo_y</span> <span class="o">=</span> <span class="n">vinfo</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="o">-</span> <span class="n">fraction</span><span class="o">*</span><span class="n">vstorm</span>
</span><span id="Record-136"><a href="#Record-136"><span class="linenos">136</span></a>                <span class="n">vinfo_amp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">vinfo_x</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">vinfo_y</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="n">swrf</span>
</span><span id="Record-137"><a href="#Record-137"><span class="linenos">137</span></a>                <span class="n">vinfo_func</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">vinfo_amp</span><span class="p">)</span>
</span><span id="Record-138"><a href="#Record-138"><span class="linenos">138</span></a>                <span class="n">fvinfo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fvinfo</span><span class="p">,</span> <span class="n">vinfo_func</span><span class="p">)</span>
</span><span id="Record-139"><a href="#Record-139"><span class="linenos">139</span></a>
</span><span id="Record-140"><a href="#Record-140"><span class="linenos">140</span></a>                <span class="n">radinfo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;radinfo&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;radinfo&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
</span><span id="Record-141"><a href="#Record-141"><span class="linenos">141</span></a>                <span class="n">radinfo_func</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">radinfo</span><span class="p">)</span>
</span><span id="Record-142"><a href="#Record-142"><span class="linenos">142</span></a>                <span class="n">fradinfo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fradinfo</span><span class="p">,</span> <span class="n">radinfo_func</span><span class="p">)</span>
</span><span id="Record-143"><a href="#Record-143"><span class="linenos">143</span></a>        
</span><span id="Record-144"><a href="#Record-144"><span class="linenos">144</span></a>        <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;fvinfo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fvinfo</span>
</span><span id="Record-145"><a href="#Record-145"><span class="linenos">145</span></a>        <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;fradinfo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fradinfo</span>
</span><span id="Record-146"><a href="#Record-146"><span class="linenos">146</span></a>
</span><span id="Record-147"><a href="#Record-147"><span class="linenos">147</span></a>        <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="Record-148"><a href="#Record-148"><span class="linenos">148</span></a>
</span><span id="Record-149"><a href="#Record-149"><span class="linenos">149</span></a>    <span class="k">def</span> <span class="nf">calc_rmax</span><span class="p">(</span>
</span><span id="Record-150"><a href="#Record-150"><span class="linenos">150</span></a>        <span class="bp">self</span><span class="p">,</span> 
</span><span id="Record-151"><a href="#Record-151"><span class="linenos">151</span></a>        <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;H80&#39;</span><span class="p">,</span> <span class="s1">&#39;E11&#39;</span><span class="p">],</span> 
</span><span id="Record-152"><a href="#Record-152"><span class="linenos">152</span></a>        <span class="n">use_rmax_info</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
</span><span id="Record-153"><a href="#Record-153"><span class="linenos">153</span></a>        <span class="n">vlimit</span><span class="o">=</span><span class="p">[</span><span class="mi">20</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">],</span>
</span><span id="Record-154"><a href="#Record-154"><span class="linenos">154</span></a>        <span class="n">kw_atmos</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;pn&#39;</span><span class="p">:</span><span class="mi">101325</span><span class="p">,</span> <span class="s1">&#39;rhoair&#39;</span><span class="p">:</span><span class="mf">1.15</span><span class="p">},</span>
</span><span id="Record-155"><a href="#Record-155"><span class="linenos">155</span></a>        <span class="n">kw_h80</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;bmax&#39;</span><span class="p">:</span><span class="mf">2.5</span><span class="p">,</span> <span class="s1">&#39;bmin&#39;</span><span class="p">:</span><span class="mf">0.5</span><span class="p">,</span> <span class="s1">&#39;solver&#39;</span><span class="p">:</span><span class="s1">&#39;fsolve&#39;</span><span class="p">,</span> <span class="s1">&#39;limit&#39;</span><span class="p">:[</span><span class="mi">5000</span><span class="p">,</span> <span class="mi">500000</span><span class="p">],</span> <span class="s1">&#39;step&#39;</span><span class="p">:</span><span class="mi">100</span><span class="p">},</span>
</span><span id="Record-156"><a href="#Record-156"><span class="linenos">156</span></a>        <span class="n">kw_e11</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;solver&#39;</span><span class="p">:</span><span class="s1">&#39;fsolve&#39;</span><span class="p">,</span> <span class="s1">&#39;limit&#39;</span><span class="p">:[</span><span class="mi">5000</span><span class="p">,</span> <span class="mi">500000</span><span class="p">],</span> <span class="s1">&#39;step&#39;</span><span class="p">:</span><span class="mi">100</span><span class="p">}</span>
</span><span id="Record-157"><a href="#Record-157"><span class="linenos">157</span></a>    <span class="p">):</span>
</span><span id="Record-158"><a href="#Record-158"><span class="linenos">158</span></a><span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="Record-159"><a href="#Record-159"><span class="linenos">159</span></a><span class="sd">        Calculate Radius of maximum wind based on a given method on the selected</span>
</span><span id="Record-160"><a href="#Record-160"><span class="linenos">160</span></a><span class="sd">        radial informations.</span>
</span><span id="Record-161"><a href="#Record-161"><span class="linenos">161</span></a>
</span><span id="Record-162"><a href="#Record-162"><span class="linenos">162</span></a><span class="sd">        methods: list, list of methods to try one after another</span>
</span><span id="Record-163"><a href="#Record-163"><span class="linenos">163</span></a><span class="sd">        use_rmax_info: bool, existing rmax to be used directly or not</span>
</span><span id="Record-164"><a href="#Record-164"><span class="linenos">164</span></a><span class="sd">        vlimit: list of maximum limit of v for method to be used, </span>
</span><span id="Record-165"><a href="#Record-165"><span class="linenos">165</span></a><span class="sd">                last one must be np.inf, vlimit is right open )</span>
</span><span id="Record-166"><a href="#Record-166"><span class="linenos">166</span></a><span class="sd">        kw_atmos: dict, atmospheric information, generally needed for H80 model</span>
</span><span id="Record-167"><a href="#Record-167"><span class="linenos">167</span></a><span class="sd">        kw_h80: dict, solver options for H80 model</span>
</span><span id="Record-168"><a href="#Record-168"><span class="linenos">168</span></a><span class="sd">        kw_e11: dict, solver options for E11 model</span>
</span><span id="Record-169"><a href="#Record-169"><span class="linenos">169</span></a>
</span><span id="Record-170"><a href="#Record-170"><span class="linenos">170</span></a><span class="sd">        Following methods are implemented - </span>
</span><span id="Record-171"><a href="#Record-171"><span class="linenos">171</span></a><span class="sd">            &#39;E11&#39; : Emanuel 2011 model as described in Lin and Chavas 2012</span>
</span><span id="Record-172"><a href="#Record-172"><span class="linenos">172</span></a><span class="sd">            &#39;H80&#39; : Holland 1980 model based on radial info</span>
</span><span id="Record-173"><a href="#Record-173"><span class="linenos">173</span></a><span class="sd">            &#39;S02&#39; : Silva et al. 2002 based on regression of central pressure</span>
</span><span id="Record-174"><a href="#Record-174"><span class="linenos">174</span></a><span class="sd">                    rmax = 0.4785 * Pc (mb) - 413 (km)</span>
</span><span id="Record-175"><a href="#Record-175"><span class="linenos">175</span></a><span class="sd">            &#39;W04&#39; : Willoughby and Rahn (2004) regression of Vmax</span>
</span><span id="Record-176"><a href="#Record-176"><span class="linenos">176</span></a><span class="sd">                    rmax = 51.6*exp(-0.0223*Vmax + 0.0281*lat) (km)</span>
</span><span id="Record-177"><a href="#Record-177"><span class="linenos">177</span></a>
</span><span id="Record-178"><a href="#Record-178"><span class="linenos">178</span></a><span class="sd">        Models to be implemented in the future - </span>
</span><span id="Record-179"><a href="#Record-179"><span class="linenos">179</span></a><span class="sd">            &#39;H80c&#39; : Holland 1980c (f related values are removed)</span>
</span><span id="Record-180"><a href="#Record-180"><span class="linenos">180</span></a><span class="sd">            &#39;S92&#39; : Slosh model, by jeleniaski et al . 1992</span>
</span><span id="Record-181"><a href="#Record-181"><span class="linenos">181</span></a><span class="sd">            &#39;E04&#39; : Emanuel 2004 model</span>
</span><span id="Record-182"><a href="#Record-182"><span class="linenos">182</span></a><span class="sd">            &#39;M16&#39; : Murty et al 2016 model</span>
</span><span id="Record-183"><a href="#Record-183"><span class="linenos">183</span></a><span class="sd">            &#39;W06&#39; : Willoughby et al. 2006 model </span>
</span><span id="Record-184"><a href="#Record-184"><span class="linenos">184</span></a><span class="sd">        </span>
</span><span id="Record-185"><a href="#Record-185"><span class="linenos">185</span></a><span class="sd">        &#39;&#39;&#39;</span>
</span><span id="Record-186"><a href="#Record-186"><span class="linenos">186</span></a>        <span class="n">methods</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">methods</span><span class="p">)</span>
</span><span id="Record-187"><a href="#Record-187"><span class="linenos">187</span></a>
</span><span id="Record-188"><a href="#Record-188"><span class="linenos">188</span></a>        <span class="n">calc_rmax</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="Record-189"><a href="#Record-189"><span class="linenos">189</span></a>            <span class="s1">&#39;E11&#39;</span><span class="p">:</span> <span class="n">calc_rmax_e11</span><span class="p">,</span>
</span><span id="Record-190"><a href="#Record-190"><span class="linenos">190</span></a>            <span class="s1">&#39;H80&#39;</span><span class="p">:</span> <span class="n">calc_rmax_h80</span><span class="p">,</span>
</span><span id="Record-191"><a href="#Record-191"><span class="linenos">191</span></a>            <span class="s1">&#39;S02&#39;</span><span class="p">:</span> <span class="n">calc_rmax_s02</span><span class="p">,</span>
</span><span id="Record-192"><a href="#Record-192"><span class="linenos">192</span></a>            <span class="s1">&#39;W04&#39;</span><span class="p">:</span> <span class="n">calc_rmax_w04</span>
</span><span id="Record-193"><a href="#Record-193"><span class="linenos">193</span></a>        <span class="p">}</span>
</span><span id="Record-194"><a href="#Record-194"><span class="linenos">194</span></a>        
</span><span id="Record-195"><a href="#Record-195"><span class="linenos">195</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="Record-196"><a href="#Record-196"><span class="linenos">196</span></a>            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">vlimit</span><span class="p">))</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">methods</span><span class="p">)</span>
</span><span id="Record-197"><a href="#Record-197"><span class="linenos">197</span></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="Record-198"><a href="#Record-198"><span class="linenos">198</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;vlimit must be the size of methods.&#39;</span><span class="p">)</span>
</span><span id="Record-199"><a href="#Record-199"><span class="linenos">199</span></a>
</span><span id="Record-200"><a href="#Record-200"><span class="linenos">200</span></a>        <span class="n">vlimit_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">vlimit</span><span class="p">)[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="c1"># Starts from 0 m/s</span>
</span><span id="Record-201"><a href="#Record-201"><span class="linenos">201</span></a>        <span class="n">vlimit_max</span> <span class="o">=</span> <span class="n">vlimit</span>
</span><span id="Record-202"><a href="#Record-202"><span class="linenos">202</span></a>
</span><span id="Record-203"><a href="#Record-203"><span class="linenos">203</span></a>        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">([</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;rmax&#39;</span><span class="p">]),</span> <span class="n">use_rmax_info</span><span class="p">]):</span>
</span><span id="Record-204"><a href="#Record-204"><span class="linenos">204</span></a>            <span class="c1"># Use the provided vmax</span>
</span><span id="Record-205"><a href="#Record-205"><span class="linenos">205</span></a>            <span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
</span><span id="Record-206"><a href="#Record-206"><span class="linenos">206</span></a>            <span class="n">rmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;rmax&#39;</span><span class="p">]</span>
</span><span id="Record-207"><a href="#Record-207"><span class="linenos">207</span></a>            <span class="n">frmax</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">rmax</span><span class="p">)</span>
</span><span id="Record-208"><a href="#Record-208"><span class="linenos">208</span></a>            <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;frmax&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">frmax</span>
</span><span id="Record-209"><a href="#Record-209"><span class="linenos">209</span></a>        <span class="k">elif</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;vinfo&#39;</span><span class="p">])):</span>
</span><span id="Record-210"><a href="#Record-210"><span class="linenos">210</span></a>            <span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
</span><span id="Record-211"><a href="#Record-211"><span class="linenos">211</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;mslp&#39;</span><span class="p">]):</span>
</span><span id="Record-212"><a href="#Record-212"><span class="linenos">212</span></a>                <span class="c1"># Use S02 regression method for rmax</span>
</span><span id="Record-213"><a href="#Record-213"><span class="linenos">213</span></a>                <span class="n">rmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span><span class="o">*</span><span class="n">calc_rmax_s02</span><span class="p">(</span><span class="n">mslp</span><span class="o">=</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;mslp&#39;</span><span class="p">])</span>
</span><span id="Record-214"><a href="#Record-214"><span class="linenos">214</span></a>            <span class="k">elif</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;vmax&#39;</span><span class="p">]):</span>
</span><span id="Record-215"><a href="#Record-215"><span class="linenos">215</span></a>                <span class="c1"># Use W04 regression method for rmax</span>
</span><span id="Record-216"><a href="#Record-216"><span class="linenos">216</span></a>                <span class="n">rmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span><span class="o">*</span><span class="n">calc_rmax_w04</span><span class="p">(</span><span class="n">vmax</span><span class="o">=</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;vmax&#39;</span><span class="p">],</span> <span class="n">lat</span><span class="o">=</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">])</span>
</span><span id="Record-217"><a href="#Record-217"><span class="linenos">217</span></a>            
</span><span id="Record-218"><a href="#Record-218"><span class="linenos">218</span></a>            <span class="n">frmax</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">rmax</span><span class="p">)</span>
</span><span id="Record-219"><a href="#Record-219"><span class="linenos">219</span></a>            <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;frmax&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">frmax</span>
</span><span id="Record-220"><a href="#Record-220"><span class="linenos">220</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Record-221"><a href="#Record-221"><span class="linenos">221</span></a>            <span class="n">frmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span> <span class="c1"># length of fvinfo or atleast 1</span>
</span><span id="Record-222"><a href="#Record-222"><span class="linenos">222</span></a>            <span class="n">rmax_method</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span> <span class="c1"># Keeping the rmax_method used</span>
</span><span id="Record-223"><a href="#Record-223"><span class="linenos">223</span></a>            <span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
</span><span id="Record-224"><a href="#Record-224"><span class="linenos">224</span></a>            
</span><span id="Record-225"><a href="#Record-225"><span class="linenos">225</span></a>            <span class="c1"># Radial info is available and rmax is to be calculated from radinfo</span>
</span><span id="Record-226"><a href="#Record-226"><span class="linenos">226</span></a>            <span class="k">for</span> <span class="n">fv</span><span class="p">,</span> <span class="n">fr</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;fvinfo&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;fradinfo&#39;</span><span class="p">]):</span>
</span><span id="Record-227"><a href="#Record-227"><span class="linenos">227</span></a>                <span class="n">rmax_fv_theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="c1"># Placeholder</span>
</span><span id="Record-228"><a href="#Record-228"><span class="linenos">228</span></a>                
</span><span id="Record-229"><a href="#Record-229"><span class="linenos">229</span></a>                <span class="c1"># Iterating over all the values interpolated by theta</span>
</span><span id="Record-230"><a href="#Record-230"><span class="linenos">230</span></a>                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">thetai</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">theta</span><span class="p">):</span>
</span><span id="Record-231"><a href="#Record-231"><span class="linenos">231</span></a>                    <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">method</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">methods</span><span class="p">):</span>
</span><span id="Record-232"><a href="#Record-232"><span class="linenos">232</span></a>                        <span class="k">try</span><span class="p">:</span>
</span><span id="Record-233"><a href="#Record-233"><span class="linenos">233</span></a>                            <span class="c1"># Check the vlimit_min vlimit_max</span>
</span><span id="Record-234"><a href="#Record-234"><span class="linenos">234</span></a>                            <span class="k">assert</span> <span class="n">fv</span><span class="p">(</span><span class="n">thetai</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">vlimit_min</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
</span><span id="Record-235"><a href="#Record-235"><span class="linenos">235</span></a>                            <span class="k">assert</span> <span class="n">fv</span><span class="p">(</span><span class="n">thetai</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">vlimit_max</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
</span><span id="Record-236"><a href="#Record-236"><span class="linenos">236</span></a>                            
</span><span id="Record-237"><a href="#Record-237"><span class="linenos">237</span></a>                            <span class="c1"># Trying each methods</span>
</span><span id="Record-238"><a href="#Record-238"><span class="linenos">238</span></a>                            <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;E11&#39;</span><span class="p">:</span>
</span><span id="Record-239"><a href="#Record-239"><span class="linenos">239</span></a>                                <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="Record-240"><a href="#Record-240"><span class="linenos">240</span></a>                                    <span class="s1">&#39;v&#39;</span><span class="p">:</span><span class="n">fv</span><span class="p">(</span><span class="n">thetai</span><span class="p">),</span> 
</span><span id="Record-241"><a href="#Record-241"><span class="linenos">241</span></a>                                    <span class="s1">&#39;r&#39;</span><span class="p">:</span><span class="n">fr</span><span class="p">(</span><span class="n">thetai</span><span class="p">),</span> 
</span><span id="Record-242"><a href="#Record-242"><span class="linenos">242</span></a>                                    <span class="s1">&#39;vmax&#39;</span><span class="p">:</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;fvmax&#39;</span><span class="p">](</span><span class="n">thetai</span><span class="p">),</span> 
</span><span id="Record-243"><a href="#Record-243"><span class="linenos">243</span></a>                                    <span class="s1">&#39;f&#39;</span><span class="p">:</span><span class="n">coriolis</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">]),</span> 
</span><span id="Record-244"><a href="#Record-244"><span class="linenos">244</span></a>                                    <span class="s1">&#39;solver&#39;</span><span class="p">:</span><span class="n">kw_e11</span><span class="p">[</span><span class="s1">&#39;solver&#39;</span><span class="p">],</span> 
</span><span id="Record-245"><a href="#Record-245"><span class="linenos">245</span></a>                                    <span class="s1">&#39;limit&#39;</span><span class="p">:</span><span class="n">kw_e11</span><span class="p">[</span><span class="s1">&#39;limit&#39;</span><span class="p">],</span> 
</span><span id="Record-246"><a href="#Record-246"><span class="linenos">246</span></a>                                    <span class="s1">&#39;step&#39;</span><span class="p">:</span><span class="n">kw_e11</span><span class="p">[</span><span class="s1">&#39;step&#39;</span><span class="p">]</span>
</span><span id="Record-247"><a href="#Record-247"><span class="linenos">247</span></a>                                <span class="p">}</span>
</span><span id="Record-248"><a href="#Record-248"><span class="linenos">248</span></a>                                <span class="n">rmax_fv_theta</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">calc_rmax</span><span class="p">[</span><span class="n">method</span><span class="p">](</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="Record-249"><a href="#Record-249"><span class="linenos">249</span></a>
</span><span id="Record-250"><a href="#Record-250"><span class="linenos">250</span></a>                            <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;H80&#39;</span><span class="p">:</span>
</span><span id="Record-251"><a href="#Record-251"><span class="linenos">251</span></a>                                <span class="c1"># First calculate holland B parameter</span>
</span><span id="Record-252"><a href="#Record-252"><span class="linenos">252</span></a>                                <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="Record-253"><a href="#Record-253"><span class="linenos">253</span></a>                                    <span class="s1">&#39;vmax&#39;</span><span class="p">:</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;fvmax&#39;</span><span class="p">](</span><span class="n">thetai</span><span class="p">),</span>
</span><span id="Record-254"><a href="#Record-254"><span class="linenos">254</span></a>                                    <span class="s1">&#39;pc&#39;</span><span class="p">:</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;mslp&#39;</span><span class="p">],</span>
</span><span id="Record-255"><a href="#Record-255"><span class="linenos">255</span></a>                                    <span class="s1">&#39;pn&#39;</span><span class="p">:</span><span class="n">kw_atmos</span><span class="p">[</span><span class="s1">&#39;pn&#39;</span><span class="p">],</span>
</span><span id="Record-256"><a href="#Record-256"><span class="linenos">256</span></a>                                    <span class="s1">&#39;rhoair&#39;</span><span class="p">:</span><span class="n">kw_atmos</span><span class="p">[</span><span class="s1">&#39;rhoair&#39;</span><span class="p">],</span>
</span><span id="Record-257"><a href="#Record-257"><span class="linenos">257</span></a>                                    <span class="s1">&#39;bmax&#39;</span><span class="p">:</span><span class="n">kw_h80</span><span class="p">[</span><span class="s1">&#39;bmax&#39;</span><span class="p">],</span>
</span><span id="Record-258"><a href="#Record-258"><span class="linenos">258</span></a>                                    <span class="s1">&#39;bmin&#39;</span><span class="p">:</span><span class="n">kw_h80</span><span class="p">[</span><span class="s1">&#39;bmin&#39;</span><span class="p">]</span>
</span><span id="Record-259"><a href="#Record-259"><span class="linenos">259</span></a>                                <span class="p">}</span>
</span><span id="Record-260"><a href="#Record-260"><span class="linenos">260</span></a>                                <span class="n">B</span> <span class="o">=</span> <span class="n">calc_holland_B</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="Record-261"><a href="#Record-261"><span class="linenos">261</span></a>
</span><span id="Record-262"><a href="#Record-262"><span class="linenos">262</span></a>                                <span class="c1"># Then calculate the rmax</span>
</span><span id="Record-263"><a href="#Record-263"><span class="linenos">263</span></a>                                <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="Record-264"><a href="#Record-264"><span class="linenos">264</span></a>                                    <span class="s1">&#39;v&#39;</span><span class="p">:</span><span class="n">fv</span><span class="p">(</span><span class="n">thetai</span><span class="p">),</span> 
</span><span id="Record-265"><a href="#Record-265"><span class="linenos">265</span></a>                                    <span class="s1">&#39;r&#39;</span><span class="p">:</span><span class="n">fr</span><span class="p">(</span><span class="n">thetai</span><span class="p">),</span> 
</span><span id="Record-266"><a href="#Record-266"><span class="linenos">266</span></a>                                    <span class="s1">&#39;pc&#39;</span><span class="p">:</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;mslp&#39;</span><span class="p">],</span> 
</span><span id="Record-267"><a href="#Record-267"><span class="linenos">267</span></a>                                    <span class="s1">&#39;B&#39;</span><span class="p">:</span><span class="n">B</span><span class="p">,</span> 
</span><span id="Record-268"><a href="#Record-268"><span class="linenos">268</span></a>                                    <span class="s1">&#39;f&#39;</span><span class="p">:</span><span class="n">coriolis</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">]),</span> 
</span><span id="Record-269"><a href="#Record-269"><span class="linenos">269</span></a>                                    <span class="s1">&#39;pn&#39;</span><span class="p">:</span><span class="n">kw_atmos</span><span class="p">[</span><span class="s1">&#39;pn&#39;</span><span class="p">],</span> 
</span><span id="Record-270"><a href="#Record-270"><span class="linenos">270</span></a>                                    <span class="s1">&#39;rhoair&#39;</span><span class="p">:</span><span class="n">kw_atmos</span><span class="p">[</span><span class="s1">&#39;rhoair&#39;</span><span class="p">],</span> 
</span><span id="Record-271"><a href="#Record-271"><span class="linenos">271</span></a>                                    <span class="s1">&#39;solver&#39;</span><span class="p">:</span><span class="n">kw_h80</span><span class="p">[</span><span class="s1">&#39;solver&#39;</span><span class="p">],</span> 
</span><span id="Record-272"><a href="#Record-272"><span class="linenos">272</span></a>                                    <span class="s1">&#39;limit&#39;</span><span class="p">:</span><span class="n">kw_h80</span><span class="p">[</span><span class="s1">&#39;limit&#39;</span><span class="p">],</span> 
</span><span id="Record-273"><a href="#Record-273"><span class="linenos">273</span></a>                                    <span class="s1">&#39;step&#39;</span><span class="p">:</span><span class="n">kw_h80</span><span class="p">[</span><span class="s1">&#39;step&#39;</span><span class="p">]</span>
</span><span id="Record-274"><a href="#Record-274"><span class="linenos">274</span></a>                                <span class="p">}</span>
</span><span id="Record-275"><a href="#Record-275"><span class="linenos">275</span></a>                                <span class="n">rmax_fv_theta</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">calc_rmax</span><span class="p">[</span><span class="n">method</span><span class="p">](</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="Record-276"><a href="#Record-276"><span class="linenos">276</span></a>
</span><span id="Record-277"><a href="#Record-277"><span class="linenos">277</span></a>                            <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;S02&#39;</span><span class="p">:</span>
</span><span id="Record-278"><a href="#Record-278"><span class="linenos">278</span></a>                                <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="Record-279"><a href="#Record-279"><span class="linenos">279</span></a>                                    <span class="s1">&#39;mslp&#39;</span><span class="p">:</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;mslp&#39;</span><span class="p">]</span>
</span><span id="Record-280"><a href="#Record-280"><span class="linenos">280</span></a>                                <span class="p">}</span>
</span><span id="Record-281"><a href="#Record-281"><span class="linenos">281</span></a>                                <span class="n">rmax_fv_theta</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">calc_rmax</span><span class="p">[</span><span class="n">method</span><span class="p">](</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="Record-282"><a href="#Record-282"><span class="linenos">282</span></a>
</span><span id="Record-283"><a href="#Record-283"><span class="linenos">283</span></a>                            <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;W04&#39;</span><span class="p">:</span>
</span><span id="Record-284"><a href="#Record-284"><span class="linenos">284</span></a>                                <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="Record-285"><a href="#Record-285"><span class="linenos">285</span></a>                                    <span class="s1">&#39;vmax&#39;</span><span class="p">:</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;fvmax&#39;</span><span class="p">](</span><span class="n">thetai</span><span class="p">),</span>
</span><span id="Record-286"><a href="#Record-286"><span class="linenos">286</span></a>                                    <span class="s1">&#39;lat&#39;</span><span class="p">:</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span>
</span><span id="Record-287"><a href="#Record-287"><span class="linenos">287</span></a>                                <span class="p">}</span>
</span><span id="Record-288"><a href="#Record-288"><span class="linenos">288</span></a>                                <span class="n">rmax_fv_theta</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">calc_rmax</span><span class="p">[</span><span class="n">method</span><span class="p">](</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>                            
</span><span id="Record-289"><a href="#Record-289"><span class="linenos">289</span></a>
</span><span id="Record-290"><a href="#Record-290"><span class="linenos">290</span></a>                            <span class="c1"># When successful break the loop</span>
</span><span id="Record-291"><a href="#Record-291"><span class="linenos">291</span></a>                            <span class="k">break</span>
</span><span id="Record-292"><a href="#Record-292"><span class="linenos">292</span></a>                        <span class="k">except</span><span class="p">:</span>
</span><span id="Record-293"><a href="#Record-293"><span class="linenos">293</span></a>                            <span class="c1"># Otherwise continue with the methods</span>
</span><span id="Record-294"><a href="#Record-294"><span class="linenos">294</span></a>                            <span class="k">continue</span>
</span><span id="Record-295"><a href="#Record-295"><span class="linenos">295</span></a>                
</span><span id="Record-296"><a href="#Record-296"><span class="linenos">296</span></a>                <span class="c1"># For a particular vinfo create the interpolation function</span>
</span><span id="Record-297"><a href="#Record-297"><span class="linenos">297</span></a>                <span class="c1"># append to frmax</span>
</span><span id="Record-298"><a href="#Record-298"><span class="linenos">298</span></a>                <span class="n">frmax_fv</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">rmax_fv_theta</span><span class="p">)</span>
</span><span id="Record-299"><a href="#Record-299"><span class="linenos">299</span></a>                <span class="n">frmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">frmax</span><span class="p">,</span> <span class="n">frmax_fv</span><span class="p">)</span>
</span><span id="Record-300"><a href="#Record-300"><span class="linenos">300</span></a>            
</span><span id="Record-301"><a href="#Record-301"><span class="linenos">301</span></a>            <span class="c1"># Save to Record dictionary</span>
</span><span id="Record-302"><a href="#Record-302"><span class="linenos">302</span></a>            <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;frmax&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">frmax</span>  
</span><span id="Record-303"><a href="#Record-303"><span class="linenos">303</span></a>            <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;rmax_method&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rmax_method</span>
</span><span id="Record-304"><a href="#Record-304"><span class="linenos">304</span></a>        
</span><span id="Record-305"><a href="#Record-305"><span class="linenos">305</span></a>        <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>        
</span><span id="Record-306"><a href="#Record-306"><span class="linenos">306</span></a>
</span><span id="Record-307"><a href="#Record-307"><span class="linenos">307</span></a>    <span class="k">def</span> <span class="nf">calculate_wind</span><span class="p">(</span>
</span><span id="Record-308"><a href="#Record-308"><span class="linenos">308</span></a>        <span class="bp">self</span><span class="p">,</span> 
</span><span id="Record-309"><a href="#Record-309"><span class="linenos">309</span></a>        <span class="n">at</span><span class="p">,</span> 
</span><span id="Record-310"><a href="#Record-310"><span class="linenos">310</span></a>        <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;E11&#39;</span><span class="p">,</span><span class="s1">&#39;H80&#39;</span><span class="p">],</span>
</span><span id="Record-311"><a href="#Record-311"><span class="linenos">311</span></a>        <span class="n">rmax_frac</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">],</span>
</span><span id="Record-312"><a href="#Record-312"><span class="linenos">312</span></a>        <span class="n">rmax_select</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span>
</span><span id="Record-313"><a href="#Record-313"><span class="linenos">313</span></a>        <span class="n">kw_corr</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;fraction&#39;</span><span class="p">:</span><span class="mf">0.56</span><span class="p">,</span> <span class="s1">&#39;angle&#39;</span><span class="p">:</span><span class="mf">19.2</span><span class="p">,</span> <span class="s1">&#39;swrf&#39;</span><span class="p">:</span><span class="mf">0.9</span><span class="p">,</span> <span class="s1">&#39;tfac&#39;</span><span class="p">:</span><span class="mf">0.88</span><span class="p">},</span>
</span><span id="Record-314"><a href="#Record-314"><span class="linenos">314</span></a>        <span class="n">kw_atmos</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;pn&#39;</span><span class="p">:</span><span class="mi">101325</span><span class="p">,</span> <span class="s1">&#39;rhoair&#39;</span><span class="p">:</span><span class="mf">1.15</span><span class="p">},</span>
</span><span id="Record-315"><a href="#Record-315"><span class="linenos">315</span></a>        <span class="n">kw_h80</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;bmax&#39;</span><span class="p">:</span><span class="mf">2.5</span><span class="p">,</span> <span class="s1">&#39;bmin&#39;</span><span class="p">:</span><span class="mf">0.5</span><span class="p">},</span>
</span><span id="Record-316"><a href="#Record-316"><span class="linenos">316</span></a>        <span class="n">kw_e04</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;b&#39;</span><span class="p">:</span><span class="mf">0.25</span><span class="p">,</span> <span class="s1">&#39;m&#39;</span><span class="p">:</span><span class="mf">1.6</span><span class="p">,</span> <span class="s1">&#39;n&#39;</span><span class="p">:</span><span class="mf">0.9</span><span class="p">,</span> <span class="s1">&#39;R0&#39;</span><span class="p">:</span><span class="mi">420000</span><span class="p">},</span>
</span><span id="Record-317"><a href="#Record-317"><span class="linenos">317</span></a>        <span class="n">kw_w06</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;n&#39;</span><span class="p">:</span><span class="mf">0.79</span><span class="p">,</span> <span class="s1">&#39;X&#39;</span><span class="p">:</span><span class="mi">243000</span><span class="p">},</span>
</span><span id="Record-318"><a href="#Record-318"><span class="linenos">318</span></a>        <span class="n">kw_m16</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;n&#39;</span><span class="p">:</span><span class="mf">0.6</span><span class="p">}</span>
</span><span id="Record-319"><a href="#Record-319"><span class="linenos">319</span></a>    <span class="p">):</span>
</span><span id="Record-320"><a href="#Record-320"><span class="linenos">320</span></a><span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="Record-321"><a href="#Record-321"><span class="linenos">321</span></a><span class="sd">        Calculate wind field using given method till a fractional distance of </span>
</span><span id="Record-322"><a href="#Record-322"><span class="linenos">322</span></a><span class="sd">        rmax.</span>
</span><span id="Record-323"><a href="#Record-323"><span class="linenos">323</span></a>
</span><span id="Record-324"><a href="#Record-324"><span class="linenos">324</span></a><span class="sd">        at: (r, theta) location where the wind is calculated,</span>
</span><span id="Record-325"><a href="#Record-325"><span class="linenos">325</span></a><span class="sd">            r, float, distance in m </span>
</span><span id="Record-326"><a href="#Record-326"><span class="linenos">326</span></a><span class="sd">            theta, float, is -2*np.pi, 2*np.pi radians</span>
</span><span id="Record-327"><a href="#Record-327"><span class="linenos">327</span></a><span class="sd">            Essentially theta is expected to be output from np.arctan2(y,x)</span>
</span><span id="Record-328"><a href="#Record-328"><span class="linenos">328</span></a><span class="sd">            Theis counter-clockwise from x-axis angle is converted to a clockwise</span>
</span><span id="Record-329"><a href="#Record-329"><span class="linenos">329</span></a><span class="sd">            angle from y axis to match the interpolation grid of the storm paramters. </span>
</span><span id="Record-330"><a href="#Record-330"><span class="linenos">330</span></a><span class="sd">        methods: array, list of methods to be used. Currently implemented methods</span>
</span><span id="Record-331"><a href="#Record-331"><span class="linenos">331</span></a><span class="sd">                are - H80, H80c, J92, W06, E04, E11, M16</span>
</span><span id="Record-332"><a href="#Record-332"><span class="linenos">332</span></a><span class="sd">        rmax_frac: array, till which fraction of rmax, the method to be used,</span>
</span><span id="Record-333"><a href="#Record-333"><span class="linenos">333</span></a><span class="sd">                np.inf for whole</span>
</span><span id="Record-334"><a href="#Record-334"><span class="linenos">334</span></a><span class="sd">        rmax_select: which rmax to select, int, str</span>
</span><span id="Record-335"><a href="#Record-335"><span class="linenos">335</span></a><span class="sd">                    &#39;mean&#39;: mean value of the rmax</span>
</span><span id="Record-336"><a href="#Record-336"><span class="linenos">336</span></a><span class="sd">                    &#39;nearest&#39;: rmax calculated from nearest frmax</span>
</span><span id="Record-337"><a href="#Record-337"><span class="linenos">337</span></a><span class="sd">                    &#39;linear&#39;: rmax calculated from a linear interpolation</span>
</span><span id="Record-338"><a href="#Record-338"><span class="linenos">338</span></a><span class="sd">                    int: number corresponding to selected rmax &gt;1</span>
</span><span id="Record-339"><a href="#Record-339"><span class="linenos">339</span></a><span class="sd">        kw_corr: corrections applied for translation and surface wind reduction</span>
</span><span id="Record-340"><a href="#Record-340"><span class="linenos">340</span></a><span class="sd">                fraction: fraction of translation wind, 0.56 default</span>
</span><span id="Record-341"><a href="#Record-341"><span class="linenos">341</span></a><span class="sd">                angle: angle of ratation, 19.2 degree default</span>
</span><span id="Record-342"><a href="#Record-342"><span class="linenos">342</span></a><span class="sd">                swrf: surface wind reduction factor, 0.9 default</span>
</span><span id="Record-343"><a href="#Record-343"><span class="linenos">343</span></a><span class="sd">                tfac: convertion factor to from x minute to 10 minute wind</span>
</span><span id="Record-344"><a href="#Record-344"><span class="linenos">344</span></a><span class="sd">                    0.88 for conversion from 1minute to 10minute</span>
</span><span id="Record-345"><a href="#Record-345"><span class="linenos">345</span></a><span class="sd">        kw_atmos: constant atmospheric values</span>
</span><span id="Record-346"><a href="#Record-346"><span class="linenos">346</span></a><span class="sd">            pn: nominal or environmental pressure, default 101325 Pa</span>
</span><span id="Record-347"><a href="#Record-347"><span class="linenos">347</span></a><span class="sd">            rhoair: air density, default 1.15 km/m^3</span>
</span><span id="Record-348"><a href="#Record-348"><span class="linenos">348</span></a><span class="sd">        kw_h80: extra argument for H80 model</span>
</span><span id="Record-349"><a href="#Record-349"><span class="linenos">349</span></a><span class="sd">            bmin: Minimum B value</span>
</span><span id="Record-350"><a href="#Record-350"><span class="linenos">350</span></a><span class="sd">            bmax: Maximum B value</span>
</span><span id="Record-351"><a href="#Record-351"><span class="linenos">351</span></a><span class="sd">        kw_e04: extra argument for E04 model</span>
</span><span id="Record-352"><a href="#Record-352"><span class="linenos">352</span></a><span class="sd">            b: default 0.25</span>
</span><span id="Record-353"><a href="#Record-353"><span class="linenos">353</span></a><span class="sd">            m: default 1.6</span>
</span><span id="Record-354"><a href="#Record-354"><span class="linenos">354</span></a><span class="sd">            n: default 0.9</span>
</span><span id="Record-355"><a href="#Record-355"><span class="linenos">355</span></a><span class="sd">            R0: default 420000m (420km)</span>
</span><span id="Record-356"><a href="#Record-356"><span class="linenos">356</span></a><span class="sd">        kw_w06: extra argument for W06 model</span>
</span><span id="Record-357"><a href="#Record-357"><span class="linenos">357</span></a><span class="sd">            n: default 0.79</span>
</span><span id="Record-358"><a href="#Record-358"><span class="linenos">358</span></a><span class="sd">            X: default 243000m (243km)</span>
</span><span id="Record-359"><a href="#Record-359"><span class="linenos">359</span></a><span class="sd">        kw_m16: extra argument for M16 model</span>
</span><span id="Record-360"><a href="#Record-360"><span class="linenos">360</span></a><span class="sd">            n: default 0.6</span>
</span><span id="Record-361"><a href="#Record-361"><span class="linenos">361</span></a><span class="sd">        &#39;&#39;&#39;</span>
</span><span id="Record-362"><a href="#Record-362"><span class="linenos">362</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="Record-363"><a href="#Record-363"><span class="linenos">363</span></a>            <span class="n">r</span><span class="p">,</span> <span class="n">theta_input</span> <span class="o">=</span> <span class="n">at</span>
</span><span id="Record-364"><a href="#Record-364"><span class="linenos">364</span></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="Record-365"><a href="#Record-365"><span class="linenos">365</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;the at must be in (r, theta) as list/array of size 2&#39;</span><span class="p">)</span>
</span><span id="Record-366"><a href="#Record-366"><span class="linenos">366</span></a>        
</span><span id="Record-367"><a href="#Record-367"><span class="linenos">367</span></a>        <span class="c1"># Convert theta from x-axis counter clock to y-axis clock wise</span>
</span><span id="Record-368"><a href="#Record-368"><span class="linenos">368</span></a>        <span class="n">theta</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="o">*</span><span class="n">theta_input</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span>
</span><span id="Record-369"><a href="#Record-369"><span class="linenos">369</span></a>
</span><span id="Record-370"><a href="#Record-370"><span class="linenos">370</span></a>        <span class="c1"># Theta -180:180 to 0:360 format, clockwise from 0N</span>
</span><span id="Record-371"><a href="#Record-371"><span class="linenos">371</span></a>        <span class="k">if</span> <span class="n">theta_input</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Record-372"><a href="#Record-372"><span class="linenos">372</span></a>            <span class="n">theta</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">+</span> <span class="n">theta_input</span>
</span><span id="Record-373"><a href="#Record-373"><span class="linenos">373</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Record-374"><a href="#Record-374"><span class="linenos">374</span></a>            <span class="n">theta</span> <span class="o">=</span> <span class="n">theta_input</span>
</span><span id="Record-375"><a href="#Record-375"><span class="linenos">375</span></a>
</span><span id="Record-376"><a href="#Record-376"><span class="linenos">376</span></a>        <span class="n">calc_vcirc</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="Record-377"><a href="#Record-377"><span class="linenos">377</span></a>            <span class="s1">&#39;H80&#39;</span><span class="p">:</span><span class="n">calc_vcirc_h80</span><span class="p">,</span>
</span><span id="Record-378"><a href="#Record-378"><span class="linenos">378</span></a>            <span class="s1">&#39;H80c&#39;</span><span class="p">:</span><span class="n">calc_vcirc_h80c</span><span class="p">,</span>
</span><span id="Record-379"><a href="#Record-379"><span class="linenos">379</span></a>            <span class="s1">&#39;J92&#39;</span><span class="p">:</span><span class="n">calc_vcirc_j92</span><span class="p">,</span>
</span><span id="Record-380"><a href="#Record-380"><span class="linenos">380</span></a>            <span class="s1">&#39;W06&#39;</span><span class="p">:</span><span class="n">calc_vcirc_w06</span><span class="p">,</span>
</span><span id="Record-381"><a href="#Record-381"><span class="linenos">381</span></a>            <span class="s1">&#39;E04&#39;</span><span class="p">:</span><span class="n">calc_vcirc_e04</span><span class="p">,</span>
</span><span id="Record-382"><a href="#Record-382"><span class="linenos">382</span></a>            <span class="s1">&#39;E11&#39;</span><span class="p">:</span><span class="n">calc_vcirc_e11</span><span class="p">,</span>
</span><span id="Record-383"><a href="#Record-383"><span class="linenos">383</span></a>            <span class="s1">&#39;M16&#39;</span><span class="p">:</span><span class="n">calc_vcirc_m16</span>
</span><span id="Record-384"><a href="#Record-384"><span class="linenos">384</span></a>        <span class="p">}</span>
</span><span id="Record-385"><a href="#Record-385"><span class="linenos">385</span></a>
</span><span id="Record-386"><a href="#Record-386"><span class="linenos">386</span></a>        <span class="c1"># Calculate vmax for further calculation</span>
</span><span id="Record-387"><a href="#Record-387"><span class="linenos">387</span></a>        <span class="n">vmax</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;fvmax&#39;</span><span class="p">](</span><span class="n">theta</span><span class="p">)</span>
</span><span id="Record-388"><a href="#Record-388"><span class="linenos">388</span></a>
</span><span id="Record-389"><a href="#Record-389"><span class="linenos">389</span></a>        <span class="c1"># Find appropriate rmax function to be used</span>
</span><span id="Record-390"><a href="#Record-390"><span class="linenos">390</span></a>        <span class="c1"># and calculate rmax</span>
</span><span id="Record-391"><a href="#Record-391"><span class="linenos">391</span></a>        <span class="n">rmax_select_methods_available</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;nearest&#39;</span><span class="p">,</span> <span class="s1">&#39;linear&#39;</span><span class="p">]</span>
</span><span id="Record-392"><a href="#Record-392"><span class="linenos">392</span></a>
</span><span id="Record-393"><a href="#Record-393"><span class="linenos">393</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rmax_select</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="Record-394"><a href="#Record-394"><span class="linenos">394</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="Record-395"><a href="#Record-395"><span class="linenos">395</span></a>                <span class="k">assert</span> <span class="n">rmax_select</span> <span class="ow">in</span> <span class="n">rmax_select_methods_available</span>
</span><span id="Record-396"><a href="#Record-396"><span class="linenos">396</span></a>
</span><span id="Record-397"><a href="#Record-397"><span class="linenos">397</span></a>                <span class="k">if</span> <span class="n">rmax_select</span><span class="o">==</span><span class="s1">&#39;mean&#39;</span><span class="p">:</span>
</span><span id="Record-398"><a href="#Record-398"><span class="linenos">398</span></a>                    <span class="n">rmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">([</span><span class="n">f</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;frmax&#39;</span><span class="p">])])</span>
</span><span id="Record-399"><a href="#Record-399"><span class="linenos">399</span></a>                
</span><span id="Record-400"><a href="#Record-400"><span class="linenos">400</span></a>                <span class="k">if</span> <span class="n">rmax_select</span><span class="o">==</span><span class="s1">&#39;nearest&#39;</span><span class="p">:</span>
</span><span id="Record-401"><a href="#Record-401"><span class="linenos">401</span></a>                    <span class="k">try</span><span class="p">:</span>
</span><span id="Record-402"><a href="#Record-402"><span class="linenos">402</span></a>                        <span class="n">radinfo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">radi</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="k">for</span> <span class="n">radi</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;fradinfo&#39;</span><span class="p">]])</span>
</span><span id="Record-403"><a href="#Record-403"><span class="linenos">403</span></a>                        <span class="n">radnn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">radinfo</span><span class="o">-</span><span class="n">r</span><span class="p">))</span>
</span><span id="Record-404"><a href="#Record-404"><span class="linenos">404</span></a>                        <span class="n">rmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">f</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;frmax&#39;</span><span class="p">])])[</span><span class="n">radnn</span><span class="p">]</span>
</span><span id="Record-405"><a href="#Record-405"><span class="linenos">405</span></a>                    <span class="k">except</span><span class="p">:</span>
</span><span id="Record-406"><a href="#Record-406"><span class="linenos">406</span></a>                        <span class="n">rmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;frmax&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">](</span><span class="n">theta</span><span class="p">)</span>
</span><span id="Record-407"><a href="#Record-407"><span class="linenos">407</span></a>                        <span class="k">raise</span> <span class="ne">Warning</span><span class="p">(</span><span class="s1">&#39;nearest not possible, first rmax selected&#39;</span><span class="p">)</span>
</span><span id="Record-408"><a href="#Record-408"><span class="linenos">408</span></a>
</span><span id="Record-409"><a href="#Record-409"><span class="linenos">409</span></a>                <span class="k">if</span> <span class="n">rmax_select</span><span class="o">==</span><span class="s1">&#39;linear&#39;</span><span class="p">:</span>
</span><span id="Record-410"><a href="#Record-410"><span class="linenos">410</span></a>                    <span class="k">try</span><span class="p">:</span>
</span><span id="Record-411"><a href="#Record-411"><span class="linenos">411</span></a>                        <span class="c1"># x field from -inf to +inf</span>
</span><span id="Record-412"><a href="#Record-412"><span class="linenos">412</span></a>                        <span class="n">radinfo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">radi</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="k">for</span> <span class="n">radi</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;fradinfo&#39;</span><span class="p">]])</span>
</span><span id="Record-413"><a href="#Record-413"><span class="linenos">413</span></a>                        <span class="n">radinfo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">radinfo</span><span class="p">)</span>
</span><span id="Record-414"><a href="#Record-414"><span class="linenos">414</span></a>                        <span class="n">radinfo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">radinfo</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
</span><span id="Record-415"><a href="#Record-415"><span class="linenos">415</span></a>                        <span class="c1"># y field </span>
</span><span id="Record-416"><a href="#Record-416"><span class="linenos">416</span></a>                        <span class="n">rmaxinfo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">f</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;frmax&#39;</span><span class="p">])])</span>
</span><span id="Record-417"><a href="#Record-417"><span class="linenos">417</span></a>                        <span class="n">rmaxinfo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rmaxinfo</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">rmaxinfo</span><span class="p">)</span>
</span><span id="Record-418"><a href="#Record-418"><span class="linenos">418</span></a>                        <span class="n">rmaxinfo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rmaxinfo</span><span class="p">,</span> <span class="n">rmaxinfo</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</span><span id="Record-419"><a href="#Record-419"><span class="linenos">419</span></a>                        <span class="n">int_f</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">radinfo</span><span class="p">,</span> <span class="n">rmaxinfo</span><span class="p">)</span>
</span><span id="Record-420"><a href="#Record-420"><span class="linenos">420</span></a>                        <span class="n">rmax</span> <span class="o">=</span> <span class="n">int_f</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
</span><span id="Record-421"><a href="#Record-421"><span class="linenos">421</span></a>                    <span class="k">except</span><span class="p">:</span>
</span><span id="Record-422"><a href="#Record-422"><span class="linenos">422</span></a>                        <span class="n">rmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;frmax&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">](</span><span class="n">theta</span><span class="p">)</span>
</span><span id="Record-423"><a href="#Record-423"><span class="linenos">423</span></a>                        <span class="k">raise</span> <span class="ne">Warning</span><span class="p">(</span><span class="s1">&#39;linear not possible, first rmax selected&#39;</span><span class="p">)</span>
</span><span id="Record-424"><a href="#Record-424"><span class="linenos">424</span></a>            <span class="k">except</span><span class="p">:</span>
</span><span id="Record-425"><a href="#Record-425"><span class="linenos">425</span></a>                <span class="n">rmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;frmax&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">](</span><span class="n">theta</span><span class="p">)</span>
</span><span id="Record-426"><a href="#Record-426"><span class="linenos">426</span></a>                <span class="k">raise</span> <span class="ne">Warning</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Wrong keyword for rmax method. First frmax is used&#39;</span><span class="p">)</span>
</span><span id="Record-427"><a href="#Record-427"><span class="linenos">427</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rmax_select</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="Record-428"><a href="#Record-428"><span class="linenos">428</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="Record-429"><a href="#Record-429"><span class="linenos">429</span></a>                <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">f</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;frmax&#39;</span><span class="p">])])[</span><span class="n">rmax_select</span><span class="p">]</span>
</span><span id="Record-430"><a href="#Record-430"><span class="linenos">430</span></a>            <span class="k">except</span><span class="p">:</span>
</span><span id="Record-431"><a href="#Record-431"><span class="linenos">431</span></a>                <span class="n">rmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;frmax&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">](</span><span class="n">theta</span><span class="p">)</span>
</span><span id="Record-432"><a href="#Record-432"><span class="linenos">432</span></a>                <span class="k">raise</span> <span class="ne">Warning</span><span class="p">(</span><span class="s1">&#39;Wrong rmax index. First frmax is used&#39;</span><span class="p">)</span>
</span><span id="Record-433"><a href="#Record-433"><span class="linenos">433</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Record-434"><a href="#Record-434"><span class="linenos">434</span></a>            <span class="n">rmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;frmax&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">](</span><span class="n">theta</span><span class="p">)</span>
</span><span id="Record-435"><a href="#Record-435"><span class="linenos">435</span></a>            <span class="k">raise</span> <span class="ne">Warning</span><span class="p">(</span><span class="s1">&#39;Wrong rmax selection keyword/index. First frmax is used&#39;</span><span class="p">)</span>
</span><span id="Record-436"><a href="#Record-436"><span class="linenos">436</span></a>
</span><span id="Record-437"><a href="#Record-437"><span class="linenos">437</span></a>        <span class="c1"># Now check methods and rmax_frac and apply method as required</span>
</span><span id="Record-438"><a href="#Record-438"><span class="linenos">438</span></a>        <span class="c1"># Avoid wrong input of rmax_frac</span>
</span><span id="Record-439"><a href="#Record-439"><span class="linenos">439</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="Record-440"><a href="#Record-440"><span class="linenos">440</span></a>            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">rmax_frac</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">methods</span><span class="p">)</span>
</span><span id="Record-441"><a href="#Record-441"><span class="linenos">441</span></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="Record-442"><a href="#Record-442"><span class="linenos">442</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;rmax_frac must corresponds to each listed method&#39;</span><span class="p">)</span>
</span><span id="Record-443"><a href="#Record-443"><span class="linenos">443</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Record-444"><a href="#Record-444"><span class="linenos">444</span></a>            <span class="n">rmax_frac</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">rmax_frac</span><span class="p">)</span>
</span><span id="Record-445"><a href="#Record-445"><span class="linenos">445</span></a>        
</span><span id="Record-446"><a href="#Record-446"><span class="linenos">446</span></a>        <span class="n">rlim_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">rmax_frac</span><span class="p">)[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">rmax</span> <span class="c1"># Starts from 0</span>
</span><span id="Record-447"><a href="#Record-447"><span class="linenos">447</span></a>        <span class="n">rlim_max</span> <span class="o">=</span> <span class="n">rmax_frac</span><span class="o">*</span><span class="n">rmax</span>
</span><span id="Record-448"><a href="#Record-448"><span class="linenos">448</span></a>
</span><span id="Record-449"><a href="#Record-449"><span class="linenos">449</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">method</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">methods</span><span class="p">):</span>
</span><span id="Record-450"><a href="#Record-450"><span class="linenos">450</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="Record-451"><a href="#Record-451"><span class="linenos">451</span></a>                <span class="k">assert</span> <span class="n">r</span> <span class="o">&gt;=</span> <span class="n">rlim_min</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="Record-452"><a href="#Record-452"><span class="linenos">452</span></a>                <span class="k">assert</span> <span class="n">r</span> <span class="o">&lt;</span> <span class="n">rlim_max</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="Record-453"><a href="#Record-453"><span class="linenos">453</span></a>
</span><span id="Record-454"><a href="#Record-454"><span class="linenos">454</span></a>                <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;H80&#39;</span><span class="p">:</span>
</span><span id="Record-455"><a href="#Record-455"><span class="linenos">455</span></a>                    <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="Record-456"><a href="#Record-456"><span class="linenos">456</span></a>                        <span class="s1">&#39;vmax&#39;</span><span class="p">:</span><span class="n">vmax</span><span class="p">,</span> 
</span><span id="Record-457"><a href="#Record-457"><span class="linenos">457</span></a>                        <span class="s1">&#39;rmax&#39;</span><span class="p">:</span><span class="n">rmax</span><span class="p">,</span>
</span><span id="Record-458"><a href="#Record-458"><span class="linenos">458</span></a>                        <span class="s1">&#39;pc&#39;</span><span class="p">:</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;mslp&#39;</span><span class="p">],</span>
</span><span id="Record-459"><a href="#Record-459"><span class="linenos">459</span></a>                        <span class="s1">&#39;f&#39;</span><span class="p">:</span><span class="n">coriolis</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">]),</span>
</span><span id="Record-460"><a href="#Record-460"><span class="linenos">460</span></a>                        <span class="s1">&#39;pn&#39;</span><span class="p">:</span><span class="n">kw_atmos</span><span class="p">[</span><span class="s1">&#39;pn&#39;</span><span class="p">],</span>
</span><span id="Record-461"><a href="#Record-461"><span class="linenos">461</span></a>                        <span class="s1">&#39;rhoair&#39;</span><span class="p">:</span><span class="n">kw_atmos</span><span class="p">[</span><span class="s1">&#39;rhoair&#39;</span><span class="p">],</span>
</span><span id="Record-462"><a href="#Record-462"><span class="linenos">462</span></a>                        <span class="s1">&#39;bmax&#39;</span><span class="p">:</span><span class="n">kw_h80</span><span class="p">[</span><span class="s1">&#39;bmax&#39;</span><span class="p">],</span>
</span><span id="Record-463"><a href="#Record-463"><span class="linenos">463</span></a>                        <span class="s1">&#39;bmin&#39;</span><span class="p">:</span><span class="n">kw_h80</span><span class="p">[</span><span class="s1">&#39;bmin&#39;</span><span class="p">]</span>
</span><span id="Record-464"><a href="#Record-464"><span class="linenos">464</span></a>                    <span class="p">}</span>
</span><span id="Record-465"><a href="#Record-465"><span class="linenos">465</span></a>                    <span class="n">B</span> <span class="o">=</span> <span class="n">calc_holland_B_full</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="Record-466"><a href="#Record-466"><span class="linenos">466</span></a>                    <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="Record-467"><a href="#Record-467"><span class="linenos">467</span></a>                        <span class="s1">&#39;r&#39;</span><span class="p">:</span><span class="n">r</span><span class="p">,</span>
</span><span id="Record-468"><a href="#Record-468"><span class="linenos">468</span></a>                        <span class="s1">&#39;Rm&#39;</span><span class="p">:</span><span class="n">rmax</span><span class="p">,</span>
</span><span id="Record-469"><a href="#Record-469"><span class="linenos">469</span></a>                        <span class="s1">&#39;pc&#39;</span><span class="p">:</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;mslp&#39;</span><span class="p">],</span>
</span><span id="Record-470"><a href="#Record-470"><span class="linenos">470</span></a>                        <span class="s1">&#39;B&#39;</span><span class="p">:</span><span class="n">B</span><span class="p">,</span>
</span><span id="Record-471"><a href="#Record-471"><span class="linenos">471</span></a>                        <span class="s1">&#39;pn&#39;</span><span class="p">:</span><span class="n">kw_atmos</span><span class="p">[</span><span class="s1">&#39;pn&#39;</span><span class="p">],</span>
</span><span id="Record-472"><a href="#Record-472"><span class="linenos">472</span></a>                        <span class="s1">&#39;rhoair&#39;</span><span class="p">:</span><span class="n">kw_atmos</span><span class="p">[</span><span class="s1">&#39;rhoair&#39;</span><span class="p">],</span>
</span><span id="Record-473"><a href="#Record-473"><span class="linenos">473</span></a>                        <span class="s1">&#39;f&#39;</span><span class="p">:</span><span class="n">coriolis</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">])</span>
</span><span id="Record-474"><a href="#Record-474"><span class="linenos">474</span></a>                    <span class="p">}</span>
</span><span id="Record-475"><a href="#Record-475"><span class="linenos">475</span></a>                    <span class="n">vcirc</span> <span class="o">=</span> <span class="n">calc_vcirc</span><span class="p">[</span><span class="n">method</span><span class="p">](</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="Record-476"><a href="#Record-476"><span class="linenos">476</span></a>                
</span><span id="Record-477"><a href="#Record-477"><span class="linenos">477</span></a>                <span class="k">if</span> <span class="n">method</span><span class="o">==</span><span class="s1">&#39;H80c&#39;</span><span class="p">:</span>
</span><span id="Record-478"><a href="#Record-478"><span class="linenos">478</span></a>                    <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="Record-479"><a href="#Record-479"><span class="linenos">479</span></a>                        <span class="s1">&#39;vmax&#39;</span><span class="p">:</span><span class="n">vmax</span><span class="p">,</span> 
</span><span id="Record-480"><a href="#Record-480"><span class="linenos">480</span></a>                        <span class="s1">&#39;pc&#39;</span><span class="p">:</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;mslp&#39;</span><span class="p">],</span>
</span><span id="Record-481"><a href="#Record-481"><span class="linenos">481</span></a>                        <span class="s1">&#39;pn&#39;</span><span class="p">:</span><span class="n">kw_atmos</span><span class="p">[</span><span class="s1">&#39;pn&#39;</span><span class="p">],</span>
</span><span id="Record-482"><a href="#Record-482"><span class="linenos">482</span></a>                        <span class="s1">&#39;rhoair&#39;</span><span class="p">:</span><span class="n">kw_atmos</span><span class="p">[</span><span class="s1">&#39;rhoair&#39;</span><span class="p">],</span>
</span><span id="Record-483"><a href="#Record-483"><span class="linenos">483</span></a>                        <span class="s1">&#39;bmax&#39;</span><span class="p">:</span><span class="n">kw_h80</span><span class="p">[</span><span class="s1">&#39;bmax&#39;</span><span class="p">],</span>
</span><span id="Record-484"><a href="#Record-484"><span class="linenos">484</span></a>                        <span class="s1">&#39;bmin&#39;</span><span class="p">:</span><span class="n">kw_h80</span><span class="p">[</span><span class="s1">&#39;bmin&#39;</span><span class="p">]</span>
</span><span id="Record-485"><a href="#Record-485"><span class="linenos">485</span></a>                    <span class="p">}</span>
</span><span id="Record-486"><a href="#Record-486"><span class="linenos">486</span></a>                    <span class="n">B</span> <span class="o">=</span> <span class="n">calc_holland_B</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="Record-487"><a href="#Record-487"><span class="linenos">487</span></a>                    <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="Record-488"><a href="#Record-488"><span class="linenos">488</span></a>                        <span class="s1">&#39;r&#39;</span><span class="p">:</span><span class="n">r</span><span class="p">,</span>
</span><span id="Record-489"><a href="#Record-489"><span class="linenos">489</span></a>                        <span class="s1">&#39;Rm&#39;</span><span class="p">:</span><span class="n">rmax</span><span class="p">,</span>
</span><span id="Record-490"><a href="#Record-490"><span class="linenos">490</span></a>                        <span class="s1">&#39;pc&#39;</span><span class="p">:</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;mslp&#39;</span><span class="p">],</span>
</span><span id="Record-491"><a href="#Record-491"><span class="linenos">491</span></a>                        <span class="s1">&#39;B&#39;</span><span class="p">:</span><span class="n">B</span><span class="p">,</span>
</span><span id="Record-492"><a href="#Record-492"><span class="linenos">492</span></a>                        <span class="s1">&#39;pn&#39;</span><span class="p">:</span><span class="n">kw_atmos</span><span class="p">[</span><span class="s1">&#39;pn&#39;</span><span class="p">],</span>
</span><span id="Record-493"><a href="#Record-493"><span class="linenos">493</span></a>                        <span class="s1">&#39;rhoair&#39;</span><span class="p">:</span><span class="n">kw_atmos</span><span class="p">[</span><span class="s1">&#39;rhoair&#39;</span><span class="p">]</span>
</span><span id="Record-494"><a href="#Record-494"><span class="linenos">494</span></a>                    <span class="p">}</span>
</span><span id="Record-495"><a href="#Record-495"><span class="linenos">495</span></a>                    <span class="n">vcirc</span> <span class="o">=</span> <span class="n">calc_vcirc</span><span class="p">[</span><span class="n">method</span><span class="p">](</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="Record-496"><a href="#Record-496"><span class="linenos">496</span></a>
</span><span id="Record-497"><a href="#Record-497"><span class="linenos">497</span></a>                <span class="k">if</span> <span class="n">method</span><span class="o">==</span><span class="s1">&#39;J92&#39;</span><span class="p">:</span>
</span><span id="Record-498"><a href="#Record-498"><span class="linenos">498</span></a>                    <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="Record-499"><a href="#Record-499"><span class="linenos">499</span></a>                        <span class="s1">&#39;r&#39;</span><span class="p">:</span> <span class="n">r</span><span class="p">,</span>
</span><span id="Record-500"><a href="#Record-500"><span class="linenos">500</span></a>                        <span class="s1">&#39;Rm&#39;</span><span class="p">:</span><span class="n">rmax</span><span class="p">,</span>
</span><span id="Record-501"><a href="#Record-501"><span class="linenos">501</span></a>                        <span class="s1">&#39;Vm&#39;</span><span class="p">:</span><span class="n">vmax</span>
</span><span id="Record-502"><a href="#Record-502"><span class="linenos">502</span></a>                    <span class="p">}</span>
</span><span id="Record-503"><a href="#Record-503"><span class="linenos">503</span></a>                    <span class="n">vcirc</span> <span class="o">=</span> <span class="n">calc_vcirc</span><span class="p">[</span><span class="n">method</span><span class="p">](</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="Record-504"><a href="#Record-504"><span class="linenos">504</span></a>
</span><span id="Record-505"><a href="#Record-505"><span class="linenos">505</span></a>                <span class="k">if</span> <span class="n">method</span><span class="o">==</span><span class="s1">&#39;W06&#39;</span><span class="p">:</span>
</span><span id="Record-506"><a href="#Record-506"><span class="linenos">506</span></a>                    <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="Record-507"><a href="#Record-507"><span class="linenos">507</span></a>                        <span class="s1">&#39;r&#39;</span><span class="p">:</span><span class="n">r</span><span class="p">,</span>
</span><span id="Record-508"><a href="#Record-508"><span class="linenos">508</span></a>                        <span class="s1">&#39;Rm&#39;</span><span class="p">:</span><span class="n">rmax</span><span class="p">,</span>
</span><span id="Record-509"><a href="#Record-509"><span class="linenos">509</span></a>                        <span class="s1">&#39;Vm&#39;</span><span class="p">:</span><span class="n">vmax</span><span class="p">,</span>
</span><span id="Record-510"><a href="#Record-510"><span class="linenos">510</span></a>                        <span class="s1">&#39;n&#39;</span><span class="p">:</span><span class="n">kw_w06</span><span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">],</span>
</span><span id="Record-511"><a href="#Record-511"><span class="linenos">511</span></a>                        <span class="s1">&#39;X&#39;</span><span class="p">:</span><span class="n">kw_w06</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">]</span>
</span><span id="Record-512"><a href="#Record-512"><span class="linenos">512</span></a>                    <span class="p">}</span>
</span><span id="Record-513"><a href="#Record-513"><span class="linenos">513</span></a>                    <span class="n">vcirc</span> <span class="o">=</span> <span class="n">calc_vcirc</span><span class="p">[</span><span class="n">method</span><span class="p">](</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="Record-514"><a href="#Record-514"><span class="linenos">514</span></a>
</span><span id="Record-515"><a href="#Record-515"><span class="linenos">515</span></a>                <span class="k">if</span> <span class="n">method</span><span class="o">==</span><span class="s1">&#39;E04&#39;</span><span class="p">:</span>
</span><span id="Record-516"><a href="#Record-516"><span class="linenos">516</span></a>                    <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="Record-517"><a href="#Record-517"><span class="linenos">517</span></a>                        <span class="s1">&#39;r&#39;</span><span class="p">:</span><span class="n">r</span><span class="p">,</span>
</span><span id="Record-518"><a href="#Record-518"><span class="linenos">518</span></a>                        <span class="s1">&#39;Rm&#39;</span><span class="p">:</span><span class="n">rmax</span><span class="p">,</span>
</span><span id="Record-519"><a href="#Record-519"><span class="linenos">519</span></a>                        <span class="s1">&#39;Vm&#39;</span><span class="p">:</span><span class="n">vmax</span><span class="p">,</span>
</span><span id="Record-520"><a href="#Record-520"><span class="linenos">520</span></a>                        <span class="s1">&#39;b&#39;</span><span class="p">:</span><span class="n">kw_e04</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">],</span>
</span><span id="Record-521"><a href="#Record-521"><span class="linenos">521</span></a>                        <span class="s1">&#39;m&#39;</span><span class="p">:</span><span class="n">kw_e04</span><span class="p">[</span><span class="s1">&#39;m&#39;</span><span class="p">],</span>
</span><span id="Record-522"><a href="#Record-522"><span class="linenos">522</span></a>                        <span class="s1">&#39;n&#39;</span><span class="p">:</span><span class="n">kw_e04</span><span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">],</span>
</span><span id="Record-523"><a href="#Record-523"><span class="linenos">523</span></a>                        <span class="s1">&#39;R0&#39;</span><span class="p">:</span><span class="n">kw_e04</span><span class="p">[</span><span class="s1">&#39;R0&#39;</span><span class="p">]</span>
</span><span id="Record-524"><a href="#Record-524"><span class="linenos">524</span></a>                    <span class="p">}</span>
</span><span id="Record-525"><a href="#Record-525"><span class="linenos">525</span></a>                    <span class="n">vcirc</span> <span class="o">=</span> <span class="n">calc_vcirc</span><span class="p">[</span><span class="n">method</span><span class="p">](</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="Record-526"><a href="#Record-526"><span class="linenos">526</span></a>                    <span class="k">if</span> <span class="n">vcirc</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Record-527"><a href="#Record-527"><span class="linenos">527</span></a>                        <span class="n">vcirc</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Record-528"><a href="#Record-528"><span class="linenos">528</span></a>
</span><span id="Record-529"><a href="#Record-529"><span class="linenos">529</span></a>                <span class="k">if</span> <span class="n">method</span><span class="o">==</span><span class="s1">&#39;E11&#39;</span><span class="p">:</span>
</span><span id="Record-530"><a href="#Record-530"><span class="linenos">530</span></a>                    <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="Record-531"><a href="#Record-531"><span class="linenos">531</span></a>                        <span class="s1">&#39;r&#39;</span><span class="p">:</span><span class="n">r</span><span class="p">,</span>
</span><span id="Record-532"><a href="#Record-532"><span class="linenos">532</span></a>                        <span class="s1">&#39;Rm&#39;</span><span class="p">:</span><span class="n">rmax</span><span class="p">,</span>
</span><span id="Record-533"><a href="#Record-533"><span class="linenos">533</span></a>                        <span class="s1">&#39;Vm&#39;</span><span class="p">:</span><span class="n">vmax</span><span class="p">,</span>
</span><span id="Record-534"><a href="#Record-534"><span class="linenos">534</span></a>                        <span class="s1">&#39;f&#39;</span><span class="p">:</span><span class="n">coriolis</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">])</span>
</span><span id="Record-535"><a href="#Record-535"><span class="linenos">535</span></a>                    <span class="p">}</span>
</span><span id="Record-536"><a href="#Record-536"><span class="linenos">536</span></a>                    <span class="n">vcirc</span> <span class="o">=</span> <span class="n">calc_vcirc</span><span class="p">[</span><span class="n">method</span><span class="p">](</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="Record-537"><a href="#Record-537"><span class="linenos">537</span></a>                    <span class="k">if</span> <span class="n">vcirc</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Record-538"><a href="#Record-538"><span class="linenos">538</span></a>                        <span class="n">vcirc</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Record-539"><a href="#Record-539"><span class="linenos">539</span></a>
</span><span id="Record-540"><a href="#Record-540"><span class="linenos">540</span></a>                <span class="k">if</span> <span class="n">method</span><span class="o">==</span><span class="s1">&#39;M16&#39;</span><span class="p">:</span>
</span><span id="Record-541"><a href="#Record-541"><span class="linenos">541</span></a>                    <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="Record-542"><a href="#Record-542"><span class="linenos">542</span></a>                        <span class="s1">&#39;r&#39;</span><span class="p">:</span><span class="n">r</span><span class="p">,</span>
</span><span id="Record-543"><a href="#Record-543"><span class="linenos">543</span></a>                        <span class="s1">&#39;Rm&#39;</span><span class="p">:</span><span class="n">rmax</span><span class="p">,</span>
</span><span id="Record-544"><a href="#Record-544"><span class="linenos">544</span></a>                        <span class="s1">&#39;Vm&#39;</span><span class="p">:</span><span class="n">vmax</span><span class="p">,</span>
</span><span id="Record-545"><a href="#Record-545"><span class="linenos">545</span></a>                        <span class="s1">&#39;n&#39;</span><span class="p">:</span><span class="n">kw_m16</span><span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">]</span>
</span><span id="Record-546"><a href="#Record-546"><span class="linenos">546</span></a>                    <span class="p">}</span>
</span><span id="Record-547"><a href="#Record-547"><span class="linenos">547</span></a>                    <span class="n">vcirc</span> <span class="o">=</span> <span class="n">calc_vcirc</span><span class="p">[</span><span class="n">method</span><span class="p">](</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="Record-548"><a href="#Record-548"><span class="linenos">548</span></a>                <span class="k">break</span>
</span><span id="Record-549"><a href="#Record-549"><span class="linenos">549</span></a>            <span class="k">except</span><span class="p">:</span>
</span><span id="Record-550"><a href="#Record-550"><span class="linenos">550</span></a>                <span class="k">continue</span>
</span><span id="Record-551"><a href="#Record-551"><span class="linenos">551</span></a>        
</span><span id="Record-552"><a href="#Record-552"><span class="linenos">552</span></a>        <span class="c1"># Calculating u,v wind with translation correction</span>
</span><span id="Record-553"><a href="#Record-553"><span class="linenos">553</span></a>        <span class="n">vcirc</span> <span class="o">=</span> <span class="n">vcirc</span> <span class="o">*</span> <span class="n">kw_corr</span><span class="p">[</span><span class="s1">&#39;swrf&#39;</span><span class="p">]</span>
</span><span id="Record-554"><a href="#Record-554"><span class="linenos">554</span></a>
</span><span id="Record-555"><a href="#Record-555"><span class="linenos">555</span></a>        <span class="n">u</span> <span class="o">=</span> <span class="o">-</span><span class="n">vcirc</span><span class="o">*</span><span class="n">r</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta_input</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">([</span><span class="n">r</span><span class="p">,</span> <span class="mf">1e-8</span><span class="p">])</span> <span class="c1"># 1e-8 avoids x/0</span>
</span><span id="Record-556"><a href="#Record-556"><span class="linenos">556</span></a>        <span class="n">v</span> <span class="o">=</span> <span class="n">vcirc</span><span class="o">*</span><span class="n">r</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta_input</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">([</span><span class="n">r</span><span class="p">,</span> <span class="mf">1e-8</span><span class="p">])</span>
</span><span id="Record-557"><a href="#Record-557"><span class="linenos">557</span></a>
</span><span id="Record-558"><a href="#Record-558"><span class="linenos">558</span></a>        <span class="n">utrans</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;ustorm&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">kw_corr</span><span class="p">[</span><span class="s1">&#39;angle&#39;</span><span class="p">]))</span> <span class="o">-</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;vstorm&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">kw_corr</span><span class="p">[</span><span class="s1">&#39;angle&#39;</span><span class="p">]))</span>
</span><span id="Record-559"><a href="#Record-559"><span class="linenos">559</span></a>        <span class="n">vtrans</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;ustorm&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">kw_corr</span><span class="p">[</span><span class="s1">&#39;angle&#39;</span><span class="p">]))</span> <span class="o">+</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;vstorm&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">kw_corr</span><span class="p">[</span><span class="s1">&#39;angle&#39;</span><span class="p">]))</span>
</span><span id="Record-560"><a href="#Record-560"><span class="linenos">560</span></a>
</span><span id="Record-561"><a href="#Record-561"><span class="linenos">561</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="Record-562"><a href="#Record-562"><span class="linenos">562</span></a>            <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_not</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">utrans</span><span class="p">)))</span>
</span><span id="Record-563"><a href="#Record-563"><span class="linenos">563</span></a>            <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_not</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">vtrans</span><span class="p">)))</span>
</span><span id="Record-564"><a href="#Record-564"><span class="linenos">564</span></a>
</span><span id="Record-565"><a href="#Record-565"><span class="linenos">565</span></a>            <span class="n">u</span> <span class="o">=</span> <span class="n">u</span> <span class="o">+</span> <span class="n">kw_corr</span><span class="p">[</span><span class="s1">&#39;fraction&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">utrans</span>
</span><span id="Record-566"><a href="#Record-566"><span class="linenos">566</span></a>            <span class="n">v</span> <span class="o">=</span> <span class="n">v</span> <span class="o">+</span> <span class="n">kw_corr</span><span class="p">[</span><span class="s1">&#39;fraction&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">vtrans</span>
</span><span id="Record-567"><a href="#Record-567"><span class="linenos">567</span></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="Record-568"><a href="#Record-568"><span class="linenos">568</span></a>            <span class="n">u</span> <span class="o">=</span> <span class="n">u</span>
</span><span id="Record-569"><a href="#Record-569"><span class="linenos">569</span></a>            <span class="n">v</span> <span class="o">=</span> <span class="n">v</span>
</span><span id="Record-570"><a href="#Record-570"><span class="linenos">570</span></a>
</span><span id="Record-571"><a href="#Record-571"><span class="linenos">571</span></a>        <span class="n">u</span> <span class="o">=</span> <span class="n">u</span> <span class="o">*</span> <span class="n">kw_corr</span><span class="p">[</span><span class="s1">&#39;tfac&#39;</span><span class="p">]</span>
</span><span id="Record-572"><a href="#Record-572"><span class="linenos">572</span></a>        <span class="n">v</span> <span class="o">=</span> <span class="n">v</span> <span class="o">*</span> <span class="n">kw_corr</span><span class="p">[</span><span class="s1">&#39;tfac&#39;</span><span class="p">]</span>
</span><span id="Record-573"><a href="#Record-573"><span class="linenos">573</span></a>
</span><span id="Record-574"><a href="#Record-574"><span class="linenos">574</span></a>        <span class="k">return</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
</span><span id="Record-575"><a href="#Record-575"><span class="linenos">575</span></a>    
</span><span id="Record-576"><a href="#Record-576"><span class="linenos">576</span></a>    <span class="k">def</span> <span class="nf">calculate_pressure</span><span class="p">(</span>
</span><span id="Record-577"><a href="#Record-577"><span class="linenos">577</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Record-578"><a href="#Record-578"><span class="linenos">578</span></a>        <span class="n">at</span><span class="p">,</span>
</span><span id="Record-579"><a href="#Record-579"><span class="linenos">579</span></a>        <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;H80&#39;</span><span class="p">],</span>
</span><span id="Record-580"><a href="#Record-580"><span class="linenos">580</span></a>        <span class="n">rmax_frac</span><span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">],</span>
</span><span id="Record-581"><a href="#Record-581"><span class="linenos">581</span></a>        <span class="n">rmax_select</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span>
</span><span id="Record-582"><a href="#Record-582"><span class="linenos">582</span></a>        <span class="n">kw_atmos</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;pn&#39;</span><span class="p">:</span><span class="mi">101325</span><span class="p">,</span> <span class="s1">&#39;rhoair&#39;</span><span class="p">:</span><span class="mf">1.15</span><span class="p">},</span>
</span><span id="Record-583"><a href="#Record-583"><span class="linenos">583</span></a>        <span class="n">kw_h80</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;bmax&#39;</span><span class="p">:</span><span class="mf">2.5</span><span class="p">,</span> <span class="s1">&#39;bmin&#39;</span><span class="p">:</span><span class="mf">0.5</span><span class="p">}</span>
</span><span id="Record-584"><a href="#Record-584"><span class="linenos">584</span></a>    <span class="p">):</span>
</span><span id="Record-585"><a href="#Record-585"><span class="linenos">585</span></a><span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="Record-586"><a href="#Record-586"><span class="linenos">586</span></a><span class="sd">        Calculate pressure field using given method till a fractional distance of </span>
</span><span id="Record-587"><a href="#Record-587"><span class="linenos">587</span></a><span class="sd">        rmax.</span>
</span><span id="Record-588"><a href="#Record-588"><span class="linenos">588</span></a>
</span><span id="Record-589"><a href="#Record-589"><span class="linenos">589</span></a><span class="sd">        at: (r, theta) location where the wind is calculated,</span>
</span><span id="Record-590"><a href="#Record-590"><span class="linenos">590</span></a><span class="sd">            r, float, distance in m </span>
</span><span id="Record-591"><a href="#Record-591"><span class="linenos">591</span></a><span class="sd">            theta, float, is -2*np.pi, 2*np.pi radians</span>
</span><span id="Record-592"><a href="#Record-592"><span class="linenos">592</span></a><span class="sd">            Essentially theta is expected to be output from np.arctan2(y,x)</span>
</span><span id="Record-593"><a href="#Record-593"><span class="linenos">593</span></a><span class="sd">            This is counter-clockwise from x-axis angle is converted to a clockwise</span>
</span><span id="Record-594"><a href="#Record-594"><span class="linenos">594</span></a><span class="sd">            angle from y axis to match the interpolation grid of the storm paramters. </span>
</span><span id="Record-595"><a href="#Record-595"><span class="linenos">595</span></a><span class="sd">        methods: array, list of methods to be used. Currently implemented methods</span>
</span><span id="Record-596"><a href="#Record-596"><span class="linenos">596</span></a><span class="sd">                are - H80, H80c</span>
</span><span id="Record-597"><a href="#Record-597"><span class="linenos">597</span></a><span class="sd">        rmax_frac: array, till which fraction of rmax, the method to be used,</span>
</span><span id="Record-598"><a href="#Record-598"><span class="linenos">598</span></a><span class="sd">                np.inf for whole</span>
</span><span id="Record-599"><a href="#Record-599"><span class="linenos">599</span></a><span class="sd">        rmax_select: which rmax to select, int, str</span>
</span><span id="Record-600"><a href="#Record-600"><span class="linenos">600</span></a><span class="sd">                    &#39;mean&#39;: mean value of the rmax</span>
</span><span id="Record-601"><a href="#Record-601"><span class="linenos">601</span></a><span class="sd">                    &#39;nearest&#39;: rmax calculated from nearest frmax</span>
</span><span id="Record-602"><a href="#Record-602"><span class="linenos">602</span></a><span class="sd">                    &#39;linear&#39;: rmax calculated from a linear interpolation</span>
</span><span id="Record-603"><a href="#Record-603"><span class="linenos">603</span></a><span class="sd">                    int: number corresponding to selected rmax &gt;1</span>
</span><span id="Record-604"><a href="#Record-604"><span class="linenos">604</span></a><span class="sd">        kw_atmos: constant atmospheric values</span>
</span><span id="Record-605"><a href="#Record-605"><span class="linenos">605</span></a><span class="sd">            pn: nominal or environmental pressure, default 101325 Pa</span>
</span><span id="Record-606"><a href="#Record-606"><span class="linenos">606</span></a><span class="sd">            rhoair: air density, default 1.15 kg/m^3</span>
</span><span id="Record-607"><a href="#Record-607"><span class="linenos">607</span></a><span class="sd">        kw_h80: extra argument for H80 model</span>
</span><span id="Record-608"><a href="#Record-608"><span class="linenos">608</span></a><span class="sd">            bmin: min value of B</span>
</span><span id="Record-609"><a href="#Record-609"><span class="linenos">609</span></a><span class="sd">            bmax: max value of B</span>
</span><span id="Record-610"><a href="#Record-610"><span class="linenos">610</span></a><span class="sd">        &#39;&#39;&#39;</span>
</span><span id="Record-611"><a href="#Record-611"><span class="linenos">611</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="Record-612"><a href="#Record-612"><span class="linenos">612</span></a>            <span class="n">r</span><span class="p">,</span> <span class="n">theta_input</span> <span class="o">=</span> <span class="n">at</span>
</span><span id="Record-613"><a href="#Record-613"><span class="linenos">613</span></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="Record-614"><a href="#Record-614"><span class="linenos">614</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;the at must be in (r, theta) as list/array of size 2&#39;</span><span class="p">)</span>
</span><span id="Record-615"><a href="#Record-615"><span class="linenos">615</span></a>        
</span><span id="Record-616"><a href="#Record-616"><span class="linenos">616</span></a>        <span class="c1"># Convert theta from x-axis counter clock to y-axis clock wise</span>
</span><span id="Record-617"><a href="#Record-617"><span class="linenos">617</span></a>        <span class="n">theta</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="o">*</span><span class="n">theta_input</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span>
</span><span id="Record-618"><a href="#Record-618"><span class="linenos">618</span></a>
</span><span id="Record-619"><a href="#Record-619"><span class="linenos">619</span></a>        <span class="c1"># Theta -180:180 to 0:360 format, clockwise from 0N</span>
</span><span id="Record-620"><a href="#Record-620"><span class="linenos">620</span></a>        <span class="k">if</span> <span class="n">theta_input</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Record-621"><a href="#Record-621"><span class="linenos">621</span></a>            <span class="n">theta</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">+</span> <span class="n">theta_input</span>
</span><span id="Record-622"><a href="#Record-622"><span class="linenos">622</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Record-623"><a href="#Record-623"><span class="linenos">623</span></a>            <span class="n">theta</span> <span class="o">=</span> <span class="n">theta_input</span>
</span><span id="Record-624"><a href="#Record-624"><span class="linenos">624</span></a>
</span><span id="Record-625"><a href="#Record-625"><span class="linenos">625</span></a>        <span class="n">calc_mslp</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="Record-626"><a href="#Record-626"><span class="linenos">626</span></a>            <span class="s1">&#39;H80&#39;</span><span class="p">:</span><span class="n">calc_mslp_h80</span><span class="p">,</span>
</span><span id="Record-627"><a href="#Record-627"><span class="linenos">627</span></a>            <span class="s1">&#39;H80c&#39;</span><span class="p">:</span><span class="n">calc_mslp_h80</span> <span class="c1"># Only B calculation differs</span>
</span><span id="Record-628"><a href="#Record-628"><span class="linenos">628</span></a>        <span class="p">}</span>
</span><span id="Record-629"><a href="#Record-629"><span class="linenos">629</span></a>
</span><span id="Record-630"><a href="#Record-630"><span class="linenos">630</span></a>        <span class="c1"># Calculate vmax for further calculation</span>
</span><span id="Record-631"><a href="#Record-631"><span class="linenos">631</span></a>        <span class="n">vmax</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;fvmax&#39;</span><span class="p">](</span><span class="n">theta</span><span class="p">)</span>
</span><span id="Record-632"><a href="#Record-632"><span class="linenos">632</span></a>
</span><span id="Record-633"><a href="#Record-633"><span class="linenos">633</span></a>        <span class="c1"># Find appropriate rmax function to be used</span>
</span><span id="Record-634"><a href="#Record-634"><span class="linenos">634</span></a>        <span class="c1"># and calculate rmax</span>
</span><span id="Record-635"><a href="#Record-635"><span class="linenos">635</span></a>        <span class="n">rmax_select_methods_available</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;nearest&#39;</span><span class="p">,</span> <span class="s1">&#39;linear&#39;</span><span class="p">]</span>
</span><span id="Record-636"><a href="#Record-636"><span class="linenos">636</span></a>
</span><span id="Record-637"><a href="#Record-637"><span class="linenos">637</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rmax_select</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="Record-638"><a href="#Record-638"><span class="linenos">638</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="Record-639"><a href="#Record-639"><span class="linenos">639</span></a>                <span class="k">assert</span> <span class="n">rmax_select</span> <span class="ow">in</span> <span class="n">rmax_select_methods_available</span>
</span><span id="Record-640"><a href="#Record-640"><span class="linenos">640</span></a>
</span><span id="Record-641"><a href="#Record-641"><span class="linenos">641</span></a>                <span class="k">if</span> <span class="n">rmax_select</span><span class="o">==</span><span class="s1">&#39;mean&#39;</span><span class="p">:</span>
</span><span id="Record-642"><a href="#Record-642"><span class="linenos">642</span></a>                    <span class="n">rmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">([</span><span class="n">f</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;frmax&#39;</span><span class="p">])])</span>
</span><span id="Record-643"><a href="#Record-643"><span class="linenos">643</span></a>                
</span><span id="Record-644"><a href="#Record-644"><span class="linenos">644</span></a>                <span class="k">if</span> <span class="n">rmax_select</span><span class="o">==</span><span class="s1">&#39;nearest&#39;</span><span class="p">:</span>
</span><span id="Record-645"><a href="#Record-645"><span class="linenos">645</span></a>                    <span class="k">try</span><span class="p">:</span>
</span><span id="Record-646"><a href="#Record-646"><span class="linenos">646</span></a>                        <span class="n">radinfo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">radi</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="k">for</span> <span class="n">radi</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;fradinfo&#39;</span><span class="p">]])</span>
</span><span id="Record-647"><a href="#Record-647"><span class="linenos">647</span></a>                        <span class="n">radnn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">radinfo</span><span class="o">-</span><span class="n">r</span><span class="p">))</span>
</span><span id="Record-648"><a href="#Record-648"><span class="linenos">648</span></a>                        <span class="n">rmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">f</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;frmax&#39;</span><span class="p">])])[</span><span class="n">radnn</span><span class="p">]</span>
</span><span id="Record-649"><a href="#Record-649"><span class="linenos">649</span></a>                    <span class="k">except</span><span class="p">:</span>
</span><span id="Record-650"><a href="#Record-650"><span class="linenos">650</span></a>                        <span class="n">rmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;frmax&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">](</span><span class="n">theta</span><span class="p">)</span>
</span><span id="Record-651"><a href="#Record-651"><span class="linenos">651</span></a>                        <span class="k">raise</span> <span class="ne">Warning</span><span class="p">(</span><span class="s1">&#39;nearest not possible, first rmax selected&#39;</span><span class="p">)</span>
</span><span id="Record-652"><a href="#Record-652"><span class="linenos">652</span></a>
</span><span id="Record-653"><a href="#Record-653"><span class="linenos">653</span></a>                <span class="k">if</span> <span class="n">rmax_select</span><span class="o">==</span><span class="s1">&#39;linear&#39;</span><span class="p">:</span>
</span><span id="Record-654"><a href="#Record-654"><span class="linenos">654</span></a>                    <span class="k">try</span><span class="p">:</span>
</span><span id="Record-655"><a href="#Record-655"><span class="linenos">655</span></a>                        <span class="c1"># x field from -inf to +inf</span>
</span><span id="Record-656"><a href="#Record-656"><span class="linenos">656</span></a>                        <span class="n">radinfo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">radi</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="k">for</span> <span class="n">radi</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;fradinfo&#39;</span><span class="p">]])</span>
</span><span id="Record-657"><a href="#Record-657"><span class="linenos">657</span></a>                        <span class="n">radinfo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">radinfo</span><span class="p">)</span>
</span><span id="Record-658"><a href="#Record-658"><span class="linenos">658</span></a>                        <span class="n">radinfo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">radinfo</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
</span><span id="Record-659"><a href="#Record-659"><span class="linenos">659</span></a>                        <span class="c1"># y field </span>
</span><span id="Record-660"><a href="#Record-660"><span class="linenos">660</span></a>                        <span class="n">rmaxinfo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">f</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;frmax&#39;</span><span class="p">])])</span>
</span><span id="Record-661"><a href="#Record-661"><span class="linenos">661</span></a>                        <span class="n">rmaxinfo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rmaxinfo</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">rmaxinfo</span><span class="p">)</span>
</span><span id="Record-662"><a href="#Record-662"><span class="linenos">662</span></a>                        <span class="n">rmaxinfo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rmaxinfo</span><span class="p">,</span> <span class="n">rmaxinfo</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</span><span id="Record-663"><a href="#Record-663"><span class="linenos">663</span></a>                        <span class="n">int_f</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">radinfo</span><span class="p">,</span> <span class="n">rmaxinfo</span><span class="p">)</span>
</span><span id="Record-664"><a href="#Record-664"><span class="linenos">664</span></a>                        <span class="n">rmax</span> <span class="o">=</span> <span class="n">int_f</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
</span><span id="Record-665"><a href="#Record-665"><span class="linenos">665</span></a>                    <span class="k">except</span><span class="p">:</span>
</span><span id="Record-666"><a href="#Record-666"><span class="linenos">666</span></a>                        <span class="n">rmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;frmax&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">](</span><span class="n">theta</span><span class="p">)</span>
</span><span id="Record-667"><a href="#Record-667"><span class="linenos">667</span></a>                        <span class="k">raise</span> <span class="ne">Warning</span><span class="p">(</span><span class="s1">&#39;linear not possible, first rmax selected&#39;</span><span class="p">)</span>
</span><span id="Record-668"><a href="#Record-668"><span class="linenos">668</span></a>            <span class="k">except</span><span class="p">:</span>
</span><span id="Record-669"><a href="#Record-669"><span class="linenos">669</span></a>                <span class="n">rmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;frmax&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">](</span><span class="n">theta</span><span class="p">)</span>
</span><span id="Record-670"><a href="#Record-670"><span class="linenos">670</span></a>                <span class="k">raise</span> <span class="ne">Warning</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Wrong keyword for rmax method. First frmax is used&#39;</span><span class="p">)</span>
</span><span id="Record-671"><a href="#Record-671"><span class="linenos">671</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rmax_select</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="Record-672"><a href="#Record-672"><span class="linenos">672</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="Record-673"><a href="#Record-673"><span class="linenos">673</span></a>                <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">f</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;frmax&#39;</span><span class="p">])])[</span><span class="n">rmax_select</span><span class="p">]</span>
</span><span id="Record-674"><a href="#Record-674"><span class="linenos">674</span></a>            <span class="k">except</span><span class="p">:</span>
</span><span id="Record-675"><a href="#Record-675"><span class="linenos">675</span></a>                <span class="n">rmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;frmax&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">](</span><span class="n">theta</span><span class="p">)</span>
</span><span id="Record-676"><a href="#Record-676"><span class="linenos">676</span></a>                <span class="k">raise</span> <span class="ne">Warning</span><span class="p">(</span><span class="s1">&#39;Wrong rmax index. First frmax is used&#39;</span><span class="p">)</span>
</span><span id="Record-677"><a href="#Record-677"><span class="linenos">677</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Record-678"><a href="#Record-678"><span class="linenos">678</span></a>            <span class="n">rmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;frmax&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">](</span><span class="n">theta</span><span class="p">)</span>
</span><span id="Record-679"><a href="#Record-679"><span class="linenos">679</span></a>            <span class="k">raise</span> <span class="ne">Warning</span><span class="p">(</span><span class="s1">&#39;Wrong rmax selection keyword/index. First frmax is used&#39;</span><span class="p">)</span>
</span><span id="Record-680"><a href="#Record-680"><span class="linenos">680</span></a>
</span><span id="Record-681"><a href="#Record-681"><span class="linenos">681</span></a>        <span class="c1"># Now check methods and rmax_frac and apply method as required</span>
</span><span id="Record-682"><a href="#Record-682"><span class="linenos">682</span></a>        <span class="c1"># Avoid wrong input of rmax_frac</span>
</span><span id="Record-683"><a href="#Record-683"><span class="linenos">683</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="Record-684"><a href="#Record-684"><span class="linenos">684</span></a>            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">rmax_frac</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">methods</span><span class="p">)</span>
</span><span id="Record-685"><a href="#Record-685"><span class="linenos">685</span></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="Record-686"><a href="#Record-686"><span class="linenos">686</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;rmax_frac must corresponds to each listed method&#39;</span><span class="p">)</span>
</span><span id="Record-687"><a href="#Record-687"><span class="linenos">687</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Record-688"><a href="#Record-688"><span class="linenos">688</span></a>            <span class="n">rmax_frac</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">rmax_frac</span><span class="p">)</span> <span class="c1"># accomodates * of np.inf</span>
</span><span id="Record-689"><a href="#Record-689"><span class="linenos">689</span></a>        
</span><span id="Record-690"><a href="#Record-690"><span class="linenos">690</span></a>        <span class="n">rlim_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">rmax_frac</span><span class="p">)[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">rmax</span> <span class="c1"># Starts from 0</span>
</span><span id="Record-691"><a href="#Record-691"><span class="linenos">691</span></a>        <span class="n">rlim_max</span> <span class="o">=</span> <span class="n">rmax_frac</span><span class="o">*</span><span class="n">rmax</span>
</span><span id="Record-692"><a href="#Record-692"><span class="linenos">692</span></a>
</span><span id="Record-693"><a href="#Record-693"><span class="linenos">693</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">method</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">methods</span><span class="p">):</span>
</span><span id="Record-694"><a href="#Record-694"><span class="linenos">694</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="Record-695"><a href="#Record-695"><span class="linenos">695</span></a>                <span class="k">assert</span> <span class="n">r</span> <span class="o">&gt;=</span> <span class="n">rlim_min</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="Record-696"><a href="#Record-696"><span class="linenos">696</span></a>                <span class="k">assert</span> <span class="n">r</span> <span class="o">&lt;</span> <span class="n">rlim_max</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="Record-697"><a href="#Record-697"><span class="linenos">697</span></a>
</span><span id="Record-698"><a href="#Record-698"><span class="linenos">698</span></a>                <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;H80&#39;</span><span class="p">:</span>
</span><span id="Record-699"><a href="#Record-699"><span class="linenos">699</span></a>                    <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="Record-700"><a href="#Record-700"><span class="linenos">700</span></a>                        <span class="s1">&#39;vmax&#39;</span><span class="p">:</span><span class="n">vmax</span><span class="p">,</span> 
</span><span id="Record-701"><a href="#Record-701"><span class="linenos">701</span></a>                        <span class="s1">&#39;rmax&#39;</span><span class="p">:</span><span class="n">rmax</span><span class="p">,</span>
</span><span id="Record-702"><a href="#Record-702"><span class="linenos">702</span></a>                        <span class="s1">&#39;pc&#39;</span><span class="p">:</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;mslp&#39;</span><span class="p">],</span>
</span><span id="Record-703"><a href="#Record-703"><span class="linenos">703</span></a>                        <span class="s1">&#39;f&#39;</span><span class="p">:</span><span class="n">coriolis</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">]),</span>
</span><span id="Record-704"><a href="#Record-704"><span class="linenos">704</span></a>                        <span class="s1">&#39;pn&#39;</span><span class="p">:</span><span class="n">kw_atmos</span><span class="p">[</span><span class="s1">&#39;pn&#39;</span><span class="p">],</span>
</span><span id="Record-705"><a href="#Record-705"><span class="linenos">705</span></a>                        <span class="s1">&#39;rhoair&#39;</span><span class="p">:</span><span class="n">kw_atmos</span><span class="p">[</span><span class="s1">&#39;rhoair&#39;</span><span class="p">],</span>
</span><span id="Record-706"><a href="#Record-706"><span class="linenos">706</span></a>                        <span class="s1">&#39;bmax&#39;</span><span class="p">:</span><span class="n">kw_h80</span><span class="p">[</span><span class="s1">&#39;bmax&#39;</span><span class="p">],</span>
</span><span id="Record-707"><a href="#Record-707"><span class="linenos">707</span></a>                        <span class="s1">&#39;bmin&#39;</span><span class="p">:</span><span class="n">kw_h80</span><span class="p">[</span><span class="s1">&#39;bmin&#39;</span><span class="p">]</span>
</span><span id="Record-708"><a href="#Record-708"><span class="linenos">708</span></a>                    <span class="p">}</span>
</span><span id="Record-709"><a href="#Record-709"><span class="linenos">709</span></a>                    <span class="n">B</span> <span class="o">=</span> <span class="n">calc_holland_B_full</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="Record-710"><a href="#Record-710"><span class="linenos">710</span></a>                    <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="Record-711"><a href="#Record-711"><span class="linenos">711</span></a>                        <span class="s1">&#39;r&#39;</span><span class="p">:</span><span class="n">r</span><span class="p">,</span>
</span><span id="Record-712"><a href="#Record-712"><span class="linenos">712</span></a>                        <span class="s1">&#39;Rm&#39;</span><span class="p">:</span><span class="n">rmax</span><span class="p">,</span>
</span><span id="Record-713"><a href="#Record-713"><span class="linenos">713</span></a>                        <span class="s1">&#39;pc&#39;</span><span class="p">:</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;mslp&#39;</span><span class="p">],</span>
</span><span id="Record-714"><a href="#Record-714"><span class="linenos">714</span></a>                        <span class="s1">&#39;B&#39;</span><span class="p">:</span><span class="n">B</span><span class="p">,</span>
</span><span id="Record-715"><a href="#Record-715"><span class="linenos">715</span></a>                        <span class="s1">&#39;pn&#39;</span><span class="p">:</span><span class="n">kw_atmos</span><span class="p">[</span><span class="s1">&#39;pn&#39;</span><span class="p">]</span>
</span><span id="Record-716"><a href="#Record-716"><span class="linenos">716</span></a>                    <span class="p">}</span>
</span><span id="Record-717"><a href="#Record-717"><span class="linenos">717</span></a>                    <span class="n">mslp</span> <span class="o">=</span> <span class="n">calc_mslp</span><span class="p">[</span><span class="n">method</span><span class="p">](</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="Record-718"><a href="#Record-718"><span class="linenos">718</span></a>                
</span><span id="Record-719"><a href="#Record-719"><span class="linenos">719</span></a>                <span class="k">if</span> <span class="n">method</span><span class="o">==</span><span class="s1">&#39;H80c&#39;</span><span class="p">:</span>
</span><span id="Record-720"><a href="#Record-720"><span class="linenos">720</span></a>                    <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="Record-721"><a href="#Record-721"><span class="linenos">721</span></a>                        <span class="s1">&#39;vmax&#39;</span><span class="p">:</span><span class="n">vmax</span><span class="p">,</span> 
</span><span id="Record-722"><a href="#Record-722"><span class="linenos">722</span></a>                        <span class="s1">&#39;pc&#39;</span><span class="p">:</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;mslp&#39;</span><span class="p">],</span>
</span><span id="Record-723"><a href="#Record-723"><span class="linenos">723</span></a>                        <span class="s1">&#39;pn&#39;</span><span class="p">:</span><span class="n">kw_atmos</span><span class="p">[</span><span class="s1">&#39;pn&#39;</span><span class="p">],</span>
</span><span id="Record-724"><a href="#Record-724"><span class="linenos">724</span></a>                        <span class="s1">&#39;rhoair&#39;</span><span class="p">:</span><span class="n">kw_atmos</span><span class="p">[</span><span class="s1">&#39;rhoair&#39;</span><span class="p">],</span>
</span><span id="Record-725"><a href="#Record-725"><span class="linenos">725</span></a>                        <span class="s1">&#39;bmax&#39;</span><span class="p">:</span><span class="n">kw_h80</span><span class="p">[</span><span class="s1">&#39;bmax&#39;</span><span class="p">],</span>
</span><span id="Record-726"><a href="#Record-726"><span class="linenos">726</span></a>                        <span class="s1">&#39;bmin&#39;</span><span class="p">:</span><span class="n">kw_h80</span><span class="p">[</span><span class="s1">&#39;bmin&#39;</span><span class="p">]</span>
</span><span id="Record-727"><a href="#Record-727"><span class="linenos">727</span></a>                    <span class="p">}</span>
</span><span id="Record-728"><a href="#Record-728"><span class="linenos">728</span></a>                    <span class="n">B</span> <span class="o">=</span> <span class="n">calc_holland_B</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="Record-729"><a href="#Record-729"><span class="linenos">729</span></a>                    <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="Record-730"><a href="#Record-730"><span class="linenos">730</span></a>                        <span class="s1">&#39;r&#39;</span><span class="p">:</span><span class="n">r</span><span class="p">,</span>
</span><span id="Record-731"><a href="#Record-731"><span class="linenos">731</span></a>                        <span class="s1">&#39;Rm&#39;</span><span class="p">:</span><span class="n">rmax</span><span class="p">,</span>
</span><span id="Record-732"><a href="#Record-732"><span class="linenos">732</span></a>                        <span class="s1">&#39;pc&#39;</span><span class="p">:</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;mslp&#39;</span><span class="p">],</span>
</span><span id="Record-733"><a href="#Record-733"><span class="linenos">733</span></a>                        <span class="s1">&#39;B&#39;</span><span class="p">:</span><span class="n">B</span><span class="p">,</span>
</span><span id="Record-734"><a href="#Record-734"><span class="linenos">734</span></a>                        <span class="s1">&#39;pn&#39;</span><span class="p">:</span><span class="n">kw_atmos</span><span class="p">[</span><span class="s1">&#39;pn&#39;</span><span class="p">]</span>
</span><span id="Record-735"><a href="#Record-735"><span class="linenos">735</span></a>                    <span class="p">}</span>
</span><span id="Record-736"><a href="#Record-736"><span class="linenos">736</span></a>                    <span class="n">mslp</span> <span class="o">=</span> <span class="n">calc_mslp</span><span class="p">[</span><span class="n">method</span><span class="p">](</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="Record-737"><a href="#Record-737"><span class="linenos">737</span></a>                
</span><span id="Record-738"><a href="#Record-738"><span class="linenos">738</span></a>                <span class="k">break</span>
</span><span id="Record-739"><a href="#Record-739"><span class="linenos">739</span></a>            <span class="k">except</span><span class="p">:</span>
</span><span id="Record-740"><a href="#Record-740"><span class="linenos">740</span></a>                <span class="k">continue</span>
</span><span id="Record-741"><a href="#Record-741"><span class="linenos">741</span></a>        
</span><span id="Record-742"><a href="#Record-742"><span class="linenos">742</span></a>        <span class="k">return</span><span class="p">(</span><span class="n">mslp</span><span class="p">)</span>
</span><span id="Record-743"><a href="#Record-743"><span class="linenos">743</span></a>    
</span><span id="Record-744"><a href="#Record-744"><span class="linenos">744</span></a>    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Record-745"><a href="#Record-745"><span class="linenos">745</span></a>        <span class="n">repr_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">key</span><span class="p">])</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">])</span>
</span><span id="Record-746"><a href="#Record-746"><span class="linenos">746</span></a>        <span class="k">return</span><span class="p">(</span><span class="n">repr_str</span><span class="p">)</span>
</span></pre></div>


    

                            <div id="Record.__init__" class="classattr">
                                        <input id="Record.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">Record</span><span class="signature pdoc-code condensed">(<span class="param"><span class="o">*</span><span class="n">args</span>, </span><span class="param"><span class="o">**</span><span class="n">kwargs</span></span>)</span>

                <label class="view-source-button" for="Record.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Record.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Record.__init__-21"><a href="#Record.__init__-21"><span class="linenos">21</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="Record.__init__-22"><a href="#Record.__init__-22"><span class="linenos">22</span></a><span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="Record.__init__-23"><a href="#Record.__init__-23"><span class="linenos">23</span></a><span class="sd">        A recrod object takes keyworded input as arguments by entending the python</span>
</span><span id="Record.__init__-24"><a href="#Record.__init__-24"><span class="linenos">24</span></a><span class="sd">        dictionary object. </span>
</span><span id="Record.__init__-25"><a href="#Record.__init__-25"><span class="linenos">25</span></a>
</span><span id="Record.__init__-26"><a href="#Record.__init__-26"><span class="linenos">26</span></a><span class="sd">        The required fields are - </span>
</span><span id="Record.__init__-27"><a href="#Record.__init__-27"><span class="linenos">27</span></a><span class="sd">            : timestamp:    datetime, pd.Datetimeindex</span>
</span><span id="Record.__init__-28"><a href="#Record.__init__-28"><span class="linenos">28</span></a><span class="sd">            : lon:          longitude, 0-359, float</span>
</span><span id="Record.__init__-29"><a href="#Record.__init__-29"><span class="linenos">29</span></a><span class="sd">            : lat:          latitude, -180, 180, float</span>
</span><span id="Record.__init__-30"><a href="#Record.__init__-30"><span class="linenos">30</span></a><span class="sd">            : mslp:         central pressure, Pa, float</span>
</span><span id="Record.__init__-31"><a href="#Record.__init__-31"><span class="linenos">31</span></a><span class="sd">            : vmax:         maximum velocity, m/s, float</span>
</span><span id="Record.__init__-32"><a href="#Record.__init__-32"><span class="linenos">32</span></a><span class="sd">        </span>
</span><span id="Record.__init__-33"><a href="#Record.__init__-33"><span class="linenos">33</span></a><span class="sd">        The optional (but recommended) fields are - </span>
</span><span id="Record.__init__-34"><a href="#Record.__init__-34"><span class="linenos">34</span></a><span class="sd">            : rmax:         radius of maximum wind, m, float</span>
</span><span id="Record.__init__-35"><a href="#Record.__init__-35"><span class="linenos">35</span></a><span class="sd">            : vinfo:        list of velocity, m/s, list or numpy array, size n</span>
</span><span id="Record.__init__-36"><a href="#Record.__init__-36"><span class="linenos">36</span></a><span class="sd">            : radinfo:      2d list of radial info, m, list or numpy array, size nx4</span>
</span><span id="Record.__init__-37"><a href="#Record.__init__-37"><span class="linenos">37</span></a><span class="sd">            : ustorm:       speed of storm in x-direction, m/s</span>
</span><span id="Record.__init__-38"><a href="#Record.__init__-38"><span class="linenos">38</span></a><span class="sd">            : vstorm:       speed of strom in y-direction, m/s</span>
</span><span id="Record.__init__-39"><a href="#Record.__init__-39"><span class="linenos">39</span></a><span class="sd">        &#39;&#39;&#39;</span>
</span><span id="Record.__init__-40"><a href="#Record.__init__-40"><span class="linenos">40</span></a>        <span class="n">req_kw</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">,</span> <span class="s1">&#39;lon&#39;</span><span class="p">,</span> <span class="s1">&#39;lat&#39;</span><span class="p">,</span> <span class="s1">&#39;mslp&#39;</span><span class="p">,</span> <span class="s1">&#39;vmax&#39;</span><span class="p">]</span>
</span><span id="Record.__init__-41"><a href="#Record.__init__-41"><span class="linenos">41</span></a>        <span class="n">opt_kw</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;rmax&#39;</span><span class="p">,</span> <span class="s1">&#39;vinfo&#39;</span><span class="p">,</span> <span class="s1">&#39;radinfo&#39;</span><span class="p">,</span> <span class="s1">&#39;ustorm&#39;</span><span class="p">,</span> <span class="s1">&#39;vstorm&#39;</span><span class="p">]</span>
</span><span id="Record.__init__-42"><a href="#Record.__init__-42"><span class="linenos">42</span></a>
</span><span id="Record.__init__-43"><a href="#Record.__init__-43"><span class="linenos">43</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="Record.__init__-44"><a href="#Record.__init__-44"><span class="linenos">44</span></a>            <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">([</span><span class="n">kw</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">for</span> <span class="n">kw</span> <span class="ow">in</span> <span class="n">req_kw</span><span class="p">])</span>
</span><span id="Record.__init__-45"><a href="#Record.__init__-45"><span class="linenos">45</span></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="Record.__init__-46"><a href="#Record.__init__-46"><span class="linenos">46</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;All required fields are not provided&#39;</span><span class="p">)</span>
</span><span id="Record.__init__-47"><a href="#Record.__init__-47"><span class="linenos">47</span></a>
</span><span id="Record.__init__-48"><a href="#Record.__init__-48"><span class="linenos">48</span></a>        <span class="k">for</span> <span class="n">kw</span> <span class="ow">in</span> <span class="n">opt_kw</span><span class="p">:</span>
</span><span id="Record.__init__-49"><a href="#Record.__init__-49"><span class="linenos">49</span></a>            <span class="k">if</span> <span class="n">kw</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
</span><span id="Record.__init__-50"><a href="#Record.__init__-50"><span class="linenos">50</span></a>                <span class="n">kwargs</span><span class="p">[</span><span class="n">kw</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
</span><span id="Record.__init__-51"><a href="#Record.__init__-51"><span class="linenos">51</span></a>
</span><span id="Record.__init__-52"><a href="#Record.__init__-52"><span class="linenos">52</span></a>        <span class="c1"># Correcting datetime and convert to pandas datetime object</span>
</span><span id="Record.__init__-53"><a href="#Record.__init__-53"><span class="linenos">53</span></a>        <span class="n">allowed_datetime</span> <span class="o">=</span> <span class="p">(</span><span class="n">datetime</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
</span><span id="Record.__init__-54"><a href="#Record.__init__-54"><span class="linenos">54</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="Record.__init__-55"><a href="#Record.__init__-55"><span class="linenos">55</span></a>            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">],</span> <span class="n">allowed_datetime</span><span class="p">)</span>
</span><span id="Record.__init__-56"><a href="#Record.__init__-56"><span class="linenos">56</span></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="Record.__init__-57"><a href="#Record.__init__-57"><span class="linenos">57</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;timestamp must be parsable by pd.to_datetime&#39;</span><span class="p">)</span>
</span><span id="Record.__init__-58"><a href="#Record.__init__-58"><span class="linenos">58</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Record.__init__-59"><a href="#Record.__init__-59"><span class="linenos">59</span></a>            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">])</span>
</span><span id="Record.__init__-60"><a href="#Record.__init__-60"><span class="linenos">60</span></a>
</span><span id="Record.__init__-61"><a href="#Record.__init__-61"><span class="linenos">61</span></a>        <span class="c1"># Initiate the dictionary</span>
</span><span id="Record.__init__-62"><a href="#Record.__init__-62"><span class="linenos">62</span></a>        <span class="nb">super</span><span class="p">(</span><span class="n">Record</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>A recrod object takes keyworded input as arguments by entending the python
dictionary object. </p>

<p>The required fields are - 
    : timestamp:    datetime, pd.Datetimeindex
    : lon:          longitude, 0-359, float
    : lat:          latitude, -180, 180, float
    : mslp:         central pressure, Pa, float
    : vmax:         maximum velocity, m/s, float</p>

<p>The optional (but recommended) fields are - 
    : rmax:         radius of maximum wind, m, float
    : vinfo:        list of velocity, m/s, list or numpy array, size n
    : radinfo:      2d list of radial info, m, list or numpy array, size nx4
    : ustorm:       speed of storm in x-direction, m/s
    : vstorm:       speed of strom in y-direction, m/s</p>
</div>


                            </div>
                            <div id="Record.gen_radial_fields" class="classattr">
                                        <input id="Record.gen_radial_fields-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">gen_radial_fields</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">fraction</span><span class="o">=</span><span class="mf">0.56</span>, </span><span class="param"><span class="n">angle</span><span class="o">=</span><span class="mf">19.2</span>, </span><span class="param"><span class="n">swrf</span><span class="o">=</span><span class="mf">0.9</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Record.gen_radial_fields-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Record.gen_radial_fields"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Record.gen_radial_fields-71"><a href="#Record.gen_radial_fields-71"><span class="linenos"> 71</span></a>    <span class="k">def</span> <span class="nf">gen_radial_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fraction</span><span class="o">=</span><span class="mf">0.56</span><span class="p">,</span> <span class="n">angle</span><span class="o">=</span><span class="mf">19.2</span><span class="p">,</span> <span class="n">swrf</span><span class="o">=</span><span class="mf">0.9</span><span class="p">):</span>
</span><span id="Record.gen_radial_fields-72"><a href="#Record.gen_radial_fields-72"><span class="linenos"> 72</span></a><span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="Record.gen_radial_fields-73"><a href="#Record.gen_radial_fields-73"><span class="linenos"> 73</span></a><span class="sd">        Generate the interpolator for radial field for exisiting radial informations.</span>
</span><span id="Record.gen_radial_fields-74"><a href="#Record.gen_radial_fields-74"><span class="linenos"> 74</span></a><span class="sd">        To get correct radial field, atmospheric background is removed and</span>
</span><span id="Record.gen_radial_fields-75"><a href="#Record.gen_radial_fields-75"><span class="linenos"> 75</span></a><span class="sd">        the amount to be removed is controlled by fraction, and angle.  </span>
</span><span id="Record.gen_radial_fields-76"><a href="#Record.gen_radial_fields-76"><span class="linenos"> 76</span></a>
</span><span id="Record.gen_radial_fields-77"><a href="#Record.gen_radial_fields-77"><span class="linenos"> 77</span></a><span class="sd">        Arguments:</span>
</span><span id="Record.gen_radial_fields-78"><a href="#Record.gen_radial_fields-78"><span class="linenos"> 78</span></a><span class="sd">            fraction: float, fraction of translation speed to remove</span>
</span><span id="Record.gen_radial_fields-79"><a href="#Record.gen_radial_fields-79"><span class="linenos"> 79</span></a><span class="sd">            angle: float, angle of translation velocity change in degree</span>
</span><span id="Record.gen_radial_fields-80"><a href="#Record.gen_radial_fields-80"><span class="linenos"> 80</span></a><span class="sd">            swrf: float, surface wind reduction factor</span>
</span><span id="Record.gen_radial_fields-81"><a href="#Record.gen_radial_fields-81"><span class="linenos"> 81</span></a>
</span><span id="Record.gen_radial_fields-82"><a href="#Record.gen_radial_fields-82"><span class="linenos"> 82</span></a><span class="sd">        Due to translation a fraction of the wind-speed is embadded to the axysymmetric</span>
</span><span id="Record.gen_radial_fields-83"><a href="#Record.gen_radial_fields-83"><span class="linenos"> 83</span></a><span class="sd">        wind structure. To get the radial wind structure, we need to remove this</span>
</span><span id="Record.gen_radial_fields-84"><a href="#Record.gen_radial_fields-84"><span class="linenos"> 84</span></a><span class="sd">        translation velocity from the recorded wind velocity.</span>
</span><span id="Record.gen_radial_fields-85"><a href="#Record.gen_radial_fields-85"><span class="linenos"> 85</span></a><span class="sd">        </span>
</span><span id="Record.gen_radial_fields-86"><a href="#Record.gen_radial_fields-86"><span class="linenos"> 86</span></a><span class="sd">        The fraction is historically taken as unity (1). However, as shown in </span>
</span><span id="Record.gen_radial_fields-87"><a href="#Record.gen_radial_fields-87"><span class="linenos"> 87</span></a><span class="sd">        lin and chavas (2012), more statistically consistent value of this fraction</span>
</span><span id="Record.gen_radial_fields-88"><a href="#Record.gen_radial_fields-88"><span class="linenos"> 88</span></a><span class="sd">        is 0.56 (default)</span>
</span><span id="Record.gen_radial_fields-89"><a href="#Record.gen_radial_fields-89"><span class="linenos"> 89</span></a>
</span><span id="Record.gen_radial_fields-90"><a href="#Record.gen_radial_fields-90"><span class="linenos"> 90</span></a><span class="sd">        Similarly, the translation is not fully forward (angle=0), rather the </span>
</span><span id="Record.gen_radial_fields-91"><a href="#Record.gen_radial_fields-91"><span class="linenos"> 91</span></a><span class="sd">        background wind is slightly on southerly direction if we consider the</span>
</span><span id="Record.gen_radial_fields-92"><a href="#Record.gen_radial_fields-92"><span class="linenos"> 92</span></a><span class="sd">        storm is westerly. The angle is found around 19.2 degrees from statistical</span>
</span><span id="Record.gen_radial_fields-93"><a href="#Record.gen_radial_fields-93"><span class="linenos"> 93</span></a><span class="sd">        analysis. Thus the background wind is rotated anti-clockwise and needs </span>
</span><span id="Record.gen_radial_fields-94"><a href="#Record.gen_radial_fields-94"><span class="linenos"> 94</span></a><span class="sd">        to be updated before applying as fraction to the wind values.</span>
</span><span id="Record.gen_radial_fields-95"><a href="#Record.gen_radial_fields-95"><span class="linenos"> 95</span></a>
</span><span id="Record.gen_radial_fields-96"><a href="#Record.gen_radial_fields-96"><span class="linenos"> 96</span></a><span class="sd">        In the advisories, radial fields are defined at 10m level, whereas </span>
</span><span id="Record.gen_radial_fields-97"><a href="#Record.gen_radial_fields-97"><span class="linenos"> 97</span></a><span class="sd">        the analytical fields are defined at the boundary layer. Thus the velocity</span>
</span><span id="Record.gen_radial_fields-98"><a href="#Record.gen_radial_fields-98"><span class="linenos"> 98</span></a><span class="sd">        is needed to be divided by SWRF to shift it to boundary layer and multiplied</span>
</span><span id="Record.gen_radial_fields-99"><a href="#Record.gen_radial_fields-99"><span class="linenos"> 99</span></a><span class="sd">        by SWRF to get it back to 10m level.</span>
</span><span id="Record.gen_radial_fields-100"><a href="#Record.gen_radial_fields-100"><span class="linenos">100</span></a><span class="sd">        &#39;&#39;&#39;</span>
</span><span id="Record.gen_radial_fields-101"><a href="#Record.gen_radial_fields-101"><span class="linenos">101</span></a>        <span class="c1"># Rotating ustorm vstorm by 19.2 degree anti-clockwise</span>
</span><span id="Record.gen_radial_fields-102"><a href="#Record.gen_radial_fields-102"><span class="linenos">102</span></a>        <span class="c1"># Same operation as rotating a cartesian coordinate by 19.2 degree</span>
</span><span id="Record.gen_radial_fields-103"><a href="#Record.gen_radial_fields-103"><span class="linenos">103</span></a>        <span class="n">angle_rad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>
</span><span id="Record.gen_radial_fields-104"><a href="#Record.gen_radial_fields-104"><span class="linenos">104</span></a>        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">([</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;ustorm&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;vstorm&#39;</span><span class="p">]])):</span>
</span><span id="Record.gen_radial_fields-105"><a href="#Record.gen_radial_fields-105"><span class="linenos">105</span></a>            <span class="n">ustorm</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Record.gen_radial_fields-106"><a href="#Record.gen_radial_fields-106"><span class="linenos">106</span></a>            <span class="n">vstorm</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Record.gen_radial_fields-107"><a href="#Record.gen_radial_fields-107"><span class="linenos">107</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Record.gen_radial_fields-108"><a href="#Record.gen_radial_fields-108"><span class="linenos">108</span></a>            <span class="n">ustorm</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;ustorm&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle_rad</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;vstorm&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angle_rad</span><span class="p">)</span>
</span><span id="Record.gen_radial_fields-109"><a href="#Record.gen_radial_fields-109"><span class="linenos">109</span></a>            <span class="n">vstorm</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;ustorm&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angle_rad</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;vstorm&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle_rad</span><span class="p">)</span>
</span><span id="Record.gen_radial_fields-110"><a href="#Record.gen_radial_fields-110"><span class="linenos">110</span></a>
</span><span id="Record.gen_radial_fields-111"><a href="#Record.gen_radial_fields-111"><span class="linenos">111</span></a>        <span class="c1"># Apply correction to vmax for 4 quadrant clockwise from 0N</span>
</span><span id="Record.gen_radial_fields-112"><a href="#Record.gen_radial_fields-112"><span class="linenos">112</span></a>        <span class="c1"># Careful about the sin/cos from north</span>
</span><span id="Record.gen_radial_fields-113"><a href="#Record.gen_radial_fields-113"><span class="linenos">113</span></a>        <span class="c1">#            N</span>
</span><span id="Record.gen_radial_fields-114"><a href="#Record.gen_radial_fields-114"><span class="linenos">114</span></a>        <span class="c1">#            | t /</span>
</span><span id="Record.gen_radial_fields-115"><a href="#Record.gen_radial_fields-115"><span class="linenos">115</span></a>        <span class="c1">#            | /</span>
</span><span id="Record.gen_radial_fields-116"><a href="#Record.gen_radial_fields-116"><span class="linenos">116</span></a>        <span class="c1">#    W ------*------- E</span>
</span><span id="Record.gen_radial_fields-117"><a href="#Record.gen_radial_fields-117"><span class="linenos">117</span></a>        <span class="c1">#            |</span>
</span><span id="Record.gen_radial_fields-118"><a href="#Record.gen_radial_fields-118"><span class="linenos">118</span></a>        <span class="c1">#            |</span>
</span><span id="Record.gen_radial_fields-119"><a href="#Record.gen_radial_fields-119"><span class="linenos">119</span></a>        <span class="c1">#            S</span>
</span><span id="Record.gen_radial_fields-120"><a href="#Record.gen_radial_fields-120"><span class="linenos">120</span></a>        <span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
</span><span id="Record.gen_radial_fields-121"><a href="#Record.gen_radial_fields-121"><span class="linenos">121</span></a>        <span class="n">vmax_x</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;vmax&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">fraction</span><span class="o">*</span><span class="n">ustorm</span> 
</span><span id="Record.gen_radial_fields-122"><a href="#Record.gen_radial_fields-122"><span class="linenos">122</span></a>        <span class="n">vmax_y</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;vmax&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="o">-</span> <span class="n">fraction</span><span class="o">*</span><span class="n">vstorm</span>
</span><span id="Record.gen_radial_fields-123"><a href="#Record.gen_radial_fields-123"><span class="linenos">123</span></a>        <span class="n">vmax_amp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">vmax_x</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">vmax_y</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="n">swrf</span>
</span><span id="Record.gen_radial_fields-124"><a href="#Record.gen_radial_fields-124"><span class="linenos">124</span></a>        <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;fvmax&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">vmax_amp</span><span class="p">)</span>
</span><span id="Record.gen_radial_fields-125"><a href="#Record.gen_radial_fields-125"><span class="linenos">125</span></a>
</span><span id="Record.gen_radial_fields-126"><a href="#Record.gen_radial_fields-126"><span class="linenos">126</span></a>        <span class="c1"># Apply correction to vinfo for 4 quadrant</span>
</span><span id="Record.gen_radial_fields-127"><a href="#Record.gen_radial_fields-127"><span class="linenos">127</span></a>        <span class="n">fvinfo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
</span><span id="Record.gen_radial_fields-128"><a href="#Record.gen_radial_fields-128"><span class="linenos">128</span></a>        <span class="n">fradinfo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
</span><span id="Record.gen_radial_fields-129"><a href="#Record.gen_radial_fields-129"><span class="linenos">129</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">vinfo</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;vinfo&#39;</span><span class="p">])):</span>
</span><span id="Record.gen_radial_fields-130"><a href="#Record.gen_radial_fields-130"><span class="linenos">130</span></a>            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">vinfo</span><span class="p">):</span>
</span><span id="Record.gen_radial_fields-131"><a href="#Record.gen_radial_fields-131"><span class="linenos">131</span></a>                <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;vinfo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
</span><span id="Record.gen_radial_fields-132"><a href="#Record.gen_radial_fields-132"><span class="linenos">132</span></a>                <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;radinfo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
</span><span id="Record.gen_radial_fields-133"><a href="#Record.gen_radial_fields-133"><span class="linenos">133</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Record.gen_radial_fields-134"><a href="#Record.gen_radial_fields-134"><span class="linenos">134</span></a>                <span class="n">vinfo_x</span> <span class="o">=</span> <span class="n">vinfo</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">fraction</span><span class="o">*</span><span class="n">ustorm</span>
</span><span id="Record.gen_radial_fields-135"><a href="#Record.gen_radial_fields-135"><span class="linenos">135</span></a>                <span class="n">vinfo_y</span> <span class="o">=</span> <span class="n">vinfo</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="o">-</span> <span class="n">fraction</span><span class="o">*</span><span class="n">vstorm</span>
</span><span id="Record.gen_radial_fields-136"><a href="#Record.gen_radial_fields-136"><span class="linenos">136</span></a>                <span class="n">vinfo_amp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">vinfo_x</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">vinfo_y</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="n">swrf</span>
</span><span id="Record.gen_radial_fields-137"><a href="#Record.gen_radial_fields-137"><span class="linenos">137</span></a>                <span class="n">vinfo_func</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">vinfo_amp</span><span class="p">)</span>
</span><span id="Record.gen_radial_fields-138"><a href="#Record.gen_radial_fields-138"><span class="linenos">138</span></a>                <span class="n">fvinfo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fvinfo</span><span class="p">,</span> <span class="n">vinfo_func</span><span class="p">)</span>
</span><span id="Record.gen_radial_fields-139"><a href="#Record.gen_radial_fields-139"><span class="linenos">139</span></a>
</span><span id="Record.gen_radial_fields-140"><a href="#Record.gen_radial_fields-140"><span class="linenos">140</span></a>                <span class="n">radinfo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;radinfo&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;radinfo&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
</span><span id="Record.gen_radial_fields-141"><a href="#Record.gen_radial_fields-141"><span class="linenos">141</span></a>                <span class="n">radinfo_func</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">radinfo</span><span class="p">)</span>
</span><span id="Record.gen_radial_fields-142"><a href="#Record.gen_radial_fields-142"><span class="linenos">142</span></a>                <span class="n">fradinfo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fradinfo</span><span class="p">,</span> <span class="n">radinfo_func</span><span class="p">)</span>
</span><span id="Record.gen_radial_fields-143"><a href="#Record.gen_radial_fields-143"><span class="linenos">143</span></a>        
</span><span id="Record.gen_radial_fields-144"><a href="#Record.gen_radial_fields-144"><span class="linenos">144</span></a>        <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;fvinfo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fvinfo</span>
</span><span id="Record.gen_radial_fields-145"><a href="#Record.gen_radial_fields-145"><span class="linenos">145</span></a>        <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;fradinfo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fradinfo</span>
</span><span id="Record.gen_radial_fields-146"><a href="#Record.gen_radial_fields-146"><span class="linenos">146</span></a>
</span><span id="Record.gen_radial_fields-147"><a href="#Record.gen_radial_fields-147"><span class="linenos">147</span></a>        <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Generate the interpolator for radial field for exisiting radial informations.
To get correct radial field, atmospheric background is removed and
the amount to be removed is controlled by fraction, and angle.  </p>

<p>Arguments:
    fraction: float, fraction of translation speed to remove
    angle: float, angle of translation velocity change in degree
    swrf: float, surface wind reduction factor</p>

<p>Due to translation a fraction of the wind-speed is embadded to the axysymmetric
wind structure. To get the radial wind structure, we need to remove this
translation velocity from the recorded wind velocity.</p>

<p>The fraction is historically taken as unity (1). However, as shown in 
lin and chavas (2012), more statistically consistent value of this fraction
is 0.56 (default)</p>

<p>Similarly, the translation is not fully forward (angle=0), rather the 
background wind is slightly on southerly direction if we consider the
storm is westerly. The angle is found around 19.2 degrees from statistical
analysis. Thus the background wind is rotated anti-clockwise and needs 
to be updated before applying as fraction to the wind values.</p>

<p>In the advisories, radial fields are defined at 10m level, whereas 
the analytical fields are defined at the boundary layer. Thus the velocity
is needed to be divided by SWRF to shift it to boundary layer and multiplied
by SWRF to get it back to 10m level.</p>
</div>


                            </div>
                            <div id="Record.calc_rmax" class="classattr">
                                        <input id="Record.calc_rmax-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">calc_rmax</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;H80&#39;</span><span class="p">,</span> <span class="s1">&#39;E11&#39;</span><span class="p">]</span>,</span><span class="param">	<span class="n">use_rmax_info</span><span class="o">=</span><span class="kc">False</span>,</span><span class="param">	<span class="n">vlimit</span><span class="o">=</span><span class="p">[</span><span class="mi">20</span><span class="p">,</span> <span class="n">inf</span><span class="p">]</span>,</span><span class="param">	<span class="n">kw_atmos</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;pn&#39;</span><span class="p">:</span> <span class="mi">101325</span><span class="p">,</span> <span class="s1">&#39;rhoair&#39;</span><span class="p">:</span> <span class="mf">1.15</span><span class="p">}</span>,</span><span class="param">	<span class="n">kw_h80</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;bmax&#39;</span><span class="p">:</span> <span class="mf">2.5</span><span class="p">,</span> <span class="s1">&#39;bmin&#39;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span> <span class="s1">&#39;solver&#39;</span><span class="p">:</span> <span class="s1">&#39;fsolve&#39;</span><span class="p">,</span> <span class="s1">&#39;limit&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">5000</span><span class="p">,</span> <span class="mi">500000</span><span class="p">],</span> <span class="s1">&#39;step&#39;</span><span class="p">:</span> <span class="mi">100</span><span class="p">}</span>,</span><span class="param">	<span class="n">kw_e11</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;solver&#39;</span><span class="p">:</span> <span class="s1">&#39;fsolve&#39;</span><span class="p">,</span> <span class="s1">&#39;limit&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">5000</span><span class="p">,</span> <span class="mi">500000</span><span class="p">],</span> <span class="s1">&#39;step&#39;</span><span class="p">:</span> <span class="mi">100</span><span class="p">}</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Record.calc_rmax-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Record.calc_rmax"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Record.calc_rmax-149"><a href="#Record.calc_rmax-149"><span class="linenos">149</span></a>    <span class="k">def</span> <span class="nf">calc_rmax</span><span class="p">(</span>
</span><span id="Record.calc_rmax-150"><a href="#Record.calc_rmax-150"><span class="linenos">150</span></a>        <span class="bp">self</span><span class="p">,</span> 
</span><span id="Record.calc_rmax-151"><a href="#Record.calc_rmax-151"><span class="linenos">151</span></a>        <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;H80&#39;</span><span class="p">,</span> <span class="s1">&#39;E11&#39;</span><span class="p">],</span> 
</span><span id="Record.calc_rmax-152"><a href="#Record.calc_rmax-152"><span class="linenos">152</span></a>        <span class="n">use_rmax_info</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
</span><span id="Record.calc_rmax-153"><a href="#Record.calc_rmax-153"><span class="linenos">153</span></a>        <span class="n">vlimit</span><span class="o">=</span><span class="p">[</span><span class="mi">20</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">],</span>
</span><span id="Record.calc_rmax-154"><a href="#Record.calc_rmax-154"><span class="linenos">154</span></a>        <span class="n">kw_atmos</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;pn&#39;</span><span class="p">:</span><span class="mi">101325</span><span class="p">,</span> <span class="s1">&#39;rhoair&#39;</span><span class="p">:</span><span class="mf">1.15</span><span class="p">},</span>
</span><span id="Record.calc_rmax-155"><a href="#Record.calc_rmax-155"><span class="linenos">155</span></a>        <span class="n">kw_h80</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;bmax&#39;</span><span class="p">:</span><span class="mf">2.5</span><span class="p">,</span> <span class="s1">&#39;bmin&#39;</span><span class="p">:</span><span class="mf">0.5</span><span class="p">,</span> <span class="s1">&#39;solver&#39;</span><span class="p">:</span><span class="s1">&#39;fsolve&#39;</span><span class="p">,</span> <span class="s1">&#39;limit&#39;</span><span class="p">:[</span><span class="mi">5000</span><span class="p">,</span> <span class="mi">500000</span><span class="p">],</span> <span class="s1">&#39;step&#39;</span><span class="p">:</span><span class="mi">100</span><span class="p">},</span>
</span><span id="Record.calc_rmax-156"><a href="#Record.calc_rmax-156"><span class="linenos">156</span></a>        <span class="n">kw_e11</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;solver&#39;</span><span class="p">:</span><span class="s1">&#39;fsolve&#39;</span><span class="p">,</span> <span class="s1">&#39;limit&#39;</span><span class="p">:[</span><span class="mi">5000</span><span class="p">,</span> <span class="mi">500000</span><span class="p">],</span> <span class="s1">&#39;step&#39;</span><span class="p">:</span><span class="mi">100</span><span class="p">}</span>
</span><span id="Record.calc_rmax-157"><a href="#Record.calc_rmax-157"><span class="linenos">157</span></a>    <span class="p">):</span>
</span><span id="Record.calc_rmax-158"><a href="#Record.calc_rmax-158"><span class="linenos">158</span></a><span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="Record.calc_rmax-159"><a href="#Record.calc_rmax-159"><span class="linenos">159</span></a><span class="sd">        Calculate Radius of maximum wind based on a given method on the selected</span>
</span><span id="Record.calc_rmax-160"><a href="#Record.calc_rmax-160"><span class="linenos">160</span></a><span class="sd">        radial informations.</span>
</span><span id="Record.calc_rmax-161"><a href="#Record.calc_rmax-161"><span class="linenos">161</span></a>
</span><span id="Record.calc_rmax-162"><a href="#Record.calc_rmax-162"><span class="linenos">162</span></a><span class="sd">        methods: list, list of methods to try one after another</span>
</span><span id="Record.calc_rmax-163"><a href="#Record.calc_rmax-163"><span class="linenos">163</span></a><span class="sd">        use_rmax_info: bool, existing rmax to be used directly or not</span>
</span><span id="Record.calc_rmax-164"><a href="#Record.calc_rmax-164"><span class="linenos">164</span></a><span class="sd">        vlimit: list of maximum limit of v for method to be used, </span>
</span><span id="Record.calc_rmax-165"><a href="#Record.calc_rmax-165"><span class="linenos">165</span></a><span class="sd">                last one must be np.inf, vlimit is right open )</span>
</span><span id="Record.calc_rmax-166"><a href="#Record.calc_rmax-166"><span class="linenos">166</span></a><span class="sd">        kw_atmos: dict, atmospheric information, generally needed for H80 model</span>
</span><span id="Record.calc_rmax-167"><a href="#Record.calc_rmax-167"><span class="linenos">167</span></a><span class="sd">        kw_h80: dict, solver options for H80 model</span>
</span><span id="Record.calc_rmax-168"><a href="#Record.calc_rmax-168"><span class="linenos">168</span></a><span class="sd">        kw_e11: dict, solver options for E11 model</span>
</span><span id="Record.calc_rmax-169"><a href="#Record.calc_rmax-169"><span class="linenos">169</span></a>
</span><span id="Record.calc_rmax-170"><a href="#Record.calc_rmax-170"><span class="linenos">170</span></a><span class="sd">        Following methods are implemented - </span>
</span><span id="Record.calc_rmax-171"><a href="#Record.calc_rmax-171"><span class="linenos">171</span></a><span class="sd">            &#39;E11&#39; : Emanuel 2011 model as described in Lin and Chavas 2012</span>
</span><span id="Record.calc_rmax-172"><a href="#Record.calc_rmax-172"><span class="linenos">172</span></a><span class="sd">            &#39;H80&#39; : Holland 1980 model based on radial info</span>
</span><span id="Record.calc_rmax-173"><a href="#Record.calc_rmax-173"><span class="linenos">173</span></a><span class="sd">            &#39;S02&#39; : Silva et al. 2002 based on regression of central pressure</span>
</span><span id="Record.calc_rmax-174"><a href="#Record.calc_rmax-174"><span class="linenos">174</span></a><span class="sd">                    rmax = 0.4785 * Pc (mb) - 413 (km)</span>
</span><span id="Record.calc_rmax-175"><a href="#Record.calc_rmax-175"><span class="linenos">175</span></a><span class="sd">            &#39;W04&#39; : Willoughby and Rahn (2004) regression of Vmax</span>
</span><span id="Record.calc_rmax-176"><a href="#Record.calc_rmax-176"><span class="linenos">176</span></a><span class="sd">                    rmax = 51.6*exp(-0.0223*Vmax + 0.0281*lat) (km)</span>
</span><span id="Record.calc_rmax-177"><a href="#Record.calc_rmax-177"><span class="linenos">177</span></a>
</span><span id="Record.calc_rmax-178"><a href="#Record.calc_rmax-178"><span class="linenos">178</span></a><span class="sd">        Models to be implemented in the future - </span>
</span><span id="Record.calc_rmax-179"><a href="#Record.calc_rmax-179"><span class="linenos">179</span></a><span class="sd">            &#39;H80c&#39; : Holland 1980c (f related values are removed)</span>
</span><span id="Record.calc_rmax-180"><a href="#Record.calc_rmax-180"><span class="linenos">180</span></a><span class="sd">            &#39;S92&#39; : Slosh model, by jeleniaski et al . 1992</span>
</span><span id="Record.calc_rmax-181"><a href="#Record.calc_rmax-181"><span class="linenos">181</span></a><span class="sd">            &#39;E04&#39; : Emanuel 2004 model</span>
</span><span id="Record.calc_rmax-182"><a href="#Record.calc_rmax-182"><span class="linenos">182</span></a><span class="sd">            &#39;M16&#39; : Murty et al 2016 model</span>
</span><span id="Record.calc_rmax-183"><a href="#Record.calc_rmax-183"><span class="linenos">183</span></a><span class="sd">            &#39;W06&#39; : Willoughby et al. 2006 model </span>
</span><span id="Record.calc_rmax-184"><a href="#Record.calc_rmax-184"><span class="linenos">184</span></a><span class="sd">        </span>
</span><span id="Record.calc_rmax-185"><a href="#Record.calc_rmax-185"><span class="linenos">185</span></a><span class="sd">        &#39;&#39;&#39;</span>
</span><span id="Record.calc_rmax-186"><a href="#Record.calc_rmax-186"><span class="linenos">186</span></a>        <span class="n">methods</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">methods</span><span class="p">)</span>
</span><span id="Record.calc_rmax-187"><a href="#Record.calc_rmax-187"><span class="linenos">187</span></a>
</span><span id="Record.calc_rmax-188"><a href="#Record.calc_rmax-188"><span class="linenos">188</span></a>        <span class="n">calc_rmax</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="Record.calc_rmax-189"><a href="#Record.calc_rmax-189"><span class="linenos">189</span></a>            <span class="s1">&#39;E11&#39;</span><span class="p">:</span> <span class="n">calc_rmax_e11</span><span class="p">,</span>
</span><span id="Record.calc_rmax-190"><a href="#Record.calc_rmax-190"><span class="linenos">190</span></a>            <span class="s1">&#39;H80&#39;</span><span class="p">:</span> <span class="n">calc_rmax_h80</span><span class="p">,</span>
</span><span id="Record.calc_rmax-191"><a href="#Record.calc_rmax-191"><span class="linenos">191</span></a>            <span class="s1">&#39;S02&#39;</span><span class="p">:</span> <span class="n">calc_rmax_s02</span><span class="p">,</span>
</span><span id="Record.calc_rmax-192"><a href="#Record.calc_rmax-192"><span class="linenos">192</span></a>            <span class="s1">&#39;W04&#39;</span><span class="p">:</span> <span class="n">calc_rmax_w04</span>
</span><span id="Record.calc_rmax-193"><a href="#Record.calc_rmax-193"><span class="linenos">193</span></a>        <span class="p">}</span>
</span><span id="Record.calc_rmax-194"><a href="#Record.calc_rmax-194"><span class="linenos">194</span></a>        
</span><span id="Record.calc_rmax-195"><a href="#Record.calc_rmax-195"><span class="linenos">195</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="Record.calc_rmax-196"><a href="#Record.calc_rmax-196"><span class="linenos">196</span></a>            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">vlimit</span><span class="p">))</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">methods</span><span class="p">)</span>
</span><span id="Record.calc_rmax-197"><a href="#Record.calc_rmax-197"><span class="linenos">197</span></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="Record.calc_rmax-198"><a href="#Record.calc_rmax-198"><span class="linenos">198</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;vlimit must be the size of methods.&#39;</span><span class="p">)</span>
</span><span id="Record.calc_rmax-199"><a href="#Record.calc_rmax-199"><span class="linenos">199</span></a>
</span><span id="Record.calc_rmax-200"><a href="#Record.calc_rmax-200"><span class="linenos">200</span></a>        <span class="n">vlimit_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">vlimit</span><span class="p">)[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="c1"># Starts from 0 m/s</span>
</span><span id="Record.calc_rmax-201"><a href="#Record.calc_rmax-201"><span class="linenos">201</span></a>        <span class="n">vlimit_max</span> <span class="o">=</span> <span class="n">vlimit</span>
</span><span id="Record.calc_rmax-202"><a href="#Record.calc_rmax-202"><span class="linenos">202</span></a>
</span><span id="Record.calc_rmax-203"><a href="#Record.calc_rmax-203"><span class="linenos">203</span></a>        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">([</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;rmax&#39;</span><span class="p">]),</span> <span class="n">use_rmax_info</span><span class="p">]):</span>
</span><span id="Record.calc_rmax-204"><a href="#Record.calc_rmax-204"><span class="linenos">204</span></a>            <span class="c1"># Use the provided vmax</span>
</span><span id="Record.calc_rmax-205"><a href="#Record.calc_rmax-205"><span class="linenos">205</span></a>            <span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
</span><span id="Record.calc_rmax-206"><a href="#Record.calc_rmax-206"><span class="linenos">206</span></a>            <span class="n">rmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;rmax&#39;</span><span class="p">]</span>
</span><span id="Record.calc_rmax-207"><a href="#Record.calc_rmax-207"><span class="linenos">207</span></a>            <span class="n">frmax</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">rmax</span><span class="p">)</span>
</span><span id="Record.calc_rmax-208"><a href="#Record.calc_rmax-208"><span class="linenos">208</span></a>            <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;frmax&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">frmax</span>
</span><span id="Record.calc_rmax-209"><a href="#Record.calc_rmax-209"><span class="linenos">209</span></a>        <span class="k">elif</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;vinfo&#39;</span><span class="p">])):</span>
</span><span id="Record.calc_rmax-210"><a href="#Record.calc_rmax-210"><span class="linenos">210</span></a>            <span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
</span><span id="Record.calc_rmax-211"><a href="#Record.calc_rmax-211"><span class="linenos">211</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;mslp&#39;</span><span class="p">]):</span>
</span><span id="Record.calc_rmax-212"><a href="#Record.calc_rmax-212"><span class="linenos">212</span></a>                <span class="c1"># Use S02 regression method for rmax</span>
</span><span id="Record.calc_rmax-213"><a href="#Record.calc_rmax-213"><span class="linenos">213</span></a>                <span class="n">rmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span><span class="o">*</span><span class="n">calc_rmax_s02</span><span class="p">(</span><span class="n">mslp</span><span class="o">=</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;mslp&#39;</span><span class="p">])</span>
</span><span id="Record.calc_rmax-214"><a href="#Record.calc_rmax-214"><span class="linenos">214</span></a>            <span class="k">elif</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;vmax&#39;</span><span class="p">]):</span>
</span><span id="Record.calc_rmax-215"><a href="#Record.calc_rmax-215"><span class="linenos">215</span></a>                <span class="c1"># Use W04 regression method for rmax</span>
</span><span id="Record.calc_rmax-216"><a href="#Record.calc_rmax-216"><span class="linenos">216</span></a>                <span class="n">rmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span><span class="o">*</span><span class="n">calc_rmax_w04</span><span class="p">(</span><span class="n">vmax</span><span class="o">=</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;vmax&#39;</span><span class="p">],</span> <span class="n">lat</span><span class="o">=</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">])</span>
</span><span id="Record.calc_rmax-217"><a href="#Record.calc_rmax-217"><span class="linenos">217</span></a>            
</span><span id="Record.calc_rmax-218"><a href="#Record.calc_rmax-218"><span class="linenos">218</span></a>            <span class="n">frmax</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">rmax</span><span class="p">)</span>
</span><span id="Record.calc_rmax-219"><a href="#Record.calc_rmax-219"><span class="linenos">219</span></a>            <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;frmax&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">frmax</span>
</span><span id="Record.calc_rmax-220"><a href="#Record.calc_rmax-220"><span class="linenos">220</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Record.calc_rmax-221"><a href="#Record.calc_rmax-221"><span class="linenos">221</span></a>            <span class="n">frmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span> <span class="c1"># length of fvinfo or atleast 1</span>
</span><span id="Record.calc_rmax-222"><a href="#Record.calc_rmax-222"><span class="linenos">222</span></a>            <span class="n">rmax_method</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span> <span class="c1"># Keeping the rmax_method used</span>
</span><span id="Record.calc_rmax-223"><a href="#Record.calc_rmax-223"><span class="linenos">223</span></a>            <span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
</span><span id="Record.calc_rmax-224"><a href="#Record.calc_rmax-224"><span class="linenos">224</span></a>            
</span><span id="Record.calc_rmax-225"><a href="#Record.calc_rmax-225"><span class="linenos">225</span></a>            <span class="c1"># Radial info is available and rmax is to be calculated from radinfo</span>
</span><span id="Record.calc_rmax-226"><a href="#Record.calc_rmax-226"><span class="linenos">226</span></a>            <span class="k">for</span> <span class="n">fv</span><span class="p">,</span> <span class="n">fr</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;fvinfo&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;fradinfo&#39;</span><span class="p">]):</span>
</span><span id="Record.calc_rmax-227"><a href="#Record.calc_rmax-227"><span class="linenos">227</span></a>                <span class="n">rmax_fv_theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="c1"># Placeholder</span>
</span><span id="Record.calc_rmax-228"><a href="#Record.calc_rmax-228"><span class="linenos">228</span></a>                
</span><span id="Record.calc_rmax-229"><a href="#Record.calc_rmax-229"><span class="linenos">229</span></a>                <span class="c1"># Iterating over all the values interpolated by theta</span>
</span><span id="Record.calc_rmax-230"><a href="#Record.calc_rmax-230"><span class="linenos">230</span></a>                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">thetai</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">theta</span><span class="p">):</span>
</span><span id="Record.calc_rmax-231"><a href="#Record.calc_rmax-231"><span class="linenos">231</span></a>                    <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">method</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">methods</span><span class="p">):</span>
</span><span id="Record.calc_rmax-232"><a href="#Record.calc_rmax-232"><span class="linenos">232</span></a>                        <span class="k">try</span><span class="p">:</span>
</span><span id="Record.calc_rmax-233"><a href="#Record.calc_rmax-233"><span class="linenos">233</span></a>                            <span class="c1"># Check the vlimit_min vlimit_max</span>
</span><span id="Record.calc_rmax-234"><a href="#Record.calc_rmax-234"><span class="linenos">234</span></a>                            <span class="k">assert</span> <span class="n">fv</span><span class="p">(</span><span class="n">thetai</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">vlimit_min</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
</span><span id="Record.calc_rmax-235"><a href="#Record.calc_rmax-235"><span class="linenos">235</span></a>                            <span class="k">assert</span> <span class="n">fv</span><span class="p">(</span><span class="n">thetai</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">vlimit_max</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
</span><span id="Record.calc_rmax-236"><a href="#Record.calc_rmax-236"><span class="linenos">236</span></a>                            
</span><span id="Record.calc_rmax-237"><a href="#Record.calc_rmax-237"><span class="linenos">237</span></a>                            <span class="c1"># Trying each methods</span>
</span><span id="Record.calc_rmax-238"><a href="#Record.calc_rmax-238"><span class="linenos">238</span></a>                            <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;E11&#39;</span><span class="p">:</span>
</span><span id="Record.calc_rmax-239"><a href="#Record.calc_rmax-239"><span class="linenos">239</span></a>                                <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="Record.calc_rmax-240"><a href="#Record.calc_rmax-240"><span class="linenos">240</span></a>                                    <span class="s1">&#39;v&#39;</span><span class="p">:</span><span class="n">fv</span><span class="p">(</span><span class="n">thetai</span><span class="p">),</span> 
</span><span id="Record.calc_rmax-241"><a href="#Record.calc_rmax-241"><span class="linenos">241</span></a>                                    <span class="s1">&#39;r&#39;</span><span class="p">:</span><span class="n">fr</span><span class="p">(</span><span class="n">thetai</span><span class="p">),</span> 
</span><span id="Record.calc_rmax-242"><a href="#Record.calc_rmax-242"><span class="linenos">242</span></a>                                    <span class="s1">&#39;vmax&#39;</span><span class="p">:</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;fvmax&#39;</span><span class="p">](</span><span class="n">thetai</span><span class="p">),</span> 
</span><span id="Record.calc_rmax-243"><a href="#Record.calc_rmax-243"><span class="linenos">243</span></a>                                    <span class="s1">&#39;f&#39;</span><span class="p">:</span><span class="n">coriolis</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">]),</span> 
</span><span id="Record.calc_rmax-244"><a href="#Record.calc_rmax-244"><span class="linenos">244</span></a>                                    <span class="s1">&#39;solver&#39;</span><span class="p">:</span><span class="n">kw_e11</span><span class="p">[</span><span class="s1">&#39;solver&#39;</span><span class="p">],</span> 
</span><span id="Record.calc_rmax-245"><a href="#Record.calc_rmax-245"><span class="linenos">245</span></a>                                    <span class="s1">&#39;limit&#39;</span><span class="p">:</span><span class="n">kw_e11</span><span class="p">[</span><span class="s1">&#39;limit&#39;</span><span class="p">],</span> 
</span><span id="Record.calc_rmax-246"><a href="#Record.calc_rmax-246"><span class="linenos">246</span></a>                                    <span class="s1">&#39;step&#39;</span><span class="p">:</span><span class="n">kw_e11</span><span class="p">[</span><span class="s1">&#39;step&#39;</span><span class="p">]</span>
</span><span id="Record.calc_rmax-247"><a href="#Record.calc_rmax-247"><span class="linenos">247</span></a>                                <span class="p">}</span>
</span><span id="Record.calc_rmax-248"><a href="#Record.calc_rmax-248"><span class="linenos">248</span></a>                                <span class="n">rmax_fv_theta</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">calc_rmax</span><span class="p">[</span><span class="n">method</span><span class="p">](</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="Record.calc_rmax-249"><a href="#Record.calc_rmax-249"><span class="linenos">249</span></a>
</span><span id="Record.calc_rmax-250"><a href="#Record.calc_rmax-250"><span class="linenos">250</span></a>                            <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;H80&#39;</span><span class="p">:</span>
</span><span id="Record.calc_rmax-251"><a href="#Record.calc_rmax-251"><span class="linenos">251</span></a>                                <span class="c1"># First calculate holland B parameter</span>
</span><span id="Record.calc_rmax-252"><a href="#Record.calc_rmax-252"><span class="linenos">252</span></a>                                <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="Record.calc_rmax-253"><a href="#Record.calc_rmax-253"><span class="linenos">253</span></a>                                    <span class="s1">&#39;vmax&#39;</span><span class="p">:</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;fvmax&#39;</span><span class="p">](</span><span class="n">thetai</span><span class="p">),</span>
</span><span id="Record.calc_rmax-254"><a href="#Record.calc_rmax-254"><span class="linenos">254</span></a>                                    <span class="s1">&#39;pc&#39;</span><span class="p">:</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;mslp&#39;</span><span class="p">],</span>
</span><span id="Record.calc_rmax-255"><a href="#Record.calc_rmax-255"><span class="linenos">255</span></a>                                    <span class="s1">&#39;pn&#39;</span><span class="p">:</span><span class="n">kw_atmos</span><span class="p">[</span><span class="s1">&#39;pn&#39;</span><span class="p">],</span>
</span><span id="Record.calc_rmax-256"><a href="#Record.calc_rmax-256"><span class="linenos">256</span></a>                                    <span class="s1">&#39;rhoair&#39;</span><span class="p">:</span><span class="n">kw_atmos</span><span class="p">[</span><span class="s1">&#39;rhoair&#39;</span><span class="p">],</span>
</span><span id="Record.calc_rmax-257"><a href="#Record.calc_rmax-257"><span class="linenos">257</span></a>                                    <span class="s1">&#39;bmax&#39;</span><span class="p">:</span><span class="n">kw_h80</span><span class="p">[</span><span class="s1">&#39;bmax&#39;</span><span class="p">],</span>
</span><span id="Record.calc_rmax-258"><a href="#Record.calc_rmax-258"><span class="linenos">258</span></a>                                    <span class="s1">&#39;bmin&#39;</span><span class="p">:</span><span class="n">kw_h80</span><span class="p">[</span><span class="s1">&#39;bmin&#39;</span><span class="p">]</span>
</span><span id="Record.calc_rmax-259"><a href="#Record.calc_rmax-259"><span class="linenos">259</span></a>                                <span class="p">}</span>
</span><span id="Record.calc_rmax-260"><a href="#Record.calc_rmax-260"><span class="linenos">260</span></a>                                <span class="n">B</span> <span class="o">=</span> <span class="n">calc_holland_B</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="Record.calc_rmax-261"><a href="#Record.calc_rmax-261"><span class="linenos">261</span></a>
</span><span id="Record.calc_rmax-262"><a href="#Record.calc_rmax-262"><span class="linenos">262</span></a>                                <span class="c1"># Then calculate the rmax</span>
</span><span id="Record.calc_rmax-263"><a href="#Record.calc_rmax-263"><span class="linenos">263</span></a>                                <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="Record.calc_rmax-264"><a href="#Record.calc_rmax-264"><span class="linenos">264</span></a>                                    <span class="s1">&#39;v&#39;</span><span class="p">:</span><span class="n">fv</span><span class="p">(</span><span class="n">thetai</span><span class="p">),</span> 
</span><span id="Record.calc_rmax-265"><a href="#Record.calc_rmax-265"><span class="linenos">265</span></a>                                    <span class="s1">&#39;r&#39;</span><span class="p">:</span><span class="n">fr</span><span class="p">(</span><span class="n">thetai</span><span class="p">),</span> 
</span><span id="Record.calc_rmax-266"><a href="#Record.calc_rmax-266"><span class="linenos">266</span></a>                                    <span class="s1">&#39;pc&#39;</span><span class="p">:</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;mslp&#39;</span><span class="p">],</span> 
</span><span id="Record.calc_rmax-267"><a href="#Record.calc_rmax-267"><span class="linenos">267</span></a>                                    <span class="s1">&#39;B&#39;</span><span class="p">:</span><span class="n">B</span><span class="p">,</span> 
</span><span id="Record.calc_rmax-268"><a href="#Record.calc_rmax-268"><span class="linenos">268</span></a>                                    <span class="s1">&#39;f&#39;</span><span class="p">:</span><span class="n">coriolis</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">]),</span> 
</span><span id="Record.calc_rmax-269"><a href="#Record.calc_rmax-269"><span class="linenos">269</span></a>                                    <span class="s1">&#39;pn&#39;</span><span class="p">:</span><span class="n">kw_atmos</span><span class="p">[</span><span class="s1">&#39;pn&#39;</span><span class="p">],</span> 
</span><span id="Record.calc_rmax-270"><a href="#Record.calc_rmax-270"><span class="linenos">270</span></a>                                    <span class="s1">&#39;rhoair&#39;</span><span class="p">:</span><span class="n">kw_atmos</span><span class="p">[</span><span class="s1">&#39;rhoair&#39;</span><span class="p">],</span> 
</span><span id="Record.calc_rmax-271"><a href="#Record.calc_rmax-271"><span class="linenos">271</span></a>                                    <span class="s1">&#39;solver&#39;</span><span class="p">:</span><span class="n">kw_h80</span><span class="p">[</span><span class="s1">&#39;solver&#39;</span><span class="p">],</span> 
</span><span id="Record.calc_rmax-272"><a href="#Record.calc_rmax-272"><span class="linenos">272</span></a>                                    <span class="s1">&#39;limit&#39;</span><span class="p">:</span><span class="n">kw_h80</span><span class="p">[</span><span class="s1">&#39;limit&#39;</span><span class="p">],</span> 
</span><span id="Record.calc_rmax-273"><a href="#Record.calc_rmax-273"><span class="linenos">273</span></a>                                    <span class="s1">&#39;step&#39;</span><span class="p">:</span><span class="n">kw_h80</span><span class="p">[</span><span class="s1">&#39;step&#39;</span><span class="p">]</span>
</span><span id="Record.calc_rmax-274"><a href="#Record.calc_rmax-274"><span class="linenos">274</span></a>                                <span class="p">}</span>
</span><span id="Record.calc_rmax-275"><a href="#Record.calc_rmax-275"><span class="linenos">275</span></a>                                <span class="n">rmax_fv_theta</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">calc_rmax</span><span class="p">[</span><span class="n">method</span><span class="p">](</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="Record.calc_rmax-276"><a href="#Record.calc_rmax-276"><span class="linenos">276</span></a>
</span><span id="Record.calc_rmax-277"><a href="#Record.calc_rmax-277"><span class="linenos">277</span></a>                            <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;S02&#39;</span><span class="p">:</span>
</span><span id="Record.calc_rmax-278"><a href="#Record.calc_rmax-278"><span class="linenos">278</span></a>                                <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="Record.calc_rmax-279"><a href="#Record.calc_rmax-279"><span class="linenos">279</span></a>                                    <span class="s1">&#39;mslp&#39;</span><span class="p">:</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;mslp&#39;</span><span class="p">]</span>
</span><span id="Record.calc_rmax-280"><a href="#Record.calc_rmax-280"><span class="linenos">280</span></a>                                <span class="p">}</span>
</span><span id="Record.calc_rmax-281"><a href="#Record.calc_rmax-281"><span class="linenos">281</span></a>                                <span class="n">rmax_fv_theta</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">calc_rmax</span><span class="p">[</span><span class="n">method</span><span class="p">](</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="Record.calc_rmax-282"><a href="#Record.calc_rmax-282"><span class="linenos">282</span></a>
</span><span id="Record.calc_rmax-283"><a href="#Record.calc_rmax-283"><span class="linenos">283</span></a>                            <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;W04&#39;</span><span class="p">:</span>
</span><span id="Record.calc_rmax-284"><a href="#Record.calc_rmax-284"><span class="linenos">284</span></a>                                <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="Record.calc_rmax-285"><a href="#Record.calc_rmax-285"><span class="linenos">285</span></a>                                    <span class="s1">&#39;vmax&#39;</span><span class="p">:</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;fvmax&#39;</span><span class="p">](</span><span class="n">thetai</span><span class="p">),</span>
</span><span id="Record.calc_rmax-286"><a href="#Record.calc_rmax-286"><span class="linenos">286</span></a>                                    <span class="s1">&#39;lat&#39;</span><span class="p">:</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span>
</span><span id="Record.calc_rmax-287"><a href="#Record.calc_rmax-287"><span class="linenos">287</span></a>                                <span class="p">}</span>
</span><span id="Record.calc_rmax-288"><a href="#Record.calc_rmax-288"><span class="linenos">288</span></a>                                <span class="n">rmax_fv_theta</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">calc_rmax</span><span class="p">[</span><span class="n">method</span><span class="p">](</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>                            
</span><span id="Record.calc_rmax-289"><a href="#Record.calc_rmax-289"><span class="linenos">289</span></a>
</span><span id="Record.calc_rmax-290"><a href="#Record.calc_rmax-290"><span class="linenos">290</span></a>                            <span class="c1"># When successful break the loop</span>
</span><span id="Record.calc_rmax-291"><a href="#Record.calc_rmax-291"><span class="linenos">291</span></a>                            <span class="k">break</span>
</span><span id="Record.calc_rmax-292"><a href="#Record.calc_rmax-292"><span class="linenos">292</span></a>                        <span class="k">except</span><span class="p">:</span>
</span><span id="Record.calc_rmax-293"><a href="#Record.calc_rmax-293"><span class="linenos">293</span></a>                            <span class="c1"># Otherwise continue with the methods</span>
</span><span id="Record.calc_rmax-294"><a href="#Record.calc_rmax-294"><span class="linenos">294</span></a>                            <span class="k">continue</span>
</span><span id="Record.calc_rmax-295"><a href="#Record.calc_rmax-295"><span class="linenos">295</span></a>                
</span><span id="Record.calc_rmax-296"><a href="#Record.calc_rmax-296"><span class="linenos">296</span></a>                <span class="c1"># For a particular vinfo create the interpolation function</span>
</span><span id="Record.calc_rmax-297"><a href="#Record.calc_rmax-297"><span class="linenos">297</span></a>                <span class="c1"># append to frmax</span>
</span><span id="Record.calc_rmax-298"><a href="#Record.calc_rmax-298"><span class="linenos">298</span></a>                <span class="n">frmax_fv</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">rmax_fv_theta</span><span class="p">)</span>
</span><span id="Record.calc_rmax-299"><a href="#Record.calc_rmax-299"><span class="linenos">299</span></a>                <span class="n">frmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">frmax</span><span class="p">,</span> <span class="n">frmax_fv</span><span class="p">)</span>
</span><span id="Record.calc_rmax-300"><a href="#Record.calc_rmax-300"><span class="linenos">300</span></a>            
</span><span id="Record.calc_rmax-301"><a href="#Record.calc_rmax-301"><span class="linenos">301</span></a>            <span class="c1"># Save to Record dictionary</span>
</span><span id="Record.calc_rmax-302"><a href="#Record.calc_rmax-302"><span class="linenos">302</span></a>            <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;frmax&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">frmax</span>  
</span><span id="Record.calc_rmax-303"><a href="#Record.calc_rmax-303"><span class="linenos">303</span></a>            <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;rmax_method&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rmax_method</span>
</span><span id="Record.calc_rmax-304"><a href="#Record.calc_rmax-304"><span class="linenos">304</span></a>        
</span><span id="Record.calc_rmax-305"><a href="#Record.calc_rmax-305"><span class="linenos">305</span></a>        <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>        
</span></pre></div>


            <div class="docstring"><p>Calculate Radius of maximum wind based on a given method on the selected
radial informations.</p>

<p>methods: list, list of methods to try one after another
use_rmax_info: bool, existing rmax to be used directly or not
vlimit: list of maximum limit of v for method to be used, 
        last one must be np.inf, vlimit is right open )
kw_atmos: dict, atmospheric information, generally needed for H80 model
kw_h80: dict, solver options for H80 model
kw_e11: dict, solver options for E11 model</p>

<p>Following methods are implemented - 
    'E11' : Emanuel 2011 model as described in Lin and Chavas 2012
    'H80' : Holland 1980 model based on radial info
    'S02' : Silva et al. 2002 based on regression of central pressure
            rmax = 0.4785 * Pc (mb) - 413 (km)
    'W04' : Willoughby and Rahn (2004) regression of Vmax
            rmax = 51.6<em>exp(-0.0223</em>Vmax + 0.0281*lat) (km)</p>

<p>Models to be implemented in the future - 
    'H80c' : Holland 1980c (f related values are removed)
    'S92' : Slosh model, by jeleniaski et al . 1992
    'E04' : Emanuel 2004 model
    'M16' : Murty et al 2016 model
    'W06' : Willoughby et al. 2006 model</p>
</div>


                            </div>
                            <div id="Record.calculate_wind" class="classattr">
                                        <input id="Record.calculate_wind-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">calculate_wind</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">at</span>,</span><span class="param">	<span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;E11&#39;</span><span class="p">,</span> <span class="s1">&#39;H80&#39;</span><span class="p">]</span>,</span><span class="param">	<span class="n">rmax_frac</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="n">inf</span><span class="p">]</span>,</span><span class="param">	<span class="n">rmax_select</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span>,</span><span class="param">	<span class="n">kw_corr</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;fraction&#39;</span><span class="p">:</span> <span class="mf">0.56</span><span class="p">,</span> <span class="s1">&#39;angle&#39;</span><span class="p">:</span> <span class="mf">19.2</span><span class="p">,</span> <span class="s1">&#39;swrf&#39;</span><span class="p">:</span> <span class="mf">0.9</span><span class="p">,</span> <span class="s1">&#39;tfac&#39;</span><span class="p">:</span> <span class="mf">0.88</span><span class="p">}</span>,</span><span class="param">	<span class="n">kw_atmos</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;pn&#39;</span><span class="p">:</span> <span class="mi">101325</span><span class="p">,</span> <span class="s1">&#39;rhoair&#39;</span><span class="p">:</span> <span class="mf">1.15</span><span class="p">}</span>,</span><span class="param">	<span class="n">kw_h80</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;bmax&#39;</span><span class="p">:</span> <span class="mf">2.5</span><span class="p">,</span> <span class="s1">&#39;bmin&#39;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">}</span>,</span><span class="param">	<span class="n">kw_e04</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="mf">0.25</span><span class="p">,</span> <span class="s1">&#39;m&#39;</span><span class="p">:</span> <span class="mf">1.6</span><span class="p">,</span> <span class="s1">&#39;n&#39;</span><span class="p">:</span> <span class="mf">0.9</span><span class="p">,</span> <span class="s1">&#39;R0&#39;</span><span class="p">:</span> <span class="mi">420000</span><span class="p">}</span>,</span><span class="param">	<span class="n">kw_w06</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;n&#39;</span><span class="p">:</span> <span class="mf">0.79</span><span class="p">,</span> <span class="s1">&#39;X&#39;</span><span class="p">:</span> <span class="mi">243000</span><span class="p">}</span>,</span><span class="param">	<span class="n">kw_m16</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;n&#39;</span><span class="p">:</span> <span class="mf">0.6</span><span class="p">}</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Record.calculate_wind-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Record.calculate_wind"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Record.calculate_wind-307"><a href="#Record.calculate_wind-307"><span class="linenos">307</span></a>    <span class="k">def</span> <span class="nf">calculate_wind</span><span class="p">(</span>
</span><span id="Record.calculate_wind-308"><a href="#Record.calculate_wind-308"><span class="linenos">308</span></a>        <span class="bp">self</span><span class="p">,</span> 
</span><span id="Record.calculate_wind-309"><a href="#Record.calculate_wind-309"><span class="linenos">309</span></a>        <span class="n">at</span><span class="p">,</span> 
</span><span id="Record.calculate_wind-310"><a href="#Record.calculate_wind-310"><span class="linenos">310</span></a>        <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;E11&#39;</span><span class="p">,</span><span class="s1">&#39;H80&#39;</span><span class="p">],</span>
</span><span id="Record.calculate_wind-311"><a href="#Record.calculate_wind-311"><span class="linenos">311</span></a>        <span class="n">rmax_frac</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">],</span>
</span><span id="Record.calculate_wind-312"><a href="#Record.calculate_wind-312"><span class="linenos">312</span></a>        <span class="n">rmax_select</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span>
</span><span id="Record.calculate_wind-313"><a href="#Record.calculate_wind-313"><span class="linenos">313</span></a>        <span class="n">kw_corr</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;fraction&#39;</span><span class="p">:</span><span class="mf">0.56</span><span class="p">,</span> <span class="s1">&#39;angle&#39;</span><span class="p">:</span><span class="mf">19.2</span><span class="p">,</span> <span class="s1">&#39;swrf&#39;</span><span class="p">:</span><span class="mf">0.9</span><span class="p">,</span> <span class="s1">&#39;tfac&#39;</span><span class="p">:</span><span class="mf">0.88</span><span class="p">},</span>
</span><span id="Record.calculate_wind-314"><a href="#Record.calculate_wind-314"><span class="linenos">314</span></a>        <span class="n">kw_atmos</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;pn&#39;</span><span class="p">:</span><span class="mi">101325</span><span class="p">,</span> <span class="s1">&#39;rhoair&#39;</span><span class="p">:</span><span class="mf">1.15</span><span class="p">},</span>
</span><span id="Record.calculate_wind-315"><a href="#Record.calculate_wind-315"><span class="linenos">315</span></a>        <span class="n">kw_h80</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;bmax&#39;</span><span class="p">:</span><span class="mf">2.5</span><span class="p">,</span> <span class="s1">&#39;bmin&#39;</span><span class="p">:</span><span class="mf">0.5</span><span class="p">},</span>
</span><span id="Record.calculate_wind-316"><a href="#Record.calculate_wind-316"><span class="linenos">316</span></a>        <span class="n">kw_e04</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;b&#39;</span><span class="p">:</span><span class="mf">0.25</span><span class="p">,</span> <span class="s1">&#39;m&#39;</span><span class="p">:</span><span class="mf">1.6</span><span class="p">,</span> <span class="s1">&#39;n&#39;</span><span class="p">:</span><span class="mf">0.9</span><span class="p">,</span> <span class="s1">&#39;R0&#39;</span><span class="p">:</span><span class="mi">420000</span><span class="p">},</span>
</span><span id="Record.calculate_wind-317"><a href="#Record.calculate_wind-317"><span class="linenos">317</span></a>        <span class="n">kw_w06</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;n&#39;</span><span class="p">:</span><span class="mf">0.79</span><span class="p">,</span> <span class="s1">&#39;X&#39;</span><span class="p">:</span><span class="mi">243000</span><span class="p">},</span>
</span><span id="Record.calculate_wind-318"><a href="#Record.calculate_wind-318"><span class="linenos">318</span></a>        <span class="n">kw_m16</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;n&#39;</span><span class="p">:</span><span class="mf">0.6</span><span class="p">}</span>
</span><span id="Record.calculate_wind-319"><a href="#Record.calculate_wind-319"><span class="linenos">319</span></a>    <span class="p">):</span>
</span><span id="Record.calculate_wind-320"><a href="#Record.calculate_wind-320"><span class="linenos">320</span></a><span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="Record.calculate_wind-321"><a href="#Record.calculate_wind-321"><span class="linenos">321</span></a><span class="sd">        Calculate wind field using given method till a fractional distance of </span>
</span><span id="Record.calculate_wind-322"><a href="#Record.calculate_wind-322"><span class="linenos">322</span></a><span class="sd">        rmax.</span>
</span><span id="Record.calculate_wind-323"><a href="#Record.calculate_wind-323"><span class="linenos">323</span></a>
</span><span id="Record.calculate_wind-324"><a href="#Record.calculate_wind-324"><span class="linenos">324</span></a><span class="sd">        at: (r, theta) location where the wind is calculated,</span>
</span><span id="Record.calculate_wind-325"><a href="#Record.calculate_wind-325"><span class="linenos">325</span></a><span class="sd">            r, float, distance in m </span>
</span><span id="Record.calculate_wind-326"><a href="#Record.calculate_wind-326"><span class="linenos">326</span></a><span class="sd">            theta, float, is -2*np.pi, 2*np.pi radians</span>
</span><span id="Record.calculate_wind-327"><a href="#Record.calculate_wind-327"><span class="linenos">327</span></a><span class="sd">            Essentially theta is expected to be output from np.arctan2(y,x)</span>
</span><span id="Record.calculate_wind-328"><a href="#Record.calculate_wind-328"><span class="linenos">328</span></a><span class="sd">            Theis counter-clockwise from x-axis angle is converted to a clockwise</span>
</span><span id="Record.calculate_wind-329"><a href="#Record.calculate_wind-329"><span class="linenos">329</span></a><span class="sd">            angle from y axis to match the interpolation grid of the storm paramters. </span>
</span><span id="Record.calculate_wind-330"><a href="#Record.calculate_wind-330"><span class="linenos">330</span></a><span class="sd">        methods: array, list of methods to be used. Currently implemented methods</span>
</span><span id="Record.calculate_wind-331"><a href="#Record.calculate_wind-331"><span class="linenos">331</span></a><span class="sd">                are - H80, H80c, J92, W06, E04, E11, M16</span>
</span><span id="Record.calculate_wind-332"><a href="#Record.calculate_wind-332"><span class="linenos">332</span></a><span class="sd">        rmax_frac: array, till which fraction of rmax, the method to be used,</span>
</span><span id="Record.calculate_wind-333"><a href="#Record.calculate_wind-333"><span class="linenos">333</span></a><span class="sd">                np.inf for whole</span>
</span><span id="Record.calculate_wind-334"><a href="#Record.calculate_wind-334"><span class="linenos">334</span></a><span class="sd">        rmax_select: which rmax to select, int, str</span>
</span><span id="Record.calculate_wind-335"><a href="#Record.calculate_wind-335"><span class="linenos">335</span></a><span class="sd">                    &#39;mean&#39;: mean value of the rmax</span>
</span><span id="Record.calculate_wind-336"><a href="#Record.calculate_wind-336"><span class="linenos">336</span></a><span class="sd">                    &#39;nearest&#39;: rmax calculated from nearest frmax</span>
</span><span id="Record.calculate_wind-337"><a href="#Record.calculate_wind-337"><span class="linenos">337</span></a><span class="sd">                    &#39;linear&#39;: rmax calculated from a linear interpolation</span>
</span><span id="Record.calculate_wind-338"><a href="#Record.calculate_wind-338"><span class="linenos">338</span></a><span class="sd">                    int: number corresponding to selected rmax &gt;1</span>
</span><span id="Record.calculate_wind-339"><a href="#Record.calculate_wind-339"><span class="linenos">339</span></a><span class="sd">        kw_corr: corrections applied for translation and surface wind reduction</span>
</span><span id="Record.calculate_wind-340"><a href="#Record.calculate_wind-340"><span class="linenos">340</span></a><span class="sd">                fraction: fraction of translation wind, 0.56 default</span>
</span><span id="Record.calculate_wind-341"><a href="#Record.calculate_wind-341"><span class="linenos">341</span></a><span class="sd">                angle: angle of ratation, 19.2 degree default</span>
</span><span id="Record.calculate_wind-342"><a href="#Record.calculate_wind-342"><span class="linenos">342</span></a><span class="sd">                swrf: surface wind reduction factor, 0.9 default</span>
</span><span id="Record.calculate_wind-343"><a href="#Record.calculate_wind-343"><span class="linenos">343</span></a><span class="sd">                tfac: convertion factor to from x minute to 10 minute wind</span>
</span><span id="Record.calculate_wind-344"><a href="#Record.calculate_wind-344"><span class="linenos">344</span></a><span class="sd">                    0.88 for conversion from 1minute to 10minute</span>
</span><span id="Record.calculate_wind-345"><a href="#Record.calculate_wind-345"><span class="linenos">345</span></a><span class="sd">        kw_atmos: constant atmospheric values</span>
</span><span id="Record.calculate_wind-346"><a href="#Record.calculate_wind-346"><span class="linenos">346</span></a><span class="sd">            pn: nominal or environmental pressure, default 101325 Pa</span>
</span><span id="Record.calculate_wind-347"><a href="#Record.calculate_wind-347"><span class="linenos">347</span></a><span class="sd">            rhoair: air density, default 1.15 km/m^3</span>
</span><span id="Record.calculate_wind-348"><a href="#Record.calculate_wind-348"><span class="linenos">348</span></a><span class="sd">        kw_h80: extra argument for H80 model</span>
</span><span id="Record.calculate_wind-349"><a href="#Record.calculate_wind-349"><span class="linenos">349</span></a><span class="sd">            bmin: Minimum B value</span>
</span><span id="Record.calculate_wind-350"><a href="#Record.calculate_wind-350"><span class="linenos">350</span></a><span class="sd">            bmax: Maximum B value</span>
</span><span id="Record.calculate_wind-351"><a href="#Record.calculate_wind-351"><span class="linenos">351</span></a><span class="sd">        kw_e04: extra argument for E04 model</span>
</span><span id="Record.calculate_wind-352"><a href="#Record.calculate_wind-352"><span class="linenos">352</span></a><span class="sd">            b: default 0.25</span>
</span><span id="Record.calculate_wind-353"><a href="#Record.calculate_wind-353"><span class="linenos">353</span></a><span class="sd">            m: default 1.6</span>
</span><span id="Record.calculate_wind-354"><a href="#Record.calculate_wind-354"><span class="linenos">354</span></a><span class="sd">            n: default 0.9</span>
</span><span id="Record.calculate_wind-355"><a href="#Record.calculate_wind-355"><span class="linenos">355</span></a><span class="sd">            R0: default 420000m (420km)</span>
</span><span id="Record.calculate_wind-356"><a href="#Record.calculate_wind-356"><span class="linenos">356</span></a><span class="sd">        kw_w06: extra argument for W06 model</span>
</span><span id="Record.calculate_wind-357"><a href="#Record.calculate_wind-357"><span class="linenos">357</span></a><span class="sd">            n: default 0.79</span>
</span><span id="Record.calculate_wind-358"><a href="#Record.calculate_wind-358"><span class="linenos">358</span></a><span class="sd">            X: default 243000m (243km)</span>
</span><span id="Record.calculate_wind-359"><a href="#Record.calculate_wind-359"><span class="linenos">359</span></a><span class="sd">        kw_m16: extra argument for M16 model</span>
</span><span id="Record.calculate_wind-360"><a href="#Record.calculate_wind-360"><span class="linenos">360</span></a><span class="sd">            n: default 0.6</span>
</span><span id="Record.calculate_wind-361"><a href="#Record.calculate_wind-361"><span class="linenos">361</span></a><span class="sd">        &#39;&#39;&#39;</span>
</span><span id="Record.calculate_wind-362"><a href="#Record.calculate_wind-362"><span class="linenos">362</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="Record.calculate_wind-363"><a href="#Record.calculate_wind-363"><span class="linenos">363</span></a>            <span class="n">r</span><span class="p">,</span> <span class="n">theta_input</span> <span class="o">=</span> <span class="n">at</span>
</span><span id="Record.calculate_wind-364"><a href="#Record.calculate_wind-364"><span class="linenos">364</span></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="Record.calculate_wind-365"><a href="#Record.calculate_wind-365"><span class="linenos">365</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;the at must be in (r, theta) as list/array of size 2&#39;</span><span class="p">)</span>
</span><span id="Record.calculate_wind-366"><a href="#Record.calculate_wind-366"><span class="linenos">366</span></a>        
</span><span id="Record.calculate_wind-367"><a href="#Record.calculate_wind-367"><span class="linenos">367</span></a>        <span class="c1"># Convert theta from x-axis counter clock to y-axis clock wise</span>
</span><span id="Record.calculate_wind-368"><a href="#Record.calculate_wind-368"><span class="linenos">368</span></a>        <span class="n">theta</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="o">*</span><span class="n">theta_input</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span>
</span><span id="Record.calculate_wind-369"><a href="#Record.calculate_wind-369"><span class="linenos">369</span></a>
</span><span id="Record.calculate_wind-370"><a href="#Record.calculate_wind-370"><span class="linenos">370</span></a>        <span class="c1"># Theta -180:180 to 0:360 format, clockwise from 0N</span>
</span><span id="Record.calculate_wind-371"><a href="#Record.calculate_wind-371"><span class="linenos">371</span></a>        <span class="k">if</span> <span class="n">theta_input</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Record.calculate_wind-372"><a href="#Record.calculate_wind-372"><span class="linenos">372</span></a>            <span class="n">theta</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">+</span> <span class="n">theta_input</span>
</span><span id="Record.calculate_wind-373"><a href="#Record.calculate_wind-373"><span class="linenos">373</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Record.calculate_wind-374"><a href="#Record.calculate_wind-374"><span class="linenos">374</span></a>            <span class="n">theta</span> <span class="o">=</span> <span class="n">theta_input</span>
</span><span id="Record.calculate_wind-375"><a href="#Record.calculate_wind-375"><span class="linenos">375</span></a>
</span><span id="Record.calculate_wind-376"><a href="#Record.calculate_wind-376"><span class="linenos">376</span></a>        <span class="n">calc_vcirc</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="Record.calculate_wind-377"><a href="#Record.calculate_wind-377"><span class="linenos">377</span></a>            <span class="s1">&#39;H80&#39;</span><span class="p">:</span><span class="n">calc_vcirc_h80</span><span class="p">,</span>
</span><span id="Record.calculate_wind-378"><a href="#Record.calculate_wind-378"><span class="linenos">378</span></a>            <span class="s1">&#39;H80c&#39;</span><span class="p">:</span><span class="n">calc_vcirc_h80c</span><span class="p">,</span>
</span><span id="Record.calculate_wind-379"><a href="#Record.calculate_wind-379"><span class="linenos">379</span></a>            <span class="s1">&#39;J92&#39;</span><span class="p">:</span><span class="n">calc_vcirc_j92</span><span class="p">,</span>
</span><span id="Record.calculate_wind-380"><a href="#Record.calculate_wind-380"><span class="linenos">380</span></a>            <span class="s1">&#39;W06&#39;</span><span class="p">:</span><span class="n">calc_vcirc_w06</span><span class="p">,</span>
</span><span id="Record.calculate_wind-381"><a href="#Record.calculate_wind-381"><span class="linenos">381</span></a>            <span class="s1">&#39;E04&#39;</span><span class="p">:</span><span class="n">calc_vcirc_e04</span><span class="p">,</span>
</span><span id="Record.calculate_wind-382"><a href="#Record.calculate_wind-382"><span class="linenos">382</span></a>            <span class="s1">&#39;E11&#39;</span><span class="p">:</span><span class="n">calc_vcirc_e11</span><span class="p">,</span>
</span><span id="Record.calculate_wind-383"><a href="#Record.calculate_wind-383"><span class="linenos">383</span></a>            <span class="s1">&#39;M16&#39;</span><span class="p">:</span><span class="n">calc_vcirc_m16</span>
</span><span id="Record.calculate_wind-384"><a href="#Record.calculate_wind-384"><span class="linenos">384</span></a>        <span class="p">}</span>
</span><span id="Record.calculate_wind-385"><a href="#Record.calculate_wind-385"><span class="linenos">385</span></a>
</span><span id="Record.calculate_wind-386"><a href="#Record.calculate_wind-386"><span class="linenos">386</span></a>        <span class="c1"># Calculate vmax for further calculation</span>
</span><span id="Record.calculate_wind-387"><a href="#Record.calculate_wind-387"><span class="linenos">387</span></a>        <span class="n">vmax</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;fvmax&#39;</span><span class="p">](</span><span class="n">theta</span><span class="p">)</span>
</span><span id="Record.calculate_wind-388"><a href="#Record.calculate_wind-388"><span class="linenos">388</span></a>
</span><span id="Record.calculate_wind-389"><a href="#Record.calculate_wind-389"><span class="linenos">389</span></a>        <span class="c1"># Find appropriate rmax function to be used</span>
</span><span id="Record.calculate_wind-390"><a href="#Record.calculate_wind-390"><span class="linenos">390</span></a>        <span class="c1"># and calculate rmax</span>
</span><span id="Record.calculate_wind-391"><a href="#Record.calculate_wind-391"><span class="linenos">391</span></a>        <span class="n">rmax_select_methods_available</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;nearest&#39;</span><span class="p">,</span> <span class="s1">&#39;linear&#39;</span><span class="p">]</span>
</span><span id="Record.calculate_wind-392"><a href="#Record.calculate_wind-392"><span class="linenos">392</span></a>
</span><span id="Record.calculate_wind-393"><a href="#Record.calculate_wind-393"><span class="linenos">393</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rmax_select</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="Record.calculate_wind-394"><a href="#Record.calculate_wind-394"><span class="linenos">394</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="Record.calculate_wind-395"><a href="#Record.calculate_wind-395"><span class="linenos">395</span></a>                <span class="k">assert</span> <span class="n">rmax_select</span> <span class="ow">in</span> <span class="n">rmax_select_methods_available</span>
</span><span id="Record.calculate_wind-396"><a href="#Record.calculate_wind-396"><span class="linenos">396</span></a>
</span><span id="Record.calculate_wind-397"><a href="#Record.calculate_wind-397"><span class="linenos">397</span></a>                <span class="k">if</span> <span class="n">rmax_select</span><span class="o">==</span><span class="s1">&#39;mean&#39;</span><span class="p">:</span>
</span><span id="Record.calculate_wind-398"><a href="#Record.calculate_wind-398"><span class="linenos">398</span></a>                    <span class="n">rmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">([</span><span class="n">f</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;frmax&#39;</span><span class="p">])])</span>
</span><span id="Record.calculate_wind-399"><a href="#Record.calculate_wind-399"><span class="linenos">399</span></a>                
</span><span id="Record.calculate_wind-400"><a href="#Record.calculate_wind-400"><span class="linenos">400</span></a>                <span class="k">if</span> <span class="n">rmax_select</span><span class="o">==</span><span class="s1">&#39;nearest&#39;</span><span class="p">:</span>
</span><span id="Record.calculate_wind-401"><a href="#Record.calculate_wind-401"><span class="linenos">401</span></a>                    <span class="k">try</span><span class="p">:</span>
</span><span id="Record.calculate_wind-402"><a href="#Record.calculate_wind-402"><span class="linenos">402</span></a>                        <span class="n">radinfo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">radi</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="k">for</span> <span class="n">radi</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;fradinfo&#39;</span><span class="p">]])</span>
</span><span id="Record.calculate_wind-403"><a href="#Record.calculate_wind-403"><span class="linenos">403</span></a>                        <span class="n">radnn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">radinfo</span><span class="o">-</span><span class="n">r</span><span class="p">))</span>
</span><span id="Record.calculate_wind-404"><a href="#Record.calculate_wind-404"><span class="linenos">404</span></a>                        <span class="n">rmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">f</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;frmax&#39;</span><span class="p">])])[</span><span class="n">radnn</span><span class="p">]</span>
</span><span id="Record.calculate_wind-405"><a href="#Record.calculate_wind-405"><span class="linenos">405</span></a>                    <span class="k">except</span><span class="p">:</span>
</span><span id="Record.calculate_wind-406"><a href="#Record.calculate_wind-406"><span class="linenos">406</span></a>                        <span class="n">rmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;frmax&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">](</span><span class="n">theta</span><span class="p">)</span>
</span><span id="Record.calculate_wind-407"><a href="#Record.calculate_wind-407"><span class="linenos">407</span></a>                        <span class="k">raise</span> <span class="ne">Warning</span><span class="p">(</span><span class="s1">&#39;nearest not possible, first rmax selected&#39;</span><span class="p">)</span>
</span><span id="Record.calculate_wind-408"><a href="#Record.calculate_wind-408"><span class="linenos">408</span></a>
</span><span id="Record.calculate_wind-409"><a href="#Record.calculate_wind-409"><span class="linenos">409</span></a>                <span class="k">if</span> <span class="n">rmax_select</span><span class="o">==</span><span class="s1">&#39;linear&#39;</span><span class="p">:</span>
</span><span id="Record.calculate_wind-410"><a href="#Record.calculate_wind-410"><span class="linenos">410</span></a>                    <span class="k">try</span><span class="p">:</span>
</span><span id="Record.calculate_wind-411"><a href="#Record.calculate_wind-411"><span class="linenos">411</span></a>                        <span class="c1"># x field from -inf to +inf</span>
</span><span id="Record.calculate_wind-412"><a href="#Record.calculate_wind-412"><span class="linenos">412</span></a>                        <span class="n">radinfo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">radi</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="k">for</span> <span class="n">radi</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;fradinfo&#39;</span><span class="p">]])</span>
</span><span id="Record.calculate_wind-413"><a href="#Record.calculate_wind-413"><span class="linenos">413</span></a>                        <span class="n">radinfo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">radinfo</span><span class="p">)</span>
</span><span id="Record.calculate_wind-414"><a href="#Record.calculate_wind-414"><span class="linenos">414</span></a>                        <span class="n">radinfo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">radinfo</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
</span><span id="Record.calculate_wind-415"><a href="#Record.calculate_wind-415"><span class="linenos">415</span></a>                        <span class="c1"># y field </span>
</span><span id="Record.calculate_wind-416"><a href="#Record.calculate_wind-416"><span class="linenos">416</span></a>                        <span class="n">rmaxinfo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">f</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;frmax&#39;</span><span class="p">])])</span>
</span><span id="Record.calculate_wind-417"><a href="#Record.calculate_wind-417"><span class="linenos">417</span></a>                        <span class="n">rmaxinfo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rmaxinfo</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">rmaxinfo</span><span class="p">)</span>
</span><span id="Record.calculate_wind-418"><a href="#Record.calculate_wind-418"><span class="linenos">418</span></a>                        <span class="n">rmaxinfo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rmaxinfo</span><span class="p">,</span> <span class="n">rmaxinfo</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</span><span id="Record.calculate_wind-419"><a href="#Record.calculate_wind-419"><span class="linenos">419</span></a>                        <span class="n">int_f</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">radinfo</span><span class="p">,</span> <span class="n">rmaxinfo</span><span class="p">)</span>
</span><span id="Record.calculate_wind-420"><a href="#Record.calculate_wind-420"><span class="linenos">420</span></a>                        <span class="n">rmax</span> <span class="o">=</span> <span class="n">int_f</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
</span><span id="Record.calculate_wind-421"><a href="#Record.calculate_wind-421"><span class="linenos">421</span></a>                    <span class="k">except</span><span class="p">:</span>
</span><span id="Record.calculate_wind-422"><a href="#Record.calculate_wind-422"><span class="linenos">422</span></a>                        <span class="n">rmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;frmax&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">](</span><span class="n">theta</span><span class="p">)</span>
</span><span id="Record.calculate_wind-423"><a href="#Record.calculate_wind-423"><span class="linenos">423</span></a>                        <span class="k">raise</span> <span class="ne">Warning</span><span class="p">(</span><span class="s1">&#39;linear not possible, first rmax selected&#39;</span><span class="p">)</span>
</span><span id="Record.calculate_wind-424"><a href="#Record.calculate_wind-424"><span class="linenos">424</span></a>            <span class="k">except</span><span class="p">:</span>
</span><span id="Record.calculate_wind-425"><a href="#Record.calculate_wind-425"><span class="linenos">425</span></a>                <span class="n">rmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;frmax&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">](</span><span class="n">theta</span><span class="p">)</span>
</span><span id="Record.calculate_wind-426"><a href="#Record.calculate_wind-426"><span class="linenos">426</span></a>                <span class="k">raise</span> <span class="ne">Warning</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Wrong keyword for rmax method. First frmax is used&#39;</span><span class="p">)</span>
</span><span id="Record.calculate_wind-427"><a href="#Record.calculate_wind-427"><span class="linenos">427</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rmax_select</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="Record.calculate_wind-428"><a href="#Record.calculate_wind-428"><span class="linenos">428</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="Record.calculate_wind-429"><a href="#Record.calculate_wind-429"><span class="linenos">429</span></a>                <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">f</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;frmax&#39;</span><span class="p">])])[</span><span class="n">rmax_select</span><span class="p">]</span>
</span><span id="Record.calculate_wind-430"><a href="#Record.calculate_wind-430"><span class="linenos">430</span></a>            <span class="k">except</span><span class="p">:</span>
</span><span id="Record.calculate_wind-431"><a href="#Record.calculate_wind-431"><span class="linenos">431</span></a>                <span class="n">rmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;frmax&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">](</span><span class="n">theta</span><span class="p">)</span>
</span><span id="Record.calculate_wind-432"><a href="#Record.calculate_wind-432"><span class="linenos">432</span></a>                <span class="k">raise</span> <span class="ne">Warning</span><span class="p">(</span><span class="s1">&#39;Wrong rmax index. First frmax is used&#39;</span><span class="p">)</span>
</span><span id="Record.calculate_wind-433"><a href="#Record.calculate_wind-433"><span class="linenos">433</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Record.calculate_wind-434"><a href="#Record.calculate_wind-434"><span class="linenos">434</span></a>            <span class="n">rmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;frmax&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">](</span><span class="n">theta</span><span class="p">)</span>
</span><span id="Record.calculate_wind-435"><a href="#Record.calculate_wind-435"><span class="linenos">435</span></a>            <span class="k">raise</span> <span class="ne">Warning</span><span class="p">(</span><span class="s1">&#39;Wrong rmax selection keyword/index. First frmax is used&#39;</span><span class="p">)</span>
</span><span id="Record.calculate_wind-436"><a href="#Record.calculate_wind-436"><span class="linenos">436</span></a>
</span><span id="Record.calculate_wind-437"><a href="#Record.calculate_wind-437"><span class="linenos">437</span></a>        <span class="c1"># Now check methods and rmax_frac and apply method as required</span>
</span><span id="Record.calculate_wind-438"><a href="#Record.calculate_wind-438"><span class="linenos">438</span></a>        <span class="c1"># Avoid wrong input of rmax_frac</span>
</span><span id="Record.calculate_wind-439"><a href="#Record.calculate_wind-439"><span class="linenos">439</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="Record.calculate_wind-440"><a href="#Record.calculate_wind-440"><span class="linenos">440</span></a>            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">rmax_frac</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">methods</span><span class="p">)</span>
</span><span id="Record.calculate_wind-441"><a href="#Record.calculate_wind-441"><span class="linenos">441</span></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="Record.calculate_wind-442"><a href="#Record.calculate_wind-442"><span class="linenos">442</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;rmax_frac must corresponds to each listed method&#39;</span><span class="p">)</span>
</span><span id="Record.calculate_wind-443"><a href="#Record.calculate_wind-443"><span class="linenos">443</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Record.calculate_wind-444"><a href="#Record.calculate_wind-444"><span class="linenos">444</span></a>            <span class="n">rmax_frac</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">rmax_frac</span><span class="p">)</span>
</span><span id="Record.calculate_wind-445"><a href="#Record.calculate_wind-445"><span class="linenos">445</span></a>        
</span><span id="Record.calculate_wind-446"><a href="#Record.calculate_wind-446"><span class="linenos">446</span></a>        <span class="n">rlim_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">rmax_frac</span><span class="p">)[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">rmax</span> <span class="c1"># Starts from 0</span>
</span><span id="Record.calculate_wind-447"><a href="#Record.calculate_wind-447"><span class="linenos">447</span></a>        <span class="n">rlim_max</span> <span class="o">=</span> <span class="n">rmax_frac</span><span class="o">*</span><span class="n">rmax</span>
</span><span id="Record.calculate_wind-448"><a href="#Record.calculate_wind-448"><span class="linenos">448</span></a>
</span><span id="Record.calculate_wind-449"><a href="#Record.calculate_wind-449"><span class="linenos">449</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">method</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">methods</span><span class="p">):</span>
</span><span id="Record.calculate_wind-450"><a href="#Record.calculate_wind-450"><span class="linenos">450</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="Record.calculate_wind-451"><a href="#Record.calculate_wind-451"><span class="linenos">451</span></a>                <span class="k">assert</span> <span class="n">r</span> <span class="o">&gt;=</span> <span class="n">rlim_min</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="Record.calculate_wind-452"><a href="#Record.calculate_wind-452"><span class="linenos">452</span></a>                <span class="k">assert</span> <span class="n">r</span> <span class="o">&lt;</span> <span class="n">rlim_max</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="Record.calculate_wind-453"><a href="#Record.calculate_wind-453"><span class="linenos">453</span></a>
</span><span id="Record.calculate_wind-454"><a href="#Record.calculate_wind-454"><span class="linenos">454</span></a>                <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;H80&#39;</span><span class="p">:</span>
</span><span id="Record.calculate_wind-455"><a href="#Record.calculate_wind-455"><span class="linenos">455</span></a>                    <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="Record.calculate_wind-456"><a href="#Record.calculate_wind-456"><span class="linenos">456</span></a>                        <span class="s1">&#39;vmax&#39;</span><span class="p">:</span><span class="n">vmax</span><span class="p">,</span> 
</span><span id="Record.calculate_wind-457"><a href="#Record.calculate_wind-457"><span class="linenos">457</span></a>                        <span class="s1">&#39;rmax&#39;</span><span class="p">:</span><span class="n">rmax</span><span class="p">,</span>
</span><span id="Record.calculate_wind-458"><a href="#Record.calculate_wind-458"><span class="linenos">458</span></a>                        <span class="s1">&#39;pc&#39;</span><span class="p">:</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;mslp&#39;</span><span class="p">],</span>
</span><span id="Record.calculate_wind-459"><a href="#Record.calculate_wind-459"><span class="linenos">459</span></a>                        <span class="s1">&#39;f&#39;</span><span class="p">:</span><span class="n">coriolis</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">]),</span>
</span><span id="Record.calculate_wind-460"><a href="#Record.calculate_wind-460"><span class="linenos">460</span></a>                        <span class="s1">&#39;pn&#39;</span><span class="p">:</span><span class="n">kw_atmos</span><span class="p">[</span><span class="s1">&#39;pn&#39;</span><span class="p">],</span>
</span><span id="Record.calculate_wind-461"><a href="#Record.calculate_wind-461"><span class="linenos">461</span></a>                        <span class="s1">&#39;rhoair&#39;</span><span class="p">:</span><span class="n">kw_atmos</span><span class="p">[</span><span class="s1">&#39;rhoair&#39;</span><span class="p">],</span>
</span><span id="Record.calculate_wind-462"><a href="#Record.calculate_wind-462"><span class="linenos">462</span></a>                        <span class="s1">&#39;bmax&#39;</span><span class="p">:</span><span class="n">kw_h80</span><span class="p">[</span><span class="s1">&#39;bmax&#39;</span><span class="p">],</span>
</span><span id="Record.calculate_wind-463"><a href="#Record.calculate_wind-463"><span class="linenos">463</span></a>                        <span class="s1">&#39;bmin&#39;</span><span class="p">:</span><span class="n">kw_h80</span><span class="p">[</span><span class="s1">&#39;bmin&#39;</span><span class="p">]</span>
</span><span id="Record.calculate_wind-464"><a href="#Record.calculate_wind-464"><span class="linenos">464</span></a>                    <span class="p">}</span>
</span><span id="Record.calculate_wind-465"><a href="#Record.calculate_wind-465"><span class="linenos">465</span></a>                    <span class="n">B</span> <span class="o">=</span> <span class="n">calc_holland_B_full</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="Record.calculate_wind-466"><a href="#Record.calculate_wind-466"><span class="linenos">466</span></a>                    <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="Record.calculate_wind-467"><a href="#Record.calculate_wind-467"><span class="linenos">467</span></a>                        <span class="s1">&#39;r&#39;</span><span class="p">:</span><span class="n">r</span><span class="p">,</span>
</span><span id="Record.calculate_wind-468"><a href="#Record.calculate_wind-468"><span class="linenos">468</span></a>                        <span class="s1">&#39;Rm&#39;</span><span class="p">:</span><span class="n">rmax</span><span class="p">,</span>
</span><span id="Record.calculate_wind-469"><a href="#Record.calculate_wind-469"><span class="linenos">469</span></a>                        <span class="s1">&#39;pc&#39;</span><span class="p">:</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;mslp&#39;</span><span class="p">],</span>
</span><span id="Record.calculate_wind-470"><a href="#Record.calculate_wind-470"><span class="linenos">470</span></a>                        <span class="s1">&#39;B&#39;</span><span class="p">:</span><span class="n">B</span><span class="p">,</span>
</span><span id="Record.calculate_wind-471"><a href="#Record.calculate_wind-471"><span class="linenos">471</span></a>                        <span class="s1">&#39;pn&#39;</span><span class="p">:</span><span class="n">kw_atmos</span><span class="p">[</span><span class="s1">&#39;pn&#39;</span><span class="p">],</span>
</span><span id="Record.calculate_wind-472"><a href="#Record.calculate_wind-472"><span class="linenos">472</span></a>                        <span class="s1">&#39;rhoair&#39;</span><span class="p">:</span><span class="n">kw_atmos</span><span class="p">[</span><span class="s1">&#39;rhoair&#39;</span><span class="p">],</span>
</span><span id="Record.calculate_wind-473"><a href="#Record.calculate_wind-473"><span class="linenos">473</span></a>                        <span class="s1">&#39;f&#39;</span><span class="p">:</span><span class="n">coriolis</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">])</span>
</span><span id="Record.calculate_wind-474"><a href="#Record.calculate_wind-474"><span class="linenos">474</span></a>                    <span class="p">}</span>
</span><span id="Record.calculate_wind-475"><a href="#Record.calculate_wind-475"><span class="linenos">475</span></a>                    <span class="n">vcirc</span> <span class="o">=</span> <span class="n">calc_vcirc</span><span class="p">[</span><span class="n">method</span><span class="p">](</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="Record.calculate_wind-476"><a href="#Record.calculate_wind-476"><span class="linenos">476</span></a>                
</span><span id="Record.calculate_wind-477"><a href="#Record.calculate_wind-477"><span class="linenos">477</span></a>                <span class="k">if</span> <span class="n">method</span><span class="o">==</span><span class="s1">&#39;H80c&#39;</span><span class="p">:</span>
</span><span id="Record.calculate_wind-478"><a href="#Record.calculate_wind-478"><span class="linenos">478</span></a>                    <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="Record.calculate_wind-479"><a href="#Record.calculate_wind-479"><span class="linenos">479</span></a>                        <span class="s1">&#39;vmax&#39;</span><span class="p">:</span><span class="n">vmax</span><span class="p">,</span> 
</span><span id="Record.calculate_wind-480"><a href="#Record.calculate_wind-480"><span class="linenos">480</span></a>                        <span class="s1">&#39;pc&#39;</span><span class="p">:</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;mslp&#39;</span><span class="p">],</span>
</span><span id="Record.calculate_wind-481"><a href="#Record.calculate_wind-481"><span class="linenos">481</span></a>                        <span class="s1">&#39;pn&#39;</span><span class="p">:</span><span class="n">kw_atmos</span><span class="p">[</span><span class="s1">&#39;pn&#39;</span><span class="p">],</span>
</span><span id="Record.calculate_wind-482"><a href="#Record.calculate_wind-482"><span class="linenos">482</span></a>                        <span class="s1">&#39;rhoair&#39;</span><span class="p">:</span><span class="n">kw_atmos</span><span class="p">[</span><span class="s1">&#39;rhoair&#39;</span><span class="p">],</span>
</span><span id="Record.calculate_wind-483"><a href="#Record.calculate_wind-483"><span class="linenos">483</span></a>                        <span class="s1">&#39;bmax&#39;</span><span class="p">:</span><span class="n">kw_h80</span><span class="p">[</span><span class="s1">&#39;bmax&#39;</span><span class="p">],</span>
</span><span id="Record.calculate_wind-484"><a href="#Record.calculate_wind-484"><span class="linenos">484</span></a>                        <span class="s1">&#39;bmin&#39;</span><span class="p">:</span><span class="n">kw_h80</span><span class="p">[</span><span class="s1">&#39;bmin&#39;</span><span class="p">]</span>
</span><span id="Record.calculate_wind-485"><a href="#Record.calculate_wind-485"><span class="linenos">485</span></a>                    <span class="p">}</span>
</span><span id="Record.calculate_wind-486"><a href="#Record.calculate_wind-486"><span class="linenos">486</span></a>                    <span class="n">B</span> <span class="o">=</span> <span class="n">calc_holland_B</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="Record.calculate_wind-487"><a href="#Record.calculate_wind-487"><span class="linenos">487</span></a>                    <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="Record.calculate_wind-488"><a href="#Record.calculate_wind-488"><span class="linenos">488</span></a>                        <span class="s1">&#39;r&#39;</span><span class="p">:</span><span class="n">r</span><span class="p">,</span>
</span><span id="Record.calculate_wind-489"><a href="#Record.calculate_wind-489"><span class="linenos">489</span></a>                        <span class="s1">&#39;Rm&#39;</span><span class="p">:</span><span class="n">rmax</span><span class="p">,</span>
</span><span id="Record.calculate_wind-490"><a href="#Record.calculate_wind-490"><span class="linenos">490</span></a>                        <span class="s1">&#39;pc&#39;</span><span class="p">:</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;mslp&#39;</span><span class="p">],</span>
</span><span id="Record.calculate_wind-491"><a href="#Record.calculate_wind-491"><span class="linenos">491</span></a>                        <span class="s1">&#39;B&#39;</span><span class="p">:</span><span class="n">B</span><span class="p">,</span>
</span><span id="Record.calculate_wind-492"><a href="#Record.calculate_wind-492"><span class="linenos">492</span></a>                        <span class="s1">&#39;pn&#39;</span><span class="p">:</span><span class="n">kw_atmos</span><span class="p">[</span><span class="s1">&#39;pn&#39;</span><span class="p">],</span>
</span><span id="Record.calculate_wind-493"><a href="#Record.calculate_wind-493"><span class="linenos">493</span></a>                        <span class="s1">&#39;rhoair&#39;</span><span class="p">:</span><span class="n">kw_atmos</span><span class="p">[</span><span class="s1">&#39;rhoair&#39;</span><span class="p">]</span>
</span><span id="Record.calculate_wind-494"><a href="#Record.calculate_wind-494"><span class="linenos">494</span></a>                    <span class="p">}</span>
</span><span id="Record.calculate_wind-495"><a href="#Record.calculate_wind-495"><span class="linenos">495</span></a>                    <span class="n">vcirc</span> <span class="o">=</span> <span class="n">calc_vcirc</span><span class="p">[</span><span class="n">method</span><span class="p">](</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="Record.calculate_wind-496"><a href="#Record.calculate_wind-496"><span class="linenos">496</span></a>
</span><span id="Record.calculate_wind-497"><a href="#Record.calculate_wind-497"><span class="linenos">497</span></a>                <span class="k">if</span> <span class="n">method</span><span class="o">==</span><span class="s1">&#39;J92&#39;</span><span class="p">:</span>
</span><span id="Record.calculate_wind-498"><a href="#Record.calculate_wind-498"><span class="linenos">498</span></a>                    <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="Record.calculate_wind-499"><a href="#Record.calculate_wind-499"><span class="linenos">499</span></a>                        <span class="s1">&#39;r&#39;</span><span class="p">:</span> <span class="n">r</span><span class="p">,</span>
</span><span id="Record.calculate_wind-500"><a href="#Record.calculate_wind-500"><span class="linenos">500</span></a>                        <span class="s1">&#39;Rm&#39;</span><span class="p">:</span><span class="n">rmax</span><span class="p">,</span>
</span><span id="Record.calculate_wind-501"><a href="#Record.calculate_wind-501"><span class="linenos">501</span></a>                        <span class="s1">&#39;Vm&#39;</span><span class="p">:</span><span class="n">vmax</span>
</span><span id="Record.calculate_wind-502"><a href="#Record.calculate_wind-502"><span class="linenos">502</span></a>                    <span class="p">}</span>
</span><span id="Record.calculate_wind-503"><a href="#Record.calculate_wind-503"><span class="linenos">503</span></a>                    <span class="n">vcirc</span> <span class="o">=</span> <span class="n">calc_vcirc</span><span class="p">[</span><span class="n">method</span><span class="p">](</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="Record.calculate_wind-504"><a href="#Record.calculate_wind-504"><span class="linenos">504</span></a>
</span><span id="Record.calculate_wind-505"><a href="#Record.calculate_wind-505"><span class="linenos">505</span></a>                <span class="k">if</span> <span class="n">method</span><span class="o">==</span><span class="s1">&#39;W06&#39;</span><span class="p">:</span>
</span><span id="Record.calculate_wind-506"><a href="#Record.calculate_wind-506"><span class="linenos">506</span></a>                    <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="Record.calculate_wind-507"><a href="#Record.calculate_wind-507"><span class="linenos">507</span></a>                        <span class="s1">&#39;r&#39;</span><span class="p">:</span><span class="n">r</span><span class="p">,</span>
</span><span id="Record.calculate_wind-508"><a href="#Record.calculate_wind-508"><span class="linenos">508</span></a>                        <span class="s1">&#39;Rm&#39;</span><span class="p">:</span><span class="n">rmax</span><span class="p">,</span>
</span><span id="Record.calculate_wind-509"><a href="#Record.calculate_wind-509"><span class="linenos">509</span></a>                        <span class="s1">&#39;Vm&#39;</span><span class="p">:</span><span class="n">vmax</span><span class="p">,</span>
</span><span id="Record.calculate_wind-510"><a href="#Record.calculate_wind-510"><span class="linenos">510</span></a>                        <span class="s1">&#39;n&#39;</span><span class="p">:</span><span class="n">kw_w06</span><span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">],</span>
</span><span id="Record.calculate_wind-511"><a href="#Record.calculate_wind-511"><span class="linenos">511</span></a>                        <span class="s1">&#39;X&#39;</span><span class="p">:</span><span class="n">kw_w06</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">]</span>
</span><span id="Record.calculate_wind-512"><a href="#Record.calculate_wind-512"><span class="linenos">512</span></a>                    <span class="p">}</span>
</span><span id="Record.calculate_wind-513"><a href="#Record.calculate_wind-513"><span class="linenos">513</span></a>                    <span class="n">vcirc</span> <span class="o">=</span> <span class="n">calc_vcirc</span><span class="p">[</span><span class="n">method</span><span class="p">](</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="Record.calculate_wind-514"><a href="#Record.calculate_wind-514"><span class="linenos">514</span></a>
</span><span id="Record.calculate_wind-515"><a href="#Record.calculate_wind-515"><span class="linenos">515</span></a>                <span class="k">if</span> <span class="n">method</span><span class="o">==</span><span class="s1">&#39;E04&#39;</span><span class="p">:</span>
</span><span id="Record.calculate_wind-516"><a href="#Record.calculate_wind-516"><span class="linenos">516</span></a>                    <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="Record.calculate_wind-517"><a href="#Record.calculate_wind-517"><span class="linenos">517</span></a>                        <span class="s1">&#39;r&#39;</span><span class="p">:</span><span class="n">r</span><span class="p">,</span>
</span><span id="Record.calculate_wind-518"><a href="#Record.calculate_wind-518"><span class="linenos">518</span></a>                        <span class="s1">&#39;Rm&#39;</span><span class="p">:</span><span class="n">rmax</span><span class="p">,</span>
</span><span id="Record.calculate_wind-519"><a href="#Record.calculate_wind-519"><span class="linenos">519</span></a>                        <span class="s1">&#39;Vm&#39;</span><span class="p">:</span><span class="n">vmax</span><span class="p">,</span>
</span><span id="Record.calculate_wind-520"><a href="#Record.calculate_wind-520"><span class="linenos">520</span></a>                        <span class="s1">&#39;b&#39;</span><span class="p">:</span><span class="n">kw_e04</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">],</span>
</span><span id="Record.calculate_wind-521"><a href="#Record.calculate_wind-521"><span class="linenos">521</span></a>                        <span class="s1">&#39;m&#39;</span><span class="p">:</span><span class="n">kw_e04</span><span class="p">[</span><span class="s1">&#39;m&#39;</span><span class="p">],</span>
</span><span id="Record.calculate_wind-522"><a href="#Record.calculate_wind-522"><span class="linenos">522</span></a>                        <span class="s1">&#39;n&#39;</span><span class="p">:</span><span class="n">kw_e04</span><span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">],</span>
</span><span id="Record.calculate_wind-523"><a href="#Record.calculate_wind-523"><span class="linenos">523</span></a>                        <span class="s1">&#39;R0&#39;</span><span class="p">:</span><span class="n">kw_e04</span><span class="p">[</span><span class="s1">&#39;R0&#39;</span><span class="p">]</span>
</span><span id="Record.calculate_wind-524"><a href="#Record.calculate_wind-524"><span class="linenos">524</span></a>                    <span class="p">}</span>
</span><span id="Record.calculate_wind-525"><a href="#Record.calculate_wind-525"><span class="linenos">525</span></a>                    <span class="n">vcirc</span> <span class="o">=</span> <span class="n">calc_vcirc</span><span class="p">[</span><span class="n">method</span><span class="p">](</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="Record.calculate_wind-526"><a href="#Record.calculate_wind-526"><span class="linenos">526</span></a>                    <span class="k">if</span> <span class="n">vcirc</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Record.calculate_wind-527"><a href="#Record.calculate_wind-527"><span class="linenos">527</span></a>                        <span class="n">vcirc</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Record.calculate_wind-528"><a href="#Record.calculate_wind-528"><span class="linenos">528</span></a>
</span><span id="Record.calculate_wind-529"><a href="#Record.calculate_wind-529"><span class="linenos">529</span></a>                <span class="k">if</span> <span class="n">method</span><span class="o">==</span><span class="s1">&#39;E11&#39;</span><span class="p">:</span>
</span><span id="Record.calculate_wind-530"><a href="#Record.calculate_wind-530"><span class="linenos">530</span></a>                    <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="Record.calculate_wind-531"><a href="#Record.calculate_wind-531"><span class="linenos">531</span></a>                        <span class="s1">&#39;r&#39;</span><span class="p">:</span><span class="n">r</span><span class="p">,</span>
</span><span id="Record.calculate_wind-532"><a href="#Record.calculate_wind-532"><span class="linenos">532</span></a>                        <span class="s1">&#39;Rm&#39;</span><span class="p">:</span><span class="n">rmax</span><span class="p">,</span>
</span><span id="Record.calculate_wind-533"><a href="#Record.calculate_wind-533"><span class="linenos">533</span></a>                        <span class="s1">&#39;Vm&#39;</span><span class="p">:</span><span class="n">vmax</span><span class="p">,</span>
</span><span id="Record.calculate_wind-534"><a href="#Record.calculate_wind-534"><span class="linenos">534</span></a>                        <span class="s1">&#39;f&#39;</span><span class="p">:</span><span class="n">coriolis</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">])</span>
</span><span id="Record.calculate_wind-535"><a href="#Record.calculate_wind-535"><span class="linenos">535</span></a>                    <span class="p">}</span>
</span><span id="Record.calculate_wind-536"><a href="#Record.calculate_wind-536"><span class="linenos">536</span></a>                    <span class="n">vcirc</span> <span class="o">=</span> <span class="n">calc_vcirc</span><span class="p">[</span><span class="n">method</span><span class="p">](</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="Record.calculate_wind-537"><a href="#Record.calculate_wind-537"><span class="linenos">537</span></a>                    <span class="k">if</span> <span class="n">vcirc</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Record.calculate_wind-538"><a href="#Record.calculate_wind-538"><span class="linenos">538</span></a>                        <span class="n">vcirc</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Record.calculate_wind-539"><a href="#Record.calculate_wind-539"><span class="linenos">539</span></a>
</span><span id="Record.calculate_wind-540"><a href="#Record.calculate_wind-540"><span class="linenos">540</span></a>                <span class="k">if</span> <span class="n">method</span><span class="o">==</span><span class="s1">&#39;M16&#39;</span><span class="p">:</span>
</span><span id="Record.calculate_wind-541"><a href="#Record.calculate_wind-541"><span class="linenos">541</span></a>                    <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="Record.calculate_wind-542"><a href="#Record.calculate_wind-542"><span class="linenos">542</span></a>                        <span class="s1">&#39;r&#39;</span><span class="p">:</span><span class="n">r</span><span class="p">,</span>
</span><span id="Record.calculate_wind-543"><a href="#Record.calculate_wind-543"><span class="linenos">543</span></a>                        <span class="s1">&#39;Rm&#39;</span><span class="p">:</span><span class="n">rmax</span><span class="p">,</span>
</span><span id="Record.calculate_wind-544"><a href="#Record.calculate_wind-544"><span class="linenos">544</span></a>                        <span class="s1">&#39;Vm&#39;</span><span class="p">:</span><span class="n">vmax</span><span class="p">,</span>
</span><span id="Record.calculate_wind-545"><a href="#Record.calculate_wind-545"><span class="linenos">545</span></a>                        <span class="s1">&#39;n&#39;</span><span class="p">:</span><span class="n">kw_m16</span><span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">]</span>
</span><span id="Record.calculate_wind-546"><a href="#Record.calculate_wind-546"><span class="linenos">546</span></a>                    <span class="p">}</span>
</span><span id="Record.calculate_wind-547"><a href="#Record.calculate_wind-547"><span class="linenos">547</span></a>                    <span class="n">vcirc</span> <span class="o">=</span> <span class="n">calc_vcirc</span><span class="p">[</span><span class="n">method</span><span class="p">](</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="Record.calculate_wind-548"><a href="#Record.calculate_wind-548"><span class="linenos">548</span></a>                <span class="k">break</span>
</span><span id="Record.calculate_wind-549"><a href="#Record.calculate_wind-549"><span class="linenos">549</span></a>            <span class="k">except</span><span class="p">:</span>
</span><span id="Record.calculate_wind-550"><a href="#Record.calculate_wind-550"><span class="linenos">550</span></a>                <span class="k">continue</span>
</span><span id="Record.calculate_wind-551"><a href="#Record.calculate_wind-551"><span class="linenos">551</span></a>        
</span><span id="Record.calculate_wind-552"><a href="#Record.calculate_wind-552"><span class="linenos">552</span></a>        <span class="c1"># Calculating u,v wind with translation correction</span>
</span><span id="Record.calculate_wind-553"><a href="#Record.calculate_wind-553"><span class="linenos">553</span></a>        <span class="n">vcirc</span> <span class="o">=</span> <span class="n">vcirc</span> <span class="o">*</span> <span class="n">kw_corr</span><span class="p">[</span><span class="s1">&#39;swrf&#39;</span><span class="p">]</span>
</span><span id="Record.calculate_wind-554"><a href="#Record.calculate_wind-554"><span class="linenos">554</span></a>
</span><span id="Record.calculate_wind-555"><a href="#Record.calculate_wind-555"><span class="linenos">555</span></a>        <span class="n">u</span> <span class="o">=</span> <span class="o">-</span><span class="n">vcirc</span><span class="o">*</span><span class="n">r</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta_input</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">([</span><span class="n">r</span><span class="p">,</span> <span class="mf">1e-8</span><span class="p">])</span> <span class="c1"># 1e-8 avoids x/0</span>
</span><span id="Record.calculate_wind-556"><a href="#Record.calculate_wind-556"><span class="linenos">556</span></a>        <span class="n">v</span> <span class="o">=</span> <span class="n">vcirc</span><span class="o">*</span><span class="n">r</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta_input</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">([</span><span class="n">r</span><span class="p">,</span> <span class="mf">1e-8</span><span class="p">])</span>
</span><span id="Record.calculate_wind-557"><a href="#Record.calculate_wind-557"><span class="linenos">557</span></a>
</span><span id="Record.calculate_wind-558"><a href="#Record.calculate_wind-558"><span class="linenos">558</span></a>        <span class="n">utrans</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;ustorm&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">kw_corr</span><span class="p">[</span><span class="s1">&#39;angle&#39;</span><span class="p">]))</span> <span class="o">-</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;vstorm&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">kw_corr</span><span class="p">[</span><span class="s1">&#39;angle&#39;</span><span class="p">]))</span>
</span><span id="Record.calculate_wind-559"><a href="#Record.calculate_wind-559"><span class="linenos">559</span></a>        <span class="n">vtrans</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;ustorm&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">kw_corr</span><span class="p">[</span><span class="s1">&#39;angle&#39;</span><span class="p">]))</span> <span class="o">+</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;vstorm&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">kw_corr</span><span class="p">[</span><span class="s1">&#39;angle&#39;</span><span class="p">]))</span>
</span><span id="Record.calculate_wind-560"><a href="#Record.calculate_wind-560"><span class="linenos">560</span></a>
</span><span id="Record.calculate_wind-561"><a href="#Record.calculate_wind-561"><span class="linenos">561</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="Record.calculate_wind-562"><a href="#Record.calculate_wind-562"><span class="linenos">562</span></a>            <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_not</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">utrans</span><span class="p">)))</span>
</span><span id="Record.calculate_wind-563"><a href="#Record.calculate_wind-563"><span class="linenos">563</span></a>            <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_not</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">vtrans</span><span class="p">)))</span>
</span><span id="Record.calculate_wind-564"><a href="#Record.calculate_wind-564"><span class="linenos">564</span></a>
</span><span id="Record.calculate_wind-565"><a href="#Record.calculate_wind-565"><span class="linenos">565</span></a>            <span class="n">u</span> <span class="o">=</span> <span class="n">u</span> <span class="o">+</span> <span class="n">kw_corr</span><span class="p">[</span><span class="s1">&#39;fraction&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">utrans</span>
</span><span id="Record.calculate_wind-566"><a href="#Record.calculate_wind-566"><span class="linenos">566</span></a>            <span class="n">v</span> <span class="o">=</span> <span class="n">v</span> <span class="o">+</span> <span class="n">kw_corr</span><span class="p">[</span><span class="s1">&#39;fraction&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">vtrans</span>
</span><span id="Record.calculate_wind-567"><a href="#Record.calculate_wind-567"><span class="linenos">567</span></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="Record.calculate_wind-568"><a href="#Record.calculate_wind-568"><span class="linenos">568</span></a>            <span class="n">u</span> <span class="o">=</span> <span class="n">u</span>
</span><span id="Record.calculate_wind-569"><a href="#Record.calculate_wind-569"><span class="linenos">569</span></a>            <span class="n">v</span> <span class="o">=</span> <span class="n">v</span>
</span><span id="Record.calculate_wind-570"><a href="#Record.calculate_wind-570"><span class="linenos">570</span></a>
</span><span id="Record.calculate_wind-571"><a href="#Record.calculate_wind-571"><span class="linenos">571</span></a>        <span class="n">u</span> <span class="o">=</span> <span class="n">u</span> <span class="o">*</span> <span class="n">kw_corr</span><span class="p">[</span><span class="s1">&#39;tfac&#39;</span><span class="p">]</span>
</span><span id="Record.calculate_wind-572"><a href="#Record.calculate_wind-572"><span class="linenos">572</span></a>        <span class="n">v</span> <span class="o">=</span> <span class="n">v</span> <span class="o">*</span> <span class="n">kw_corr</span><span class="p">[</span><span class="s1">&#39;tfac&#39;</span><span class="p">]</span>
</span><span id="Record.calculate_wind-573"><a href="#Record.calculate_wind-573"><span class="linenos">573</span></a>
</span><span id="Record.calculate_wind-574"><a href="#Record.calculate_wind-574"><span class="linenos">574</span></a>        <span class="k">return</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Calculate wind field using given method till a fractional distance of 
rmax.</p>

<p>at: (r, theta) location where the wind is calculated,
    r, float, distance in m 
    theta, float, is -2<em>np.pi, 2</em>np.pi radians
    Essentially theta is expected to be output from np.arctan2(y,x)
    Theis counter-clockwise from x-axis angle is converted to a clockwise
    angle from y axis to match the interpolation grid of the storm paramters. 
methods: array, list of methods to be used. Currently implemented methods
        are - H80, H80c, J92, W06, E04, E11, M16
rmax_frac: array, till which fraction of rmax, the method to be used,
        np.inf for whole
rmax_select: which rmax to select, int, str
            'mean': mean value of the rmax
            'nearest': rmax calculated from nearest frmax
            'linear': rmax calculated from a linear interpolation
            int: number corresponding to selected rmax &gt;1
kw_corr: corrections applied for translation and surface wind reduction
        fraction: fraction of translation wind, 0.56 default
        angle: angle of ratation, 19.2 degree default
        swrf: surface wind reduction factor, 0.9 default
        tfac: convertion factor to from x minute to 10 minute wind
            0.88 for conversion from 1minute to 10minute
kw_atmos: constant atmospheric values
    pn: nominal or environmental pressure, default 101325 Pa
    rhoair: air density, default 1.15 km/m^3
kw_h80: extra argument for H80 model
    bmin: Minimum B value
    bmax: Maximum B value
kw_e04: extra argument for E04 model
    b: default 0.25
    m: default 1.6
    n: default 0.9
    R0: default 420000m (420km)
kw_w06: extra argument for W06 model
    n: default 0.79
    X: default 243000m (243km)
kw_m16: extra argument for M16 model
    n: default 0.6</p>
</div>


                            </div>
                            <div id="Record.calculate_pressure" class="classattr">
                                        <input id="Record.calculate_pressure-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">calculate_pressure</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">at</span>,</span><span class="param">	<span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;H80&#39;</span><span class="p">]</span>,</span><span class="param">	<span class="n">rmax_frac</span><span class="o">=</span><span class="p">[</span><span class="n">inf</span><span class="p">]</span>,</span><span class="param">	<span class="n">rmax_select</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span>,</span><span class="param">	<span class="n">kw_atmos</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;pn&#39;</span><span class="p">:</span> <span class="mi">101325</span><span class="p">,</span> <span class="s1">&#39;rhoair&#39;</span><span class="p">:</span> <span class="mf">1.15</span><span class="p">}</span>,</span><span class="param">	<span class="n">kw_h80</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;bmax&#39;</span><span class="p">:</span> <span class="mf">2.5</span><span class="p">,</span> <span class="s1">&#39;bmin&#39;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">}</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Record.calculate_pressure-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Record.calculate_pressure"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Record.calculate_pressure-576"><a href="#Record.calculate_pressure-576"><span class="linenos">576</span></a>    <span class="k">def</span> <span class="nf">calculate_pressure</span><span class="p">(</span>
</span><span id="Record.calculate_pressure-577"><a href="#Record.calculate_pressure-577"><span class="linenos">577</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Record.calculate_pressure-578"><a href="#Record.calculate_pressure-578"><span class="linenos">578</span></a>        <span class="n">at</span><span class="p">,</span>
</span><span id="Record.calculate_pressure-579"><a href="#Record.calculate_pressure-579"><span class="linenos">579</span></a>        <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;H80&#39;</span><span class="p">],</span>
</span><span id="Record.calculate_pressure-580"><a href="#Record.calculate_pressure-580"><span class="linenos">580</span></a>        <span class="n">rmax_frac</span><span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">],</span>
</span><span id="Record.calculate_pressure-581"><a href="#Record.calculate_pressure-581"><span class="linenos">581</span></a>        <span class="n">rmax_select</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span>
</span><span id="Record.calculate_pressure-582"><a href="#Record.calculate_pressure-582"><span class="linenos">582</span></a>        <span class="n">kw_atmos</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;pn&#39;</span><span class="p">:</span><span class="mi">101325</span><span class="p">,</span> <span class="s1">&#39;rhoair&#39;</span><span class="p">:</span><span class="mf">1.15</span><span class="p">},</span>
</span><span id="Record.calculate_pressure-583"><a href="#Record.calculate_pressure-583"><span class="linenos">583</span></a>        <span class="n">kw_h80</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;bmax&#39;</span><span class="p">:</span><span class="mf">2.5</span><span class="p">,</span> <span class="s1">&#39;bmin&#39;</span><span class="p">:</span><span class="mf">0.5</span><span class="p">}</span>
</span><span id="Record.calculate_pressure-584"><a href="#Record.calculate_pressure-584"><span class="linenos">584</span></a>    <span class="p">):</span>
</span><span id="Record.calculate_pressure-585"><a href="#Record.calculate_pressure-585"><span class="linenos">585</span></a><span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="Record.calculate_pressure-586"><a href="#Record.calculate_pressure-586"><span class="linenos">586</span></a><span class="sd">        Calculate pressure field using given method till a fractional distance of </span>
</span><span id="Record.calculate_pressure-587"><a href="#Record.calculate_pressure-587"><span class="linenos">587</span></a><span class="sd">        rmax.</span>
</span><span id="Record.calculate_pressure-588"><a href="#Record.calculate_pressure-588"><span class="linenos">588</span></a>
</span><span id="Record.calculate_pressure-589"><a href="#Record.calculate_pressure-589"><span class="linenos">589</span></a><span class="sd">        at: (r, theta) location where the wind is calculated,</span>
</span><span id="Record.calculate_pressure-590"><a href="#Record.calculate_pressure-590"><span class="linenos">590</span></a><span class="sd">            r, float, distance in m </span>
</span><span id="Record.calculate_pressure-591"><a href="#Record.calculate_pressure-591"><span class="linenos">591</span></a><span class="sd">            theta, float, is -2*np.pi, 2*np.pi radians</span>
</span><span id="Record.calculate_pressure-592"><a href="#Record.calculate_pressure-592"><span class="linenos">592</span></a><span class="sd">            Essentially theta is expected to be output from np.arctan2(y,x)</span>
</span><span id="Record.calculate_pressure-593"><a href="#Record.calculate_pressure-593"><span class="linenos">593</span></a><span class="sd">            This is counter-clockwise from x-axis angle is converted to a clockwise</span>
</span><span id="Record.calculate_pressure-594"><a href="#Record.calculate_pressure-594"><span class="linenos">594</span></a><span class="sd">            angle from y axis to match the interpolation grid of the storm paramters. </span>
</span><span id="Record.calculate_pressure-595"><a href="#Record.calculate_pressure-595"><span class="linenos">595</span></a><span class="sd">        methods: array, list of methods to be used. Currently implemented methods</span>
</span><span id="Record.calculate_pressure-596"><a href="#Record.calculate_pressure-596"><span class="linenos">596</span></a><span class="sd">                are - H80, H80c</span>
</span><span id="Record.calculate_pressure-597"><a href="#Record.calculate_pressure-597"><span class="linenos">597</span></a><span class="sd">        rmax_frac: array, till which fraction of rmax, the method to be used,</span>
</span><span id="Record.calculate_pressure-598"><a href="#Record.calculate_pressure-598"><span class="linenos">598</span></a><span class="sd">                np.inf for whole</span>
</span><span id="Record.calculate_pressure-599"><a href="#Record.calculate_pressure-599"><span class="linenos">599</span></a><span class="sd">        rmax_select: which rmax to select, int, str</span>
</span><span id="Record.calculate_pressure-600"><a href="#Record.calculate_pressure-600"><span class="linenos">600</span></a><span class="sd">                    &#39;mean&#39;: mean value of the rmax</span>
</span><span id="Record.calculate_pressure-601"><a href="#Record.calculate_pressure-601"><span class="linenos">601</span></a><span class="sd">                    &#39;nearest&#39;: rmax calculated from nearest frmax</span>
</span><span id="Record.calculate_pressure-602"><a href="#Record.calculate_pressure-602"><span class="linenos">602</span></a><span class="sd">                    &#39;linear&#39;: rmax calculated from a linear interpolation</span>
</span><span id="Record.calculate_pressure-603"><a href="#Record.calculate_pressure-603"><span class="linenos">603</span></a><span class="sd">                    int: number corresponding to selected rmax &gt;1</span>
</span><span id="Record.calculate_pressure-604"><a href="#Record.calculate_pressure-604"><span class="linenos">604</span></a><span class="sd">        kw_atmos: constant atmospheric values</span>
</span><span id="Record.calculate_pressure-605"><a href="#Record.calculate_pressure-605"><span class="linenos">605</span></a><span class="sd">            pn: nominal or environmental pressure, default 101325 Pa</span>
</span><span id="Record.calculate_pressure-606"><a href="#Record.calculate_pressure-606"><span class="linenos">606</span></a><span class="sd">            rhoair: air density, default 1.15 kg/m^3</span>
</span><span id="Record.calculate_pressure-607"><a href="#Record.calculate_pressure-607"><span class="linenos">607</span></a><span class="sd">        kw_h80: extra argument for H80 model</span>
</span><span id="Record.calculate_pressure-608"><a href="#Record.calculate_pressure-608"><span class="linenos">608</span></a><span class="sd">            bmin: min value of B</span>
</span><span id="Record.calculate_pressure-609"><a href="#Record.calculate_pressure-609"><span class="linenos">609</span></a><span class="sd">            bmax: max value of B</span>
</span><span id="Record.calculate_pressure-610"><a href="#Record.calculate_pressure-610"><span class="linenos">610</span></a><span class="sd">        &#39;&#39;&#39;</span>
</span><span id="Record.calculate_pressure-611"><a href="#Record.calculate_pressure-611"><span class="linenos">611</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="Record.calculate_pressure-612"><a href="#Record.calculate_pressure-612"><span class="linenos">612</span></a>            <span class="n">r</span><span class="p">,</span> <span class="n">theta_input</span> <span class="o">=</span> <span class="n">at</span>
</span><span id="Record.calculate_pressure-613"><a href="#Record.calculate_pressure-613"><span class="linenos">613</span></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="Record.calculate_pressure-614"><a href="#Record.calculate_pressure-614"><span class="linenos">614</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;the at must be in (r, theta) as list/array of size 2&#39;</span><span class="p">)</span>
</span><span id="Record.calculate_pressure-615"><a href="#Record.calculate_pressure-615"><span class="linenos">615</span></a>        
</span><span id="Record.calculate_pressure-616"><a href="#Record.calculate_pressure-616"><span class="linenos">616</span></a>        <span class="c1"># Convert theta from x-axis counter clock to y-axis clock wise</span>
</span><span id="Record.calculate_pressure-617"><a href="#Record.calculate_pressure-617"><span class="linenos">617</span></a>        <span class="n">theta</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="o">*</span><span class="n">theta_input</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span>
</span><span id="Record.calculate_pressure-618"><a href="#Record.calculate_pressure-618"><span class="linenos">618</span></a>
</span><span id="Record.calculate_pressure-619"><a href="#Record.calculate_pressure-619"><span class="linenos">619</span></a>        <span class="c1"># Theta -180:180 to 0:360 format, clockwise from 0N</span>
</span><span id="Record.calculate_pressure-620"><a href="#Record.calculate_pressure-620"><span class="linenos">620</span></a>        <span class="k">if</span> <span class="n">theta_input</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Record.calculate_pressure-621"><a href="#Record.calculate_pressure-621"><span class="linenos">621</span></a>            <span class="n">theta</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">+</span> <span class="n">theta_input</span>
</span><span id="Record.calculate_pressure-622"><a href="#Record.calculate_pressure-622"><span class="linenos">622</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Record.calculate_pressure-623"><a href="#Record.calculate_pressure-623"><span class="linenos">623</span></a>            <span class="n">theta</span> <span class="o">=</span> <span class="n">theta_input</span>
</span><span id="Record.calculate_pressure-624"><a href="#Record.calculate_pressure-624"><span class="linenos">624</span></a>
</span><span id="Record.calculate_pressure-625"><a href="#Record.calculate_pressure-625"><span class="linenos">625</span></a>        <span class="n">calc_mslp</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="Record.calculate_pressure-626"><a href="#Record.calculate_pressure-626"><span class="linenos">626</span></a>            <span class="s1">&#39;H80&#39;</span><span class="p">:</span><span class="n">calc_mslp_h80</span><span class="p">,</span>
</span><span id="Record.calculate_pressure-627"><a href="#Record.calculate_pressure-627"><span class="linenos">627</span></a>            <span class="s1">&#39;H80c&#39;</span><span class="p">:</span><span class="n">calc_mslp_h80</span> <span class="c1"># Only B calculation differs</span>
</span><span id="Record.calculate_pressure-628"><a href="#Record.calculate_pressure-628"><span class="linenos">628</span></a>        <span class="p">}</span>
</span><span id="Record.calculate_pressure-629"><a href="#Record.calculate_pressure-629"><span class="linenos">629</span></a>
</span><span id="Record.calculate_pressure-630"><a href="#Record.calculate_pressure-630"><span class="linenos">630</span></a>        <span class="c1"># Calculate vmax for further calculation</span>
</span><span id="Record.calculate_pressure-631"><a href="#Record.calculate_pressure-631"><span class="linenos">631</span></a>        <span class="n">vmax</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;fvmax&#39;</span><span class="p">](</span><span class="n">theta</span><span class="p">)</span>
</span><span id="Record.calculate_pressure-632"><a href="#Record.calculate_pressure-632"><span class="linenos">632</span></a>
</span><span id="Record.calculate_pressure-633"><a href="#Record.calculate_pressure-633"><span class="linenos">633</span></a>        <span class="c1"># Find appropriate rmax function to be used</span>
</span><span id="Record.calculate_pressure-634"><a href="#Record.calculate_pressure-634"><span class="linenos">634</span></a>        <span class="c1"># and calculate rmax</span>
</span><span id="Record.calculate_pressure-635"><a href="#Record.calculate_pressure-635"><span class="linenos">635</span></a>        <span class="n">rmax_select_methods_available</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;nearest&#39;</span><span class="p">,</span> <span class="s1">&#39;linear&#39;</span><span class="p">]</span>
</span><span id="Record.calculate_pressure-636"><a href="#Record.calculate_pressure-636"><span class="linenos">636</span></a>
</span><span id="Record.calculate_pressure-637"><a href="#Record.calculate_pressure-637"><span class="linenos">637</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rmax_select</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="Record.calculate_pressure-638"><a href="#Record.calculate_pressure-638"><span class="linenos">638</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="Record.calculate_pressure-639"><a href="#Record.calculate_pressure-639"><span class="linenos">639</span></a>                <span class="k">assert</span> <span class="n">rmax_select</span> <span class="ow">in</span> <span class="n">rmax_select_methods_available</span>
</span><span id="Record.calculate_pressure-640"><a href="#Record.calculate_pressure-640"><span class="linenos">640</span></a>
</span><span id="Record.calculate_pressure-641"><a href="#Record.calculate_pressure-641"><span class="linenos">641</span></a>                <span class="k">if</span> <span class="n">rmax_select</span><span class="o">==</span><span class="s1">&#39;mean&#39;</span><span class="p">:</span>
</span><span id="Record.calculate_pressure-642"><a href="#Record.calculate_pressure-642"><span class="linenos">642</span></a>                    <span class="n">rmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">([</span><span class="n">f</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;frmax&#39;</span><span class="p">])])</span>
</span><span id="Record.calculate_pressure-643"><a href="#Record.calculate_pressure-643"><span class="linenos">643</span></a>                
</span><span id="Record.calculate_pressure-644"><a href="#Record.calculate_pressure-644"><span class="linenos">644</span></a>                <span class="k">if</span> <span class="n">rmax_select</span><span class="o">==</span><span class="s1">&#39;nearest&#39;</span><span class="p">:</span>
</span><span id="Record.calculate_pressure-645"><a href="#Record.calculate_pressure-645"><span class="linenos">645</span></a>                    <span class="k">try</span><span class="p">:</span>
</span><span id="Record.calculate_pressure-646"><a href="#Record.calculate_pressure-646"><span class="linenos">646</span></a>                        <span class="n">radinfo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">radi</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="k">for</span> <span class="n">radi</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;fradinfo&#39;</span><span class="p">]])</span>
</span><span id="Record.calculate_pressure-647"><a href="#Record.calculate_pressure-647"><span class="linenos">647</span></a>                        <span class="n">radnn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">radinfo</span><span class="o">-</span><span class="n">r</span><span class="p">))</span>
</span><span id="Record.calculate_pressure-648"><a href="#Record.calculate_pressure-648"><span class="linenos">648</span></a>                        <span class="n">rmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">f</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;frmax&#39;</span><span class="p">])])[</span><span class="n">radnn</span><span class="p">]</span>
</span><span id="Record.calculate_pressure-649"><a href="#Record.calculate_pressure-649"><span class="linenos">649</span></a>                    <span class="k">except</span><span class="p">:</span>
</span><span id="Record.calculate_pressure-650"><a href="#Record.calculate_pressure-650"><span class="linenos">650</span></a>                        <span class="n">rmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;frmax&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">](</span><span class="n">theta</span><span class="p">)</span>
</span><span id="Record.calculate_pressure-651"><a href="#Record.calculate_pressure-651"><span class="linenos">651</span></a>                        <span class="k">raise</span> <span class="ne">Warning</span><span class="p">(</span><span class="s1">&#39;nearest not possible, first rmax selected&#39;</span><span class="p">)</span>
</span><span id="Record.calculate_pressure-652"><a href="#Record.calculate_pressure-652"><span class="linenos">652</span></a>
</span><span id="Record.calculate_pressure-653"><a href="#Record.calculate_pressure-653"><span class="linenos">653</span></a>                <span class="k">if</span> <span class="n">rmax_select</span><span class="o">==</span><span class="s1">&#39;linear&#39;</span><span class="p">:</span>
</span><span id="Record.calculate_pressure-654"><a href="#Record.calculate_pressure-654"><span class="linenos">654</span></a>                    <span class="k">try</span><span class="p">:</span>
</span><span id="Record.calculate_pressure-655"><a href="#Record.calculate_pressure-655"><span class="linenos">655</span></a>                        <span class="c1"># x field from -inf to +inf</span>
</span><span id="Record.calculate_pressure-656"><a href="#Record.calculate_pressure-656"><span class="linenos">656</span></a>                        <span class="n">radinfo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">radi</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="k">for</span> <span class="n">radi</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;fradinfo&#39;</span><span class="p">]])</span>
</span><span id="Record.calculate_pressure-657"><a href="#Record.calculate_pressure-657"><span class="linenos">657</span></a>                        <span class="n">radinfo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">radinfo</span><span class="p">)</span>
</span><span id="Record.calculate_pressure-658"><a href="#Record.calculate_pressure-658"><span class="linenos">658</span></a>                        <span class="n">radinfo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">radinfo</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
</span><span id="Record.calculate_pressure-659"><a href="#Record.calculate_pressure-659"><span class="linenos">659</span></a>                        <span class="c1"># y field </span>
</span><span id="Record.calculate_pressure-660"><a href="#Record.calculate_pressure-660"><span class="linenos">660</span></a>                        <span class="n">rmaxinfo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">f</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;frmax&#39;</span><span class="p">])])</span>
</span><span id="Record.calculate_pressure-661"><a href="#Record.calculate_pressure-661"><span class="linenos">661</span></a>                        <span class="n">rmaxinfo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rmaxinfo</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">rmaxinfo</span><span class="p">)</span>
</span><span id="Record.calculate_pressure-662"><a href="#Record.calculate_pressure-662"><span class="linenos">662</span></a>                        <span class="n">rmaxinfo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rmaxinfo</span><span class="p">,</span> <span class="n">rmaxinfo</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</span><span id="Record.calculate_pressure-663"><a href="#Record.calculate_pressure-663"><span class="linenos">663</span></a>                        <span class="n">int_f</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">radinfo</span><span class="p">,</span> <span class="n">rmaxinfo</span><span class="p">)</span>
</span><span id="Record.calculate_pressure-664"><a href="#Record.calculate_pressure-664"><span class="linenos">664</span></a>                        <span class="n">rmax</span> <span class="o">=</span> <span class="n">int_f</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
</span><span id="Record.calculate_pressure-665"><a href="#Record.calculate_pressure-665"><span class="linenos">665</span></a>                    <span class="k">except</span><span class="p">:</span>
</span><span id="Record.calculate_pressure-666"><a href="#Record.calculate_pressure-666"><span class="linenos">666</span></a>                        <span class="n">rmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;frmax&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">](</span><span class="n">theta</span><span class="p">)</span>
</span><span id="Record.calculate_pressure-667"><a href="#Record.calculate_pressure-667"><span class="linenos">667</span></a>                        <span class="k">raise</span> <span class="ne">Warning</span><span class="p">(</span><span class="s1">&#39;linear not possible, first rmax selected&#39;</span><span class="p">)</span>
</span><span id="Record.calculate_pressure-668"><a href="#Record.calculate_pressure-668"><span class="linenos">668</span></a>            <span class="k">except</span><span class="p">:</span>
</span><span id="Record.calculate_pressure-669"><a href="#Record.calculate_pressure-669"><span class="linenos">669</span></a>                <span class="n">rmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;frmax&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">](</span><span class="n">theta</span><span class="p">)</span>
</span><span id="Record.calculate_pressure-670"><a href="#Record.calculate_pressure-670"><span class="linenos">670</span></a>                <span class="k">raise</span> <span class="ne">Warning</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Wrong keyword for rmax method. First frmax is used&#39;</span><span class="p">)</span>
</span><span id="Record.calculate_pressure-671"><a href="#Record.calculate_pressure-671"><span class="linenos">671</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rmax_select</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="Record.calculate_pressure-672"><a href="#Record.calculate_pressure-672"><span class="linenos">672</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="Record.calculate_pressure-673"><a href="#Record.calculate_pressure-673"><span class="linenos">673</span></a>                <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">f</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;frmax&#39;</span><span class="p">])])[</span><span class="n">rmax_select</span><span class="p">]</span>
</span><span id="Record.calculate_pressure-674"><a href="#Record.calculate_pressure-674"><span class="linenos">674</span></a>            <span class="k">except</span><span class="p">:</span>
</span><span id="Record.calculate_pressure-675"><a href="#Record.calculate_pressure-675"><span class="linenos">675</span></a>                <span class="n">rmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;frmax&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">](</span><span class="n">theta</span><span class="p">)</span>
</span><span id="Record.calculate_pressure-676"><a href="#Record.calculate_pressure-676"><span class="linenos">676</span></a>                <span class="k">raise</span> <span class="ne">Warning</span><span class="p">(</span><span class="s1">&#39;Wrong rmax index. First frmax is used&#39;</span><span class="p">)</span>
</span><span id="Record.calculate_pressure-677"><a href="#Record.calculate_pressure-677"><span class="linenos">677</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Record.calculate_pressure-678"><a href="#Record.calculate_pressure-678"><span class="linenos">678</span></a>            <span class="n">rmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;frmax&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">](</span><span class="n">theta</span><span class="p">)</span>
</span><span id="Record.calculate_pressure-679"><a href="#Record.calculate_pressure-679"><span class="linenos">679</span></a>            <span class="k">raise</span> <span class="ne">Warning</span><span class="p">(</span><span class="s1">&#39;Wrong rmax selection keyword/index. First frmax is used&#39;</span><span class="p">)</span>
</span><span id="Record.calculate_pressure-680"><a href="#Record.calculate_pressure-680"><span class="linenos">680</span></a>
</span><span id="Record.calculate_pressure-681"><a href="#Record.calculate_pressure-681"><span class="linenos">681</span></a>        <span class="c1"># Now check methods and rmax_frac and apply method as required</span>
</span><span id="Record.calculate_pressure-682"><a href="#Record.calculate_pressure-682"><span class="linenos">682</span></a>        <span class="c1"># Avoid wrong input of rmax_frac</span>
</span><span id="Record.calculate_pressure-683"><a href="#Record.calculate_pressure-683"><span class="linenos">683</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="Record.calculate_pressure-684"><a href="#Record.calculate_pressure-684"><span class="linenos">684</span></a>            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">rmax_frac</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">methods</span><span class="p">)</span>
</span><span id="Record.calculate_pressure-685"><a href="#Record.calculate_pressure-685"><span class="linenos">685</span></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="Record.calculate_pressure-686"><a href="#Record.calculate_pressure-686"><span class="linenos">686</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;rmax_frac must corresponds to each listed method&#39;</span><span class="p">)</span>
</span><span id="Record.calculate_pressure-687"><a href="#Record.calculate_pressure-687"><span class="linenos">687</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Record.calculate_pressure-688"><a href="#Record.calculate_pressure-688"><span class="linenos">688</span></a>            <span class="n">rmax_frac</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">rmax_frac</span><span class="p">)</span> <span class="c1"># accomodates * of np.inf</span>
</span><span id="Record.calculate_pressure-689"><a href="#Record.calculate_pressure-689"><span class="linenos">689</span></a>        
</span><span id="Record.calculate_pressure-690"><a href="#Record.calculate_pressure-690"><span class="linenos">690</span></a>        <span class="n">rlim_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">rmax_frac</span><span class="p">)[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">rmax</span> <span class="c1"># Starts from 0</span>
</span><span id="Record.calculate_pressure-691"><a href="#Record.calculate_pressure-691"><span class="linenos">691</span></a>        <span class="n">rlim_max</span> <span class="o">=</span> <span class="n">rmax_frac</span><span class="o">*</span><span class="n">rmax</span>
</span><span id="Record.calculate_pressure-692"><a href="#Record.calculate_pressure-692"><span class="linenos">692</span></a>
</span><span id="Record.calculate_pressure-693"><a href="#Record.calculate_pressure-693"><span class="linenos">693</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">method</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">methods</span><span class="p">):</span>
</span><span id="Record.calculate_pressure-694"><a href="#Record.calculate_pressure-694"><span class="linenos">694</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="Record.calculate_pressure-695"><a href="#Record.calculate_pressure-695"><span class="linenos">695</span></a>                <span class="k">assert</span> <span class="n">r</span> <span class="o">&gt;=</span> <span class="n">rlim_min</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="Record.calculate_pressure-696"><a href="#Record.calculate_pressure-696"><span class="linenos">696</span></a>                <span class="k">assert</span> <span class="n">r</span> <span class="o">&lt;</span> <span class="n">rlim_max</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="Record.calculate_pressure-697"><a href="#Record.calculate_pressure-697"><span class="linenos">697</span></a>
</span><span id="Record.calculate_pressure-698"><a href="#Record.calculate_pressure-698"><span class="linenos">698</span></a>                <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;H80&#39;</span><span class="p">:</span>
</span><span id="Record.calculate_pressure-699"><a href="#Record.calculate_pressure-699"><span class="linenos">699</span></a>                    <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="Record.calculate_pressure-700"><a href="#Record.calculate_pressure-700"><span class="linenos">700</span></a>                        <span class="s1">&#39;vmax&#39;</span><span class="p">:</span><span class="n">vmax</span><span class="p">,</span> 
</span><span id="Record.calculate_pressure-701"><a href="#Record.calculate_pressure-701"><span class="linenos">701</span></a>                        <span class="s1">&#39;rmax&#39;</span><span class="p">:</span><span class="n">rmax</span><span class="p">,</span>
</span><span id="Record.calculate_pressure-702"><a href="#Record.calculate_pressure-702"><span class="linenos">702</span></a>                        <span class="s1">&#39;pc&#39;</span><span class="p">:</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;mslp&#39;</span><span class="p">],</span>
</span><span id="Record.calculate_pressure-703"><a href="#Record.calculate_pressure-703"><span class="linenos">703</span></a>                        <span class="s1">&#39;f&#39;</span><span class="p">:</span><span class="n">coriolis</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">]),</span>
</span><span id="Record.calculate_pressure-704"><a href="#Record.calculate_pressure-704"><span class="linenos">704</span></a>                        <span class="s1">&#39;pn&#39;</span><span class="p">:</span><span class="n">kw_atmos</span><span class="p">[</span><span class="s1">&#39;pn&#39;</span><span class="p">],</span>
</span><span id="Record.calculate_pressure-705"><a href="#Record.calculate_pressure-705"><span class="linenos">705</span></a>                        <span class="s1">&#39;rhoair&#39;</span><span class="p">:</span><span class="n">kw_atmos</span><span class="p">[</span><span class="s1">&#39;rhoair&#39;</span><span class="p">],</span>
</span><span id="Record.calculate_pressure-706"><a href="#Record.calculate_pressure-706"><span class="linenos">706</span></a>                        <span class="s1">&#39;bmax&#39;</span><span class="p">:</span><span class="n">kw_h80</span><span class="p">[</span><span class="s1">&#39;bmax&#39;</span><span class="p">],</span>
</span><span id="Record.calculate_pressure-707"><a href="#Record.calculate_pressure-707"><span class="linenos">707</span></a>                        <span class="s1">&#39;bmin&#39;</span><span class="p">:</span><span class="n">kw_h80</span><span class="p">[</span><span class="s1">&#39;bmin&#39;</span><span class="p">]</span>
</span><span id="Record.calculate_pressure-708"><a href="#Record.calculate_pressure-708"><span class="linenos">708</span></a>                    <span class="p">}</span>
</span><span id="Record.calculate_pressure-709"><a href="#Record.calculate_pressure-709"><span class="linenos">709</span></a>                    <span class="n">B</span> <span class="o">=</span> <span class="n">calc_holland_B_full</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="Record.calculate_pressure-710"><a href="#Record.calculate_pressure-710"><span class="linenos">710</span></a>                    <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="Record.calculate_pressure-711"><a href="#Record.calculate_pressure-711"><span class="linenos">711</span></a>                        <span class="s1">&#39;r&#39;</span><span class="p">:</span><span class="n">r</span><span class="p">,</span>
</span><span id="Record.calculate_pressure-712"><a href="#Record.calculate_pressure-712"><span class="linenos">712</span></a>                        <span class="s1">&#39;Rm&#39;</span><span class="p">:</span><span class="n">rmax</span><span class="p">,</span>
</span><span id="Record.calculate_pressure-713"><a href="#Record.calculate_pressure-713"><span class="linenos">713</span></a>                        <span class="s1">&#39;pc&#39;</span><span class="p">:</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;mslp&#39;</span><span class="p">],</span>
</span><span id="Record.calculate_pressure-714"><a href="#Record.calculate_pressure-714"><span class="linenos">714</span></a>                        <span class="s1">&#39;B&#39;</span><span class="p">:</span><span class="n">B</span><span class="p">,</span>
</span><span id="Record.calculate_pressure-715"><a href="#Record.calculate_pressure-715"><span class="linenos">715</span></a>                        <span class="s1">&#39;pn&#39;</span><span class="p">:</span><span class="n">kw_atmos</span><span class="p">[</span><span class="s1">&#39;pn&#39;</span><span class="p">]</span>
</span><span id="Record.calculate_pressure-716"><a href="#Record.calculate_pressure-716"><span class="linenos">716</span></a>                    <span class="p">}</span>
</span><span id="Record.calculate_pressure-717"><a href="#Record.calculate_pressure-717"><span class="linenos">717</span></a>                    <span class="n">mslp</span> <span class="o">=</span> <span class="n">calc_mslp</span><span class="p">[</span><span class="n">method</span><span class="p">](</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="Record.calculate_pressure-718"><a href="#Record.calculate_pressure-718"><span class="linenos">718</span></a>                
</span><span id="Record.calculate_pressure-719"><a href="#Record.calculate_pressure-719"><span class="linenos">719</span></a>                <span class="k">if</span> <span class="n">method</span><span class="o">==</span><span class="s1">&#39;H80c&#39;</span><span class="p">:</span>
</span><span id="Record.calculate_pressure-720"><a href="#Record.calculate_pressure-720"><span class="linenos">720</span></a>                    <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="Record.calculate_pressure-721"><a href="#Record.calculate_pressure-721"><span class="linenos">721</span></a>                        <span class="s1">&#39;vmax&#39;</span><span class="p">:</span><span class="n">vmax</span><span class="p">,</span> 
</span><span id="Record.calculate_pressure-722"><a href="#Record.calculate_pressure-722"><span class="linenos">722</span></a>                        <span class="s1">&#39;pc&#39;</span><span class="p">:</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;mslp&#39;</span><span class="p">],</span>
</span><span id="Record.calculate_pressure-723"><a href="#Record.calculate_pressure-723"><span class="linenos">723</span></a>                        <span class="s1">&#39;pn&#39;</span><span class="p">:</span><span class="n">kw_atmos</span><span class="p">[</span><span class="s1">&#39;pn&#39;</span><span class="p">],</span>
</span><span id="Record.calculate_pressure-724"><a href="#Record.calculate_pressure-724"><span class="linenos">724</span></a>                        <span class="s1">&#39;rhoair&#39;</span><span class="p">:</span><span class="n">kw_atmos</span><span class="p">[</span><span class="s1">&#39;rhoair&#39;</span><span class="p">],</span>
</span><span id="Record.calculate_pressure-725"><a href="#Record.calculate_pressure-725"><span class="linenos">725</span></a>                        <span class="s1">&#39;bmax&#39;</span><span class="p">:</span><span class="n">kw_h80</span><span class="p">[</span><span class="s1">&#39;bmax&#39;</span><span class="p">],</span>
</span><span id="Record.calculate_pressure-726"><a href="#Record.calculate_pressure-726"><span class="linenos">726</span></a>                        <span class="s1">&#39;bmin&#39;</span><span class="p">:</span><span class="n">kw_h80</span><span class="p">[</span><span class="s1">&#39;bmin&#39;</span><span class="p">]</span>
</span><span id="Record.calculate_pressure-727"><a href="#Record.calculate_pressure-727"><span class="linenos">727</span></a>                    <span class="p">}</span>
</span><span id="Record.calculate_pressure-728"><a href="#Record.calculate_pressure-728"><span class="linenos">728</span></a>                    <span class="n">B</span> <span class="o">=</span> <span class="n">calc_holland_B</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="Record.calculate_pressure-729"><a href="#Record.calculate_pressure-729"><span class="linenos">729</span></a>                    <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="Record.calculate_pressure-730"><a href="#Record.calculate_pressure-730"><span class="linenos">730</span></a>                        <span class="s1">&#39;r&#39;</span><span class="p">:</span><span class="n">r</span><span class="p">,</span>
</span><span id="Record.calculate_pressure-731"><a href="#Record.calculate_pressure-731"><span class="linenos">731</span></a>                        <span class="s1">&#39;Rm&#39;</span><span class="p">:</span><span class="n">rmax</span><span class="p">,</span>
</span><span id="Record.calculate_pressure-732"><a href="#Record.calculate_pressure-732"><span class="linenos">732</span></a>                        <span class="s1">&#39;pc&#39;</span><span class="p">:</span><span class="bp">self</span><span class="p">[</span><span class="s1">&#39;mslp&#39;</span><span class="p">],</span>
</span><span id="Record.calculate_pressure-733"><a href="#Record.calculate_pressure-733"><span class="linenos">733</span></a>                        <span class="s1">&#39;B&#39;</span><span class="p">:</span><span class="n">B</span><span class="p">,</span>
</span><span id="Record.calculate_pressure-734"><a href="#Record.calculate_pressure-734"><span class="linenos">734</span></a>                        <span class="s1">&#39;pn&#39;</span><span class="p">:</span><span class="n">kw_atmos</span><span class="p">[</span><span class="s1">&#39;pn&#39;</span><span class="p">]</span>
</span><span id="Record.calculate_pressure-735"><a href="#Record.calculate_pressure-735"><span class="linenos">735</span></a>                    <span class="p">}</span>
</span><span id="Record.calculate_pressure-736"><a href="#Record.calculate_pressure-736"><span class="linenos">736</span></a>                    <span class="n">mslp</span> <span class="o">=</span> <span class="n">calc_mslp</span><span class="p">[</span><span class="n">method</span><span class="p">](</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="Record.calculate_pressure-737"><a href="#Record.calculate_pressure-737"><span class="linenos">737</span></a>                
</span><span id="Record.calculate_pressure-738"><a href="#Record.calculate_pressure-738"><span class="linenos">738</span></a>                <span class="k">break</span>
</span><span id="Record.calculate_pressure-739"><a href="#Record.calculate_pressure-739"><span class="linenos">739</span></a>            <span class="k">except</span><span class="p">:</span>
</span><span id="Record.calculate_pressure-740"><a href="#Record.calculate_pressure-740"><span class="linenos">740</span></a>                <span class="k">continue</span>
</span><span id="Record.calculate_pressure-741"><a href="#Record.calculate_pressure-741"><span class="linenos">741</span></a>        
</span><span id="Record.calculate_pressure-742"><a href="#Record.calculate_pressure-742"><span class="linenos">742</span></a>        <span class="k">return</span><span class="p">(</span><span class="n">mslp</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Calculate pressure field using given method till a fractional distance of 
rmax.</p>

<p>at: (r, theta) location where the wind is calculated,
    r, float, distance in m 
    theta, float, is -2<em>np.pi, 2</em>np.pi radians
    Essentially theta is expected to be output from np.arctan2(y,x)
    This is counter-clockwise from x-axis angle is converted to a clockwise
    angle from y axis to match the interpolation grid of the storm paramters. 
methods: array, list of methods to be used. Currently implemented methods
        are - H80, H80c
rmax_frac: array, till which fraction of rmax, the method to be used,
        np.inf for whole
rmax_select: which rmax to select, int, str
            'mean': mean value of the rmax
            'nearest': rmax calculated from nearest frmax
            'linear': rmax calculated from a linear interpolation
            int: number corresponding to selected rmax &gt;1
kw_atmos: constant atmospheric values
    pn: nominal or environmental pressure, default 101325 Pa
    rhoair: air density, default 1.15 kg/m^3
kw_h80: extra argument for H80 model
    bmin: min value of B
    bmax: max value of B</p>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>builtins.dict</dt>
                                <dd id="Record.get" class="function">get</dd>
                <dd id="Record.setdefault" class="function">setdefault</dd>
                <dd id="Record.pop" class="function">pop</dd>
                <dd id="Record.popitem" class="function">popitem</dd>
                <dd id="Record.keys" class="function">keys</dd>
                <dd id="Record.items" class="function">items</dd>
                <dd id="Record.values" class="function">values</dd>
                <dd id="Record.update" class="function">update</dd>
                <dd id="Record.fromkeys" class="function">fromkeys</dd>
                <dd id="Record.clear" class="function">clear</dd>
                <dd id="Record.copy" class="function">copy</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="Track">
                            <input id="Track-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">Track</span>:

                <label class="view-source-button" for="Track-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Track"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Track-748"><a href="#Track-748"><span class="linenos"> 748</span></a><span class="k">class</span> <span class="nc">Track</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
</span><span id="Track-749"><a href="#Track-749"><span class="linenos"> 749</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">records</span><span class="p">):</span>
</span><span id="Track-750"><a href="#Track-750"><span class="linenos"> 750</span></a><span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="Track-751"><a href="#Track-751"><span class="linenos"> 751</span></a><span class="sd">        Take a record or an array of record and provide track related functionalities.</span>
</span><span id="Track-752"><a href="#Track-752"><span class="linenos"> 752</span></a><span class="sd">        &#39;&#39;&#39;</span>
</span><span id="Track-753"><a href="#Track-753"><span class="linenos"> 753</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="Track-754"><a href="#Track-754"><span class="linenos"> 754</span></a>            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">records</span><span class="p">,</span> <span class="p">(</span><span class="n">Record</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">))</span>
</span><span id="Track-755"><a href="#Track-755"><span class="linenos"> 755</span></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="Track-756"><a href="#Track-756"><span class="linenos"> 756</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Records must be a single or an array of records&#39;</span><span class="p">)</span>
</span><span id="Track-757"><a href="#Track-757"><span class="linenos"> 757</span></a>
</span><span id="Track-758"><a href="#Track-758"><span class="linenos"> 758</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">records</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">records</span><span class="p">)</span>
</span><span id="Track-759"><a href="#Track-759"><span class="linenos"> 759</span></a>
</span><span id="Track-760"><a href="#Track-760"><span class="linenos"> 760</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="Track-761"><a href="#Track-761"><span class="linenos"> 761</span></a>            <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">([</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">Record</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">records</span><span class="p">])</span>
</span><span id="Track-762"><a href="#Track-762"><span class="linenos"> 762</span></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="Track-763"><a href="#Track-763"><span class="linenos"> 763</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The records must be an array of Record object&#39;</span><span class="p">)</span>
</span><span id="Track-764"><a href="#Track-764"><span class="linenos"> 764</span></a>
</span><span id="Track-765"><a href="#Track-765"><span class="linenos"> 765</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">timeindex</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">([</span><span class="n">record</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">records</span><span class="p">])</span>
</span><span id="Track-766"><a href="#Track-766"><span class="linenos"> 766</span></a>
</span><span id="Track-767"><a href="#Track-767"><span class="linenos"> 767</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span> <span class="c1"># To put all records in ascending order</span>
</span><span id="Track-768"><a href="#Track-768"><span class="linenos"> 768</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">calc_translation</span><span class="p">()</span> <span class="c1"># Recalculate translation speed</span>
</span><span id="Track-769"><a href="#Track-769"><span class="linenos"> 769</span></a>
</span><span id="Track-770"><a href="#Track-770"><span class="linenos"> 770</span></a>    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Track-771"><a href="#Track-771"><span class="linenos"> 771</span></a><span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="Track-772"><a href="#Track-772"><span class="linenos"> 772</span></a><span class="sd">        Called and return the timeindex for invoke like - for t in track</span>
</span><span id="Track-773"><a href="#Track-773"><span class="linenos"> 773</span></a><span class="sd">        &#39;&#39;&#39;</span>
</span><span id="Track-774"><a href="#Track-774"><span class="linenos"> 774</span></a>        <span class="k">return</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timeindex</span><span class="p">)</span>
</span><span id="Track-775"><a href="#Track-775"><span class="linenos"> 775</span></a>
</span><span id="Track-776"><a href="#Track-776"><span class="linenos"> 776</span></a>    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
</span><span id="Track-777"><a href="#Track-777"><span class="linenos"> 777</span></a><span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="Track-778"><a href="#Track-778"><span class="linenos"> 778</span></a><span class="sd">        Get an item at a given timeindex</span>
</span><span id="Track-779"><a href="#Track-779"><span class="linenos"> 779</span></a><span class="sd">        &#39;&#39;&#39;</span>
</span><span id="Track-780"><a href="#Track-780"><span class="linenos"> 780</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="Track-781"><a href="#Track-781"><span class="linenos"> 781</span></a>            <span class="n">track</span> <span class="o">=</span> <span class="n">Track</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">records</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
</span><span id="Track-782"><a href="#Track-782"><span class="linenos"> 782</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
</span><span id="Track-783"><a href="#Track-783"><span class="linenos"> 783</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="Track-784"><a href="#Track-784"><span class="linenos"> 784</span></a>                <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">([</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">key</span><span class="p">])</span>
</span><span id="Track-785"><a href="#Track-785"><span class="linenos"> 785</span></a>            <span class="k">except</span><span class="p">:</span>
</span><span id="Track-786"><a href="#Track-786"><span class="linenos"> 786</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Integer indexing array expected&#39;</span><span class="p">)</span>
</span><span id="Track-787"><a href="#Track-787"><span class="linenos"> 787</span></a>            
</span><span id="Track-788"><a href="#Track-788"><span class="linenos"> 788</span></a>            <span class="n">track</span> <span class="o">=</span> <span class="n">Track</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">records</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
</span><span id="Track-789"><a href="#Track-789"><span class="linenos"> 789</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">slice</span><span class="p">):</span>
</span><span id="Track-790"><a href="#Track-790"><span class="linenos"> 790</span></a>            <span class="n">track</span> <span class="o">=</span> <span class="n">Track</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">records</span><span class="p">[</span><span class="n">key</span><span class="o">.</span><span class="n">start</span><span class="p">:</span><span class="n">key</span><span class="o">.</span><span class="n">stop</span><span class="p">:</span><span class="n">key</span><span class="o">.</span><span class="n">step</span><span class="p">])</span>
</span><span id="Track-791"><a href="#Track-791"><span class="linenos"> 791</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Track-792"><a href="#Track-792"><span class="linenos"> 792</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="Track-793"><a href="#Track-793"><span class="linenos"> 793</span></a>                <span class="n">key</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</span><span id="Track-794"><a href="#Track-794"><span class="linenos"> 794</span></a>            <span class="k">except</span><span class="p">:</span>
</span><span id="Track-795"><a href="#Track-795"><span class="linenos"> 795</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Accessor must be parsable by pd.to_datetime&#39;</span><span class="p">)</span>
</span><span id="Track-796"><a href="#Track-796"><span class="linenos"> 796</span></a>
</span><span id="Track-797"><a href="#Track-797"><span class="linenos"> 797</span></a>            <span class="n">track</span> <span class="o">=</span> <span class="n">Track</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">records</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">timeindex</span> <span class="o">==</span> <span class="n">key</span><span class="p">])</span>
</span><span id="Track-798"><a href="#Track-798"><span class="linenos"> 798</span></a>
</span><span id="Track-799"><a href="#Track-799"><span class="linenos"> 799</span></a>        <span class="k">return</span> <span class="n">track</span>
</span><span id="Track-800"><a href="#Track-800"><span class="linenos"> 800</span></a>
</span><span id="Track-801"><a href="#Track-801"><span class="linenos"> 801</span></a>    <span class="k">def</span> <span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
</span><span id="Track-802"><a href="#Track-802"><span class="linenos"> 802</span></a><span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="Track-803"><a href="#Track-803"><span class="linenos"> 803</span></a><span class="sd">        Set an item at a given time index</span>
</span><span id="Track-804"><a href="#Track-804"><span class="linenos"> 804</span></a><span class="sd">        &#39;&#39;&#39;</span>
</span><span id="Track-805"><a href="#Track-805"><span class="linenos"> 805</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="Track-806"><a href="#Track-806"><span class="linenos"> 806</span></a>            <span class="n">key</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</span><span id="Track-807"><a href="#Track-807"><span class="linenos"> 807</span></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="Track-808"><a href="#Track-808"><span class="linenos"> 808</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Accessor must be parsable by pd.to_datetime&#39;</span><span class="p">)</span>
</span><span id="Track-809"><a href="#Track-809"><span class="linenos"> 809</span></a>
</span><span id="Track-810"><a href="#Track-810"><span class="linenos"> 810</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">records</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">timeindex</span> <span class="o">==</span> <span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="Track-811"><a href="#Track-811"><span class="linenos"> 811</span></a>
</span><span id="Track-812"><a href="#Track-812"><span class="linenos"> 812</span></a>    <span class="k">def</span> <span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
</span><span id="Track-813"><a href="#Track-813"><span class="linenos"> 813</span></a><span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="Track-814"><a href="#Track-814"><span class="linenos"> 814</span></a><span class="sd">        Implements checking of a record</span>
</span><span id="Track-815"><a href="#Track-815"><span class="linenos"> 815</span></a><span class="sd">        &#39;&#39;&#39;</span>
</span><span id="Track-816"><a href="#Track-816"><span class="linenos"> 816</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="Track-817"><a href="#Track-817"><span class="linenos"> 817</span></a>            <span class="n">key</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</span><span id="Track-818"><a href="#Track-818"><span class="linenos"> 818</span></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="Track-819"><a href="#Track-819"><span class="linenos"> 819</span></a>            <span class="n">key</span> <span class="o">=</span> <span class="n">key</span>
</span><span id="Track-820"><a href="#Track-820"><span class="linenos"> 820</span></a>        
</span><span id="Track-821"><a href="#Track-821"><span class="linenos"> 821</span></a>        <span class="k">return</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeindex</span>
</span><span id="Track-822"><a href="#Track-822"><span class="linenos"> 822</span></a>
</span><span id="Track-823"><a href="#Track-823"><span class="linenos"> 823</span></a>    <span class="k">def</span> <span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
</span><span id="Track-824"><a href="#Track-824"><span class="linenos"> 824</span></a><span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="Track-825"><a href="#Track-825"><span class="linenos"> 825</span></a><span class="sd">        Implements accessing the the dictionary objects as array.</span>
</span><span id="Track-826"><a href="#Track-826"><span class="linenos"> 826</span></a><span class="sd">        &#39;&#39;&#39;</span>
</span><span id="Track-827"><a href="#Track-827"><span class="linenos"> 827</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="Track-828"><a href="#Track-828"><span class="linenos"> 828</span></a>            <span class="n">attr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">record</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">records</span><span class="p">])</span>
</span><span id="Track-829"><a href="#Track-829"><span class="linenos"> 829</span></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="Track-830"><a href="#Track-830"><span class="linenos"> 830</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1"> not found in the records&#39;</span><span class="p">)</span>
</span><span id="Track-831"><a href="#Track-831"><span class="linenos"> 831</span></a>        
</span><span id="Track-832"><a href="#Track-832"><span class="linenos"> 832</span></a>        <span class="k">return</span> <span class="n">attr</span>
</span><span id="Track-833"><a href="#Track-833"><span class="linenos"> 833</span></a>
</span><span id="Track-834"><a href="#Track-834"><span class="linenos"> 834</span></a>    <span class="k">def</span> <span class="nf">sort</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Track-835"><a href="#Track-835"><span class="linenos"> 835</span></a><span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="Track-836"><a href="#Track-836"><span class="linenos"> 836</span></a><span class="sd">        Apply time sorting and sort the records</span>
</span><span id="Track-837"><a href="#Track-837"><span class="linenos"> 837</span></a><span class="sd">        &#39;&#39;&#39;</span>
</span><span id="Track-838"><a href="#Track-838"><span class="linenos"> 838</span></a>        <span class="n">isort</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timeindex</span><span class="p">)</span>
</span><span id="Track-839"><a href="#Track-839"><span class="linenos"> 839</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">timeindex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeindex</span><span class="p">[</span><span class="n">isort</span><span class="p">]</span>
</span><span id="Track-840"><a href="#Track-840"><span class="linenos"> 840</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">records</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">records</span><span class="p">[</span><span class="n">isort</span><span class="p">]</span>
</span><span id="Track-841"><a href="#Track-841"><span class="linenos"> 841</span></a>
</span><span id="Track-842"><a href="#Track-842"><span class="linenos"> 842</span></a>    <span class="k">def</span> <span class="nf">calc_translation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Track-843"><a href="#Track-843"><span class="linenos"> 843</span></a><span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="Track-844"><a href="#Track-844"><span class="linenos"> 844</span></a><span class="sd">        Calculate and update the ustorm, vstorm fields.</span>
</span><span id="Track-845"><a href="#Track-845"><span class="linenos"> 845</span></a><span class="sd">        &#39;&#39;&#39;</span>
</span><span id="Track-846"><a href="#Track-846"><span class="linenos"> 846</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">records</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
</span><span id="Track-847"><a href="#Track-847"><span class="linenos"> 847</span></a>            <span class="n">dt</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timeindex</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeindex</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span>
</span><span id="Track-848"><a href="#Track-848"><span class="linenos"> 848</span></a>            <span class="n">dtrans_x</span><span class="p">,</span> <span class="n">dtrans_y</span> <span class="o">=</span> <span class="n">gc_distance</span><span class="p">(</span>
</span><span id="Track-849"><a href="#Track-849"><span class="linenos"> 849</span></a>                <span class="n">of_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">records</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;lon&#39;</span><span class="p">],</span>
</span><span id="Track-850"><a href="#Track-850"><span class="linenos"> 850</span></a>                <span class="n">of_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">records</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;lat&#39;</span><span class="p">],</span>
</span><span id="Track-851"><a href="#Track-851"><span class="linenos"> 851</span></a>                <span class="n">origin_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">records</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;lon&#39;</span><span class="p">],</span>
</span><span id="Track-852"><a href="#Track-852"><span class="linenos"> 852</span></a>                <span class="n">origin_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">records</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span>
</span><span id="Track-853"><a href="#Track-853"><span class="linenos"> 853</span></a>            <span class="p">)</span>
</span><span id="Track-854"><a href="#Track-854"><span class="linenos"> 854</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">records</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;ustorm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dtrans_x</span><span class="o">/</span><span class="n">dt</span>
</span><span id="Track-855"><a href="#Track-855"><span class="linenos"> 855</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">records</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;vstorm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dtrans_y</span><span class="o">/</span><span class="n">dt</span>
</span><span id="Track-856"><a href="#Track-856"><span class="linenos"> 856</span></a>
</span><span id="Track-857"><a href="#Track-857"><span class="linenos"> 857</span></a>            <span class="c1"># For the last time step, we are keeping it to the same</span>
</span><span id="Track-858"><a href="#Track-858"><span class="linenos"> 858</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">records</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;ustorm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">records</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">][</span><span class="s1">&#39;ustorm&#39;</span><span class="p">]</span>
</span><span id="Track-859"><a href="#Track-859"><span class="linenos"> 859</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">records</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;vstorm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">records</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">][</span><span class="s1">&#39;vstorm&#39;</span><span class="p">]</span>
</span><span id="Track-860"><a href="#Track-860"><span class="linenos"> 860</span></a>
</span><span id="Track-861"><a href="#Track-861"><span class="linenos"> 861</span></a>    <span class="k">def</span> <span class="nf">append</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">records</span><span class="p">):</span>
</span><span id="Track-862"><a href="#Track-862"><span class="linenos"> 862</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="Track-863"><a href="#Track-863"><span class="linenos"> 863</span></a>            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">records</span><span class="p">,</span> <span class="p">(</span><span class="n">Record</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">))</span>
</span><span id="Track-864"><a href="#Track-864"><span class="linenos"> 864</span></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="Track-865"><a href="#Track-865"><span class="linenos"> 865</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Records must be a single or an array of records&#39;</span><span class="p">)</span>
</span><span id="Track-866"><a href="#Track-866"><span class="linenos"> 866</span></a>
</span><span id="Track-867"><a href="#Track-867"><span class="linenos"> 867</span></a>        <span class="n">records</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">records</span><span class="p">)</span>
</span><span id="Track-868"><a href="#Track-868"><span class="linenos"> 868</span></a>
</span><span id="Track-869"><a href="#Track-869"><span class="linenos"> 869</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="Track-870"><a href="#Track-870"><span class="linenos"> 870</span></a>            <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">([</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">Record</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">records</span><span class="p">])</span>
</span><span id="Track-871"><a href="#Track-871"><span class="linenos"> 871</span></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="Track-872"><a href="#Track-872"><span class="linenos"> 872</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The records must be an array of Record object&#39;</span><span class="p">)</span>
</span><span id="Track-873"><a href="#Track-873"><span class="linenos"> 873</span></a>
</span><span id="Track-874"><a href="#Track-874"><span class="linenos"> 874</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">records</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">records</span><span class="p">,</span> <span class="n">records</span><span class="p">)</span>
</span><span id="Track-875"><a href="#Track-875"><span class="linenos"> 875</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">timeindex</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">([</span><span class="n">record</span><span class="o">.</span><span class="n">timestamp</span> <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">records</span><span class="p">])</span>
</span><span id="Track-876"><a href="#Track-876"><span class="linenos"> 876</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span> <span class="c1"># To put all record in ascending order</span>
</span><span id="Track-877"><a href="#Track-877"><span class="linenos"> 877</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">calc_translation</span><span class="p">()</span> <span class="c1"># Recalculate translation speed</span>
</span><span id="Track-878"><a href="#Track-878"><span class="linenos"> 878</span></a>
</span><span id="Track-879"><a href="#Track-879"><span class="linenos"> 879</span></a>    <span class="k">def</span> <span class="nf">interpolate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">at</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="Track-880"><a href="#Track-880"><span class="linenos"> 880</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="Track-881"><a href="#Track-881"><span class="linenos"> 881</span></a>            <span class="n">at</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">at</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="Track-882"><a href="#Track-882"><span class="linenos"> 882</span></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="Track-883"><a href="#Track-883"><span class="linenos"> 883</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;`at` must be parsable by pd.to_datetime&#39;</span><span class="p">)</span>
</span><span id="Track-884"><a href="#Track-884"><span class="linenos"> 884</span></a>
</span><span id="Track-885"><a href="#Track-885"><span class="linenos"> 885</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="Track-886"><a href="#Track-886"><span class="linenos"> 886</span></a>            <span class="k">assert</span> <span class="n">at</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeindex</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="Track-887"><a href="#Track-887"><span class="linenos"> 887</span></a>            <span class="k">assert</span> <span class="n">at</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeindex</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Track-888"><a href="#Track-888"><span class="linenos"> 888</span></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="Track-889"><a href="#Track-889"><span class="linenos"> 889</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Out of interpolation range&#39;</span><span class="p">)</span>
</span><span id="Track-890"><a href="#Track-890"><span class="linenos"> 890</span></a>
</span><span id="Track-891"><a href="#Track-891"><span class="linenos"> 891</span></a>        <span class="c1"># Calculate the corresponding indices</span>
</span><span id="Track-892"><a href="#Track-892"><span class="linenos"> 892</span></a>        <span class="n">i_right</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">timeindex</span><span class="p">,</span> <span class="n">v</span><span class="o">=</span><span class="n">at</span><span class="p">,</span> <span class="n">side</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
</span><span id="Track-893"><a href="#Track-893"><span class="linenos"> 893</span></a>
</span><span id="Track-894"><a href="#Track-894"><span class="linenos"> 894</span></a>        <span class="k">if</span> <span class="n">i_right</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Track-895"><a href="#Track-895"><span class="linenos"> 895</span></a>            <span class="n">i_left</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Track-896"><a href="#Track-896"><span class="linenos"> 896</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Track-897"><a href="#Track-897"><span class="linenos"> 897</span></a>            <span class="n">i_left</span> <span class="o">=</span> <span class="n">i_right</span> <span class="o">-</span> <span class="mi">1</span>
</span><span id="Track-898"><a href="#Track-898"><span class="linenos"> 898</span></a>
</span><span id="Track-899"><a href="#Track-899"><span class="linenos"> 899</span></a>        <span class="c1"># Calculate the corresponding weights</span>
</span><span id="Track-900"><a href="#Track-900"><span class="linenos"> 900</span></a>        <span class="n">v_left</span><span class="p">,</span> <span class="n">v_right</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeindex</span><span class="p">[[</span><span class="n">i_left</span><span class="p">,</span> <span class="n">i_right</span><span class="p">]]</span>
</span><span id="Track-901"><a href="#Track-901"><span class="linenos"> 901</span></a>        
</span><span id="Track-902"><a href="#Track-902"><span class="linenos"> 902</span></a>        <span class="k">if</span><span class="p">(</span><span class="n">i_left</span> <span class="o">&lt;</span> <span class="n">i_right</span><span class="p">):</span>
</span><span id="Track-903"><a href="#Track-903"><span class="linenos"> 903</span></a>            <span class="n">td_right</span> <span class="o">=</span> <span class="p">(</span><span class="n">v_right</span> <span class="o">-</span> <span class="n">at</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span> <span class="c1"># Timedelta to seconds</span>
</span><span id="Track-904"><a href="#Track-904"><span class="linenos"> 904</span></a>            <span class="n">td_total</span> <span class="o">=</span>  <span class="p">(</span><span class="n">v_right</span> <span class="o">-</span> <span class="n">v_left</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span> <span class="c1"># Timedelta to seconds</span>
</span><span id="Track-905"><a href="#Track-905"><span class="linenos"> 905</span></a>            <span class="n">w_left</span> <span class="o">=</span> <span class="n">td_right</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">td_total</span><span class="p">)</span>
</span><span id="Track-906"><a href="#Track-906"><span class="linenos"> 906</span></a>            <span class="n">w_right</span> <span class="o">=</span> <span class="mi">1</span><span class="o">-</span><span class="n">w_left</span>
</span><span id="Track-907"><a href="#Track-907"><span class="linenos"> 907</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Track-908"><a href="#Track-908"><span class="linenos"> 908</span></a>            <span class="n">w_left</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span id="Track-909"><a href="#Track-909"><span class="linenos"> 909</span></a>            <span class="n">w_right</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="Track-910"><a href="#Track-910"><span class="linenos"> 910</span></a>
</span><span id="Track-911"><a href="#Track-911"><span class="linenos"> 911</span></a>        <span class="c1"># Create Record for the necessary fields with direct interpolation</span>
</span><span id="Track-912"><a href="#Track-912"><span class="linenos"> 912</span></a>        <span class="n">int_record</span> <span class="o">=</span> <span class="n">Record</span><span class="p">(</span>
</span><span id="Track-913"><a href="#Track-913"><span class="linenos"> 913</span></a>            <span class="n">timestamp</span><span class="o">=</span><span class="n">at</span><span class="p">,</span>
</span><span id="Track-914"><a href="#Track-914"><span class="linenos"> 914</span></a>            <span class="n">lon</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">records</span><span class="p">[</span><span class="n">i_left</span><span class="p">][</span><span class="s1">&#39;lon&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">w_left</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">records</span><span class="p">[</span><span class="n">i_right</span><span class="p">][</span><span class="s1">&#39;lon&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">w_right</span><span class="p">,</span>
</span><span id="Track-915"><a href="#Track-915"><span class="linenos"> 915</span></a>            <span class="n">lat</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">records</span><span class="p">[</span><span class="n">i_left</span><span class="p">][</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">w_left</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">records</span><span class="p">[</span><span class="n">i_right</span><span class="p">][</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">w_right</span><span class="p">,</span>
</span><span id="Track-916"><a href="#Track-916"><span class="linenos"> 916</span></a>            <span class="n">mslp</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">records</span><span class="p">[</span><span class="n">i_left</span><span class="p">][</span><span class="s1">&#39;mslp&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">w_left</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">records</span><span class="p">[</span><span class="n">i_right</span><span class="p">][</span><span class="s1">&#39;mslp&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">w_right</span><span class="p">,</span>
</span><span id="Track-917"><a href="#Track-917"><span class="linenos"> 917</span></a>            <span class="n">vmax</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">records</span><span class="p">[</span><span class="n">i_left</span><span class="p">][</span><span class="s1">&#39;vmax&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">w_left</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">records</span><span class="p">[</span><span class="n">i_right</span><span class="p">][</span><span class="s1">&#39;vmax&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">w_right</span><span class="p">,</span>
</span><span id="Track-918"><a href="#Track-918"><span class="linenos"> 918</span></a>            <span class="n">rmax</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">records</span><span class="p">[</span><span class="n">i_left</span><span class="p">][</span><span class="s1">&#39;rmax&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">w_left</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">records</span><span class="p">[</span><span class="n">i_right</span><span class="p">][</span><span class="s1">&#39;rmax&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">w_right</span><span class="p">,</span>
</span><span id="Track-919"><a href="#Track-919"><span class="linenos"> 919</span></a>            <span class="n">ustorm</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">records</span><span class="p">[</span><span class="n">i_left</span><span class="p">][</span><span class="s1">&#39;ustorm&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">w_left</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">records</span><span class="p">[</span><span class="n">i_right</span><span class="p">][</span><span class="s1">&#39;ustorm&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">w_right</span><span class="p">,</span>
</span><span id="Track-920"><a href="#Track-920"><span class="linenos"> 920</span></a>            <span class="n">vstorm</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">records</span><span class="p">[</span><span class="n">i_left</span><span class="p">][</span><span class="s1">&#39;vstorm&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">w_left</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">records</span><span class="p">[</span><span class="n">i_right</span><span class="p">][</span><span class="s1">&#39;vstorm&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">w_right</span>
</span><span id="Track-921"><a href="#Track-921"><span class="linenos"> 921</span></a>        <span class="p">)</span>
</span><span id="Track-922"><a href="#Track-922"><span class="linenos"> 922</span></a>
</span><span id="Track-923"><a href="#Track-923"><span class="linenos"> 923</span></a>        <span class="c1"># now interpolate vinfo and radinfo</span>
</span><span id="Track-924"><a href="#Track-924"><span class="linenos"> 924</span></a>        <span class="c1"># export np.nan if not available</span>
</span><span id="Track-925"><a href="#Track-925"><span class="linenos"> 925</span></a>        <span class="n">vinfo_left</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">records</span><span class="p">[</span><span class="n">i_left</span><span class="p">][</span><span class="s1">&#39;vinfo&#39;</span><span class="p">]</span>
</span><span id="Track-926"><a href="#Track-926"><span class="linenos"> 926</span></a>        <span class="n">lvinfo_left</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">vinfo_left</span><span class="p">)</span>
</span><span id="Track-927"><a href="#Track-927"><span class="linenos"> 927</span></a>        <span class="n">vinfo_right</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">records</span><span class="p">[</span><span class="n">i_right</span><span class="p">][</span><span class="s1">&#39;vinfo&#39;</span><span class="p">]</span>
</span><span id="Track-928"><a href="#Track-928"><span class="linenos"> 928</span></a>        <span class="n">lvinfo_right</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">vinfo_right</span><span class="p">)</span>
</span><span id="Track-929"><a href="#Track-929"><span class="linenos"> 929</span></a>        <span class="n">radinfo_left</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_2d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">records</span><span class="p">[</span><span class="n">i_left</span><span class="p">][</span><span class="s1">&#39;radinfo&#39;</span><span class="p">])</span>
</span><span id="Track-930"><a href="#Track-930"><span class="linenos"> 930</span></a>        <span class="n">sradinfo_left</span> <span class="o">=</span> <span class="n">radinfo_left</span><span class="o">.</span><span class="n">shape</span>
</span><span id="Track-931"><a href="#Track-931"><span class="linenos"> 931</span></a>        <span class="n">radinfo_right</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_2d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">records</span><span class="p">[</span><span class="n">i_right</span><span class="p">][</span><span class="s1">&#39;radinfo&#39;</span><span class="p">])</span>
</span><span id="Track-932"><a href="#Track-932"><span class="linenos"> 932</span></a>        <span class="n">sradinfo_right</span> <span class="o">=</span> <span class="n">radinfo_right</span><span class="o">.</span><span class="n">shape</span>
</span><span id="Track-933"><a href="#Track-933"><span class="linenos"> 933</span></a>
</span><span id="Track-934"><a href="#Track-934"><span class="linenos"> 934</span></a>        <span class="c1"># Checking if the left and right are same size</span>
</span><span id="Track-935"><a href="#Track-935"><span class="linenos"> 935</span></a>        <span class="k">if</span> <span class="n">lvinfo_left</span> <span class="o">==</span> <span class="n">lvinfo_right</span><span class="p">:</span>
</span><span id="Track-936"><a href="#Track-936"><span class="linenos"> 936</span></a>            <span class="n">vinfo_diff</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Track-937"><a href="#Track-937"><span class="linenos"> 937</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Track-938"><a href="#Track-938"><span class="linenos"> 938</span></a>            <span class="n">vinfo_diff</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Track-939"><a href="#Track-939"><span class="linenos"> 939</span></a>
</span><span id="Track-940"><a href="#Track-940"><span class="linenos"> 940</span></a>        <span class="c1"># Interpolating</span>
</span><span id="Track-941"><a href="#Track-941"><span class="linenos"> 941</span></a>        <span class="k">if</span> <span class="n">vinfo_diff</span><span class="p">:</span>
</span><span id="Track-942"><a href="#Track-942"><span class="linenos"> 942</span></a>            <span class="c1"># vinfo size is different more check is needed</span>
</span><span id="Track-943"><a href="#Track-943"><span class="linenos"> 943</span></a>            <span class="n">min_vinfo_length</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">([</span><span class="n">lvinfo_left</span><span class="p">,</span> <span class="n">lvinfo_right</span><span class="p">])</span>
</span><span id="Track-944"><a href="#Track-944"><span class="linenos"> 944</span></a>            <span class="n">vinfo</span> <span class="o">=</span> <span class="n">vinfo_left</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">min_vinfo_length</span><span class="p">]</span>
</span><span id="Track-945"><a href="#Track-945"><span class="linenos"> 945</span></a>
</span><span id="Track-946"><a href="#Track-946"><span class="linenos"> 946</span></a>            <span class="c1"># First find which one is the longer and set radinfo size</span>
</span><span id="Track-947"><a href="#Track-947"><span class="linenos"> 947</span></a>            <span class="k">if</span> <span class="n">lvinfo_left</span> <span class="o">&gt;</span> <span class="n">lvinfo_right</span><span class="p">:</span>
</span><span id="Track-948"><a href="#Track-948"><span class="linenos"> 948</span></a>                <span class="n">radinfo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">min_vinfo_length</span><span class="p">,</span> <span class="n">sradinfo_left</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
</span><span id="Track-949"><a href="#Track-949"><span class="linenos"> 949</span></a>            <span class="k">elif</span> <span class="n">lvinfo_left</span> <span class="o">&lt;</span> <span class="n">lvinfo_right</span><span class="p">:</span>
</span><span id="Track-950"><a href="#Track-950"><span class="linenos"> 950</span></a>                <span class="n">radinfo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">min_vinfo_length</span><span class="p">,</span> <span class="n">sradinfo_right</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
</span><span id="Track-951"><a href="#Track-951"><span class="linenos"> 951</span></a>
</span><span id="Track-952"><a href="#Track-952"><span class="linenos"> 952</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">min_vinfo_length</span><span class="p">):</span>
</span><span id="Track-953"><a href="#Track-953"><span class="linenos"> 953</span></a>                    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">vinfo_left</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">vinfo_right</span><span class="p">[</span><span class="n">i</span><span class="p">])]):</span>
</span><span id="Track-954"><a href="#Track-954"><span class="linenos"> 954</span></a>                        <span class="n">radinfo</span> <span class="o">=</span> <span class="n">radinfo</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span>
</span><span id="Track-955"><a href="#Track-955"><span class="linenos"> 955</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="Track-956"><a href="#Track-956"><span class="linenos"> 956</span></a>                        <span class="n">vinfo</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">vinfo_left</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="Track-957"><a href="#Track-957"><span class="linenos"> 957</span></a>                        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">radinfo</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
</span><span id="Track-958"><a href="#Track-958"><span class="linenos"> 958</span></a>                            <span class="n">radinfo</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">radinfo_left</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="n">w_left</span> <span class="o">+</span> <span class="n">radinfo_right</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="n">w_right</span>
</span><span id="Track-959"><a href="#Track-959"><span class="linenos"> 959</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Track-960"><a href="#Track-960"><span class="linenos"> 960</span></a>            <span class="c1"># vinfo size is same</span>
</span><span id="Track-961"><a href="#Track-961"><span class="linenos"> 961</span></a>            <span class="n">len_vinfo</span> <span class="o">=</span> <span class="n">lvinfo_left</span>
</span><span id="Track-962"><a href="#Track-962"><span class="linenos"> 962</span></a>            <span class="c1"># If the both of them has length 1</span>
</span><span id="Track-963"><a href="#Track-963"><span class="linenos"> 963</span></a>            <span class="k">if</span> <span class="n">len_vinfo</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Track-964"><a href="#Track-964"><span class="linenos"> 964</span></a>                <span class="c1"># Return missing if vinfo itselft is missing</span>
</span><span id="Track-965"><a href="#Track-965"><span class="linenos"> 965</span></a>                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">vinfo_left</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">vinfo_right</span><span class="p">[</span><span class="mi">0</span><span class="p">])]):</span>
</span><span id="Track-966"><a href="#Track-966"><span class="linenos"> 966</span></a>                    <span class="n">vinfo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
</span><span id="Track-967"><a href="#Track-967"><span class="linenos"> 967</span></a>                    <span class="n">radinfo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
</span><span id="Track-968"><a href="#Track-968"><span class="linenos"> 968</span></a>                <span class="c1"># Or set to zero</span>
</span><span id="Track-969"><a href="#Track-969"><span class="linenos"> 969</span></a>                <span class="k">elif</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">([</span><span class="n">vinfo_left</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">,</span> <span class="n">vinfo_right</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="Track-970"><a href="#Track-970"><span class="linenos"> 970</span></a>                    <span class="n">vinfo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
</span><span id="Track-971"><a href="#Track-971"><span class="linenos"> 971</span></a>                    <span class="n">radinfo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
</span><span id="Track-972"><a href="#Track-972"><span class="linenos"> 972</span></a>                <span class="c1"># Otherwise calculate the linear interpolation</span>
</span><span id="Track-973"><a href="#Track-973"><span class="linenos"> 973</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Track-974"><a href="#Track-974"><span class="linenos"> 974</span></a>                    <span class="n">vinfo</span> <span class="o">=</span> <span class="n">vinfo_left</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Track-975"><a href="#Track-975"><span class="linenos"> 975</span></a>                    <span class="n">radinfo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">radinfo_left</span><span class="p">)</span>
</span><span id="Track-976"><a href="#Track-976"><span class="linenos"> 976</span></a>                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">sradinfo_left</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="Track-977"><a href="#Track-977"><span class="linenos"> 977</span></a>                        <span class="n">radinfo</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">radinfo_left</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="n">w_left</span> <span class="o">+</span> <span class="n">radinfo_right</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="n">w_right</span>
</span><span id="Track-978"><a href="#Track-978"><span class="linenos"> 978</span></a>            <span class="k">elif</span> <span class="n">len_vinfo</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Track-979"><a href="#Track-979"><span class="linenos"> 979</span></a>                <span class="c1"># If both of them as length &gt; 1</span>
</span><span id="Track-980"><a href="#Track-980"><span class="linenos"> 980</span></a>                <span class="n">vinfo</span> <span class="o">=</span> <span class="n">vinfo_left</span>
</span><span id="Track-981"><a href="#Track-981"><span class="linenos"> 981</span></a>                <span class="n">shape_radinfo</span> <span class="o">=</span> <span class="p">(</span><span class="n">lvinfo_left</span><span class="p">,</span> <span class="n">sradinfo_left</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="Track-982"><a href="#Track-982"><span class="linenos"> 982</span></a>                <span class="n">radinfo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">shape_radinfo</span><span class="p">)</span>
</span><span id="Track-983"><a href="#Track-983"><span class="linenos"> 983</span></a>                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">vinfo</span><span class="p">):</span>
</span><span id="Track-984"><a href="#Track-984"><span class="linenos"> 984</span></a>                    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">vinfo_left</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">vinfo_right</span><span class="p">[</span><span class="n">i</span><span class="p">])]):</span>
</span><span id="Track-985"><a href="#Track-985"><span class="linenos"> 985</span></a>                        <span class="n">radinfo</span> <span class="o">=</span> <span class="n">radinfo</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span>
</span><span id="Track-986"><a href="#Track-986"><span class="linenos"> 986</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="Track-987"><a href="#Track-987"><span class="linenos"> 987</span></a>                        <span class="n">vinfo</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">vinfo_left</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="Track-988"><a href="#Track-988"><span class="linenos"> 988</span></a>                        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">shape_radinfo</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
</span><span id="Track-989"><a href="#Track-989"><span class="linenos"> 989</span></a>                            <span class="n">radinfo</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">radinfo_left</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="n">w_left</span> <span class="o">+</span> <span class="n">radinfo_right</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="n">w_right</span>
</span><span id="Track-990"><a href="#Track-990"><span class="linenos"> 990</span></a>        
</span><span id="Track-991"><a href="#Track-991"><span class="linenos"> 991</span></a>        <span class="c1"># Providing the same as the dataset if interpolated on a given time</span>
</span><span id="Track-992"><a href="#Track-992"><span class="linenos"> 992</span></a>        <span class="k">if</span> <span class="n">w_right</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Track-993"><a href="#Track-993"><span class="linenos"> 993</span></a>            <span class="n">vinfo</span> <span class="o">=</span> <span class="n">vinfo_right</span>
</span><span id="Track-994"><a href="#Track-994"><span class="linenos"> 994</span></a>            <span class="n">radinfo</span> <span class="o">=</span> <span class="n">radinfo_right</span>
</span><span id="Track-995"><a href="#Track-995"><span class="linenos"> 995</span></a>        <span class="k">elif</span> <span class="n">w_left</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Track-996"><a href="#Track-996"><span class="linenos"> 996</span></a>            <span class="n">vinfo</span> <span class="o">=</span> <span class="n">vinfo_left</span>
</span><span id="Track-997"><a href="#Track-997"><span class="linenos"> 997</span></a>            <span class="n">radinfo</span> <span class="o">=</span> <span class="n">radinfo_left</span>
</span><span id="Track-998"><a href="#Track-998"><span class="linenos"> 998</span></a>
</span><span id="Track-999"><a href="#Track-999"><span class="linenos"> 999</span></a>        <span class="c1"># Updating int_record with vinfo, radinfo</span>
</span><span id="Track-1000"><a href="#Track-1000"><span class="linenos">1000</span></a>        <span class="n">int_record</span><span class="p">[</span><span class="s1">&#39;vinfo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">vinfo</span>
</span><span id="Track-1001"><a href="#Track-1001"><span class="linenos">1001</span></a>        <span class="n">int_record</span><span class="p">[</span><span class="s1">&#39;radinfo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">radinfo</span>
</span><span id="Track-1002"><a href="#Track-1002"><span class="linenos">1002</span></a>
</span><span id="Track-1003"><a href="#Track-1003"><span class="linenos">1003</span></a>        <span class="c1"># Return the record file for rest of the calculations</span>
</span><span id="Track-1004"><a href="#Track-1004"><span class="linenos">1004</span></a>        <span class="k">return</span><span class="p">(</span><span class="n">int_record</span><span class="p">)</span>
</span><span id="Track-1005"><a href="#Track-1005"><span class="linenos">1005</span></a>
</span><span id="Track-1006"><a href="#Track-1006"><span class="linenos">1006</span></a>    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">subplot_kw</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;projection&#39;</span><span class="p">:</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">()}):</span>
</span><span id="Track-1007"><a href="#Track-1007"><span class="linenos">1007</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">plt</span><span class="o">.</span><span class="n">Axes</span><span class="p">):</span>
</span><span id="Track-1008"><a href="#Track-1008"><span class="linenos">1008</span></a>            <span class="n">_</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">subplot_kw</span><span class="o">=</span><span class="n">subplot_kw</span><span class="p">)</span>
</span><span id="Track-1009"><a href="#Track-1009"><span class="linenos">1009</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Track-1010"><a href="#Track-1010"><span class="linenos">1010</span></a>            <span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span>
</span><span id="Track-1011"><a href="#Track-1011"><span class="linenos">1011</span></a>        
</span><span id="Track-1012"><a href="#Track-1012"><span class="linenos">1012</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lon</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lat</span><span class="p">,</span> <span class="s1">&#39;.-&#39;</span><span class="p">)</span>
</span><span id="Track-1013"><a href="#Track-1013"><span class="linenos">1013</span></a>        
</span><span id="Track-1014"><a href="#Track-1014"><span class="linenos">1014</span></a>        <span class="k">return</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
</span><span id="Track-1015"><a href="#Track-1015"><span class="linenos">1015</span></a>
</span><span id="Track-1016"><a href="#Track-1016"><span class="linenos">1016</span></a>    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Track-1017"><a href="#Track-1017"><span class="linenos">1017</span></a><span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="Track-1018"><a href="#Track-1018"><span class="linenos">1018</span></a><span class="sd">        String representation for print function.</span>
</span><span id="Track-1019"><a href="#Track-1019"><span class="linenos">1019</span></a><span class="sd">        &#39;&#39;&#39;</span>
</span><span id="Track-1020"><a href="#Track-1020"><span class="linenos">1020</span></a>        <span class="n">out_str</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">record</span><span class="p">)</span> <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">records</span><span class="p">)</span>
</span><span id="Track-1021"><a href="#Track-1021"><span class="linenos">1021</span></a>        <span class="k">return</span><span class="p">(</span><span class="n">out_str</span><span class="p">)</span>
</span></pre></div>


    

                            <div id="Track.__init__" class="classattr">
                                        <input id="Track.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">Track</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">records</span></span>)</span>

                <label class="view-source-button" for="Track.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Track.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Track.__init__-749"><a href="#Track.__init__-749"><span class="linenos">749</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">records</span><span class="p">):</span>
</span><span id="Track.__init__-750"><a href="#Track.__init__-750"><span class="linenos">750</span></a><span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="Track.__init__-751"><a href="#Track.__init__-751"><span class="linenos">751</span></a><span class="sd">        Take a record or an array of record and provide track related functionalities.</span>
</span><span id="Track.__init__-752"><a href="#Track.__init__-752"><span class="linenos">752</span></a><span class="sd">        &#39;&#39;&#39;</span>
</span><span id="Track.__init__-753"><a href="#Track.__init__-753"><span class="linenos">753</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="Track.__init__-754"><a href="#Track.__init__-754"><span class="linenos">754</span></a>            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">records</span><span class="p">,</span> <span class="p">(</span><span class="n">Record</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">))</span>
</span><span id="Track.__init__-755"><a href="#Track.__init__-755"><span class="linenos">755</span></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="Track.__init__-756"><a href="#Track.__init__-756"><span class="linenos">756</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Records must be a single or an array of records&#39;</span><span class="p">)</span>
</span><span id="Track.__init__-757"><a href="#Track.__init__-757"><span class="linenos">757</span></a>
</span><span id="Track.__init__-758"><a href="#Track.__init__-758"><span class="linenos">758</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">records</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">records</span><span class="p">)</span>
</span><span id="Track.__init__-759"><a href="#Track.__init__-759"><span class="linenos">759</span></a>
</span><span id="Track.__init__-760"><a href="#Track.__init__-760"><span class="linenos">760</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="Track.__init__-761"><a href="#Track.__init__-761"><span class="linenos">761</span></a>            <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">([</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">Record</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">records</span><span class="p">])</span>
</span><span id="Track.__init__-762"><a href="#Track.__init__-762"><span class="linenos">762</span></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="Track.__init__-763"><a href="#Track.__init__-763"><span class="linenos">763</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The records must be an array of Record object&#39;</span><span class="p">)</span>
</span><span id="Track.__init__-764"><a href="#Track.__init__-764"><span class="linenos">764</span></a>
</span><span id="Track.__init__-765"><a href="#Track.__init__-765"><span class="linenos">765</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">timeindex</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">([</span><span class="n">record</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">records</span><span class="p">])</span>
</span><span id="Track.__init__-766"><a href="#Track.__init__-766"><span class="linenos">766</span></a>
</span><span id="Track.__init__-767"><a href="#Track.__init__-767"><span class="linenos">767</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span> <span class="c1"># To put all records in ascending order</span>
</span><span id="Track.__init__-768"><a href="#Track.__init__-768"><span class="linenos">768</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">calc_translation</span><span class="p">()</span> <span class="c1"># Recalculate translation speed</span>
</span></pre></div>


            <div class="docstring"><p>Take a record or an array of record and provide track related functionalities.</p>
</div>


                            </div>
                            <div id="Track.sort" class="classattr">
                                        <input id="Track.sort-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">sort</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Track.sort-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Track.sort"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Track.sort-834"><a href="#Track.sort-834"><span class="linenos">834</span></a>    <span class="k">def</span> <span class="nf">sort</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Track.sort-835"><a href="#Track.sort-835"><span class="linenos">835</span></a><span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="Track.sort-836"><a href="#Track.sort-836"><span class="linenos">836</span></a><span class="sd">        Apply time sorting and sort the records</span>
</span><span id="Track.sort-837"><a href="#Track.sort-837"><span class="linenos">837</span></a><span class="sd">        &#39;&#39;&#39;</span>
</span><span id="Track.sort-838"><a href="#Track.sort-838"><span class="linenos">838</span></a>        <span class="n">isort</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timeindex</span><span class="p">)</span>
</span><span id="Track.sort-839"><a href="#Track.sort-839"><span class="linenos">839</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">timeindex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeindex</span><span class="p">[</span><span class="n">isort</span><span class="p">]</span>
</span><span id="Track.sort-840"><a href="#Track.sort-840"><span class="linenos">840</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">records</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">records</span><span class="p">[</span><span class="n">isort</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>Apply time sorting and sort the records</p>
</div>


                            </div>
                            <div id="Track.calc_translation" class="classattr">
                                        <input id="Track.calc_translation-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">calc_translation</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Track.calc_translation-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Track.calc_translation"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Track.calc_translation-842"><a href="#Track.calc_translation-842"><span class="linenos">842</span></a>    <span class="k">def</span> <span class="nf">calc_translation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Track.calc_translation-843"><a href="#Track.calc_translation-843"><span class="linenos">843</span></a><span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="Track.calc_translation-844"><a href="#Track.calc_translation-844"><span class="linenos">844</span></a><span class="sd">        Calculate and update the ustorm, vstorm fields.</span>
</span><span id="Track.calc_translation-845"><a href="#Track.calc_translation-845"><span class="linenos">845</span></a><span class="sd">        &#39;&#39;&#39;</span>
</span><span id="Track.calc_translation-846"><a href="#Track.calc_translation-846"><span class="linenos">846</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">records</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
</span><span id="Track.calc_translation-847"><a href="#Track.calc_translation-847"><span class="linenos">847</span></a>            <span class="n">dt</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timeindex</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeindex</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span>
</span><span id="Track.calc_translation-848"><a href="#Track.calc_translation-848"><span class="linenos">848</span></a>            <span class="n">dtrans_x</span><span class="p">,</span> <span class="n">dtrans_y</span> <span class="o">=</span> <span class="n">gc_distance</span><span class="p">(</span>
</span><span id="Track.calc_translation-849"><a href="#Track.calc_translation-849"><span class="linenos">849</span></a>                <span class="n">of_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">records</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;lon&#39;</span><span class="p">],</span>
</span><span id="Track.calc_translation-850"><a href="#Track.calc_translation-850"><span class="linenos">850</span></a>                <span class="n">of_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">records</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;lat&#39;</span><span class="p">],</span>
</span><span id="Track.calc_translation-851"><a href="#Track.calc_translation-851"><span class="linenos">851</span></a>                <span class="n">origin_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">records</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;lon&#39;</span><span class="p">],</span>
</span><span id="Track.calc_translation-852"><a href="#Track.calc_translation-852"><span class="linenos">852</span></a>                <span class="n">origin_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">records</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span>
</span><span id="Track.calc_translation-853"><a href="#Track.calc_translation-853"><span class="linenos">853</span></a>            <span class="p">)</span>
</span><span id="Track.calc_translation-854"><a href="#Track.calc_translation-854"><span class="linenos">854</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">records</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;ustorm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dtrans_x</span><span class="o">/</span><span class="n">dt</span>
</span><span id="Track.calc_translation-855"><a href="#Track.calc_translation-855"><span class="linenos">855</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">records</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;vstorm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dtrans_y</span><span class="o">/</span><span class="n">dt</span>
</span><span id="Track.calc_translation-856"><a href="#Track.calc_translation-856"><span class="linenos">856</span></a>
</span><span id="Track.calc_translation-857"><a href="#Track.calc_translation-857"><span class="linenos">857</span></a>            <span class="c1"># For the last time step, we are keeping it to the same</span>
</span><span id="Track.calc_translation-858"><a href="#Track.calc_translation-858"><span class="linenos">858</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">records</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;ustorm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">records</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">][</span><span class="s1">&#39;ustorm&#39;</span><span class="p">]</span>
</span><span id="Track.calc_translation-859"><a href="#Track.calc_translation-859"><span class="linenos">859</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">records</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;vstorm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">records</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">][</span><span class="s1">&#39;vstorm&#39;</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>Calculate and update the ustorm, vstorm fields.</p>
</div>


                            </div>
                            <div id="Track.append" class="classattr">
                                        <input id="Track.append-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">append</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">records</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Track.append-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Track.append"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Track.append-861"><a href="#Track.append-861"><span class="linenos">861</span></a>    <span class="k">def</span> <span class="nf">append</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">records</span><span class="p">):</span>
</span><span id="Track.append-862"><a href="#Track.append-862"><span class="linenos">862</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="Track.append-863"><a href="#Track.append-863"><span class="linenos">863</span></a>            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">records</span><span class="p">,</span> <span class="p">(</span><span class="n">Record</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">))</span>
</span><span id="Track.append-864"><a href="#Track.append-864"><span class="linenos">864</span></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="Track.append-865"><a href="#Track.append-865"><span class="linenos">865</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Records must be a single or an array of records&#39;</span><span class="p">)</span>
</span><span id="Track.append-866"><a href="#Track.append-866"><span class="linenos">866</span></a>
</span><span id="Track.append-867"><a href="#Track.append-867"><span class="linenos">867</span></a>        <span class="n">records</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">records</span><span class="p">)</span>
</span><span id="Track.append-868"><a href="#Track.append-868"><span class="linenos">868</span></a>
</span><span id="Track.append-869"><a href="#Track.append-869"><span class="linenos">869</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="Track.append-870"><a href="#Track.append-870"><span class="linenos">870</span></a>            <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">([</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">Record</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">records</span><span class="p">])</span>
</span><span id="Track.append-871"><a href="#Track.append-871"><span class="linenos">871</span></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="Track.append-872"><a href="#Track.append-872"><span class="linenos">872</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The records must be an array of Record object&#39;</span><span class="p">)</span>
</span><span id="Track.append-873"><a href="#Track.append-873"><span class="linenos">873</span></a>
</span><span id="Track.append-874"><a href="#Track.append-874"><span class="linenos">874</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">records</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">records</span><span class="p">,</span> <span class="n">records</span><span class="p">)</span>
</span><span id="Track.append-875"><a href="#Track.append-875"><span class="linenos">875</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">timeindex</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">([</span><span class="n">record</span><span class="o">.</span><span class="n">timestamp</span> <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">records</span><span class="p">])</span>
</span><span id="Track.append-876"><a href="#Track.append-876"><span class="linenos">876</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span> <span class="c1"># To put all record in ascending order</span>
</span><span id="Track.append-877"><a href="#Track.append-877"><span class="linenos">877</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">calc_translation</span><span class="p">()</span> <span class="c1"># Recalculate translation speed</span>
</span></pre></div>


    

                            </div>
                            <div id="Track.interpolate" class="classattr">
                                        <input id="Track.interpolate-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">interpolate</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">at</span>, </span><span class="param"><span class="o">**</span><span class="n">kwargs</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Track.interpolate-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Track.interpolate"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Track.interpolate-879"><a href="#Track.interpolate-879"><span class="linenos"> 879</span></a>    <span class="k">def</span> <span class="nf">interpolate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">at</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="Track.interpolate-880"><a href="#Track.interpolate-880"><span class="linenos"> 880</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="Track.interpolate-881"><a href="#Track.interpolate-881"><span class="linenos"> 881</span></a>            <span class="n">at</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">at</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="Track.interpolate-882"><a href="#Track.interpolate-882"><span class="linenos"> 882</span></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="Track.interpolate-883"><a href="#Track.interpolate-883"><span class="linenos"> 883</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;`at` must be parsable by pd.to_datetime&#39;</span><span class="p">)</span>
</span><span id="Track.interpolate-884"><a href="#Track.interpolate-884"><span class="linenos"> 884</span></a>
</span><span id="Track.interpolate-885"><a href="#Track.interpolate-885"><span class="linenos"> 885</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="Track.interpolate-886"><a href="#Track.interpolate-886"><span class="linenos"> 886</span></a>            <span class="k">assert</span> <span class="n">at</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeindex</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="Track.interpolate-887"><a href="#Track.interpolate-887"><span class="linenos"> 887</span></a>            <span class="k">assert</span> <span class="n">at</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeindex</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Track.interpolate-888"><a href="#Track.interpolate-888"><span class="linenos"> 888</span></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="Track.interpolate-889"><a href="#Track.interpolate-889"><span class="linenos"> 889</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Out of interpolation range&#39;</span><span class="p">)</span>
</span><span id="Track.interpolate-890"><a href="#Track.interpolate-890"><span class="linenos"> 890</span></a>
</span><span id="Track.interpolate-891"><a href="#Track.interpolate-891"><span class="linenos"> 891</span></a>        <span class="c1"># Calculate the corresponding indices</span>
</span><span id="Track.interpolate-892"><a href="#Track.interpolate-892"><span class="linenos"> 892</span></a>        <span class="n">i_right</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">timeindex</span><span class="p">,</span> <span class="n">v</span><span class="o">=</span><span class="n">at</span><span class="p">,</span> <span class="n">side</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
</span><span id="Track.interpolate-893"><a href="#Track.interpolate-893"><span class="linenos"> 893</span></a>
</span><span id="Track.interpolate-894"><a href="#Track.interpolate-894"><span class="linenos"> 894</span></a>        <span class="k">if</span> <span class="n">i_right</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Track.interpolate-895"><a href="#Track.interpolate-895"><span class="linenos"> 895</span></a>            <span class="n">i_left</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Track.interpolate-896"><a href="#Track.interpolate-896"><span class="linenos"> 896</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Track.interpolate-897"><a href="#Track.interpolate-897"><span class="linenos"> 897</span></a>            <span class="n">i_left</span> <span class="o">=</span> <span class="n">i_right</span> <span class="o">-</span> <span class="mi">1</span>
</span><span id="Track.interpolate-898"><a href="#Track.interpolate-898"><span class="linenos"> 898</span></a>
</span><span id="Track.interpolate-899"><a href="#Track.interpolate-899"><span class="linenos"> 899</span></a>        <span class="c1"># Calculate the corresponding weights</span>
</span><span id="Track.interpolate-900"><a href="#Track.interpolate-900"><span class="linenos"> 900</span></a>        <span class="n">v_left</span><span class="p">,</span> <span class="n">v_right</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeindex</span><span class="p">[[</span><span class="n">i_left</span><span class="p">,</span> <span class="n">i_right</span><span class="p">]]</span>
</span><span id="Track.interpolate-901"><a href="#Track.interpolate-901"><span class="linenos"> 901</span></a>        
</span><span id="Track.interpolate-902"><a href="#Track.interpolate-902"><span class="linenos"> 902</span></a>        <span class="k">if</span><span class="p">(</span><span class="n">i_left</span> <span class="o">&lt;</span> <span class="n">i_right</span><span class="p">):</span>
</span><span id="Track.interpolate-903"><a href="#Track.interpolate-903"><span class="linenos"> 903</span></a>            <span class="n">td_right</span> <span class="o">=</span> <span class="p">(</span><span class="n">v_right</span> <span class="o">-</span> <span class="n">at</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span> <span class="c1"># Timedelta to seconds</span>
</span><span id="Track.interpolate-904"><a href="#Track.interpolate-904"><span class="linenos"> 904</span></a>            <span class="n">td_total</span> <span class="o">=</span>  <span class="p">(</span><span class="n">v_right</span> <span class="o">-</span> <span class="n">v_left</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span> <span class="c1"># Timedelta to seconds</span>
</span><span id="Track.interpolate-905"><a href="#Track.interpolate-905"><span class="linenos"> 905</span></a>            <span class="n">w_left</span> <span class="o">=</span> <span class="n">td_right</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">td_total</span><span class="p">)</span>
</span><span id="Track.interpolate-906"><a href="#Track.interpolate-906"><span class="linenos"> 906</span></a>            <span class="n">w_right</span> <span class="o">=</span> <span class="mi">1</span><span class="o">-</span><span class="n">w_left</span>
</span><span id="Track.interpolate-907"><a href="#Track.interpolate-907"><span class="linenos"> 907</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Track.interpolate-908"><a href="#Track.interpolate-908"><span class="linenos"> 908</span></a>            <span class="n">w_left</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span id="Track.interpolate-909"><a href="#Track.interpolate-909"><span class="linenos"> 909</span></a>            <span class="n">w_right</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="Track.interpolate-910"><a href="#Track.interpolate-910"><span class="linenos"> 910</span></a>
</span><span id="Track.interpolate-911"><a href="#Track.interpolate-911"><span class="linenos"> 911</span></a>        <span class="c1"># Create Record for the necessary fields with direct interpolation</span>
</span><span id="Track.interpolate-912"><a href="#Track.interpolate-912"><span class="linenos"> 912</span></a>        <span class="n">int_record</span> <span class="o">=</span> <span class="n">Record</span><span class="p">(</span>
</span><span id="Track.interpolate-913"><a href="#Track.interpolate-913"><span class="linenos"> 913</span></a>            <span class="n">timestamp</span><span class="o">=</span><span class="n">at</span><span class="p">,</span>
</span><span id="Track.interpolate-914"><a href="#Track.interpolate-914"><span class="linenos"> 914</span></a>            <span class="n">lon</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">records</span><span class="p">[</span><span class="n">i_left</span><span class="p">][</span><span class="s1">&#39;lon&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">w_left</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">records</span><span class="p">[</span><span class="n">i_right</span><span class="p">][</span><span class="s1">&#39;lon&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">w_right</span><span class="p">,</span>
</span><span id="Track.interpolate-915"><a href="#Track.interpolate-915"><span class="linenos"> 915</span></a>            <span class="n">lat</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">records</span><span class="p">[</span><span class="n">i_left</span><span class="p">][</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">w_left</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">records</span><span class="p">[</span><span class="n">i_right</span><span class="p">][</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">w_right</span><span class="p">,</span>
</span><span id="Track.interpolate-916"><a href="#Track.interpolate-916"><span class="linenos"> 916</span></a>            <span class="n">mslp</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">records</span><span class="p">[</span><span class="n">i_left</span><span class="p">][</span><span class="s1">&#39;mslp&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">w_left</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">records</span><span class="p">[</span><span class="n">i_right</span><span class="p">][</span><span class="s1">&#39;mslp&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">w_right</span><span class="p">,</span>
</span><span id="Track.interpolate-917"><a href="#Track.interpolate-917"><span class="linenos"> 917</span></a>            <span class="n">vmax</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">records</span><span class="p">[</span><span class="n">i_left</span><span class="p">][</span><span class="s1">&#39;vmax&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">w_left</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">records</span><span class="p">[</span><span class="n">i_right</span><span class="p">][</span><span class="s1">&#39;vmax&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">w_right</span><span class="p">,</span>
</span><span id="Track.interpolate-918"><a href="#Track.interpolate-918"><span class="linenos"> 918</span></a>            <span class="n">rmax</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">records</span><span class="p">[</span><span class="n">i_left</span><span class="p">][</span><span class="s1">&#39;rmax&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">w_left</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">records</span><span class="p">[</span><span class="n">i_right</span><span class="p">][</span><span class="s1">&#39;rmax&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">w_right</span><span class="p">,</span>
</span><span id="Track.interpolate-919"><a href="#Track.interpolate-919"><span class="linenos"> 919</span></a>            <span class="n">ustorm</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">records</span><span class="p">[</span><span class="n">i_left</span><span class="p">][</span><span class="s1">&#39;ustorm&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">w_left</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">records</span><span class="p">[</span><span class="n">i_right</span><span class="p">][</span><span class="s1">&#39;ustorm&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">w_right</span><span class="p">,</span>
</span><span id="Track.interpolate-920"><a href="#Track.interpolate-920"><span class="linenos"> 920</span></a>            <span class="n">vstorm</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">records</span><span class="p">[</span><span class="n">i_left</span><span class="p">][</span><span class="s1">&#39;vstorm&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">w_left</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">records</span><span class="p">[</span><span class="n">i_right</span><span class="p">][</span><span class="s1">&#39;vstorm&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">w_right</span>
</span><span id="Track.interpolate-921"><a href="#Track.interpolate-921"><span class="linenos"> 921</span></a>        <span class="p">)</span>
</span><span id="Track.interpolate-922"><a href="#Track.interpolate-922"><span class="linenos"> 922</span></a>
</span><span id="Track.interpolate-923"><a href="#Track.interpolate-923"><span class="linenos"> 923</span></a>        <span class="c1"># now interpolate vinfo and radinfo</span>
</span><span id="Track.interpolate-924"><a href="#Track.interpolate-924"><span class="linenos"> 924</span></a>        <span class="c1"># export np.nan if not available</span>
</span><span id="Track.interpolate-925"><a href="#Track.interpolate-925"><span class="linenos"> 925</span></a>        <span class="n">vinfo_left</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">records</span><span class="p">[</span><span class="n">i_left</span><span class="p">][</span><span class="s1">&#39;vinfo&#39;</span><span class="p">]</span>
</span><span id="Track.interpolate-926"><a href="#Track.interpolate-926"><span class="linenos"> 926</span></a>        <span class="n">lvinfo_left</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">vinfo_left</span><span class="p">)</span>
</span><span id="Track.interpolate-927"><a href="#Track.interpolate-927"><span class="linenos"> 927</span></a>        <span class="n">vinfo_right</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">records</span><span class="p">[</span><span class="n">i_right</span><span class="p">][</span><span class="s1">&#39;vinfo&#39;</span><span class="p">]</span>
</span><span id="Track.interpolate-928"><a href="#Track.interpolate-928"><span class="linenos"> 928</span></a>        <span class="n">lvinfo_right</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">vinfo_right</span><span class="p">)</span>
</span><span id="Track.interpolate-929"><a href="#Track.interpolate-929"><span class="linenos"> 929</span></a>        <span class="n">radinfo_left</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_2d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">records</span><span class="p">[</span><span class="n">i_left</span><span class="p">][</span><span class="s1">&#39;radinfo&#39;</span><span class="p">])</span>
</span><span id="Track.interpolate-930"><a href="#Track.interpolate-930"><span class="linenos"> 930</span></a>        <span class="n">sradinfo_left</span> <span class="o">=</span> <span class="n">radinfo_left</span><span class="o">.</span><span class="n">shape</span>
</span><span id="Track.interpolate-931"><a href="#Track.interpolate-931"><span class="linenos"> 931</span></a>        <span class="n">radinfo_right</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_2d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">records</span><span class="p">[</span><span class="n">i_right</span><span class="p">][</span><span class="s1">&#39;radinfo&#39;</span><span class="p">])</span>
</span><span id="Track.interpolate-932"><a href="#Track.interpolate-932"><span class="linenos"> 932</span></a>        <span class="n">sradinfo_right</span> <span class="o">=</span> <span class="n">radinfo_right</span><span class="o">.</span><span class="n">shape</span>
</span><span id="Track.interpolate-933"><a href="#Track.interpolate-933"><span class="linenos"> 933</span></a>
</span><span id="Track.interpolate-934"><a href="#Track.interpolate-934"><span class="linenos"> 934</span></a>        <span class="c1"># Checking if the left and right are same size</span>
</span><span id="Track.interpolate-935"><a href="#Track.interpolate-935"><span class="linenos"> 935</span></a>        <span class="k">if</span> <span class="n">lvinfo_left</span> <span class="o">==</span> <span class="n">lvinfo_right</span><span class="p">:</span>
</span><span id="Track.interpolate-936"><a href="#Track.interpolate-936"><span class="linenos"> 936</span></a>            <span class="n">vinfo_diff</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Track.interpolate-937"><a href="#Track.interpolate-937"><span class="linenos"> 937</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Track.interpolate-938"><a href="#Track.interpolate-938"><span class="linenos"> 938</span></a>            <span class="n">vinfo_diff</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Track.interpolate-939"><a href="#Track.interpolate-939"><span class="linenos"> 939</span></a>
</span><span id="Track.interpolate-940"><a href="#Track.interpolate-940"><span class="linenos"> 940</span></a>        <span class="c1"># Interpolating</span>
</span><span id="Track.interpolate-941"><a href="#Track.interpolate-941"><span class="linenos"> 941</span></a>        <span class="k">if</span> <span class="n">vinfo_diff</span><span class="p">:</span>
</span><span id="Track.interpolate-942"><a href="#Track.interpolate-942"><span class="linenos"> 942</span></a>            <span class="c1"># vinfo size is different more check is needed</span>
</span><span id="Track.interpolate-943"><a href="#Track.interpolate-943"><span class="linenos"> 943</span></a>            <span class="n">min_vinfo_length</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">([</span><span class="n">lvinfo_left</span><span class="p">,</span> <span class="n">lvinfo_right</span><span class="p">])</span>
</span><span id="Track.interpolate-944"><a href="#Track.interpolate-944"><span class="linenos"> 944</span></a>            <span class="n">vinfo</span> <span class="o">=</span> <span class="n">vinfo_left</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">min_vinfo_length</span><span class="p">]</span>
</span><span id="Track.interpolate-945"><a href="#Track.interpolate-945"><span class="linenos"> 945</span></a>
</span><span id="Track.interpolate-946"><a href="#Track.interpolate-946"><span class="linenos"> 946</span></a>            <span class="c1"># First find which one is the longer and set radinfo size</span>
</span><span id="Track.interpolate-947"><a href="#Track.interpolate-947"><span class="linenos"> 947</span></a>            <span class="k">if</span> <span class="n">lvinfo_left</span> <span class="o">&gt;</span> <span class="n">lvinfo_right</span><span class="p">:</span>
</span><span id="Track.interpolate-948"><a href="#Track.interpolate-948"><span class="linenos"> 948</span></a>                <span class="n">radinfo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">min_vinfo_length</span><span class="p">,</span> <span class="n">sradinfo_left</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
</span><span id="Track.interpolate-949"><a href="#Track.interpolate-949"><span class="linenos"> 949</span></a>            <span class="k">elif</span> <span class="n">lvinfo_left</span> <span class="o">&lt;</span> <span class="n">lvinfo_right</span><span class="p">:</span>
</span><span id="Track.interpolate-950"><a href="#Track.interpolate-950"><span class="linenos"> 950</span></a>                <span class="n">radinfo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">min_vinfo_length</span><span class="p">,</span> <span class="n">sradinfo_right</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
</span><span id="Track.interpolate-951"><a href="#Track.interpolate-951"><span class="linenos"> 951</span></a>
</span><span id="Track.interpolate-952"><a href="#Track.interpolate-952"><span class="linenos"> 952</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">min_vinfo_length</span><span class="p">):</span>
</span><span id="Track.interpolate-953"><a href="#Track.interpolate-953"><span class="linenos"> 953</span></a>                    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">vinfo_left</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">vinfo_right</span><span class="p">[</span><span class="n">i</span><span class="p">])]):</span>
</span><span id="Track.interpolate-954"><a href="#Track.interpolate-954"><span class="linenos"> 954</span></a>                        <span class="n">radinfo</span> <span class="o">=</span> <span class="n">radinfo</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span>
</span><span id="Track.interpolate-955"><a href="#Track.interpolate-955"><span class="linenos"> 955</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="Track.interpolate-956"><a href="#Track.interpolate-956"><span class="linenos"> 956</span></a>                        <span class="n">vinfo</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">vinfo_left</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="Track.interpolate-957"><a href="#Track.interpolate-957"><span class="linenos"> 957</span></a>                        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">radinfo</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
</span><span id="Track.interpolate-958"><a href="#Track.interpolate-958"><span class="linenos"> 958</span></a>                            <span class="n">radinfo</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">radinfo_left</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="n">w_left</span> <span class="o">+</span> <span class="n">radinfo_right</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="n">w_right</span>
</span><span id="Track.interpolate-959"><a href="#Track.interpolate-959"><span class="linenos"> 959</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Track.interpolate-960"><a href="#Track.interpolate-960"><span class="linenos"> 960</span></a>            <span class="c1"># vinfo size is same</span>
</span><span id="Track.interpolate-961"><a href="#Track.interpolate-961"><span class="linenos"> 961</span></a>            <span class="n">len_vinfo</span> <span class="o">=</span> <span class="n">lvinfo_left</span>
</span><span id="Track.interpolate-962"><a href="#Track.interpolate-962"><span class="linenos"> 962</span></a>            <span class="c1"># If the both of them has length 1</span>
</span><span id="Track.interpolate-963"><a href="#Track.interpolate-963"><span class="linenos"> 963</span></a>            <span class="k">if</span> <span class="n">len_vinfo</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Track.interpolate-964"><a href="#Track.interpolate-964"><span class="linenos"> 964</span></a>                <span class="c1"># Return missing if vinfo itselft is missing</span>
</span><span id="Track.interpolate-965"><a href="#Track.interpolate-965"><span class="linenos"> 965</span></a>                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">vinfo_left</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">vinfo_right</span><span class="p">[</span><span class="mi">0</span><span class="p">])]):</span>
</span><span id="Track.interpolate-966"><a href="#Track.interpolate-966"><span class="linenos"> 966</span></a>                    <span class="n">vinfo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
</span><span id="Track.interpolate-967"><a href="#Track.interpolate-967"><span class="linenos"> 967</span></a>                    <span class="n">radinfo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
</span><span id="Track.interpolate-968"><a href="#Track.interpolate-968"><span class="linenos"> 968</span></a>                <span class="c1"># Or set to zero</span>
</span><span id="Track.interpolate-969"><a href="#Track.interpolate-969"><span class="linenos"> 969</span></a>                <span class="k">elif</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">([</span><span class="n">vinfo_left</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">,</span> <span class="n">vinfo_right</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="Track.interpolate-970"><a href="#Track.interpolate-970"><span class="linenos"> 970</span></a>                    <span class="n">vinfo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
</span><span id="Track.interpolate-971"><a href="#Track.interpolate-971"><span class="linenos"> 971</span></a>                    <span class="n">radinfo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
</span><span id="Track.interpolate-972"><a href="#Track.interpolate-972"><span class="linenos"> 972</span></a>                <span class="c1"># Otherwise calculate the linear interpolation</span>
</span><span id="Track.interpolate-973"><a href="#Track.interpolate-973"><span class="linenos"> 973</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Track.interpolate-974"><a href="#Track.interpolate-974"><span class="linenos"> 974</span></a>                    <span class="n">vinfo</span> <span class="o">=</span> <span class="n">vinfo_left</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Track.interpolate-975"><a href="#Track.interpolate-975"><span class="linenos"> 975</span></a>                    <span class="n">radinfo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">radinfo_left</span><span class="p">)</span>
</span><span id="Track.interpolate-976"><a href="#Track.interpolate-976"><span class="linenos"> 976</span></a>                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">sradinfo_left</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="Track.interpolate-977"><a href="#Track.interpolate-977"><span class="linenos"> 977</span></a>                        <span class="n">radinfo</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">radinfo_left</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="n">w_left</span> <span class="o">+</span> <span class="n">radinfo_right</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="n">w_right</span>
</span><span id="Track.interpolate-978"><a href="#Track.interpolate-978"><span class="linenos"> 978</span></a>            <span class="k">elif</span> <span class="n">len_vinfo</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Track.interpolate-979"><a href="#Track.interpolate-979"><span class="linenos"> 979</span></a>                <span class="c1"># If both of them as length &gt; 1</span>
</span><span id="Track.interpolate-980"><a href="#Track.interpolate-980"><span class="linenos"> 980</span></a>                <span class="n">vinfo</span> <span class="o">=</span> <span class="n">vinfo_left</span>
</span><span id="Track.interpolate-981"><a href="#Track.interpolate-981"><span class="linenos"> 981</span></a>                <span class="n">shape_radinfo</span> <span class="o">=</span> <span class="p">(</span><span class="n">lvinfo_left</span><span class="p">,</span> <span class="n">sradinfo_left</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="Track.interpolate-982"><a href="#Track.interpolate-982"><span class="linenos"> 982</span></a>                <span class="n">radinfo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">shape_radinfo</span><span class="p">)</span>
</span><span id="Track.interpolate-983"><a href="#Track.interpolate-983"><span class="linenos"> 983</span></a>                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">vinfo</span><span class="p">):</span>
</span><span id="Track.interpolate-984"><a href="#Track.interpolate-984"><span class="linenos"> 984</span></a>                    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">vinfo_left</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">vinfo_right</span><span class="p">[</span><span class="n">i</span><span class="p">])]):</span>
</span><span id="Track.interpolate-985"><a href="#Track.interpolate-985"><span class="linenos"> 985</span></a>                        <span class="n">radinfo</span> <span class="o">=</span> <span class="n">radinfo</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span>
</span><span id="Track.interpolate-986"><a href="#Track.interpolate-986"><span class="linenos"> 986</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="Track.interpolate-987"><a href="#Track.interpolate-987"><span class="linenos"> 987</span></a>                        <span class="n">vinfo</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">vinfo_left</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="Track.interpolate-988"><a href="#Track.interpolate-988"><span class="linenos"> 988</span></a>                        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">shape_radinfo</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
</span><span id="Track.interpolate-989"><a href="#Track.interpolate-989"><span class="linenos"> 989</span></a>                            <span class="n">radinfo</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">radinfo_left</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="n">w_left</span> <span class="o">+</span> <span class="n">radinfo_right</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="n">w_right</span>
</span><span id="Track.interpolate-990"><a href="#Track.interpolate-990"><span class="linenos"> 990</span></a>        
</span><span id="Track.interpolate-991"><a href="#Track.interpolate-991"><span class="linenos"> 991</span></a>        <span class="c1"># Providing the same as the dataset if interpolated on a given time</span>
</span><span id="Track.interpolate-992"><a href="#Track.interpolate-992"><span class="linenos"> 992</span></a>        <span class="k">if</span> <span class="n">w_right</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Track.interpolate-993"><a href="#Track.interpolate-993"><span class="linenos"> 993</span></a>            <span class="n">vinfo</span> <span class="o">=</span> <span class="n">vinfo_right</span>
</span><span id="Track.interpolate-994"><a href="#Track.interpolate-994"><span class="linenos"> 994</span></a>            <span class="n">radinfo</span> <span class="o">=</span> <span class="n">radinfo_right</span>
</span><span id="Track.interpolate-995"><a href="#Track.interpolate-995"><span class="linenos"> 995</span></a>        <span class="k">elif</span> <span class="n">w_left</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Track.interpolate-996"><a href="#Track.interpolate-996"><span class="linenos"> 996</span></a>            <span class="n">vinfo</span> <span class="o">=</span> <span class="n">vinfo_left</span>
</span><span id="Track.interpolate-997"><a href="#Track.interpolate-997"><span class="linenos"> 997</span></a>            <span class="n">radinfo</span> <span class="o">=</span> <span class="n">radinfo_left</span>
</span><span id="Track.interpolate-998"><a href="#Track.interpolate-998"><span class="linenos"> 998</span></a>
</span><span id="Track.interpolate-999"><a href="#Track.interpolate-999"><span class="linenos"> 999</span></a>        <span class="c1"># Updating int_record with vinfo, radinfo</span>
</span><span id="Track.interpolate-1000"><a href="#Track.interpolate-1000"><span class="linenos">1000</span></a>        <span class="n">int_record</span><span class="p">[</span><span class="s1">&#39;vinfo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">vinfo</span>
</span><span id="Track.interpolate-1001"><a href="#Track.interpolate-1001"><span class="linenos">1001</span></a>        <span class="n">int_record</span><span class="p">[</span><span class="s1">&#39;radinfo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">radinfo</span>
</span><span id="Track.interpolate-1002"><a href="#Track.interpolate-1002"><span class="linenos">1002</span></a>
</span><span id="Track.interpolate-1003"><a href="#Track.interpolate-1003"><span class="linenos">1003</span></a>        <span class="c1"># Return the record file for rest of the calculations</span>
</span><span id="Track.interpolate-1004"><a href="#Track.interpolate-1004"><span class="linenos">1004</span></a>        <span class="k">return</span><span class="p">(</span><span class="n">int_record</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="Track.plot" class="classattr">
                                        <input id="Track.plot-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">plot</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">ax</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">subplot_kw</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;projection&#39;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">cartopy</span><span class="o">.</span><span class="n">crs</span><span class="o">.</span><span class="n">PlateCarree</span> <span class="nb">object</span> <span class="n">at</span> <span class="mh">0x0000022CCC6DF1C8</span><span class="o">&gt;</span><span class="p">}</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Track.plot-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Track.plot"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Track.plot-1006"><a href="#Track.plot-1006"><span class="linenos">1006</span></a>    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">subplot_kw</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;projection&#39;</span><span class="p">:</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">()}):</span>
</span><span id="Track.plot-1007"><a href="#Track.plot-1007"><span class="linenos">1007</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">plt</span><span class="o">.</span><span class="n">Axes</span><span class="p">):</span>
</span><span id="Track.plot-1008"><a href="#Track.plot-1008"><span class="linenos">1008</span></a>            <span class="n">_</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">subplot_kw</span><span class="o">=</span><span class="n">subplot_kw</span><span class="p">)</span>
</span><span id="Track.plot-1009"><a href="#Track.plot-1009"><span class="linenos">1009</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Track.plot-1010"><a href="#Track.plot-1010"><span class="linenos">1010</span></a>            <span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span>
</span><span id="Track.plot-1011"><a href="#Track.plot-1011"><span class="linenos">1011</span></a>        
</span><span id="Track.plot-1012"><a href="#Track.plot-1012"><span class="linenos">1012</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lon</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lat</span><span class="p">,</span> <span class="s1">&#39;.-&#39;</span><span class="p">)</span>
</span><span id="Track.plot-1013"><a href="#Track.plot-1013"><span class="linenos">1013</span></a>        
</span><span id="Track.plot-1014"><a href="#Track.plot-1014"><span class="linenos">1014</span></a>        <span class="k">return</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "../../search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `../../${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.kind) {
                    case "function":
                        if (doc.fullname.endsWith(".__init__")) {
                            heading = `<span class="name">${doc.fullname.replace(/\.__init__$/, "")}</span>${doc.signature}`;
                        } else {
                            heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span>${doc.signature}`;
                        }
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value">${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.kind}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>